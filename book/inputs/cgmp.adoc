= CGMP

== Understanding

CGMP is a protocol used on Cisco routers and multilayer switches connected to
Layer 2 Catalyst switches to perform tasks similar to those performed by IGMP.
CGMP permits Layer 2 group membership information to be communicated from the
CGMP server to the switch, which can learn on which ports multicast members
reside instead of flooding multicast traffic to all switch ports. 

IGMP snooping is another method to constrain the flooding of multicast packets.


=== Joining a Group with CGMP

Hosts connected to a Layer 2 Catalyst switch can join a multicast group by
sending an unsolicited IGMP membership report message to the target group
(224.1.2.3) as shown in Figure 33-7. Because LAN switches operate at Layer 2
and understand only MAC addresses, the source and destination fields of the
frame contain 48-bit MAC addresses for Host 3 (0080.c7a2.1093) and MAC-address
equivalent of the multicast group address (0100.5e01.0203).

The IGMP membership report is received by the Layer 2 switch and forwarded to
the CGMP server for normal IGMP processing. The CGMP server, which must have
CGMP enabled on the interface connected to the Layer 2 switch, receives the
membership report and translates the report into a CGMP join message. It sends
the CGMP join message to the switch through the well-known CGMP multicast MAC
address (0x0100.0cdd.dddd). When the Layer 2 switch receives the join message,
it updates its forwarding table to include the MAC-equivalent of the group
destination address and the applicable input and output switch ports.

.Host Joining a Group Using CGMP
image::cgmp-host-joining-a-group.png[]

=== Leaving a Group with CGMP

When an IGMPv2 host leaves a group, it can send an IGMP leave group message to
the all-multicast-routers group (224.0.0.2). The CGMP server translates this
leave group message into a CGMP leave message and sends it to the switch.

To expedite a host on a LAN leaving a multicast group, some Layer 2 Catalyst
switch software offers the CGMP Fast-Leave feature, which allows the switch to
perform IGMPv2 leave processing locally without involving the CGMP server and
accelerates the removal of unused CGMP groups. The host sends the leave group
message to the all-multicast-routers group (224.0.0.2). The Layer 2 switch
processes it and does not forward it to the CGMP server. The Layer 2 switch
sends an IGMP general query message on the port where the leave message was
received to determine if there are remaining members for the group on the port.
If no response is received, the Layer 2 switch sends an IGMP leave message to
the CGMP server, which sends a group-specific query to the multicast group to
see if there are any remaining members in the group. If there is no response,
the CGMP server updates its multicast routing table and sends a CGMP delete
group message to the Layer 2 switch, which updates its routing table. 



== Configuring

xxx




