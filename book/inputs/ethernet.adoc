= Ethernet

- IEEE 802.3 standards
- CSMA/CD protocol
- Medium: coaxial, twisted-pair, optical fiber
- Data rates: 10/100/1000/10000 Mbps

== Frame Formats

// TODO: Add the reference to 802.2 later
// image::ethernet-framing-options.png["Ethernet framing options"]

.Ethernet (DIX) and Revised (1997) IEEE 802.3
["graphviz", target= 'ethernet-dix-and-revised-802.3']
----
digraph g {
  node [shape = record,height=.1];
  node0 [label = "8\nPreamble | 6\nDA | 6\nSA | 2\nType/Length | 46-1500\nData and Padding | 4\nFCS"];
}
----

.Original IEEE 802.3
["graphviz", target= 'ethernet-ieee802.3-extended']
----
digraph g {
  node [shape = record,height=.1];
  node0[label = "7\nPreamble | 1\nSD | 6\nDA | 6\nSA | 2\nLength | 1\nDSAP | 1\nSSAP| 1-2\nControl| 43-1500\nData and Padding | 4\nFCS"];
}
----

.IEEE 802.3 with SNAP
["graphviz", target= 'ethernet-ieee802.3-snap']
----
digraph g {
  node [shape = record,height=.1];
  node0[label = "7\nPreamble | 1\nSD | 6\nDA | 6\nSA | 2\nLength | 1\nDSAP | 1\nSSAP| 1-2\nControl| 3\nOUI | 2\nType|   38-1500\nData and Padding | 4\nFCS"];
}
----

Preamble DIX or Preamble and Start of Frame Delimiter(802.3)::
- 62 alternating 1s and 0s, and ends with a pair of 1s.
- For clocking synchronization of the transmitted signal.

Type::
- Type of protocol

Length::
- Length in bytes of the data following the Length field, up to the Ethernet trailer.

DA::
- Destination address can be an individual or group address

SA::
- Source address is always unicast address

DSAP::
- Destination Service Access Protocol
- The size limitations, along with other Point (802.2) uses of the low-order bits, required the later addition of SNAP headers.

SSAP::
- Source Service Access Protocol
- Describes the upper-layer protocol Point (802.2) that created the frame.

Control::
- Enables both connectionless and connection-oriented operation.
- Generally used only for connectionless operation by modern protocols, with a 1-byte value of 0x03.

SNAP OUI ::
- Generally unused today,
- Providing a place for the sender of the frame to code the OUI representing the manufacturer of the Ethernet NIC.

SNAP Type::
- Using same values as the DIX Type field, overcoming deficiencies with size and use of the DSAP field.

Data::
- N bytes where 46 <= n <= 1500
- If n < 46, use padding

FCS (Frame check sequence)::
- Contains a 32-bit cyclic redundancy check (CRC) value
- Calculated by the sending MAC
- Re-calculated by the receiving MAC to check for damaged frames.
- Generated from the DA, SA, Length/Type, and Data fields

== Ethernet MAC Addresses

- 48 bits in hexadecimal
- Canonical transmission (little endian)= MSO to LSO with LSB to MSB for each octet where

** I/G bit: (0/1) Individual or Group address, first bit to be transmitted as LSB of MSO
** U/L bit: (0/1) Universally or Locally administrated, second bit to be transmitted

----
Example: AC-10-7B-3A-92-3C

Convert to Hexa : 10101100 00010000 01101011 00111010 01010010 00111100
Transmission    : 00110101 00001000 11010110 01011100 01001010 00111100
----

.Task: Change the MAC address
----
(config-if)# mac-address AC-10-BE-EF-DE-AD
----
[NOTE]
Even if you change the MAC address of the swithch port,
STP will continue to use the BIA.

=== Types of MAC addresses

- Unicast : I/G bit = 0
- Multicast: I/G bit = 1
- Broadcast: all devices in the segment

== RJ-45 pinouts and Cat5 wiring

- Defined by http://www.eia.org[EIA] / http://www.tiaonline.org[TIA]

image::ethernet-pinouts.png["Ehernet and ISO", height=50]

.Ethernet cabling types
[cols="20,50,40"]
|===
| Type of cable    | Pinouts                               | Key pins connected

| Straight-through | T568A or T568B both ends              | 1-1; 2-2; 3-3; 6-6
| Cross-over       | T568A on one end,  T568B on the other | 1-3; 2-6; 3-1; 6-2
|===

- Auto-MDIX (automatic medium-dependent interface crossover)
** Detects the wrong cable and causes the switch to swap the pair it uses for transmitting and receiving
** Not supported on all Cisco switch models

== Auto-negotiation, Speed and Duplex

- By default, Ethernet auto-negotiation uses FLP (Fast Link Pulses)to determine the speed and duplex setting.
- To disable auto-negotiation, manually configure the speed and the duplex settings.

- if auto-negotation is disabled on one end by statically setting the speed , the other end
  ** detects the speed based on the incoming electrical signal
  ** sets duplex to half for 10 and 100 Mbps and full duplex for 1Gps interfaces

- if auto-negotation is disabled on both end and different speeds statically configured, link down

.Task: Set speed for the interface
----
(config-if)# speed {10 | 100 | 1000 | auto | nonegotiate}
----

.Task: Set duplex mode for the interface
----
(config-if)# duplex {auto | full | half}
----

.Task: Show controllers
----
Router# show controllers fastethernet1
!
Interface FastEthernet1   MARVELL 88E6052
Link is DOWN
Port is undergoing Negotiation or Link down
Speed :Not set, Duplex :Not set
!
Switch PHY Registers:
~~~~~~~~~~~~~~~~~~~~~
00 : 3100   01 : 7849   02 : 0141   03 : 0C1F   04 : 01E1
05 : 0000   06 : 0004   07 : 2001   08 : 0000   16 : 0130
17 : 0002   18 : 0000   19 : 0040   20 : 0000   21 : 0000
!
Switch Port Registers:
~~~~~~~~~~~~~~~~~~~~~~
Port Status Register       [00] : 0800
Switch Identifier Register [03] : 0520
Port Control Register      [04] : 007F
Rx Counter Register        [16] : 000A
Tx Counter Register        [17] : 0008
----

== Switch internal processing

Switches forward frames when necessary, and do not forward when there is no need to do so, thus
reducing overhead.

To accomplish this, switches perform three actions:

- Learn MAC addresses by examining the source MAC address of each received frame
- Decide when to forward a frame or when to filter (not forward) a frame, based on the destination MAC address
- Create a loop-free environment with other bridges by using the Spanning Tree Protocol

[horizontal]

Store-and-forward::

The switch fully receives all bits in the frame (store) before forwarding
the frame (forward). This allows the switch to check the FCS before
forwarding the frame, thus ensuring that errored frames are not forwarded.

Cut-through::

The switch performs the address table lookup as soon as the Destination
Address field in the header is received. The first bits in the frame can be sent out
the outbound port before the final bits in the incoming frame are received. This
does not allow the switch to discard frames that fail the FCS check, but the
forwarding action is faster, resulting in lower latency.

Fragment-free::

This performs like cut-through switching, but the switch waits for 64 bytes to be
received before forwarding the first bytes of the outgoing frame. According to
Ethernet specifications, collisions should be detected during the first 64 bytes of
the frame, so frames that are in error because of a collision will not be forwarded.

== Switching and bridging logic

[cols="20,60"]
:===
Type of Address: Switch Action

Known unicast: Forwards frame out the single interface associated with the destination address
Unknown unicast: Floods frame out all interfaces, except the interface on which the frame was received
Broadcast: Floods frame identically to unknown unicasts
Multicast: Floods frame identically to unknown unicasts, unless multicast optimizations are configured
:===


== Standards

[format="csv", cols="10,90", grid="none"]
|====
802.1Q, dot1q trunking
802.1d , STP
802.1s , MST
802.1w , Rapid STP
802.1ax, LACP (formerly 802.3ad)

802.2 , Logical Link Control
802.3u, Fast ethernet over copper and optical cable
802.3z, Gigabit ethernet over optical cable
802.3ab, Gigabit ethernet over copper cable
|====

== Troubleshooting

- Add something about excessive collisions, late collisions, runts, re: duplex mismatches


