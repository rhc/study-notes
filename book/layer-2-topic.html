<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Ethernet</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
<h1>Ethernet</h1>
</div>
<div id="content">
<div class="sect2">
<h3 id="_concepts">1. Concepts</h3>
<div class="sect3">
<h4 id="_introduction">1.1. Introduction</h4>
<div class="ulist">
<ul>
<li>
<p>IEEE 802.3 standards</p>
</li>
<li>
<p>CSMA/CD protocol.</p>
</li>
<li>
<p>medium: coaxial, twisted-pair, optical fiber</p>
</li>
<li>
<p>Four data rates: 10/100/1000/10000 Mbps</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ethernet_frame_formats">1.2. Ethernet Frame Formats</h4>
<div class="imageblock">
<div class="content">
<img src="images/ethernet-framing-options.png" alt="Ethernet framing options" height="250">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Preamble (DIX)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Provides synchronization and signal transitions to allow proper clocking of the transmitted signal.</p>
</li>
<li>
<p>Consists of 62 alternating 1s and 0s, and ends with a pair of 1s.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Preamble and Start of Frame Delimiter(802.3)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Same purpose and binary value as DIX preamble</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Type(or Protocol Type) DIX </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Identifies the type of protocol or protocol header that follows the header.</p>
</li>
<li>
<p>Allows the receiver of the frame to know how to process a received frame.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Length(802.3)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Describes the length in bytes of the data following the Length field, up to the Ethernet trailer.</p>
</li>
<li>
<p>Allows an Ethernet receiver to predict the end of the received frame.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Destination address(DA)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Can be an individual or group address</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Source address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Always individual address</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Destination Service Access Protocol DSAP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The size limitations, along with other Point (802.2) uses of the low-order bits, required the later addition of SNAP headers.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Source Service Access Protocol SSAP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Describes the upper-layer protocol Point (802.2) that created the frame.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Control(802.2)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>enables both connectionless and connection-oriented operation.</p>
</li>
<li>
<p>Generally used only for connectionless operation by modern protocols, with a 1-byte value of 0x03.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Organizationally Unique Identifier(SNAP)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Generally unused today,</p>
</li>
<li>
<p>providing a place for the sender of the frame to code the OUI representing the manufacturer of the Ethernet NIC.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Type(SNAP)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>using same values as the DIX Type field, overcoming deficiencies with size and use of the DSAP field.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Data: </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>n bytes where 46 &#8656; n &#8656; 1500</p>
</li>
<li>
<p>if n &lt; 46, use padding</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">FCS: Frame check sequence</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>contains a 32-bit cyclic redundancy check (CRC) value</p>
</li>
<li>
<p>calculated by the sending MAC</p>
</li>
<li>
<p>re-calculated by the receiving MAC to check for damaged frames.</p>
</li>
<li>
<p>generated from the DA, SA, Length/Type, and Data fields</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_ethernet_mac_addresses">1.3. Ethernet MAC Addresses</h4>
<div class="ulist">
<ul>
<li>
<p>48 bits represented in hexadecimal</p>
</li>
<li>
<p>Canonical transmission (little endian)= MSO to LSO with LSB to MSB for each octet</p>
</li>
<li>
<p>Most significant octet first, but for each octect, the LSB is transmitted first</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Example: AC-10-7b-3a-92-3c

convert to hexa: 10101100 00010000 01101011 00111010 01010010 00111100
transmission: 00110101 00001000 11010110 01011100 01001010 00111100</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ethernet-mac-address.png" alt="Ethernet mac address" height="240">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Fields:</p>
<div class="ulist horizontal">
<ul class="horizontal">
<li>
<p>OUI: first 3 bytes,  Organizational Unique Identifier</p>
</li>
<li>
<p>I/G: (0/1) individual or Group address, first bit to be transmitted</p>
</li>
<li>
<p>U/L: (0/1) universally  or Locally administrated</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_types_of_mac_addresses">Types of MAC addresses</h5>
<div class="ulist">
<ul>
<li>
<p>Unicast : I/G bit = 0</p>
</li>
<li>
<p>Multicast: I/G bit = 1</p>
</li>
<li>
<p>Broadcast: all devices in the segment</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rj_45_pinouts_and_cat5_wiring">1.4. RJ-45 pinouts and Cat5 wiring</h4>
<div class="ulist">
<ul>
<li>
<p>defined by <a href="http://www.eia.org">EIA</a> / <a href="http://www.tiaonline.org">TIA</a></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ethernet-pinouts.png" alt="Ehernet and ISO" height="100">
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Ethernet cabling types</caption>
<colgroup>
<col style="width: 18%;">
<col style="width: 45%;">
<col style="width: 36%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type of cable</th>
<th class="tableblock halign-left valign-top">Pinouts</th>
<th class="tableblock halign-left valign-top">Key pins connected</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Straight-through</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T568A or T568B both ends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-1; 2-2; 3-3; 6-6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-over</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T568A on one end,  T568B on the other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-3; 2-6; 3-1; 6-2</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Cisco also supports a switch feature that lets the switch figure out if the wrong cable is installed:
Auto-MDIX (automatic medium-dependent interface crossover) detects the wrong cable and
causes the switch to swap the pair it uses for transmitting and receiving, which solves the cabling
problem. This feature is not supported on all Cisco switch models.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_auto_negotiation">1.5. Auto-negotiation</h4>
<div class="paragraph">
<p>By default, each Cisco switch port uses Ethernet auto-negotiation to determine the speed and
duplex setting (half or full). The switches can also set their duplex setting with the duplex
interface subcommand, and their speed with—you guessed it—the speed interface subcommand.
Switches can dynamically detect the speed setting on a particular Ethernet segment by using a few
different methods. Cisco switches (and many other devices) can sense the speed using the Fast
Link Pulses (FLP) of the auto-negotiation process. However, if auto-negotiation is disabled on
either end of the cable, the switch detects the speed anyway based on the incoming electrical
signal. You can force a speed mismatch by statically configuring different speeds on either end of
the cable, causing the link to no longer function.</p>
</div>
<div class="paragraph">
<p>Switches detect duplex settings through auto-negotiation only. If both ends have auto-
negotiation enabled, the duplex is negotiated. However, if either device on the cable disables
auto-negotiation, the devices without a configured duplex setting must assume a default. Cisco
switches use a default duplex setting of half duplex (HDX) (for 10-Mbps and 100-Mbps
interfaces) or full duplex (FDX) (for 1000-Mbps interfaces). To disable auto-negotiation on a
Cisco switch port, you simply need to statically configure the speed and the duplex settings.
Ethernet devices can use FDX only when collisions cannot occur on the attached cable; a
collision-free link can be guaranteed only when a shared hub is not in use. The next few topics
review how Ethernet deals with collisions when they do occur, as well as what is different with
Ethernet logic in cases where collisions cannot occur and FDX is allowed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_switch_internal_processing">1.6. Switch  internal processing</h4>
<div class="paragraph">
<p>Switches forward frames when necessary, and do not forward when there is no need to do so, thus
reducing overhead.</p>
</div>
<div class="paragraph">
<p>To accomplish this, switches perform three actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Learn MAC addresses by examining the source MAC address of each received frame</p>
</li>
<li>
<p>Decide when to forward a frame or when to filter (not forward) a frame, based on the destination MAC address</p>
</li>
<li>
<p>Create a loop-free environment with other bridges by using the Spanning Tree Protocol</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Store-and-forward</dt>
<dd>
<p>The switch fully receives all bits in the frame (store) before forwarding
the frame (forward). This allows the switch to check the FCS before
forwarding the frame, thus ensuring that errored frames are not forwarded.</p>
</dd>
<dt class="hdlist1">Cut-through</dt>
<dd>
<p>The switch performs the address table lookup as soon as the Destination
Address field in the header is received. The first bits in the frame can be sent out
the outbound port before the final bits in the incoming frame are received. This
does not allow the switch to discard frames that fail the FCS check, but the
forwarding action is faster, resulting in lower latency.</p>
</dd>
<dt class="hdlist1">Fragment-free</dt>
<dd>
<p>This performs like cut-through switching, but the switch waits for 64 bytes to be
received before forwarding the first bytes of the outgoing frame. According to
Ethernet specifications, collisions should be detected during the first 64 bytes of
the frame, so frames that are in error because of a collision will not be forwarded.</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_switching_and_bridging_logic">2. Switching and bridging logic</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type of Address</th>
<th class="tableblock halign-left valign-top">Switch Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Known unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forwards frame out the single interface associated with the destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unknown unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floods frame out all interfaces, except the interface on which the frame was received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Broadcast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floods frame identically to unknown unicasts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floods frame identically to unknown unicasts, unless multicast optimizations are configured</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_configuration_tasks">3. Configuration tasks</h3>
<div class="paragraph">
<p>Puts user in interface configuration mode for that interface</p>
</div>
<div class="listingblock">
<div class="content">
<pre>interface fastethernet 0/x</pre>
</div>
</div>
<div class="paragraph">
<p>Set duplex mode for the interface</p>
</div>
<div class="listingblock">
<div class="content">
<pre>duplex {auto | full | half}</pre>
</div>
</div>
<div class="paragraph">
<p>Set speed for the interface</p>
</div>
<div class="listingblock">
<div class="content">
<pre>speed {10 | 100 | 1000 | auto |        nonegotiate}</pre>
</div>
</div>
<div class="paragraph">
<p>Show configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Router# show controllers fastethernet1
!
Interface FastEthernet1   MARVELL 88E6052
Link is DOWN
Port is undergoing Negotiation or Link down
Speed :Not set, Duplex :Not set
!
Switch PHY Registers:
~~~~~~~~~~~~~~~~~~~~~
00 : 3100   01 : 7849   02 : 0141   03 : 0C1F   04 : 01E1
05 : 0000   06 : 0004   07 : 2001   08 : 0000   16 : 0130
17 : 0002   18 : 0000   19 : 0040   20 : 0000   21 : 0000
!
Switch Port Registers:
~~~~~~~~~~~~~~~~~~~~~~
Port Status Register       [00] : 0800
Switch Identifier Register [03] : 0520
Port Control Register      [04] : 007F
Rx Counter Register        [16] : 000A
Tx Counter Register        [17] : 0008</pre>
</div>
</div>
<div class="paragraph">
<p>Show MAC address table</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Switch1# show mac-address-table dynamic
  Mac Address Table
  ------------------
  Vlan Mac Address Type Ports
  ---- ----------- ---- -----
  1 000f.2343.87cd DYNAMIC Fa0/13
  1 0200.3333.3333 DYNAMIC Fa0/3
  1 0200.4444.4444 DYNAMIC Fa0/13</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_standards">4. Standards</h3>
<table class="tableblock frame-all grid-none spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dot1q trunking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rapid STP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1ax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LACP (formerly 802.3ad)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical Link Control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast ethernet over copper and optical cable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gigabit ethernet over optical cable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3ab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gigabit ethernet over copper cable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_troubleshooting">5. Troubleshooting</h3>
<div class="ulist">
<ul>
<li>
<p>Add something about excessive collisions, late collisions, runts, re: duplex mismatches</p>
</li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="_vlan">1. VLAN</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_concepts_2">1.1. concepts</h3>
<div class="ulist">
<ul>
<li>
<p>administratively defined subset of switch ports that are in the same broadcast domain</p>
</li>
<li>
<p>best practice: one VLAN, one IP subnet</p>
</li>
<li>
<p>traffic inside same VLAN is layer 2 switched</p>
</li>
<li>
<p>traffic between VLANs is layer 3 routed</p>
</li>
<li>
<p>can span multiple physical switches over "trunks"</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_private_vlans">1.1.1. Private VLANs</h4>
<div class="ulist">
<ul>
<li>
<p>separate ports as if they are on different VLAN while consuming only one subset.</p>
</li>
<li>
<p>typically use by service provider in a multi-tenant offerings: one router, one switch, multiple customers</p>
</li>
<li>
<p>pVLAN = one primary VLAN ( promiscuous ports) + multiple secondary VLANs ( community and isolated ports)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_vlan_numbering">1.1.2. VLAN numbering</h4>
<div class="ulist">
<ul>
<li>
<p>VLAN ID = 12 bits</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Reserved [0, 4095] </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>not available for use</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Normal-range [1-1005]</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>advertised and pruned by VTP v1 and v2 except vlan 1, 1002-1005</p>
</li>
<li>
<p>configured in both vlan database mode and configuration mode</p>
</li>
<li>
<p>stored in VLAN.DAT file in Flash</p>
</li>
<li>
<p>Special vlans:</p>
<div class="ulist">
<ul>
<li>
<p>Vlan 1 is the default Ethernet VLAN for all access ports; cannot be deleted or changed.</p>
</li>
<li>
<p>Vlan 1002-1004 : default for FDDI</p>
</li>
<li>
<p>Vlan 1002-1005 : default for Token Ring translational bridge.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Extended-range [1006-4094] </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>cannot be advertised or pruned by VTP v1 and v2</p>
</li>
<li>
<p>configured only in VTP transparent mode</p>
</li>
<li>
<p>stored only in the running configuration</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_vlan_trunks">1.1.3. VLAN Trunks</h4>
<div class="ulist">
<ul>
<li>
<p>trunk: point-to-point links for multiple VLANs between devices</p>
</li>
<li>
<p>trunking add ISL or 802.1q headers to include VLAN id.</p>
<div class="ulist">
<ul>
<li>
<p>ISL : Cisco proprietary, 30-bytes (26-byte header + 4-byte trailer), does not modify original frame</p>
</li>
<li>
<p>802.1q: IEEE standard, 4-byte tag except for native VLAN, modifies original frame</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_tasks_2">1.2. Configuration tasks</h3>
<div class="sect3">
<h4 id="_basic_configuration">1.2.1. Basic configuration</h4>
<div class="paragraph">
<p>Configuring VLANs requires few steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the VLAN itself</p>
</li>
<li>
<p>Associate the correct ports with VLAN</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>VLAN creation can be done either in VLAN database mode configuration (after <strong>vlan database</strong> ) or normal configuration mode</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Catalyst 3550 VLAN database vs configuration mode</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VLAN Database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vtp {domain domain-name | password password | pruning | v2-mode | {server | client | transparent}}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">vtp {domain domain-name | file filename | interface name | mode {client | server | transparent} | password password | pruning | version number}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vlan vlan-id [backupcrf {enable | disable}] [mtu mtu-size] [name vlan-name] [parent parent-vlan-id] [state {suspend | active}]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">vlan vlan-id 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show {current | proposed | difference}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No equivalent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apply | abort | reset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No equivalent</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshoot">1.3. Troubleshoot</h3>
<div class="paragraph">
<p>Check "Creating ethernet vlans on catalyst switches: troubleshoot tips"</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SVI will be in "up/down" state after being deleted</p>
</li>
<li>
<p>SVI will be in "up/up" if</p>
<div class="ulist">
<ul>
<li>
<p>the VLAN associated with the SVI exists in the VLAN database</p>
</li>
<li>
<p>at least one trunk or access port in the "up/up" state has been assigned to the VLAN</p>
</li>
<li>
<p>those ports in the "up/up" state are not blocked by STP</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_vtp" class="sect0">VTP</h1>
<div class="openblock partintro">
<div class="content">
<span class="menuseq"><span class="menu">Catalyst Configuration guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swvtp.html#pgfId-1035238">Configuring VTP</span></span> </a>
</div>
</div>
<div class="sect1">
<h2 id="_overview">2. Overview</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>VTP vlan trunk protocol</p>
</li>
<li>
<p>Cisco-proprietary that distributes VLAN information among Catalyst switches</p>
</li>
<li>
<p>Advertises the VLAN Id, Name and Type but not which ports should be in each VLAN</p>
</li>
<li>
<p>Eases administrative burden for addition, deletion and renaming of VLANs</p>
</li>
<li>
<p>Supports 1005 VLANs (IP base or IP services feature set) or 255 VLANs (LAN base feature set)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vtp_message_format">3. VTP message format</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Encapsulated in ISL or 802.1q frames</p>
</li>
<li>
<p>Multicasted to  MAC address: 0100-0CCC-CCCC, LLC code: SNAP (AAAA), Type 2003 in the SNAP Header</p>
</li>
<li>
<p>Carried through trunk ports and VLAN 1</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/vtp-in-isl.png" alt="vtp in isl" height="80">
</div>
<div class="title">Figure 1. Example: VTP packet encapsulated in ISL frame</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The VTP header contains these fields:</p>
<div class="ulist">
<ul>
<li>
<p>VTP protocol version: 1,2,3</p>
</li>
<li>
<p>VTP message types: summary advertisements, subset advertisements, advertisement requests, VTP join messages</p>
</li>
<li>
<p>management domain length</p>
</li>
<li>
<p>management domain name</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_summary_advertisements">3.1. Summary advertisements</h3>
<div class="ulist">
<ul>
<li>
<p>Informs adjacent Catalysts of the current VTP domain name and the configuration revision number.</p>
</li>
<li>
<p>5 minutes intervals</p>
</li>
<li>
<p>When the switch receives a summary advertisement packet,</p>
<div class="ulist">
<ul>
<li>
<p>the switch compares the VTP domain name to its own VTP domain name.</p>
</li>
<li>
<p>If the name is different, the switch simply ignores the packet.</p>
</li>
<li>
<p>If the name is the same, the switch then compares the configuration revision to its own revision.</p>
</li>
<li>
<p>If its own configuration revision is higher or equal, the packet is ignored.</p>
</li>
<li>
<p>If it is lower, an advertisement request is sent.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="vtp-summary-advert-packet-format.png.png" alt="VTP Summary Advert" width="896" height="312">
</div>
<div class="title">Figure 2. VTP Summary Advert</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Followers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that this packet is followed by a Subset Advertisement packet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updater Identity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address of the switch that is the last to have incremented the configuration revision.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update Timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date and time of the last increment of the configuration revision.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MD5 Digest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If MD5 is configured and used to authenticate the validation of a VTP update.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_subset_advertisements">3.2. Subset advertisements</h3>
<div class="ulist">
<ul>
<li>
<p>Follows the summary advertisement after addition, deletion or modification of a VLAN.</p>
</li>
<li>
<p>Contains a list of VLAN information.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="vtp-subset-advert-packet-format.png.png" alt="VTP Subset advertisements" width="896" height="312">
</div>
<div class="title">Figure 3. VTP Subset advertisements</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Code</dt>
<dd>
<p>value: 0x02 for subset advertisement.</p>
</dd>
<dt class="hdlist1">Sequence number</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Identify the packet in the stream of packets that follow a summary advertisement</p>
</li>
<li>
<p>Starts with value 1</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_advertisement_request">3.3. Advertisement request</h3>
<div class="paragraph">
<p>A switch needs a VTP advertisement request in these situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The switch has been reset.</p>
</li>
<li>
<p>The VTP domain name has been changed.</p>
</li>
<li>
<p>The switch has received a VTP summary advertisement with a higher configuration revision than its own.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upon receipt of an advertisement request, a VTP device sends a summary advertisement.
One or more subset advertisements follow the summary advertisement. This is an example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="vtp-request-advert-packet-format.png.png" alt="VTP advertisement request" width="896" height="216">
</div>
<div class="title">Figure 4. VTP advertisement request</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Start-Value</dt>
<dd>
<p>This is used in cases in which there are several subset advertisements.
If the first (n) subset advertisement has been received
and the subsequent one (n+1) has not been received,
the Catalyst only requests advertisements from the (n+1)th one.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vtp_domains">4. VTP domains</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Controls which devices can exchange VTP advertisements</p>
</li>
<li>
<p>Defaults to null value</p>
</li>
<li>
<p>Switch inherits VTP domain name of first received advertisement over trunk links</p>
</li>
<li>
<p>A switch can only be part of one domain at a time</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the VTP domain name</div>
<div class="content">
<pre>(config)# vtp domain &lt;name&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_revision_number">5. Configuration revision number</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>32-bit</p>
</li>
<li>
<p>Incremented by one for each configuration change</p>
</li>
<li>
<p>Higher revision indicates newer database</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_allowed_active_and_pruned_vlans">6. Allowed, active and pruned VLANs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although a trunk can support VLANs 1–4094, several mechanisms reduce the actual number of
VLANs whose traffic flows over the trunk. First, VLANs can be administratively forbidden from
existing over the trunk using the <strong>switchport trunk allowed</strong> interface subcommand. Also, any
allowed VLANs must be configured on the switch before they are considered active on the trunk.
Finally, VTP can prune VLANs from the trunk, with the switch simply ceasing to forward frames
from that VLAN over the trunk.</p>
</div>
<div class="paragraph">
<p>The <strong>show interface trunk</strong> command lists the VLANs that fall into each category:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed VLANs </dt>
<dd>
<p>Each trunk allows all VLANs by default. However, VLANs can be
removed or added to the list of allowed VLANs by using the switchport trunk allowed
command.</p>
</dd>
<dt class="hdlist1">Allowed and active </dt>
<dd>
<p>To be active, a VLAN must be in the allowed list for the trunk (based on trunk configuration),
and the VLAN must exist in the VLAN configuration on the switch.
With PVST+, an STP instance is actively running on this trunk for the VLANs in this list.</p>
</dd>
<dt class="hdlist1">Active and not pruned </dt>
<dd>
<p>This list is a subset of the “allowed and active” list, with any VTP-pruned VLANs removed.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vtp_modes">7. VTP modes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure a switch to operate in any one of these VTP modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Server</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Default mode</p>
</li>
<li>
<p>Allows addition, deletion and modification of VLAN information</p>
</li>
<li>
<p>Changes on server overwrite the rest of the domain</p>
</li>
<li>
<p>Configuration saved in NVRAM</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Configure the switch as a VTP server</div>
<div class="content">
<pre>vtp mode server</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Client</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Cannot add, remove or modify VLAN information</p>
</li>
<li>
<p>Listens for advertisements originated by server, install them and passes them on</p>
</li>
<li>
<p>Configuration saved in NVRAM only for VTPv3</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Configure the switch as a VTP client</div>
<div class="content">
<pre>vtp mode client</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Transparent</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Keeps a separate VTP database from the rest of the domain</p>
</li>
<li>
<p>Does not originate advertisements</p>
</li>
<li>
<p>"transparently" passes received advertisements through without installing them</p>
</li>
<li>
<p>Can still create, remove or renamed VLANs which are not advertised to neighboring switches.</p>
</li>
<li>
<p>Need for some applications like Private VLANs</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Setup VTP transparent mode</div>
<div class="content">
<pre>vtp mode transparent</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Off (configurable only in CatOS switches)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Like VTP transparent mode with the exception that VTP advertisements are not forwarded</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. VTP Modes and Features</caption>
<colgroup>
<col style="width: 70%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server Mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transparent Mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Originates VTP advertisements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes received advertisements to update its VLAN configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forwards received VTP advertisements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Saves VLAN configuration in NVRAM or vlan.dat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, modify, or delete VLANs using  configuration commands</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_vtp_security">8. VTP security</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>MD5 authentication prevents against certain attack</p>
<div class="ulist">
<ul>
<li>
<p>does not prevent against misconfiguration</p>
</li>
<li>
<p>password must be setup manually because switches only exchanges MD5 digest of the password.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure VTP authentication</div>
<div class="content">
<pre>(config)# vtp password &lt;string&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Show the VTP password</div>
<div class="content">
<pre>(config)# sh vtp password</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vtp_pruning">9. VTP pruning</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Problem:</p>
<div class="ulist">
<ul>
<li>
<p>Broadcasts and unknown unicast/multicast frame are flooded everywhere in the broadcast domain
included through trunks links</p>
</li>
<li>
<p>Manual editing allowed list is a huge administrative overhead</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/flooding-traffic-without-vtp-pruning.png" alt="Flooding traffic without VTP pruning">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Solution: VTP pruning</p>
<div class="ulist">
<ul>
<li>
<p>Switches advertise what they need</p>
</li>
</ul>
</div>
</li>
<li>
<p>All other VLANs are pruned off the trunk link</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/flooding-traffic-with-vtp-pruning.png" alt="Optimized flooded traffic with VTP pruning">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Restriction:</p>
<div class="ulist">
<ul>
<li>
<p>Pruning does not work in transparent mode. Why?</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_pruning_eligibility">9.1. Pruning eligibility</h3>
<div class="ulist">
<ul>
<li>
<p>When VTP pruning is enabled on a VTP server,
pruning is enabled for the entire management domain
except for pruning-ineligible VLANS ( Vlan 1, 1002-1005, 1006-4094)</p>
</li>
<li>
<p>Making VLANs pruning-eligible or pruning-ineligible affects pruning eligibility for those VLANs on that trunk only
(not on all switches in the VTP domain).</p>
</li>
<li>
<p>VTP pruning takes effect several seconds after you enable it.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_version">10. Version</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO: Add task for this section</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default: version 1</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_version_2">10.1. Version 2</h3>
<div class="paragraph">
<p>-</p>
</div>
</div>
<div class="sect2">
<h3 id="_version_3">10.2. Version 3</h3>
<div class="ulist">
<ul>
<li>
<p>Supports the whole IEEE 802.1q vlan range up to 4095 ( v1 and v2 support only normal range VLANs 1-1005)</p>
</li>
<li>
<p>Can send private LAN information in addition to normal VLAN information.</p>
</li>
<li>
<p>Backward compatible with VTP 2</p>
</li>
<li>
<p>Add support for databases other than VLAN databases such as MST databases.</p>
</li>
<li>
<p>Clear text or hidden password protection</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, read <a href="http://www.cisco.com/c/en/us/products/collateral/switches/catalyst-6500-series-switches/solution_guide_c78_508010.html">VTP version 3</a></p>
</div>
<div class="listingblock">
<div class="title">Task: Verify VTP configuration</div>
<div class="content">
<pre># show vtp status

VTP Version: 3 (capable)
Configuration Revision: 1
Maximum VLANs supported locally: 1005
Number of existing VLANs: 37
VTP Operating Mode: Server
VTP Domain Name: [smartports]
VTP Pruning Mode: Disabled
VTP V2 Mode: Enabled
VTP Traps Generation: Disabled
MD5 digest : 0x26 0xEE 0x0D 0x84 0x73 0x0E 0x1B 0x69
Configuration last modified by 172.20.52.19 at 7-25-08 14:33:43
Local updater ID is 172.20.52.19 on interface Gi5/2 (first layer3 interface fou)
VTP version running: 2</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting_2">11. Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/support/docs/lan-switching/vtp/98155-tshoot-vlan.html#topic9" class="bare">http://www.cisco.com/c/en/us/support/docs/lan-switching/vtp/98155-tshoot-vlan.html#topic9</a></p>
</div>
</div>
</div>
<h1 id="_isl" class="sect0">ISL</h1>
<div class="sect1">
<h2 id="_overview_2">12. Overview</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Inter-Switch Link</p>
</li>
<li>
<p>Cisco proprietary</p>
</li>
<li>
<p>Provides VLAN trunking</p>
</li>
<li>
<p>Supports up to 1000 VLANs  (check ???)</p>
</li>
<li>
<p>Encapsulates the original header with 26-byte header</p>
</li>
<li>
<p>Removes the header at the receiving end</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_frame">13. Frame</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ISL frame consists of three fields: the ISL header( 26 bytes), the original frame and the FCS (4 bytes)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/isl-frame.png" alt="isl frame" height="100">
</div>
</div>
<div class="sect2">
<h3 id="_field_descriptions">13.1. Field descriptions</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">DA—Destination Address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>40-bit</p>
</li>
<li>
<p>Multicast address: "0100-0C00-00" or "0300-0C00-00".</p>
</li>
<li>
<p>The first 40 bits of the DA field signal the receiver that the packet is in ISL format. ???</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">TYPE—Frame Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>4 bits</p>
</li>
<li>
<p>Indicates the type of the original frame</p>
<div class="ulist">
<ul>
<li>
<p>0000: 	Ethernet</p>
</li>
<li>
<p>0001: 	Token Ring</p>
</li>
<li>
<p>0010: 	FDDI</p>
</li>
<li>
<p>0011: 	ATM</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">USER—User Defined Bits (TYPE Extension)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>4 bits</p>
</li>
<li>
<p>Extends the meaning of the TYPE field</p>
</li>
<li>
<p>Default value: "0000"</p>
</li>
<li>
<p>For Ethernet frames, the USER field bits "0" and "1" indicate the priority of the packet as
it passes through the switch. Whenever traffic can be handled in a manner that
allows it to be forwarded more quickly, the packets with this bit set should
take advantage of the quick path. It is not required that such paths be
provided.</p>
<div class="ulist">
<ul>
<li>
<p>XX00 	Normal Priority</p>
</li>
<li>
<p>XX01 	Priority 1</p>
</li>
<li>
<p>XX10 	Priority 2</p>
</li>
<li>
<p>XX11 	Highest Priority</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SA—Source Address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>48 bits set to set MAC address of the switch port that transmits the frame.</p>
</li>
<li>
<p>May be ignored by the receiving device</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">LEN—Length</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits set to the length of the packet in bytes
with the exclusion of the DA, TYPE, USER, SA, LEN, and FCS fields.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">AAAA03 (SNAP)—Subnetwork Access Protocol (SNAP) and Logical Link Control (LLC)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>24 bits set to "0xAAAA03".</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HSA—High Bits of Source Address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>24 bits set to 0x00-00-0C (Cisco OUI) of the SA field.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">VLAN—Destination Virtual LAN ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>15 bits set to the VLAN ID of the frame</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">BPDU—BPDU and CDP Indicator</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>1 bit set when STP or CDP encapsulates an ISL packet</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">INDX—Index</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits set to the port index of the source of the packet as it exits the switch</p>
</li>
<li>
<p>Used for diagnostic purposes only</p>
</li>
<li>
<p>May be ignored by the receiving bridge</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">RES—Reserved for Token Ring and FDDI</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits used when Token Ring or FDDI packets are encapsulated with an ISL frame</p>
<div class="ulist">
<ul>
<li>
<p>In the case of Token Ring frames, the Access Control (AC) and Frame Control (FC) fields are placed here.</p>
</li>
<li>
<p>In the case of FDDI, the FC field is placed in the Least Significant Byte (LSB) of this field.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For Ethernet packets, the RES field should be set to all zeros.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">ENCAP FRAME—Encapsulated Frame</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Encapsulated data packet with its own CRC value completely unmodified</p>
</li>
<li>
<p>Length from 1 to 24575 bytes</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">FCS—Frame Check Sequence</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>4 bytes set by the sending MAC and recalculated by the receiving bridge</p>
</li>
<li>
<p>New FCS calculated over the entire ISL packet</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<h1 id="_ieee_802_1q" class="sect0">IEEE 802.1Q</h1>
<div class="sect1">
<h2 id="_definition">14. Definition</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Tags frames on a trunk</p>
<div class="ulist">
<ul>
<li>
<p>Inserts a 4-byte tag into the original frame between the Source Address and the Type/Length field</p>
</li>
<li>
<p>Recomputes the frame check sequence (FCS) before the device sends the frame over the trunk link.</p>
</li>
<li>
<p>Removes the tag at the receiving end</p>
</li>
</ul>
</div>
</li>
<li>
<p>Does not tag frames on the native VLAN.</p>
<div class="ulist">
<ul>
<li>
<p>Must use the same native VLAN on both sides of the trunk</p>
</li>
<li>
<p>Default to VLAN 1</p>
</li>
</ul>
</div>
</li>
<li>
<p>Supports up to 4096 VLANs</p>
<div class="ulist">
<ul>
<li>
<p>Defines a single instance of spanning tree that runs on the native VLAN for all the VLANs in the network.</p>
</li>
<li>
<p>lacks the flexibility and load balancing capability of PVST that is available with ISL.</p>
</li>
<li>
<p>PVST+ offers the capability to retain multiple spanning tree topologies with 802.1Q trunking.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_frame_format">15. Frame Format</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/802-1q-frame.png" alt="802.1Q frame">
</div>
</div>
<div class="sect2">
<h3 id="_field_descriptions_2">15.1. Field descriptions</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">TPID—Tag Protocol Identifier</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits</p>
</li>
<li>
<p>Value: 08100</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Priority</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>3 bits</p>
</li>
<li>
<p>Called also user priority or IEEE 802.p</p>
</li>
<li>
<p>Indicates the frame priority level</p>
</li>
<li>
<p>Can be used to prioritize the traffic</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">CFI—Canonical Format Indicator</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>1 bit</p>
</li>
<li>
<p>Value: 0 if MAC address is in canonical format otherwise 1</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">VID—VLAN Identifier</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>12 bits</p>
</li>
<li>
<p>Identifies the VLAN to which the frame belongs</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_ethernet_frame_size_with_802_1q_tagging">15.2. Ethernet Frame Size with 802.1Q tagging</h3>
<div class="ulist">
<ul>
<li>
<p>Maximum size: 1522 bytes</p>
</li>
<li>
<p>Minimum size: 68 bytes</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_native_vlan">16. Native VLAN</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Task:  Configure a native VLAN over a trunk link</div>
<div class="content">
<pre>(config-if)# switchport trunk native vlan &lt;id&gt;</pre>
</div>
</div>
</div>
</div>
<h1 id="_stp" class="sect0">STP</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swstp.html" class="bare">http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swstp.html</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates loop-free layer 2 topology</p>
</li>
<li>
<p>prevents broadcast storms</p>
</li>
<li>
<p>STP variations:</p>
<div class="ulist">
<ul>
<li>
<p>802.1d : Common Spanning Tree</p>
</li>
<li>
<p>PVST/PVST+: Cisco per-VLAN Spanning Tree</p>
</li>
<li>
<p>802.1w: Rapid Spanning Tree Protocol</p>
</li>
<li>
<p>802.1s: Multiple STP</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_802_1d">17. 802.1d</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Uses bpdu</p>
</li>
<li>
<p>Elect one root switch and one designated switch for each segment</p>
</li>
<li>
<p>One root port per non-root switch, one designated port for each segment</p>
</li>
<li>
<p>Other ports on blocking state</p>
</li>
<li>
<p>Steps</p>
<div class="ulist">
<ul>
<li>
<p>elect the root switch with the lowest bridge id ( 2-byte priority + 6-byte MAC)</p>
</li>
<li>
<p>determine each switch&#8217;s root port: with the least cost path to the root</p>
</li>
<li>
<p>determine the designated port for each segment:
the switch that forwards the least cost hello on the segment</p>
</li>
<li>
<p>if there is a tie, select the lowest port ID</p>
</li>
</ul>
</div>
</li>
<li>
<p>Original ieee 802.1d bridge Id</p>
<div class="ulist">
<ul>
<li>
<p>2-byte priority</p>
</li>
<li>
<p>6-byte MAC adress</p>
</li>
</ul>
</div>
</li>
<li>
<p>Revised ieee 802.1d brigde id Priority for MAC address reduction</p>
<div class="ulist">
<ul>
<li>
<p>4 bits : priority multiple of 4096</p>
</li>
<li>
<p>12 bits : system id extension (vlan id ) to support pvst+ and ieee 802.1s</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_root_port_election">17.1. Root port election</h3>
<div class="ulist">
<ul>
<li>
<p>RP is upstream facing towards Root bridge</p>
</li>
<li>
<p>lowest root path cost ( cumulative cost of all links to get to the root)</p>
</li>
<li>
<p>cost based on inverse bandwith</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. default port costs</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Speed</th>
<th class="tableblock halign-left valign-top">original</th>
<th class="tableblock halign-left valign-top">revised</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Mbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 Mbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Gbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Gbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Tie breaker when a switch receives multiple Hellos with equal cost</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>lowest bridge id</p>
</li>
<li>
<p>lowest port priority</p>
</li>
<li>
<p>lowest port number</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To force selection of a root bridge,
use one of two commands below</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spanning-tree vlan id priority 0
spanning-tree vlan id root</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_determining_the_designated_port">17.2. determining the designated port</h3>
<div class="ulist">
<ul>
<li>
<p>Designated switch: send the hello with the lowest advertised cost for the segment</p>
</li>
<li>
<p>DP: port that forward frames onto that segment</p>
</li>
<li>
<p>DP are downstream facing away from root bridge</p>
</li>
<li>
<p>elected based on lowest root path cost, BID, port ID</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_blocking_all_non_rp_and_non_dp_ports">17.3. blocking all non-RP and non-DP ports</h3>
<div class="ulist">
<ul>
<li>
<p>Receive BPDUs</p>
</li>
<li>
<p>discard all other traffic</p>
</li>
<li>
<p>cannot send traffic</p>
</li>
<li>
<p>do not send Hellos</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_convergence">17.4. Convergence</h3>
<div class="ulist">
<ul>
<li>
<p>Steady operations: one Root bridge, one RP on each non-root bridge, one DP on each segment, blocking state</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>root switch generates a Hello every 2 seconds</p>
</li>
<li>
<p>each RP on non root switch receives a copy of the root&#8217;s hello</p>
</li>
<li>
<p>each DP updates and forwards the hello out</p>
</li>
<li>
<p>each blocking port receives a copy of the hello from the DP without forwarding it</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_topology_change_notification">17.5. Topology change notification</h3>
<div class="paragraph">
<p>more at
<a href="http://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/24062-146.html#topchng">understand new topology changes</a></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A switch experiencing the STP port state change sends a TCN BPDU out its Root Port; it
repeats this message every Hello time until it is acknowledged.</p>
</li>
<li>
<p>The next switch receiving that TCN BPDU sends back an acknowledgment via its next
forwarded Hello BPDU by marking the Topology Change Acknowledgment (TCA) bit in
the Hello.</p>
</li>
<li>
<p>The switch that was the DP on the segment in the first two steps repeats the first two steps,
sending a TCN BPDU out its Root Port, and awaiting acknowledgment from the DP on that
segment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By each successive switch repeating Steps 1 and 2, eventually the root receives a TCN BPDU.
Once received, the root sets the TC flag on the next several Hellos, which are forwarded to all
switches in the network, notifying them that a change has occurred. A switch receiving a Hello
BPDU with the TC flag set uses the short (Forward Delay time) timer to time out entries in
the CAM.</p>
</div>
<div class="paragraph">
<p>Transitioning from blocking to forwarding</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">forward data frames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learn source MAC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stable?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blocking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listening</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forwarding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_timers">17.6. Timers</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Hello timer</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>2 seconds</p>
</li>
<li>
<p>Interval at which the root sends Hellos</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">- Forward delay</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>15 seconds</p>
</li>
<li>
<p>Time that switch leaves a port in listening state and learning state</p>
</li>
<li>
<p>also used sd the short CAM timeout timer</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">- Maxage</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>20 seconds</p>
</li>
<li>
<p>Time without hearing a Hello before believing that the root has failed</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_pvst">17.7. PVST+</h3>
<div class="ulist">
<ul>
<li>
<p>Per-VLAN STP : for better load balancing</p>
<div class="ulist">
<ul>
<li>
<p>one instance of legacy STP per VLAN</p>
</li>
<li>
<p>Cisco ISL support</p>
</li>
</ul>
</div>
</li>
<li>
<p>PVST+</p>
<div class="ulist">
<ul>
<li>
<p>one instance of legacy STP per VLAN</p>
</li>
<li>
<p>Cisco ISL and 802.1q support</p>
</li>
<li>
<p>interoperability between CST and PVST</p>
</li>
</ul>
</div>
</li>
<li>
<p>default mode on most Catalyst platforms</p>
</li>
<li>
<p>allows root bridge/port placement per VLAN</p>
</li>
<li>
<p>Non-cisco + 802.1q &#8658; one Common Spanning Tree over vlan  1</p>
</li>
<li>
<p>When mixing cisco and non cisco switches with 802.1q trunking,</p>
<div class="ulist">
<ul>
<li>
<p>send bpdu to multicast destination MAC of 0100.0CCC.CCCD</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">17.8. configuration</h3>
<div class="paragraph">
<p>show spanning-tree root
show spanning-tree vlan 1 root detail</p>
</div>
</div>
<div class="sect2">
<h3 id="_optimizing_improving_spanning_tree">17.9. optimizing, improving spanning tree</h3>
<div class="sect3">
<h4 id="_portfast">17.9.1. PortFast</h4>
<div class="ulist">
<ul>
<li>
<p>Used on access ports connected to end users devices not other switches</p>
</li>
<li>
<p>Puts the port into forwarding state immediately</p>
</li>
<li>
<p>Prevent them to generate TCNs</p>
</li>
<li>
<p>Can generate loops if another switch is connected. so must be used with bpdu guard and root guard features</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(cfg-if) spanning-tree portfast
(cfg) spanning-tree portfast default</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_uplinkfast">17.9.2. UplinkFast</h4>
<div class="ulist">
<ul>
<li>
<p>Used on access layer switches that have multiple uplinks to distribution/core switches</p>
</li>
<li>
<p>Immediately replaces a lost RP with an alternate RP</p>
</li>
<li>
<p>Increases the root and all port priority so the switch does not become root or transit switch</p>
</li>
<li>
<p>Time-out the correct entries in their CAMs but doesnt use the TCN process. Instead, finds all the MAC
addresses of local devices and sends one multicast frame with each local addresses as the source MAC
causing all the other switches to update their CAMs. The access switch also clears out the rest of the
entries in its own CAM.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)#  spanning-tree uplinkfast [max-update-rate rate]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_backbonefast">17.9.3. BackboneFast</h4>
<div class="ulist">
<ul>
<li>
<p>Used in core switches to detect indirect link failures to the Root</p>
</li>
<li>
<p>Do not wait for Maxage to expire when another switch&#8217;s direct link fails</p>
</li>
<li>
<p>Send a Root Link Query out the port in which the missing Hello should arrive.
The RLQ asks the neighboring switch if that neighboring switch is still receiving Hellos from the root.
IF that neighbor had a direct link failure, it can tell the original switch via another RLQ that this path to the root is lost. Once known,
the switch experiencing the indirect link failure can go ahead and converge without waiting for Axage to expire</p>
</li>
<li>
<p>All switches must have backbone fast configured</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)#  spanning-tree backbonefast</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bpdu_filter">17.10. bpdu filter</h3>
<div class="ulist">
<ul>
<li>
<p>Filter BPDUs in and out</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bpdu_guard">17.11. bpdu guard</h3>
<div class="ulist">
<ul>
<li>
<p>Puts a (portfast enabled ???) port into the errdisable state when a BPDU is received and shuts down the port</p>
</li>
<li>
<p>The port must be manually re-enabled or it can be recovered automatically through the errdiable timeout function.</p>
</li>
<li>
<p>A port configured with bpdu guard will not be put into the root-inconsistent state.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_loop_guard">17.12. loop guard</h3>
<div class="ulist">
<ul>
<li>
<p>Prevents non-designated ports from inadvertently forming layer 2 switching loops
if the flow of bpdus is interrupted.</p>
</li>
<li>
<p>Puts the port into the loop-inconsistent state when the steady flow of BPDUs is interrupted</p>
</li>
<li>
<p>Only used on point-to-point links</p>
</li>
<li>
<p>Can be used with <strong>UDLD aggressive mode</strong> to get extra protection.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_root_guard">17.13. root guard</h3>
<div class="ulist">
<ul>
<li>
<p>Prevent a port from becoming a root port when receiving a superior bpdu (e.g. inferior priority + mac)</p>
</li>
<li>
<p>it is enabled on ports other than the root  port and on switches other than the root.</p>
</li>
<li>
<p>Puts the port in <strong>root-inconsistent</strong> state (no data flow) until it stops receiving superior BPDUs.
No traffic is forwarded.</p>
</li>
<li>
<p>enforce the root bridge placement by ensuring the the port on which root guard is enabled is the designated port.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/10588-74.html" class="bare">http://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/10588-74.html</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enforce the root bridge placement</p>
</li>
<li>
<p>Ensures that the port on which root guard is enabled is the designated port.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_udld">17.14. UDLD</h3>
<div class="ulist">
<ul>
<li>
<p>unidirectional links:</p>
<div class="ulist">
<ul>
<li>
<p>one of the 2 transmission path has failed but not both</p>
</li>
<li>
<p>due to miscabling, cutting on fiber cable, unplugging one fiber, GBIC problems, &#8230;&#8203;</p>
</li>
<li>
<p>can cause a loop as the previously blocking port will move to a forwarding state</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/stp-unidirectional-links.png" alt="stp unidirectional links" height="150">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>solutions:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">UDLD <strong>u</strong>ni<strong>d</strong>irectional <strong>l</strong>ink <strong>d</strong>etection</dt>
<dd>
<p>Uses Layer 2 messaging to decide when a switch can no longer receive frames from
a neighbor. The switch whose transmit interface did not fail is placed into an err-disabled
state.</p>
</dd>
<dt class="hdlist1">UDLD aggressive mode</dt>
<dd>
<p>Attempts to reconnect with the other switch (eight times)
after realizing no messages have been received.
If the other switch does not reply to the repeated additional messages,
both sides become err-disabled.</p>
</dd>
<dt class="hdlist1">Loop Guard</dt>
<dd>
<p>When normal BPDUs are no longer received,
the port does not go through normal STP convergence, but rather falls into an STP loop-inconsistent state.</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all cases, the formerly blocking port that would now cause a loop is prevented from migrating
to a forwarding state. With both types of UDLD, the switch can be configured to automatically
transition out of err-disabled state. With Loop Guard, the switch automatically puts the port back
into its former STP state when the original Hellos are received again.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_802_1w">18. 802.1w</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Improves convergence by</p>
<div class="ulist">
<ul>
<li>
<p>waiting for only 3 missed Hellos on an RP before flushing the CAM instead of 10 with 802.1d</p>
</li>
<li>
<p>bypass listening state</p>
</li>
<li>
<p>includes natively Cisco PortFast, UplinkFast, BackboneFast</p>
</li>
<li>
<p>add backup DP when multiple ports connected to the same segment</p>
</li>
</ul>
</div>
</li>
<li>
<p>backward compatible with 802.1d although</p>
</li>
<li>
<p>All bridges generate BPDUs every Hello interval</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_rstp_link_types">18.1. RSTP link types</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Point-to-point</strong>: switch to switch</p>
</li>
<li>
<p><strong>Shared</strong> : switch to hub</p>
</li>
<li>
<p><strong>Edge</strong>: switch to single end-user device</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rstp_port_states">18.2. RSTP port states</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">administrative state</th>
<th class="tableblock halign-left valign-top">802.1d</th>
<th class="tableblock halign-left valign-top">802.1w</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">discarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blocking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">discarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">listening</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">discarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">forwarding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">forwarding</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_rstp_role_ports">18.3. RSTP role ports</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Root Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Same role as 802.1d RP</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Designated Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Same role as 802.1d DP</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Alternate Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>an alternate root port</p>
</li>
<li>
<p>same concept as Cisco UplinkFast feature</p>
</li>
<li>
<p>protects against the loss of a switch&#8217;s RP by keeping track of the AP with a path to the root</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Backup Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>no equivalent Cisco features</p>
</li>
<li>
<p>protects against losing the DP attached to a shared liknk
when the switch has another physical port attached to the same shared segment</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
root bridge ports are all designated port
unless 2 or more ports of the root bridge are connected together.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
a port needs to receive BPDUs to stay blocked.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_2">18.4. configuration</h3>
<div class="listingblock">
<div class="content">
<pre>(config)#  spanning-tree mode rapid-pvst</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_802_1s">19. 802.1s</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Multiple VLANs mapped to the same STP instance.</p>
</li>
<li>
<p>enable load balancing</p>
</li>
<li>
<p>improves fault tolerance of the network
because a failure in one instance or forwarding path does not affect other instances.</p>
</li>
<li>
<p>Uses 802.1w for rapid convergence</p>
</li>
<li>
<p>Highly scalable</p>
<div class="ulist">
<ul>
<li>
<p>switches with same instance, configuration revision number and name form a <strong>region</strong></p>
</li>
<li>
<p>different regions see each other as virtual bridges</p>
</li>
</ul>
</div>
</li>
<li>
<p>each switch have three attributes:</p>
<div class="ulist">
<ul>
<li>
<p>alphanumeric configuration name (32 bytes)</p>
</li>
<li>
<p>configuration number (2 bytes)</p>
</li>
<li>
<p>4096-element table that associates each of the potential 4096 VLANs to a map ???</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_storm_control">19.1. storm control</h3>

</div>
<div class="sect2">
<h3 id="_unicast_flooding">19.2. unicast flooding</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting_3">20. Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_flapping_port_that_is_generating_bpdus_with_the_tcn_bit_set">20.1. flapping port that is generating BPDUs with the TCN bit set</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_questions">21. Questions</h2>
<div class="sectionbody">

</div>
</div>
<h1 id="_etherchannel" class="sect0">EtherChannel</h1>
<div class="sect1">
<h2 id="_overview_3">22. Overview</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>EtherChannel aggregates bandwidth of up to 8 physical links</p>
</li>
<li>
<p>Consists of two parts:</p>
<div class="ulist">
<ul>
<li>
<p>Port-channel interface: logical interface representing the bundle</p>
</li>
<li>
<p>Member interfaces: physical links part of the bundle</p>
</li>
</ul>
</div>
</li>
<li>
<p>Channel can be any type of interface:</p>
<div class="ulist">
<ul>
<li>
<p>Layer 2 access, trunk, tunnel or layer 3 routed</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configured as either Layer 2 or Layer 3 interfaces.</p>
</li>
<li>
<p>To be part of a PortChannel, both sides must agree on:</p>
<div class="ulist">
<ul>
<li>
<p>Same speed and duplex settings</p>
</li>
<li>
<p>If not trunking, same access VLAN</p>
</li>
<li>
<p>If trunking, same trunk type, allowed VLANs, and native VLAN</p>
</li>
<li>
<p>On a single switch, each port in a PortChannel must have the same STP cost per VLAN on all links in the PortChannel</p>
</li>
<li>
<p>No ports with SPAN configured</p>
</li>
</ul>
</div>
</li>
<li>
<p>When several EtherChannel bundles exist between two switches,
STP blocks one of the bundles to prevent redundant links.
When spanning tree blocks one of the redundant links, it blocks one EtherChannel,
thus blocking all the ports belonging to this EtherChannel link.</p>
</li>
<li>
<p>Where there is only one EtherChannel link,
all physical links in the EtherChannel are active because STP sees only one (logical) link.</p>
</li>
<li>
<p>If a link within an EtherChannel fails,
traffic previously carried over that failed link changes to the remaining links within the EtherChannel.
A trap is sent for a failure, identifying the switch, the EtherChannel, and the failed link.
Inbound broadcast and multicast packets on one link in an EtherChannel are blocked from returning on any other link of the EtherChannel.</p>
</li>
<li>
<p>Each EtherChannel has a logical port-channel interface numbered from 1 to 64.
The channel groups are also numbered from 1 to 64.</p>
</li>
<li>
<p>When a port joins an EtherChannel, the physical interface for that port is shut down.</p>
</li>
<li>
<p>When the port leaves the port-channel, its physical interface is brought up,
and it has the same configuration as it had before joining the EtherChannel.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_link_aggregation_protocol">23. Link aggregation protocol</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>PAgP</p>
<div class="ulist">
<ul>
<li>
<p>Maximum 8 ports</p>
</li>
</ul>
</div>
</li>
<li>
<p>LACP</p>
<div class="ulist">
<ul>
<li>
<p>Maximum 16 ports</p>
</li>
<li>
<p>Maximum 8 active ports and 8 standby ports</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Verify which negotiation protocol has been used for the EtherChannel</div>
<div class="content">
<pre># show etherchannel protocol</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the link aggregation protocol globally</div>
<div class="content">
<pre>(config-if)# channel-protocol {pagp | lacp}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <strong>channel-group</strong> interface configuration command can also set the mode for the EtherChannel</p>
</li>
<li>
<p>If you set the protocol by using <strong>channel-protocol</strong>,
the setting is not overriden by the <strong>channel-group</strong> interface configuration command.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_layer_2_etherchannels">24. Layer 2 EtherChannels</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Logical interfaces are dynamically created when using <strong>channel-group</strong> command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure layer 2 EtherChannels</div>
<div class="content">
<pre>conf t
interface &lt;type slot/number&gt;
  switchport mode {access | trunk}
  channel-group n mode {active | passive | on | {auto [non-silent] | desirable [non-silent]  }</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_layer_3_etherchannels">25. Layer 3 EtherChannels</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Task: Create the port channel logical interface</div>
<div class="content">
<pre>conf t
interface port-channel &lt;number&gt;
  no switchport
  ip address &lt;a.b.c.d&gt; &lt;mask&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Assign the physical interfaces to the layer 3 port channel</div>
<div class="content">
<pre>conf t
interface &lt;type id&gt;
  no switchport
  no ip address
  channel-group n mode {active | passive | on | {auto [non-silent] | desirable [non-silent]  }</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Always issue the <strong>no switchport</strong> command before the <strong>channel-group</strong> command</p>
</li>
<li>
<p>If L3 port-channel configured properly, the <strong>show etherchannel summary</strong> command should show <strong>RU</strong> for routed and in use</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/etherchannel-relationships.png" alt="etherchannel relationships" height="150">
</div>
<div class="title">Figure 5. Relationship of Physical Ports, Logical Port Channels, and Channel Groups</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_etherchannel_modes">26. EtherChannel modes</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. EtherChannel modes</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Cisco PAgP</th>
<th class="tableblock halign-left valign-top">802.1AD LACP</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disable negotiation and forces the port into the portChannel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disable negotiation and prevents the ports to be part of the portChannel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">desirable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initiates the negotiation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">passive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">waits on other side to start negotiation</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Display EtherChannel status</div>
<div class="content">
<pre># show etherchannel [group-number]</pre>
</div>
</div>
<div class="sect2">
<h3 id="_pagp_and_lacp_interaction_with_other_features">26.1. PAgP and LACP Interaction with Other Features</h3>
<div class="ulist">
<ul>
<li>
<p>DTP and CDP send and receive packets over the physical interfaces in the EtherChannel.</p>
</li>
<li>
<p>PAgP and LACP transmit PDUs on the lowest numbered VLAN on the interfaces enable for (desirable,auto or active,passive)</p>
</li>
<li>
<p>STP sends packets over the first interface in the Etherchannel</p>
</li>
<li>
<p>The MAC address of a Layer 3 EtherChannel is the MAC address of the first interface in the port-channel.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_load_balancing_and_forwarding_modes">26.2. Load balancing and forwarding modes</h3>
<div class="ulist">
<ul>
<li>
<p>Load balancing between member interface based on a combination of</p>
<div class="ulist">
<ul>
<li>
<p>Source MAC address</p>
</li>
<li>
<p>Destination MAC address</p>
</li>
<li>
<p>Source IP address</p>
</li>
<li>
<p>Destination IP address</p>
</li>
</ul>
</div>
</li>
<li>
<p>Uses only source MAC address by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the EtherChannel load-balancing method</div>
<div class="content">
<pre>(config)# port-channel load-balance { dst-ip | dst-mac | src-dst-ip | src-dst-mac | src-ip | src-mac}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the EtherChannel load-balancing method</div>
<div class="content">
<pre># show etherchannel load-balance

EtherChannel Load-Balancing Configuration:
src-mac

EtherChannel Load-Balancing Addresses Used Per-Protocol:
Non-IP: Source MAC address
IPv4: Source MAC address
IPv6: Source MAC address</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_misconfiguration_guard">27. Misconfiguration guard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<h1 id="_pagp" class="sect0">PAgP</h1>
<div class="sect1">
<h2 id="_overview_4">28. Overview</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>P</strong>ort <strong>Ag</strong>gregation <strong>P</strong>rotocol</p>
</li>
<li>
<p>Cisco proprietary</p>
</li>
<li>
<p>Automatic creation of a EtherChannel.</p>
</li>
<li>
<p>Sends PagP packets every 30 seconds to multicast 0100-0CCC-CCCC</p>
</li>
<li>
<p>Same destination address than CDP, UDLD, VTP, and DTP.</p>
</li>
<li>
<p>Checks for configuration consistency and manages link additions and failures between two switches.</p>
</li>
<li>
<p>Protocol value: 0x104</p>
</li>
<li>
<p>Cannot be enabled on cross-stack EtherChannel</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display PAgP status</div>
<div class="content">
<pre># show pagp [channel-group-number]</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_modes">29. Modes</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">Auto </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Never initiates PAgP communications but instead listen passively for any received PAgP packets
before creating an EtherChannel with the neighboring switch.</p>
</li>
<li>
<p>Default mode</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Desirable </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Initiates negotiations with other interfaces by sending PAgP packets.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">On </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Forces the interface to channel without PAgP.</p>
</li>
<li>
<p>Do not exchange PAgP packets.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Etherchannel formed for on-on, desirable-auto, desirable-desirable combinations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_physical_vs_aggregate_learners">30. Physical vs Aggregate learners</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Switches running PAgP are classified as:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">PAgP physical learners</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>learn MAC addresses using the physical ports within the EtherChannel instead
of via the logical EtherChannel link.</p>
</li>
<li>
<p>forward traffic to addresses based on the physical port via which the address
was learned.  The switch will send packets to the neighboring switch using
the same port in the EtherChannel from which it learned the source address.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Aggregate learners</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>learns addresses based on the aggregate or logical EtherChannel port.</p>
</li>
<li>
<p>transmit packets to the source by using any of the interfaces in the EtherChannel.</p>
</li>
<li>
<p>Aggregate learning is the default.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>By default, PAgP is not able to detect whether a neighboring switch is a
physical learner. Therefore, when configuring PAgP EtherChannels on switches
that support only physical learning, the learning method must be manually set
to physical learning. It is important when running in this mode, to set the
load-distribution method to source-based distribution so that any given source
MAC address is always sent on the same physical port.</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure the PAgP learning method</div>
<div class="content">
<pre>(config-if)# pagp learn-method {physical-port | aggregation-port&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the PAgP learning method</div>
<div class="content">
<pre># show pagp [channel-group-number] internal</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_priority">31. Priority</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Range: 0..255</p>
</li>
<li>
<p>Default: 128</p>
</li>
<li>
<p>The higher the priority, the more likely that the port will be used for PAgP transmission</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Assign a priority so that the selected port is chosen for packet transmission.</div>
<div class="content">
<pre>(config-if)# pagp port-priority &lt;priority&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_restrictions">32. Restrictions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While PAgP allows for all links within the EtherChannel to be used to forward
and receive user traffic, there are some restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DTP and CDP send and receive packets over all the physical interfaces in the EtherChannel,
while PAgP sends and receives PAgP PDU only from interfaces that are
up and have PAgP enabled for auto or desirable modes.</p>
</li>
<li>
<p>When an EtherChannel bundle is configured as a trunk port,
the trunk sends and receives PAgP frames on the lowest numbered VLAN.
STP always chooses the first operational port in an EtherChannel bundle.</p>
</li>
<li>
<p>When configuring additional STP features such as Loop Guard on an EtherChannel,
remember that if Loop Guard blocks the first port,
no BPDUs will be sent over the channel,
even if other ports in the channel bundle are operational.
This is because PAgP will enforce uniform Loop Guard configuration on all of the ports that are part of the EtherChannel group.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_3">33. Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_validate_the_port_that_will_be_used_by_stp_to_send_packets_and_receive_packets">33.1. Validate the port that will be used by STP to send packets and receive packets</h3>
<div class="listingblock">
<div class="content">
<pre>Switch#show pagp neighbor
Flags:  S – Device is sending Slow hello.  C – Device is in Consistent state.
A – Device is in Auto mode.        P – Device learns on physical port.

Channel group 4 neighbors
Partner     Partner             Partner         Partner   Group
Port        Name                Device ID       Port       Age  Flags   Cap.
Gi1/1/3     Switch.1            00c5.a003.0080   Gi0/1     4s   SC      10001
Gi1/1/4     Switch.1            00c5.a003.0080   Gi0/2     3s   SC      10001</pre>
</div>
</div>
<div class="paragraph">
<p>STP will send packets only out of port Gi1/1/3
because it is the first operational interface.
If that port fails,
STP will send packets out of Gi1/1/4.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_silent_mode">34. Silent mode</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Task: Configure a switch port for nonsilent operation</div>
<div class="content">
<pre></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a switch port for nonsilent operation</div>
<div class="content">
<pre></pre>
</div>
</div>
<div class="paragraph">
<p>TODO
You can also configure a single interface within the group for all
transmissions and use other interfaces for hot standby. The unused interfaces
in the group can be swapped into operation in just a few seconds if the
selected single interface loses hardware-signal detection.</p>
</div>
</div>
</div>
<h1 id="_lacp" class="sect0">LACP</h1>
<div class="sect1">
<h2 id="_overview_5">35. Overview</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>IEEE 802.3ad</p>
</li>
<li>
<p>Automatic creation of port channels</p>
</li>
<li>
<p>Multicast address IEEE 802.3 Slow Protocols: 0180-C200-0002</p>
</li>
<li>
<p>EtherType value: 0x8809</p>
</li>
<li>
<p>Timers: hellos every second during hand shake</p>
</li>
<li>
<p>Maximum: 16 ports with max 8 active</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_restrictions_2">35.1. Restrictions</h3>

</div>
<div class="sect2">
<h3 id="_modes_2">35.2. Modes</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Passive</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Does not initiate LACP negotiation but responds to LACP packets</p>
</li>
<li>
<p>Default mode</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Active</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Initiate LACP negotiation by sending LACP packets</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">On</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Forces the interface to the channel without PAgP or LACP</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Working Etherchannel for On-On, Passive-Active, Active-Active</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lacp_hot_standby_ports">36. LACP hot-standby ports</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Only 8 LACP links can be active at one time</p>
</li>
<li>
<p>Any additional links are in hot-standby mode</p>
</li>
<li>
<p>If one of the active links becomes inactive,
a hot-standby link becomes active in its place</p>
</li>
<li>
<p>Each link is assigned a unique priority in this order</p>
<div class="ulist">
<ul>
<li>
<p>LACP system priority (1..65535, default: 32768)</p>
</li>
<li>
<p>System ID ( the switch MAC address)</p>
</li>
<li>
<p>LACP port priority</p>
</li>
<li>
<p>Port number</p>
</li>
</ul>
</div>
</li>
<li>
<p>In priority comparisons, lower values have higher priority.</p>
</li>
<li>
<p>To determine which ports are active and which ports are hot standby,</p>
<div class="ulist">
<ul>
<li>
<p>Select the master switch with a low system priority and system-id</p>
</li>
<li>
<p>Select the master ports with the low port priority and number.
The port-priority and port-number of the slave switch are not used.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Check which ports are in the hot-standby mode</div>
<div class="content">
<pre># show etherchannel summary</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the LACP system priority</div>
<div class="content">
<pre>(config)# lacp system-priority &lt;priority&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Show the LACP system priority</div>
<div class="content">
<pre># show lacp sys-id</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: LACP port priority</div>
<div class="content">
<pre>(config-if)# lacp port-prioriy</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lacp_port_channel_maxbundle_feature">37. LACP Port-channel MaxBundle feature</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Control the number of ports allowed to be bundled into the etherchannel</p>
</li>
<li>
<p>Allows hot-standby ports with fewer bundled ports</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the maximum number of bundled ports allowed in a LACP port channel</div>
<div class="content">
<pre>(config-if)# lacp max-bundle</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lacp_port_channel_min_links_feature">38. LACP Port-Channel Min-links feature</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Only for LACP Etherchannel</p>
</li>
<li>
<p>Prevents low-bandwidth interface from becoming active</p>
</li>
<li>
<p>Causes LACP etherChannels to become inactive if they have too feww active members ports to supply the required minimum bandwith</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the minimum number of member ports that must be in the link-up state and bundled in the etherchannel for the port channel interface to transition to the link-up state</div>
<div class="content">
<pre>(config-if)# port-channel min-link n</pre>
</div>
</div>
</div>
</div>
<h1 id="_span_and_rspan" class="sect0">SPAN and RSPAN</h1>
<div class="sect1">
<h2 id="_concepts_3">39. Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SPAN (Switch Port Analyzer) mirrors received and/or transmitted traffic on
source ports and received traffic on source ports or source VLANs,
to a destination port for analysis.</p>
</div>
<div class="sect2">
<h3 id="_local_span">39.1. Local SPAN</h3>
<div class="paragraph">
<p>Local SPAN supports a SPAN session entirely within one switch; all source ports
or source VLANs and destination ports are in the same switch. Local SPAN copies
traffic from one or more source ports in any VLAN or from one or more VLANs to
a destination port for analysis.</p>
</div>
<div class="paragraph">
<p>For example, in <a href="#span-configuration">Example SPAN Configuration</a>, all traffic on port 5 (the source port) is
mirrored to port 10 (the destination port). A network analyzer on port 10
receives all network traffic from port 5 without being physically attached to
port 5.</p>
</div>
<div id="span-configuration" class="imageblock">
<div class="content">
<img src="images/span-configuration.png" alt="span configuration">
</div>
<div class="title">Figure 6. Example SPAN Configuration</div>
</div>
<div class="paragraph">
<p>Only traffic that enters or leaves source ports or traffic that enters source
VLANs can be monitored by using SPAN; traffic that gets routed to ingress
source ports or source VLANs cannot be monitored. For example, if incoming
traffic is being monitored, traffic that gets routed from another VLAN to the
source VLAN is not monitored; however, traffic that is received on the source
VLAN and routed to another VLAN is monitored.</p>
</div>
</div>
<div class="sect2">
<h3 id="_remote_span">39.2. Remote SPAN</h3>
<div class="paragraph">
<p>RSPAN extends SPAN by enabling remote monitoring of multiple switches across
your network.
The traffic for each RSPAN session is carried over a user-specified RSPAN VLAN
that is dedicated for that RSPAN session in all participating switches.
The SPAN traffic from the sources is copied onto the
RSPAN VLAN through a reflector port and then forwarded over trunk ports that
are carrying the RSPAN VLAN to any RSPAN destination sessions monitoring the
RSPAN VLAN, as shown in <a href="#rspan-configuration">Example of RSPAN Configuration</a>.</p>
</div>
<div class="paragraph">
<p>Each RSPAN source switch must have either ports or VLANs as RSPAN source.
The destination is always a physical port.</p>
</div>
<div id="rspan-configuration" class="imageblock">
<div class="content">
<img src="images/rspan-configuration.png" alt="rspan configuration">
</div>
<div class="title">Figure 7. Example of RSPAN Configuration</div>
</div>
<div class="paragraph">
<p>SPAN and RSPAN do not affect the switching of network traffic on source ports
or source VLANs; a copy of the packets received or sent by the source
interfaces are sent to the destination interface.</p>
</div>
<div class="paragraph">
<p>You can analyze network traffic passing through ports or VLANs by using SPAN to
send a copy of the traffic to another port on the switch that has been
connected to a SwitchProbe device or other Remote Monitoring (RMON) probe or
security device.</p>
</div>
<div class="paragraph">
<p>You can use the SPAN or RSPAN destination port to inject traffic from a network
security device. For example, if you connect a Cisco Intrusion Detection System
(IDS) Sensor Appliance to a destination port, the IDS device can send TCP Reset
packets to close down the TCP session of a suspected attacker.</p>
</div>
</div>
<div class="sect2">
<h3 id="_span_sessions">39.3. SPAN sessions</h3>
<div class="paragraph">
<p>SPAN sessions (local or remote) allow you to monitor traffic on one or more
ports, or one or more VLANs, and send the monitored traffic to one or more
destination ports.</p>
</div>
<div class="paragraph">
<p>A local SPAN session is an association of a destination port with source ports
or source VLANs, all on a single network device.
Local SPAN does not have separate source and destination sessions.
Local SPAN sessions gather a set of ingress and egress packets specified by the user
and form them into a stream of SPAN data, which is directed to the destination port.</p>
</div>
<div class="paragraph">
<p>RSPAN consists of at least one RSPAN source session, an RSPAN VLAN, and at
least one RSPAN destination session.
You separately configure RSPAN source sessions and RSPAN destination sessions on different network devices.
To configure an RSPAN source session on a device,
you associate a set of source ports or source VLANs with an RSPAN VLAN.
The output of this session is the stream of SPAN packets that are sent to the RSPAN VLAN.
To configure an RSPAN destination session on another device,
you associate the destination port with the RSPAN VLAN.
The destination session collects all RSPAN VLAN traffic and sends it out the RSPAN destination port.</p>
</div>
<div class="paragraph">
<p>An RSPAN source session is very similar to a local SPAN session, except for
where the packet stream is directed. In an RSPAN source session, SPAN packets
are relabeled with the RSPAN VLAN ID and directed over normal trunk ports to
the destination switch.</p>
</div>
<div class="paragraph">
<p>An RSPAN destination session takes all packets received on the RSPAN VLAN,
strips off the VLAN tagging, and presents them on the destination port.
Its purpose is to present a copy of all RSPAN VLAN packets (except Layer 2 control
packets) to the user for analysis.</p>
</div>
<div class="paragraph">
<p>There can be more than one source session and more than one destination session
active in the same RSPAN VLAN. There can also be intermediate switches
separating the RSPAN source and destination sessions. These switches need not
be capable of running RSPAN, but they must respond to the requirements of the
RSPAN VLAN.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restrictions_3">39.4. Restrictions</h3>
<div class="ulist">
<ul>
<li>
<p>Sources can be ports or VLANs,
but you cannot mix source ports and source VLANs in the same session.</p>
</li>
<li>
<p>The switch supports up to two source sessions (local SPAN and RSPAN source
sessions). You can run both a local SPAN and an RSPAN source session in the
same switch. The switch supports a total of 66 source and RSPAN destination
sessions.</p>
</li>
<li>
<p>maximum of 64 destination ports.</p>
</li>
<li>
<p>switched or routed ports can be configured as SPAN source or destination ports.</p>
</li>
<li>
<p>You can configure two separate SPAN or RSPAN source sessions with separate or
overlapping sets of SPAN source ports and VLANs. Both switched and routed
ports can be configured as SPAN sources and destinations.</p>
</li>
<li>
<p>SPAN sessions do not interfere with the normal operation of the switch.
However, an oversubscribed SPAN destination, for example, a 10-Mb/s port
monitoring a 100-Mb/s port, can result in dropped or lost packets.</p>
</li>
<li>
<p>When RSPAN is enabled, each packet being monitored is transmitted twice, once
as normal traffic and once as a monitored packet. Therefore monitoring a
large number of ports or VLANs could potentially generate large amounts of
network traffic.</p>
</li>
<li>
<p>You can configure SPAN sessions on disabled ports; however, a SPAN session
does not become active unless you enable the destination port and at least
one source port or VLAN for that session.</p>
</li>
<li>
<p>The switch does not support a combination of local SPAN and RSPAN in a single
session. That is, an RSPAN source session cannot have a local destination
port, an RSPAN destination session cannot have a local source port, and an
RSPAN destination session and an RSPAN source session that are using the same
RSPAN VLAN cannot run on the same switch.</p>
</li>
<li>
<p>When you configure a destination port,
its original configuration is overriden.
If the SPAN configuration is removed,
the original configuration on that port is restored</p>
</li>
<li>
<p>only on SPAN/RSPAN session can send traffic to a single destination port.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_monitored_traffic">39.5. Monitored traffic</h3>
<div class="paragraph">
<p>SPAN sessions include these traffic types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Receive (Rx) SPAN</dt>
<dd>
<p>The goal of receive (or ingress) SPAN is to monitor as much as possible all the
packets received by the source interface or VLAN before any modification or
processing is performed by the switch. A copy of each packet received by the
source is sent to the destination port for that SPAN session. You can monitor a
series or range of ingress ports or VLANs in a SPAN session.</p>
<div class="paragraph">
<p>Packets that are modified because of routing or QoS are copied before modification.</p>
</div>
<div class="paragraph">
<p>Features that can cause a packet to be dropped during receive processing have
no effect on ingress SPAN; the destination port receives a copy of the packet
even if the actual incoming packet is dropped. These features include IP
standard and extended input access control lists , QoS policing,
VLAN ACLs.</p>
</div>
</dd>
<dt class="hdlist1">Transmit (Tx) SPAN</dt>
<dd>
<p>The goal of transmit (or egress) SPAN is to monitor as much
as possible all the packets sent by the source interface after all modification
and processing is performed by the switch. A copy of each packet sent by the
source is sent to the destination port for that SPAN session. The copy is
provided after the packet is modified.</p>
<div class="paragraph">
<p>Only one egress source port is allowed per SPAN session. VLAN monitoring is not
supported in the egress direction.</p>
</div>
<div class="paragraph">
<p>Packets that are modified because of routing (e.g. TTL or MAC-address modification)
are duplicated at the destination port.
On packets that are modified because of QoS, the modified packet might not have
the same DSCP (IP packet) or CoS (non-IP packet) as the SPAN source.</p>
</div>
<div class="paragraph">
<p>Some features that can cause a packet to be dropped during transmit processing
might also affect the duplicated copy for SPAN. These features include VLAN
maps, IP standard and extended output ACLs on multicast packets, and egress QoS
policing. In the case of output ACLs, if the SPAN source drops the packet, the
SPAN destination would also drop the packet. In the case of egress QoS
policing, if the SPAN source drops the packet, the SPAN destination might not
drop it. If the source port is oversubscribed, the destination ports will have
different dropping behavior.</p>
</div>
</dd>
<dt class="hdlist1">Both</dt>
<dd>
<p>In a SPAN session, you can monitor a single port for both received and
sent packets. This is the default.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The default configuration for local SPAN session ports is to send all packets
untagged. SPAN also does not normally monitor BPDU, CDP, VTP, DTP, STP, PAgP.
However, when you enter the encapsulation replicate keywords when configuring a destination port,
these changes occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Packets are sent on the destination port with the same (ISL or 802,1Q) encapsulation
that they had on the source port.</p>
</li>
<li>
<p>Packets of all types, including BPDU and Layer 2 protocol packets, are
monitored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Therefore, a local SPAN session with encapsulation replicate enabled can have a
mixture of untagged, ISL, and IEEE 802.1Q tagged packets appear on the
destination port.</p>
</div>
<div class="paragraph">
<p>Switch congestion can cause packets to be dropped at ingress source ports,
egress source ports, or SPAN destination ports. In general, these
characteristics are independent of one another. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A packet might be forwarded normally but dropped from monitoring due to an
oversubscribed SPAN destination port.</p>
</li>
<li>
<p>An ingress packet might be dropped from normal forwarding, but still appear on
the SPAN destination port.</p>
</li>
<li>
<p>An egress packet dropped because of switch congestion is also dropped from
egress SPAN.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In some SPAN configurations, multiple copies of the same source packet are sent
to the SPAN destination port. For example, a bidirectional (both Rx and Tx)
SPAN session is configured for the Rx monitor on port A and Tx monitor on port B.
If a packet enters the switch through port A and is switched to port B, both
incoming and outgoing packets are sent to the destination port. Both packets
are the same (unless a Layer-3 rewrite occurs, in which case the packets are
different because of the packet modification).</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_ports">39.6. Source Ports</h3>
<div class="paragraph">
<p>A source port (also called a monitored port) is a switched or routed port that
you monitor for network traffic analysis. In a local SPAN session or RSPAN
source session, you can monitor source ports or VLANs for traffic in one or
both directions. The switch supports any number of source ports (up to the
maximum number of available ports on the switch) and any number of source VLANs
(up to the maximum number of VLANs supported). However, the switch supports a
maximum of two sessions (local or RSPAN) with source ports or VLANs, and you
cannot mix ports and VLANs in a single session.</p>
</div>
<div class="paragraph">
<p>A source port has these characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can be monitored in multiple SPAN sessions.</p>
</li>
<li>
<p>Each source port can be configured with a direction (ingress, egress, or
both) to monitor.</p>
</li>
<li>
<p>It can be any port type (EtherChannel, Fast Ethernet, Gigabit Ethernet, h).</p>
</li>
<li>
<p>For EtherChannel sources, you can monitor traffic for the entire EtherChannel
or individually on a physical port as it participates in the port channel.</p>
</li>
<li>
<p>It can be an access port, trunk port, routed port, or voice VLAN port.</p>
</li>
<li>
<p>It cannot be a destination port.</p>
</li>
<li>
<p>Source ports can be in the same or different VLANs.</p>
</li>
<li>
<p>You can monitor multiple source ports in a single session.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_source_vlans">39.7. Source VLANs</h3>
<div class="paragraph">
<p>VLAN-based SPAN (VSPAN) is the monitoring of the network traffic in one or more VLANs.
The SPAN or RSPAN source interface in VSPAN is a VLAN ID, and traffic is monitored on all the ports for that VLAN.</p>
</div>
<div class="paragraph">
<p>VSPAN has these characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All active ports in the source VLAN are included as source ports and can be monitored in either or both directions.</p>
</li>
<li>
<p>On a given port, only traffic on the monitored VLAN is sent to the destination port.</p>
</li>
<li>
<p>If a destination port belongs to a source VLAN, it is excluded from the source list and is not monitored.</p>
</li>
<li>
<p>If ports are added to or removed from the source VLANs, the traffic on the source VLAN received by those ports is added to or removed from the sources being monitored.</p>
</li>
<li>
<p>You cannot use filter VLANs in the same session with VLAN sources.</p>
</li>
<li>
<p>You can monitor only Ethernet VLANs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vlan_filtering">39.8. VLAN Filtering</h3>
<div class="paragraph">
<p>When you monitor a trunk port as a source port, by default, all VLANs active on the trunk are monitored. You can limit SPAN traffic monitoring on trunk source ports to specific VLANs by using VLAN filtering.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VLAN filtering applies only to trunk ports or to voice VLAN ports.</p>
</li>
<li>
<p>VLAN filtering applies only to port-based sessions and is not allowed in sessions with VLAN sources.</p>
</li>
<li>
<p>When a VLAN filter list is specified, only those VLANs in the list are monitored on trunk ports or on voice VLAN access ports.</p>
</li>
<li>
<p>SPAN traffic coming from other port types is not affected by VLAN filtering; that is, all VLANs are allowed on other ports.</p>
</li>
<li>
<p>VLAN filtering affects only traffic forwarded to the destination SPAN port and does not affect the switching of normal traffic.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_destination_port">39.9. Destination port</h3>
<div class="paragraph">
<p>Each local SPAN session or RSPAN destination session must have a destination port (also called a monitoring port) that receives a copy of traffic from the source ports or VLANs and sends the SPAN packets to the user, usually a network analyzer.</p>
</div>
<div class="paragraph">
<p>A destination port has these characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For a local SPAN session, the destination port must reside on the same switch
as the source port. For an RSPAN session, it is located on the switch
containing the RSPAN destination session. There is no destination port on a
switch running only an RSPAN source session.</p>
</li>
<li>
<p>When a port is configured as a SPAN destination port, the configuration
overwrites the original port configuration. When the SPAN destination
configuration is removed, the port reverts to its previous configuration. If
a configuration change is made to the port while it is acting as a SPAN
destination port, the change does not take effect until the SPAN destination
configuration had been removed.</p>
</li>
<li>
<p>If the port was in an EtherChannel group, it is removed from the group while
it is a destination port. If it was a routed port, it is no longer a routed
port.</p>
</li>
<li>
<p>It can be any Ethernet physical port.</p>
</li>
<li>
<p>It cannot be a secure port.</p>
</li>
<li>
<p>It cannot be a source port.</p>
</li>
<li>
<p>It cannot be an EtherChannel group or a VLAN.</p>
</li>
<li>
<p>It can participate in only one SPAN session at a time (a destination port in
one SPAN session cannot be a destination port for a second SPAN session).</p>
</li>
<li>
<p>When it is active, incoming traffic is disabled. The port does not transmit
any traffic except that required for the SPAN session. Incoming traffic is
never learned or forwarded on a destination port.</p>
</li>
<li>
<p>If ingress traffic forwarding is enabled for a network security device, the
destination port forwards traffic at Layer 2.</p>
</li>
<li>
<p>It does not participate in any of the Layer 2 protocols (STP, VTP, CDP, DTP,
PagP).</p>
</li>
<li>
<p>A destination port that belongs to a source VLAN of any SPAN session is
excluded from the source list and is not monitored.</p>
</li>
<li>
<p>The maximum number of destination ports in a switch is 64.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Local SPAN and RSPAN destination ports behave differently regarding VLAN
tagging and encapsulation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For local SPAN, if the encapsulation replicate keywords are specified for the
destination port, these packets appear with the original encapsulation
(untagged, ISL, or IEEE 802.1Q). If these keywords are not specified, packets
appear in the untagged format. Therefore, the output of a local SPAN session
with encapsulation replicate enabled can contain a mixture of untagged, ISL,
or IEEE 802.1Q-tagged packets.</p>
</li>
<li>
<p>For RSPAN, the original VLAN ID is lost because it is overwritten by the
RSPAN VLAN identification. Therefore, all packets appear on the destination
port as untagged.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rspan_vlan">39.10. RSPAN VLAN</h3>
<div class="paragraph">
<p>The RSPAN VLAN carries SPAN traffic between RSPAN source and destination sessions. It has these special characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All traffic in the RSPAN VLAN is always flooded.</p>
</li>
<li>
<p>No MAC address learning occurs on the RSPAN VLAN.</p>
</li>
<li>
<p>RSPAN VLAN traffic only flows on trunk ports.</p>
</li>
<li>
<p>RSPAN VLANs must be configured in VLAN configuration mode by using the remote-span VLAN configuration mode command.</p>
</li>
<li>
<p>STP can run on RSPAN VLAN trunks but not on SPAN destination ports.</p>
</li>
<li>
<p>An RSPAN VLAN cannot be a private-VLAN primary or secondary VLAN.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For VLANs 1 to 1005 that are visible to VLAN Trunking Protocol (VTP), the VLAN
ID and its associated RSPAN characteristic are propagated by VTP. If you assign
an RSPAN VLAN ID in the extended VLAN range (1006 to 4094), you must manually
configure all intermediate switches.</p>
</div>
<div class="paragraph">
<p>It is normal to have multiple RSPAN VLANs in a network at the same time with
each RSPAN VLAN defining a network-wide RSPAN session. That is, multiple RSPAN
source sessions anywhere in the network can contribute packets to the RSPAN
session. It is also possible to have multiple RSPAN destination sessions
throughout the network, monitoring the same RSPAN VLAN and presenting traffic
to the user. The RSPAN VLAN ID separates the sessions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_interaction_with_other_features">39.11. Interaction with other features</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Routing </dt>
<dd>
<p>SPAN does not monitor routed traffic. VSPAN only monitors traffic that enters or exits the switch, not traffic that is routed between VLANs. For example, if a VLAN is being Rx-monitored and the switch routes traffic from another VLAN to the monitored VLAN, that traffic is not monitored and not received on the SPAN destination port.</p>
</dd>
<dt class="hdlist1">STP</dt>
<dd>
<p>A destination port does not participate in STP while its SPAN or RSPAN session is active. The destination port can participate in STP after the SPAN or RSPAN session is disabled. On a source port, SPAN does not affect the STP status. STP can be active on trunk ports carrying an RSPAN VLAN.</p>
</dd>
<dt class="hdlist1">CDP</dt>
<dd>
<p>A SPAN destination port does not participate in CDP while the SPAN session is active. After the SPAN session is disabled, the port again participates in CDP.</p>
</dd>
<dt class="hdlist1">VTP</dt>
<dd>
<p>You can use VTP to prune an RSPAN VLAN between switches.</p>
</dd>
<dt class="hdlist1">VLAN and trunking</dt>
<dd>
<p>You can modify VLAN membership or trunk settings for source or destination ports at any time. However, changes in VLAN membership or trunk settings for a destination port do not take effect until you remove the SPAN destination configuration. Changes in VLAN membership or trunk settings for a source port immediately take effect, and the respective SPAN sessions automatically adjust accordingly.</p>
</dd>
<dt class="hdlist1">EtherChannel</dt>
<dd>
<p>You can configure an EtherChannel group as a source port but not as a SPAN destination port. When a group is configured as a SPAN source, the entire group is monitored.</p>
<div class="paragraph">
<p>If a physical port is added to a monitored EtherChannel group, the new port is added to the SPAN source port list. If a port is removed from a monitored EtherChannel group, it is automatically removed from the source port list.</p>
</div>
<div class="paragraph">
<p>A physical port that belongs to an EtherChannel group can be configured as a SPAN source port and still be a part of the EtherChannel. In this case, data from the physical port is monitored as it participates in the EtherChannel. However, if a physical port that belongs to an EtherChannel group is configured as a SPAN destination, it is removed from the group. After the port is removed from the SPAN session, it rejoins the EtherChannel group. Ports removed from an EtherChannel group remain members of the group, but they are in the inactive or suspended state.</p>
</div>
<div class="paragraph">
<p>If a physical port that belongs to an EtherChannel group is a destination port and the EtherChannel group is a source, the port is removed from the EtherChannel group and from the list of monitored ports.</p>
</div>
</dd>
<dt class="hdlist1">Multicasting</dt>
<dd>
<p>Multicast traffic can be monitored. For egress and ingress port monitoring, only a single unedited packet is sent to the SPAN destination port. It does not reflect the number of times the multicast packet is sent.</p>
</dd>
<dt class="hdlist1">Private VLAN</dt>
<dd>
<p>A private-VLAN port cannot be a SPAN destination port.</p>
</dd>
<dt class="hdlist1">Secure port</dt>
<dd>
<p>A secure port cannot be a SPAN destination port.</p>
<div class="paragraph">
<p>For SPAN sessions, do not enable port security on ports with monitored egress when ingress forwarding is enabled on the destination port. For RSPAN source sessions, do not enable port security on any ports with monitored egress.</p>
</div>
<div class="paragraph">
<p>An IEEE 802.1x port can be a SPAN source port. You can enable IEEE 802.1x on a port that is a SPAN destination port; however, IEEE 802.1x is disabled until the port is removed as a SPAN destination.</p>
</div>
<div class="paragraph">
<p>For SPAN sessions, do not enable IEEE 802.1x on ports with monitored egress when ingress forwarding is enabled on the destination port. For RSPAN source sessions, do not enable IEEE 802.1x on any ports that are egress monitored.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_tasks_3">40. Configuration tasks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_default_span_and_rspan_configuration">40.1. Default SPAN and RSPAN configuration</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Default Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPAN state (SPAN and RSPAN)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source port traffic to monitor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both received and sent traffic (both).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encapsulation type (destination port)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Native form (untagged packets).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ingress forwarding (destination port)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VLAN filtering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On a trunk interface used as a source port, all VLANs are monitored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSPAN VLANs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None configured.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_configuration_guidelines">40.2. Configuration guidelines</h3>
<div class="sect3">
<h4 id="_span">40.2.1. SPAN</h4>
<div class="ulist">
<ul>
<li>
<p>For SPAN sources, you can monitor traffic for a single port or VLAN or a series or range of ports or VLANs for each session. You cannot mix source ports and source VLANs within a single SPAN session.</p>
</li>
<li>
<p>The destination port cannot be a source port; a source port cannot be a destination port.</p>
</li>
<li>
<p>You cannot have two SPAN sessions using the same destination port.</p>
</li>
<li>
<p>When you configure a switch port as a SPAN destination port, it is no longer a normal switch port; only monitored traffic passes through the SPAN destination port.</p>
</li>
<li>
<p>Entering SPAN configuration commands does not remove previously configured SPAN parameters. You must enter the no monitor session {session_number | all | local | remote} global configuration command to delete configured SPAN parameters.</p>
</li>
<li>
<p>For local SPAN, outgoing packets through the SPAN destination port carry the original encapsulation headers—untagged, ISL, or IEEE 802.1Q—if the encapsulation replicate keywords are specified. If the keywords are not specified, the packets are sent in native form. For RSPAN destination ports, outgoing packets are not tagged.</p>
</li>
<li>
<p>You can configure a disabled port to be a source or destination port, but the SPAN function does not start until the destination port and at least one source port or source VLAN are enabled.</p>
</li>
<li>
<p>You can limit SPAN traffic to specific VLANs by using the filter vlan keyword. If a trunk port is being monitored, only traffic on the VLANs specified with this keyword is monitored. By default, all VLANs are monitored on a trunk port.</p>
</li>
<li>
<p>You cannot mix source VLANs and filter VLANs within a single SPAN session.</p>
</li>
<li>
<p>Catalyst 3560-24PS and 3560-48PS switches have hardware limitations related to SPAN. An egress SPAN copy of routed unicast traffic might show an incorrect destination MAC address on both local and remote SPAN sessions. This limitation does not apply to bridged packets. The workaround for local SPAN is to use the replicate option.</p>
</li>
<li>
<p>On Catalyst 3560-24PS and 3560-48PS switches, egress SPAN routed packets (both unicast and multicast) show the incorrect source MAC address. For local SPAN packets with native encapsulation on the destination port, the packet shows the MAC address of VLAN 1. This problem does not appear with local SPAN when the encapsulation replicate option is used. This limitation does not apply to bridged packets. The workaround is to use the encapsulate replicate keywords in the monitor session global configuration command.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_rspan">40.2.2. RSPAN</h4>
<div class="ulist">
<ul>
<li>
<p>All the items in the previous section apply to RSPAN</p>
</li>
<li>
<p>As RSPAN VLANs have special properties, you should reserve a few VLANs across your network for use as RSPAN VLANs; do not assign access ports to these VLANs.</p>
</li>
<li>
<p>You can apply an output ACL to RSPAN traffic to selectively filter or monitor specific packets. Specify these ACLs on the RSPAN VLAN in the RSPAN source switches.</p>
</li>
<li>
<p>For RSPAN configuration, you can distribute the source ports and the destination ports across multiple switches in your network.</p>
</li>
<li>
<p>RSPAN does not support BPDU packet monitoring or other Layer 2 switch protocols.</p>
</li>
<li>
<p>The RSPAN VLAN is configured only on trunk ports and not on access ports. To avoid unwanted traffic in RSPAN VLANs, make sure that the VLAN remote-span feature is supported in all the participating switches.</p>
</li>
<li>
<p>Access ports (including voice VLAN ports) on the RSPAN VLAN are put in the inactive state.</p>
</li>
<li>
<p>RSPAN VLANs are included as sources for port-based RSPAN sessions when source trunk ports have active RSPAN VLANs. RSPAN VLANs can also be sources in SPAN sessions. However, since the switch does not monitor spanned traffic, it does not support egress spanning of packets on any RSPAN VLAN identified as the destination of an RSPAN source session on the switch.</p>
</li>
<li>
<p>You can configure any VLAN as an RSPAN VLAN as long as these conditions are met:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>–The same RSPAN VLAN is used for an RSPAN session in all the switches.</p>
</div>
<div class="paragraph">
<p>–All participating switches support RSPAN.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We recommend that you configure an RSPAN VLAN before you configure an RSPAN source or a destination session.</p>
</li>
<li>
<p>If you enable VTP and VTP pruning, RSPAN traffic is pruned in the trunks to prevent the unwanted flooding of RSPAN traffic across the network for VLAN IDs that are lower than 1005.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_remove_any_existing_span_configuration">40.3. Remove any existing SPAN configuration</h3>
<div class="listingblock">
<div class="content">
<pre>no monitor session {session_number | all | local | remote}</pre>
</div>
</div>
<div class="paragraph">
<p>For session_number, the range is 1 to 66.</p>
</div>
<div class="paragraph">
<p>Specify <strong>all</strong> to remove all SPAN sessions, <strong>local</strong> to remove all local sessions, or <strong>remote</strong> to remove all remote SPAN sessions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_local_span_session">40.4. Create a local SPAN session</h3>
<div class="listingblock">
<div class="content">
<pre>monitor session number source {interface _id | vlan id} [, | -] [both | rx | tx]
monitor session number destination {interface _id | vlan id} [, | -] [both | rx | tx]</pre>
</div>
</div>
<div class="paragraph">
<p>For session_number, the range is 1 to 66.</p>
</div>
<div class="paragraph">
<p>For interface-id, specify the source port or source VLAN to monitor.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For source interface-id, specify the source port to monitor. Valid interfaces include physical interfaces and port-channel logical interfaces (port-channel port-channel-number). Valid port-channel numbers are 1 to 48.</p>
</li>
<li>
<p>For vlan-id, specify the source VLAN to monitor. The range is 1 to 4094 (excluding the RSPAN VLAN).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>(Optional) [, | -] Specify a series or range of interfaces. Enter a space before and after the comma; enter a space before and after the hyphen.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can use the <strong>monitor session</strong> <em>session_number</em> <strong>source</strong> command multiple times to configure multiple source ports.</p>
</li>
<li>
<p>A single session can include multiple sources (ports or VLANs), defined in a series of commands, but you cannot combine source ports and source VLANs in one session.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_specify_a_span_session_and_the_destination_port">40.5. Specify a SPAN session and the destination port</h3>
<div class="listingblock">
<div class="content">
<pre>monitor session number
  destination {interface _id  [, | -] [both | rx | tx]
  [encapsulation replicate]}</pre>
</div>
</div>
<div class="paragraph">
<p>The session number  must be the same as the source session number.</p>
</div>
</div>
<div class="sect2">
<h3 id="_specify_vlans_to_filter">40.6. Specify VLANs to filter</h3>
<div class="listingblock">
<div class="content">
<pre>monitor session session_number filter vlan vlan-id [, | -]</pre>
</div>
</div>
<div class="paragraph">
<p>For vlan-id, the range is 1 to 4094.</p>
</div>
<div class="paragraph">
<p>(Optional) Use a comma (,) to specify a series of VLANs, or use a hyphen (-) to specify a range of VLANs. Enter a space before and after the comma; enter a space before and after the hyphen.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_a_vlan_as_an_rspan_vlan">40.7. Configure a VLAN as an RSPAN VLAN</h3>
<div class="paragraph">
<p>First create a new VLAN to be the RSPAN VLAN for the RSPAN session. You must
create the RSPAN VLAN in all switches that will participate in RSPAN. If the
RSPAN VLAN-ID is in the normal range (lower than 1005) and VTP is enabled in
the network, you can create the RSPAN VLAN in one switch, and VTP propagates it
to the other switches in the VTP domain. For extended-range VLANs (greater than
1005), you must configure RSPAN VLAN on both source and destination switches
and any intermediate switches.</p>
</div>
<div class="paragraph">
<p>Use VTP pruning to get an efficient flow of RSPAN traffic, or manually delete
the RSPAN VLAN from all trunks that do not need to carry the RSPAN traffic.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Steps</dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter a VLAN ID to create a VLAN, or enter the VLAN ID of an existing VLAN, and enter VLAN configuration mode. The range is 2 to 1001 and 1006 to 4094.
The RSPAN VLAN cannot be VLAN 1 (the default VLAN) or VLAN IDs 1002 through 1005 (reserved for Token Ring and FDDI VLANs).</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>vlan vlan-id</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the VLAN as an RSPAN VLAN.</p>
<div class="listingblock">
<div class="content">
<pre>remote-span
exit</pre>
</div>
</div>
</li>
<li>
<p>Specify the RSPAN session and the source port (monitored port).</p>
<div class="listingblock">
<div class="content">
<pre>monitor session session_number source {interface interface-id | vlan vlan-id} [, | -] [both | rx | tx]</pre>
</div>
</div>
</li>
<li>
<p>Specify the RSPAN session and the destination RSPAN VLAN.</p>
<div class="listingblock">
<div class="content">
<pre>monitor session session_number destination remote vlan vlan-id</pre>
</div>
</div>
</li>
<li>
<p>Configure the RSPAN destination session on a different switch (not the switch on which the source session was configured)</p>
<div class="listingblock">
<div class="content">
<pre>configure terminal
vlan id
  remote-span
  exit
monitor session { 1-66 | all | local | remote}
monitor session session_number source remote vlan vlan-id
 monitor session session_number destination {interface interface-id [, | -] [ingress {dot1q vlan vlan-id | isl | untagged vlan vlan-id | vlan vlan-id}]}
end</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Though visible in the command-line help string, encapsulation replicate is not supported for RSPAN. The original VLAN ID is overwritten by the RSPAN VLAN ID, and all packets appear on the destination port as untagged.</p>
</div>
<div class="paragraph">
<p>(Optional) [, | -] Specify a series or range of interfaces. Enter a space before and after the comma; enter a space before and after the hyphen.</p>
</div>
<div class="paragraph">
<p>Enter ingress with additional keywords to enable forwarding of incoming traffic on the destination port and to specify the encapsulation type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>dot1q vlan</strong> vlan-id: Forward incoming packets with IEEE 802.1Q encapsulation with the specified VLAN as the default VLAN.</p>
</li>
<li>
<p><strong>isl</strong>: Forward ingress packets with ISL encapsulation.</p>
</li>
<li>
<p><strong>untagged vlan</strong> vlan-id or <strong>vlan</strong> vlan-id: Forward incoming packets with untagged encapsulation type with the specified VLAN as the default VLAN.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_display_span_and_rspan_status">40.8. Display SPAN and RSPAN status</h3>
<div class="listingblock">
<div class="content">
<pre>Switch# show monitor session

Session 1
==========

Type              : Local Session
Source Ports      :
    RX Only       : None
    TX Only       : None
    Both          : Fa0/4
Source VLANs      :
    RX Only       : None
    TX Only       : None
    Both          : None
Source RSPAN VLAN : None
Destination Ports : Fa0/5
    Encapsulation: DOT1Q
          Ingress: Enabled, default VLAN = 5
Reflector Port    : None
Filter VLANs      : None
Dest RSPAN VLAN   : None</pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="_hdlc" class="sect0">HDLC</h1>
<div class="sect1">
<h2 id="_concepts_4">41. Concepts</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_configuration_4">42. Configuration</h2>
<div class="sectionbody">

</div>
</div>
<h1 id="_ppp" class="sect0">PPP</h1>
<div class="sect1">
<h2 id="_concepts_5">43. Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>HDLC (high-level data link control) and PPP: layer 2 on point-to-point links</p>
</li>
<li>
<p>ISO HDLC does not include a Type field , so the Cisco implementation adds a proprietary 2-byte Type field</p>
</li>
<li>
<p>hdlc : error detection, default on ios serial links</p>
</li>
<li>
<p>ppp : error detection, error recovery, standard protocol Type field, supports synchronous and asynchronous links</p>
</li>
<li>
<p>hdlc vs ppp framing</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_ppp_lcp">43.1. PPP LCP</h3>
<div class="ulist">
<ul>
<li>
<p>LCP  (link control protocol) controls features independent of any Layer 3 protocol</p>
</li>
<li>
<p>NCP ( network control protocol) for each protocol (IP, appletalk, )</p>
</li>
<li>
<p>LCP operations:</p>
</li>
<li>
<p>LCP features</p>
</li>
<li>
<p>LQM link quality monitoring: drop if % of error frames above a configured value</p>
</li>
<li>
<p>looped link detection: drop link if a router receives its own randomly chosen magic number</p>
</li>
<li>
<p>layer 2 load balancing: fragment frames over multilink PPP</p>
</li>
<li>
<p>authentication: chap, pap</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_configuration_5">43.1.1. configuration</h4>
<div class="ulist">
<ul>
<li>
<p>minimal with <strong>encapsulation ppp</strong></p>
</li>
<li>
<p>optional authentication, quality</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multilink_ppp">43.2. multilink PPP</h3>
<div class="ulist">
<ul>
<li>
<p>originally intended to combine multiple ISDN B-channels without requiring any Layer 3 load balancing</p>
</li>
<li>
<p>now load balance traffic accross any type of point-to-point serial link</p>
</li>
<li>
<p>add a header ( 2 or 4 bytes ) to allow reassembly on the receiving end</p>
</li>
<li>
<p>configuration with multilink interfaces or virtual templates</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>LFI (link fragmentation and interleaving )</p>
</li>
<li>
<p>prevents small, delay sensitive packets from having to wait on longer, delay-insensitive packets to be completely serialized out an interface.</p>
</li>
<li>
<p>the queuing scheduler generally LLQ on the multilink interface determines the next packet to send:</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_configuration_6">43.2.1. configuration</h4>
<div class="paragraph">
<p>ppp multilink interleave
ppp multilink fragment-delay ms  defines the fragment size based on size = x * bandwidth</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ppp_compression">43.3. ppp compression</h3>
<div class="ulist">
<ul>
<li>
<p>use L2 payload compression ( ip + tcp + data + DL) : best with longer packet</p>
</li>
<li>
<p>TCP header compression ( ip + tcp )</p>
</li>
<li>
<p>RTP header compression (ip + udp + rtp)</p>
</li>
<li>
<p>payload compression works best with longer packets, and header with shorter packets</p>
</li>
<li>
<p>header compression : achieves better compression ration 10:1 to 20:1</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_layer_2_compression">43.3.1. layer 2 compression</h4>
<div class="ulist">
<ul>
<li>
<p>options: LZS (Lempel-Ziv Stacker), MPPC (microsoft point-to-point compression), Predictor</p>
</li>
<li>
<p>LZS use more CPU and less RAM than Predictor algorithm and have better compression ratio</p>
</li>
<li>
<p>stacker: supports hdlc, ppp, FR, ATM</p>
</li>
<li>
<p>mppc: ppp, atm</p>
</li>
<li>
<p>predictor: ppp, atm</p>
</li>
<li>
<p>configuration with a matching <strong>compress</strong> command under each interface on both end of the links</p>
</li>
<li>
<p>once configured, ppp starts ccp (compression control protocol) which is another NCP</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_header_compression">43.3.2. header compression</h4>
<div class="ulist">
<ul>
<li>
<p>configured with legacy commands or MQC commands</p>
</li>
<li>
<p>legacy under the serial (ppp) or multilink interface</p>
</li>
<li>
<p><strong>ip tcp header-compression [passive]</strong></p>
</li>
<li>
<p><strong>ip rtp header-compression [passive]</strong></p>
</li>
<li>
<p>add also MQC commands</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_tasks_4">44. Configuration tasks</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>debug ppp authentication</pre>
</div>
</div>
<div class="paragraph">
<p>read also <a href="http://www.cisco.com/c/en/us/support/docs/wan/point-to-point-protocol-ppp/25440-debug-ppp-negotiation.html#sampdebug">understanding debug ppp negotiation</a></p>
</div>
</div>
</div>
<h1 id="_pppoe" class="sect0">PPPoE</h1>
<div class="openblock partintro">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>used for digital subscriber line (DSL) Internet access
because the public telephone network uses ATM for its transport protocol;
therefore, Ethernet frames must be encapsulated in a protocol supported over both Ethernet and ATM.</p>
</li>
<li>
<p>The PPP Client feature permits a Cisco IOS router, rather than an endpoint host, to serve as the client
in a network. This permits multiple hosts to connect over a single PPPoE connection.</p>
</li>
<li>
<p>In a DSL environment, PPP interface IP addresses are derived from an upstream DHCP server
using IP Configuration Protocol (IPCP). Therefore, IP address negotiation must be enabled on the
router’s dialer interface. This is done using the ip address negotiated command in the dialer
interface configuration.</p>
</li>
<li>
<p>Because of the 8-byte PPP header, the MTU for PPPoE is usually set to 1492 bytes so that the
entire encapsulated frame fits within the 1500-byte Ethernet frame. A maximum transmission unit
(MTU) mismatch prevents a PPPoE connection from coming up. Checking the MTU setting is a
good first step when troubleshooting PPPoE connections.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_tasks_5">45. Configuration tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Example</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pppoe-topology-example.png" alt="pppoe topology example" height="150">
</div>
</div>
<div class="paragraph">
<p>Example of config on the Edge router</p>
</div>
<div class="listingblock">
<div class="content">
<pre># conf t
(config)# interface fa0/1
(config-if)# ip address 192.168.100.1 255.255.255.0
(config-if)# ip nat inside
(config)# interface fa0/1
(config-if)# pppoe-client dial-pool-number 1
(config-if)# exit
(config)# interface dialer1
(config-if)# mtu 1492
(config-if)# encapsulation ppp
(config-if)# ip address negotiated
(config-if)# ppp authentication chap

!The remaining CHAP commands have been omitted for brevity.

(config-if)# ip nat outside
(config-if)# dialer pool 1
(config-if)# dialer-group 1
(config-if)# exit
(config)# dialer-list 1 protocol ip permit
(config)# ip nat inside source list 1 interface dialier1 overload
(config)# access-list 1 permit 192.168.100.0 0.0.0.255
(config)# ip route 0.0.0.0 0.0.0.0 dialer1</pre>
</div>
</div>
<div class="paragraph">
<p>Verify PPPoE connectivity</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show pppoe session</pre>
</div>
</div>
<div class="paragraph">
<p>Debug</p>
</div>
<div class="listingblock">
<div class="content">
<pre>debug pppoe [data | errors | events | packets]</pre>
</div>
</div>
</div>
</div>
<h1 id="_pppoe_2" class="sect0">PPPoE</h1>
<div class="openblock partintro">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>used for digital subscriber line (DSL) Internet access
because the public telephone network uses ATM for its transport protocol;
therefore, Ethernet frames must be encapsulated in a protocol supported over both Ethernet and ATM.</p>
</li>
<li>
<p>The PPP Client feature permits a Cisco IOS router, rather than an endpoint host, to serve as the client
in a network. This permits multiple hosts to connect over a single PPPoE connection.</p>
</li>
<li>
<p>In a DSL environment, PPP interface IP addresses are derived from an upstream DHCP server
using IP Configuration Protocol (IPCP). Therefore, IP address negotiation must be enabled on the
router’s dialer interface. This is done using the ip address negotiated command in the dialer
interface configuration.</p>
</li>
<li>
<p>Because of the 8-byte PPP header, the MTU for PPPoE is usually set to 1492 bytes so that the
entire encapsulated frame fits within the 1500-byte Ethernet frame. A maximum transmission unit
(MTU) mismatch prevents a PPPoE connection from coming up. Checking the MTU setting is a
good first step when troubleshooting PPPoE connections.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_tasks_6">46. Configuration tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Example</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pppoe-topology-example.png" alt="pppoe topology example" height="150">
</div>
</div>
<div class="paragraph">
<p>Example of config on the Edge router</p>
</div>
<div class="listingblock">
<div class="content">
<pre># conf t
(config)# interface fa0/1
(config-if)# ip address 192.168.100.1 255.255.255.0
(config-if)# ip nat inside
(config)# interface fa0/1
(config-if)# pppoe-client dial-pool-number 1
(config-if)# exit
(config)# interface dialer1
(config-if)# mtu 1492
(config-if)# encapsulation ppp
(config-if)# ip address negotiated
(config-if)# ppp authentication chap

!The remaining CHAP commands have been omitted for brevity.

(config-if)# ip nat outside
(config-if)# dialer pool 1
(config-if)# dialer-group 1
(config-if)# exit
(config)# dialer-list 1 protocol ip permit
(config)# ip nat inside source list 1 interface dialier1 overload
(config)# access-list 1 permit 192.168.100.0 0.0.0.255
(config)# ip route 0.0.0.0 0.0.0.0 dialer1</pre>
</div>
</div>
<div class="paragraph">
<p>Verify PPPoE connectivity</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show pppoe session</pre>
</div>
</div>
<div class="paragraph">
<p>Debug</p>
</div>
<div class="listingblock">
<div class="content">
<pre>debug pppoe [data | errors | events | packets]</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-07-06 14:36:27 SAST
</div>
</div>
</body>
</html>