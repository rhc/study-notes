<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Christian Kyony">
<title>CCIE Routing and Switching Study Notes</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: rgba(0, 0, 0, 0.8); padding: 0; margin: 0; font-family: "Noto Serif", "DejaVu Serif", serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #7a2518; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2156a5; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #1d4b8f; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.15em; margin-bottom: 0; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Open Sans", "DejaVu Sans", sans-serif; font-weight: 300; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0; font-weight: bold; }
dl dd { margin-bottom: 0; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: rgba(0, 0, 0, 0.8); border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

.keyseq { color: rgba(51, 51, 51, 0.8); }

kbd { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; display: inline-block; color: rgba(0, 0, 0, 0.8); font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: rgba(0, 0, 0, 0.8); }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Open Sans", "DejaVu Sans", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #7a2518; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f8f8f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: rgba(0, 0, 0, 0.8); padding: 1.25em; }

#footer-text { color: rgba(255, 255, 255, 0.8); line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Noto Serif", "DejaVu Serif", serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Open Sans", "DejaVu Sans", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f8; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #7a2518; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: rgba(0, 0, 0, 0.8); font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 1.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 ; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #19407c; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: rgba(0, 0, 0, 0.8); -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

dt, th.tableblock, td.content, div.footnote { text-rendering: optimizeLegibility; }

h1, h2, p, td.content, span.alt { letter-spacing: -0.01em; }

p strong, td.content strong, div.footnote strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content, span.alt { font-size: 1.0625rem; }

p { margin-bottom: 1rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

.print-only { display: none !important; }

@media print { @page { margin: 1.25cm 0.75cm; }
  * { -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
  a { color: inherit !important; text-decoration: underline !important; }
  a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  pre, blockquote, tr, img, object, svg { page-break-inside: avoid; }
  thead { display: table-header-group; }
  svg { max-width: 100%; }
  p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
  #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
  .sect1 { padding-bottom: 0 !important; }
  .sect1 + .sect1 { border: 0 !important; }
  #header > h1:first-child { margin-top: 1.25rem; }
  body.book #header { text-align: center; }
  body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
  body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
  body.book #header .details span:first-child { margin-left: 0 !important; }
  body.book #header .details br { display: block; }
  body.book #header .details br + span:before { content: none !important; }
  body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
  .listingblock code[data-lang]:before { display: block; }
  #footer { background: none !important; padding: 0 0.9375em; }
  #footer-text { color: rgba(0, 0, 0, 0.6) !important; font-size: 0.9em; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>CCIE Routing and Switching Study Notes</h1>
<div class="details">
<span id="author" class="author">Christian Kyony</span><br>
<span id="email" class="email"><a href="mailto:ckyony@changamuka.com">ckyony@changamuka.com</a></span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">2015-10-12</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_dedication">Dedication</a></li>
<li><a href="#_part_i_layer_2_technologies">Part I : Layer 2 Technologies</a>
<ul class="sectlevel1">
<li><a href="#_switch_administration">1. Switch Administration</a>
<ul class="sectlevel2">
<li><a href="#_interface_characteristics">1.1. Interface Characteristics</a></li>
<li><a href="#_system_clock">1.2. System Clock</a></li>
<li><a href="#_system_name_and_prompt">1.3. System Name and Prompt</a></li>
<li><a href="#_motd_login_banner">1.4. MOTD Login Banner</a></li>
<li><a href="#_login_banner">1.5. Login Banner</a></li>
<li><a href="#_mac_address_table">1.6. MAC Address Table</a>
<ul class="sectlevel3">
<li><a href="#_aging_time">1.6.1. Aging Time</a></li>
<li><a href="#_mac_address_change_notification_traps">1.6.2. MAC Address Change Notification Traps</a></li>
<li><a href="#_mac_address_move_notification_traps">1.6.3. MAC Address Move Notification Traps</a></li>
<li><a href="#_mac_treshold_notification_traps">1.6.4. MAC Treshold Notification Traps</a></li>
<li><a href="#_static_address">1.6.5. Static Address</a></li>
<li><a href="#_unicast_mac_address_filtering">1.6.6. Unicast MAC Address Filtering</a></li>
<li><a href="#_mac_address_learning">1.6.7. MAC Address Learning</a></li>
</ul>
</li>
<li><a href="#_error_disable">1.7. Error disable</a>
<ul class="sectlevel3">
<li><a href="#_err_disable_detection">1.7.1. Err-Disable detection</a></li>
<li><a href="#_link_flap_detection">1.7.2. Link-flap detection</a></li>
<li><a href="#_loopback_error">1.7.3. Loopback error</a></li>
<li><a href="#_l2tp_guard">1.7.4. L2TP guard</a></li>
<li><a href="#_incorrect_gbic_small_form_factor_pluggable_module_or_cable">1.7.5. Incorrect GBIC / Small Form-Factor Pluggable module or cable</a></li>
<li><a href="#_err_disable_recovery">1.7.6. Err-Disable recovery</a></li>
</ul>
</li>
<li><a href="#_l2_mtu">1.8. L2 MTU</a></li>
<li><a href="#_switch_internal_processing">1.9. Switch Internal Processing</a></li>
<li><a href="#_switching_and_bridging_logic">1.10. Switching and Bridging Logic</a></li>
</ul>
</li>
<li><a href="#_ethernet">2. Ethernet</a>
<ul class="sectlevel2">
<li><a href="#_frame_formats">2.1. Frame Formats</a></li>
<li><a href="#_ethernet_mac_addresses">2.2. Ethernet MAC Addresses</a>
<ul class="sectlevel3">
<li><a href="#_types_of_mac_addresses">2.2.1. Types Of MAC Addresses</a></li>
</ul>
</li>
<li><a href="#_rj_45_pinouts_and_cat5_wiring">2.3. RJ-45 Pinouts and Cat5 Wiring</a></li>
<li><a href="#_auto_negotiation_speed_and_duplex">2.4. Auto-Negotiation, Speed and Duplex</a></li>
<li><a href="#_standards">2.5. Standards</a></li>
<li><a href="#_ethertype">2.6. Ethertype</a></li>
<li><a href="#_troubleshooting">2.7. Troubleshooting</a>
<ul class="sectlevel3">
<li><a href="#_problems_and_approaches">2.7.1. Problems and Approaches</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cdp_lldp_and_udld">3. CDP, LLDP and UDLD</a>
<ul class="sectlevel2">
<li><a href="#_cdp">3.1. CDP</a>
<ul class="sectlevel3">
<li><a href="#_packet_format">3.1.1. Packet Format</a></li>
<li><a href="#_cdp_operations">3.1.2. CDP Operations</a></li>
<li><a href="#_cdp_updates">3.1.3. CDP Updates</a></li>
<li><a href="#_version">3.1.4. Version</a></li>
<li><a href="#_monitoring_and_maintenance">3.1.5. Monitoring and Maintenance</a></li>
<li><a href="#_neighbors">3.1.6. Neighbors</a></li>
</ul>
</li>
<li><a href="#_lldp">3.2. LLDP</a>
<ul class="sectlevel3">
<li><a href="#_lldp_global_state">3.2.1. LLDP Global State</a></li>
<li><a href="#_lldp_interfaces">3.2.2. LLDP Interfaces</a></li>
<li><a href="#_neighbors_2">3.2.3. Neighbors</a></li>
<li><a href="#_timers">3.2.4. Timers</a></li>
<li><a href="#_tlv">3.2.5. TLV</a></li>
<li><a href="#_network_policy_profiles">3.2.6. Network-Policy Profiles</a></li>
<li><a href="#_lldp_med">3.2.7. LLDP-MED</a></li>
<li><a href="#_wired_location_service">3.2.8. Wired Location Service</a></li>
</ul>
</li>
<li><a href="#_udld">3.3. UDLD</a>
<ul class="sectlevel3">
<li><a href="#_operations">3.3.1. Operations</a></li>
<li><a href="#_default_configuration">3.3.2. Default Configuration</a></li>
<li><a href="#_udld_error_disabled_state">3.3.3. UDLD Error-Disabled State</a></li>
<li><a href="#_udld_vs_loop_guard">3.3.4. UDLD vs Loop Guard</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_vlans_and_trunking">4. VLANs and Trunking</a>
<ul class="sectlevel2">
<li><a href="#_normal_and_extended_vlans">4.1. Normal and Extended VLANs</a>
<ul class="sectlevel3">
<li><a href="#_vlan_numbering">4.1.1. VLAN Numbering</a></li>
<li><a href="#_vlan_trunks">4.1.2. VLAN Trunks</a></li>
<li><a href="#_basic_configuration">4.1.3. Basic Configuration</a></li>
<li><a href="#_vlan_state">4.1.4. VLAN State</a></li>
<li><a href="#_troubleshoot">4.1.5. Troubleshoot</a></li>
</ul>
</li>
<li><a href="#_voice_vlans">4.2. Voice VLANs</a></li>
<li><a href="#_private_vlans">4.3. Private VLANs</a>
<ul class="sectlevel3">
<li><a href="#_primary_vlans">4.3.1. Primary VLANs</a></li>
<li><a href="#_isolated_vlans">4.3.2. Isolated VLANs</a></li>
<li><a href="#_community_vlans">4.3.3. Community VLANs</a></li>
<li><a href="#_private_vlan_host_port">4.3.4. Private-Vlan Host Port</a></li>
<li><a href="#_private_vlan_promiscuous_ports">4.3.5. Private-VLAN Promiscuous Ports</a></li>
<li><a href="#_private_vlan_svi">4.3.6. Private-VLAN SVI</a></li>
<li><a href="#_private_vlan_accross_multiple_switches">4.3.7. Private-Vlan Accross Multiple Switches</a></li>
<li><a href="#_interaction_with_other_features">4.3.8. Interaction with Other Features</a></li>
<li><a href="#_pvlan_edge_or_protected_ports">4.3.9. PVLAN Edge or Protected Ports</a></li>
</ul>
</li>
<li><a href="#_vtp">4.4. VTP</a>
<ul class="sectlevel3">
<li><a href="#_vtp_version">4.4.1. VTP Version</a></li>
<li><a href="#_vtp_message_format">4.4.2. VTP Message Format</a></li>
<li><a href="#_vtp_domain">4.4.3. VTP Domain</a></li>
<li><a href="#_configuration_revision_number">4.4.4. Configuration Revision Number</a></li>
<li><a href="#_vtp_modes">4.4.5. VTP Modes</a></li>
<li><a href="#_vtp_security">4.4.6. VTP Security</a></li>
<li><a href="#_vtp_pruning">4.4.7. VTP Pruning</a></li>
<li><a href="#_troubleshooting_2">4.4.8. Troubleshooting</a></li>
</ul>
</li>
<li><a href="#_dtp">4.5. DTP</a>
<ul class="sectlevel3">
<li><a href="#_trunking_between_a_switch_and_a_router">4.5.1. Trunking Between a Switch and a Router</a></li>
<li><a href="#_verify">4.5.2. Verify</a></li>
</ul>
</li>
<li><a href="#_isl">4.6. ISL</a>
<ul class="sectlevel3">
<li><a href="#_frame">4.6.1. Frame</a></li>
</ul>
</li>
<li><a href="#_ieee_802_1q">4.7. IEEE 802.1Q</a>
<ul class="sectlevel3">
<li><a href="#_frame_format">4.7.1. Frame Format</a></li>
<li><a href="#_ethernet_frame_size_with_802_1q_tagging">4.7.2. Ethernet Frame Size with 802.1Q Tagging</a></li>
<li><a href="#_native_vlan">4.7.3. Native VLAN</a></li>
</ul>
</li>
<li><a href="#_802_1q_in_q_tunneling">4.8. 802.1Q-In-Q Tunneling</a>
<ul class="sectlevel3">
<li><a href="#_frame_2">4.8.1. Frame</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_spanning_tree_protocols">5. Spanning Tree Protocols</a>
<ul class="sectlevel2">
<li><a href="#_802_1d_common_spanning_tree">5.1. 802.1d Common Spanning Tree</a>
<ul class="sectlevel3">
<li><a href="#_bpdu">5.1.1. BPDU</a></li>
<li><a href="#_root_bridge">5.1.2. Root Bridge</a></li>
<li><a href="#_root_port">5.1.3. Root Port</a></li>
<li><a href="#_designated_port">5.1.4. Designated Port</a></li>
<li><a href="#_blocking_ports">5.1.5. Blocking Ports</a></li>
<li><a href="#_convergence">5.1.6. Convergence</a></li>
<li><a href="#_topology_change_notification">5.1.7. Topology Change Notification</a></li>
<li><a href="#_timers_2">5.1.8. Timers</a></li>
</ul>
</li>
<li><a href="#_pvst_per_vlan_stp">5.2. PVST+ Per-Vlan STP</a></li>
<li><a href="#_optimizing_improving_spanning_tree">5.3. Optimizing, Improving Spanning Tree</a>
<ul class="sectlevel3">
<li><a href="#_portfast">5.3.1. PortFast</a></li>
<li><a href="#_uplinkfast">5.3.2. UplinkFast</a></li>
<li><a href="#_backbonefast">5.3.3. BackboneFast</a></li>
<li><a href="#_bpdu_guard">5.3.4. BPDU Guard</a></li>
<li><a href="#_bpdu_filter">5.3.5. BPDU Filter</a></li>
<li><a href="#_loop_guard">5.3.6. Loop Guard</a></li>
<li><a href="#_root_guard">5.3.7. Root Guard</a></li>
</ul>
</li>
<li><a href="#_802_1w_rapid_stp">5.4. 802.1w Rapid STP</a>
<ul class="sectlevel3">
<li><a href="#_rstp_link_types">5.4.1. RSTP Link Types</a></li>
<li><a href="#_rstp_port_types">5.4.2. RSTP Port Types</a></li>
<li><a href="#_rstp_port_states">5.4.3. RSTP Port States</a></li>
<li><a href="#_rstp_port_roles">5.4.4. RSTP Port Roles</a></li>
<li><a href="#_proposal_agreement_process">5.4.5. Proposal/Agreement Process</a></li>
<li><a href="#_topology_change_handling">5.4.6. Topology Change Handling</a></li>
</ul>
</li>
<li><a href="#_802_1s_multiple_spanning_trees">5.5. 802.1s Multiple Spanning Trees</a>
<ul class="sectlevel3">
<li><a href="#_mst_region">5.5.1. MST Region</a></li>
<li><a href="#_mst_region_ports">5.5.2. MST region ports</a></li>
<li><a href="#_mst_revision_number">5.5.3. MST Revision Number</a></li>
<li><a href="#_mst_instance">5.5.4. MST Instance</a></li>
</ul>
</li>
<li><a href="#_protecting_against_unidirectional_link_issues">5.6. Protecting Against Unidirectional Link Issues</a>
<ul class="sectlevel3">
<li><a href="#_udld_2">5.6.1. UDLD</a></li>
<li><a href="#_bridge_assurance">5.6.2. Bridge Assurance</a></li>
<li><a href="#_dispute_mechanism">5.6.3. Dispute Mechanism</a></li>
<li><a href="#_unicast_flooding">5.6.4. Unicast Flooding</a></li>
</ul>
</li>
<li><a href="#_troubleshooting_3">5.7. Troubleshooting</a>
<ul class="sectlevel3">
<li><a href="#_flapping_port_that_is_generating_bpdus_with_the_tcn_bit_set">5.7.1. Flapping Port That Is Generating BPDUs with the TCN Bit Set</a></li>
</ul>
</li>
<li><a href="#_alternatives_to_stp">5.8. Alternatives to STP</a></li>
</ul>
</li>
<li><a href="#_etherchannel">6. EtherChannel</a>
<ul class="sectlevel2">
<li><a href="#_etherchannel_2">6.1. EtherChannel</a>
<ul class="sectlevel3">
<li><a href="#_link_aggregation_protocol">6.1.1. Link Aggregation Protocol</a></li>
<li><a href="#_layer_2_etherchannels">6.1.2. Layer 2 EtherChannels</a></li>
<li><a href="#_layer_3_etherchannels">6.1.3. Layer 3 EtherChannels</a></li>
<li><a href="#_etherchannel_modes">6.1.4. EtherChannel Modes</a></li>
<li><a href="#_etherchannel_misconfiguration_guard">6.1.5. EtherChannel Misconfiguration Guard</a></li>
<li><a href="#_vlan_internal_allocation_policy">6.1.6. Vlan internal allocation policy</a></li>
</ul>
</li>
<li><a href="#_lacp">6.2. LACP</a>
<ul class="sectlevel3">
<li><a href="#_restrictions">6.2.1. Restrictions</a></li>
<li><a href="#_modes">6.2.2. Modes</a></li>
<li><a href="#_lacp_hot_standby_ports">6.2.3. LACP Hot-Standby Ports</a></li>
<li><a href="#_lacp_port_channel_maxbundle_feature">6.2.4. LACP Port-Channel MaxBundle Feature</a></li>
<li><a href="#_lacp_port_channel_min_links_feature">6.2.5. LACP Port-Channel Min-Links Feature</a></li>
</ul>
</li>
<li><a href="#_pagp">6.3. PAgP</a>
<ul class="sectlevel3">
<li><a href="#_modes_2">6.3.1. Modes</a></li>
<li><a href="#_physical_vs_aggregate_learners">6.3.2. Physical Vs Aggregate Learners</a></li>
<li><a href="#_priority">6.3.3. Priority</a></li>
<li><a href="#_restrictions_2">6.3.4. Restrictions</a></li>
<li><a href="#_silent_mode">6.3.5. Silent Mode</a></li>
</ul>
</li>
<li><a href="#_span_rspan_and_erspan">6.4. SPAN , RSPAN and ERSPAN</a>
<ul class="sectlevel3">
<li><a href="#_local_span_sessions">6.4.1. Local SPAN Sessions</a></li>
<li><a href="#_remote_span_sessions">6.4.2. Remote SPAN Sessions</a></li>
<li><a href="#_encapsulated_rspan">6.4.3. Encapsulated RSPAN</a></li>
<li><a href="#_interaction_with_other_features_2">6.4.4. Interaction with Other Features</a></li>
</ul>
</li>
<li><a href="#_virtual_switch_system">6.5. Virtual Switch System</a>
<ul class="sectlevel3">
<li><a href="#_vss_active_and_standby_switch">6.5.1. VSS Active and Standby Switch</a></li>
<li><a href="#_virtual_switch_link">6.5.2. Virtual Switch Link</a></li>
<li><a href="#_multi_chassis_ethernet_channel">6.5.3. Multi-chassis Ethernet Channel</a></li>
</ul>
</li>
<li><a href="#_vpc">6.6. vPC</a></li>
</ul>
</li>
<li><a href="#_stackwise">7. Stackwise</a>
<ul class="sectlevel2">
<li><a href="#_port_based_traffic_control">7.1. Port-Based Traffic Control</a>
<ul class="sectlevel3">
<li><a href="#_storm_control">7.1.1. Storm Control</a></li>
<li><a href="#_protocol_storm_protection">7.1.2. Protocol Storm Protection</a></li>
<li><a href="#_protected_port">7.1.3. Protected Port</a></li>
<li><a href="#_port_blocking">7.1.4. Port Blocking</a></li>
<li><a href="#_port_security">7.1.5. Port Security</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_wan">8. WAN</a>
<ul class="sectlevel2">
<li><a href="#_hdlc">8.1. HDLC</a>
<ul class="sectlevel3">
<li><a href="#_hdlc_frame_format">8.1.1. HDLC Frame Format</a></li>
<li><a href="#_encapsulation">8.1.2. Encapsulation</a></li>
<li><a href="#_clock_rate">8.1.3. Clock Rate</a></li>
</ul>
</li>
<li><a href="#_ppp">8.2. PPP</a>
<ul class="sectlevel3">
<li><a href="#_ppp_frame_format">8.2.1. PPP Frame Format</a></li>
<li><a href="#_ppp_lcp">8.2.2. PPP LCP</a></li>
<li><a href="#_multilink_ppp">8.2.3. Multilink PPP</a></li>
<li><a href="#_ppp_compression">8.2.4. PPP Compression</a></li>
<li><a href="#_ppp_authentication">8.2.5. PPP Authentication</a></li>
<li><a href="#_mlpp">8.2.6. MLPP</a></li>
</ul>
</li>
<li><a href="#_pppoe">8.3. PPPoE</a>
<ul class="sectlevel3">
<li><a href="#_pppoe_packets">8.3.1. PPPoE packets</a></li>
<li><a href="#_pppoe_server">8.3.2. PPPoE Server</a></li>
<li><a href="#_pppoe_client">8.3.3. PPPOE Client</a></li>
<li><a href="#_pppoe_authentication">8.3.4. PPPoE Authentication</a></li>
</ul>
</li>
<li><a href="#_ethernet_wan">8.4. Ethernet WAN</a>
<ul class="sectlevel3">
<li><a href="#_vpls">8.4.1. VPLS</a></li>
<li><a href="#_metro_ethernet">8.4.2. Metro-Ethernet</a></li>
<li><a href="#_ethernet_private_line_epl">8.4.3. Ethernet Private Line (EPL)</a></li>
<li><a href="#_ethernet_virtual_private_line_evpl">8.4.4. Ethernet Virtual Private Line (EVPL)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_part_ii_layer_3_technologies">Part II : Layer 3 Technologies</a>
<ul class="sectlevel1">
<li><a href="#_ipv4">9. IPv4</a>
<ul class="sectlevel2">
<li><a href="#_ip_packet_format">9.1. IP Packet Format</a></li>
<li><a href="#_ip_address">9.2. IP Address</a></li>
<li><a href="#_cidr">9.3. CIDR</a></li>
<li><a href="#_private_addressing">9.4. Private Addressing</a></li>
<li><a href="#_vlsm">9.5. VLSM</a></li>
<li><a href="#_subnet_zero">9.6. Subnet Zero</a></li>
<li><a href="#_unnumbered_interfaces">9.7. Unnumbered Interfaces</a></li>
<li><a href="#_31_bit_prefix">9.8. 31-Bit Prefix</a></li>
<li><a href="#_checksum">9.9. Checksum</a>
<ul class="sectlevel3">
<li><a href="#_sender">9.9.1. Sender</a></li>
<li><a href="#_receiver">9.9.2. Receiver</a></li>
</ul>
</li>
<li><a href="#_protocol">9.10. Protocol</a></li>
<li><a href="#_ip_options">9.11. IP Options</a></li>
<li><a href="#_ip_fragmentation_and_re_assembly">9.12. IP fragmentation and Re-assembly</a></li>
</ul>
</li>
<li><a href="#_icmp">10. ICMP</a>
<ul class="sectlevel2">
<li><a href="#_header">10.1. Header</a></li>
<li><a href="#_control_messages">10.2. Control Messages</a></li>
<li><a href="#_icmp_unreachable_messages">10.3. ICMP Unreachable Messages</a></li>
<li><a href="#_icmp_source_quench_messages">10.4. ICMP Source Quench Messages</a></li>
<li><a href="#_icmp_redirect_messages">10.5. ICMP Redirect Messages</a></li>
<li><a href="#_icmp_echo_request">10.6. ICMP Echo Request</a></li>
<li><a href="#_icmp_router_messages">10.7. ICMP Router  Messages</a></li>
<li><a href="#_icmp_time_exceeded">10.8. ICMP Time Exceeded</a></li>
<li><a href="#_parameter_problem">10.9. Parameter Problem</a></li>
<li><a href="#_timestamp_messages">10.10. Timestamp Messages</a></li>
<li><a href="#_information_request">10.11. Information Request</a></li>
<li><a href="#_address_mask_messages">10.12. Address Mask Messages</a></li>
<li><a href="#_ping">10.13. Ping</a></li>
<li><a href="#_traceroute">10.14. Traceroute</a></li>
</ul>
</li>
<li><a href="#_tcp">11. TCP</a>
<ul class="sectlevel2">
<li><a href="#_connection_establishment">11.1. Connection establishment</a></li>
<li><a href="#_tcp_mss">11.2. TCP MSS</a></li>
<li><a href="#_tcp_window">11.3. TCP Window</a></li>
<li><a href="#_sliding_window_operations">11.4. Sliding window operations</a></li>
<li><a href="#_tcp_options">11.5. TCP Options</a></li>
<li><a href="#_ident">11.6. Ident</a></li>
<li><a href="#_tcp_small_servers">11.7. TCP Small Servers</a></li>
</ul>
</li>
<li><a href="#_udp">12. UDP</a>
<ul class="sectlevel2">
<li><a href="#_message_format">12.1. Message Format</a></li>
<li><a href="#_udp_checksum">12.2. UDP checksum</a></li>
<li><a href="#_udp_dominance">12.3. UDP dominance</a></li>
<li><a href="#_udp_small_servers">12.4. UDP Small Servers</a></li>
</ul>
</li>
<li><a href="#_arp">13. ARP</a>
<ul class="sectlevel2">
<li><a href="#_protocol_2">13.1. Protocol</a></li>
<li><a href="#_static_arp_entries">13.2. Static ARP Entries</a></li>
<li><a href="#_dynamic_arp_entries">13.3. Dynamic ARP Entries</a></li>
<li><a href="#_proxy_arp">13.4. Proxy ARP</a></li>
<li><a href="#_gratuitous_arp">13.5. Gratuitous ARP</a></li>
<li><a href="#_rarp_and_bootp_as_dhcp_precursors">13.6. RARP and BootP As DHCP Precursors</a></li>
<li><a href="#_arp_vulnerabilities">13.7. ARP vulnerabilities</a></li>
</ul>
</li>
<li><a href="#_dhcp">14. DHCP</a>
<ul class="sectlevel2">
<li><a href="#_protocol_operations">14.1. Protocol Operations</a></li>
<li><a href="#_dhcp_client">14.2. DHCP Client</a>
<ul class="sectlevel3">
<li><a href="#_configurable_dhcp_client_feature">14.2.1. Configurable DHCP Client Feature</a></li>
<li><a href="#_forcerenew_message_handling">14.2.2. FORCERENEW Message Handling</a></li>
</ul>
</li>
<li><a href="#_dhcp_server">14.3. DHCP Server</a>
<ul class="sectlevel3">
<li><a href="#_database_agent">14.3.1. Database Agent</a></li>
<li><a href="#_address_pool">14.3.2. Address Pool</a></li>
<li><a href="#_address_bindings">14.3.3. Address Bindings</a></li>
<li><a href="#_static_mapping">14.3.4. Static Mapping</a></li>
<li><a href="#_pings">14.3.5. Pings</a></li>
<li><a href="#_bootp_interoperability">14.3.6. BOOTP Interoperability</a></li>
<li><a href="#_central_dhcp_server">14.3.7. Central DHCP Server</a></li>
<li><a href="#_option_82">14.3.8. Option 82</a></li>
<li><a href="#_statistics">14.3.9. Statistics</a></li>
</ul>
</li>
<li><a href="#_dhcp_relay_agent">14.4. DHCP Relay Agent</a>
<ul class="sectlevel3">
<li><a href="#_option_82_2">14.4.1. Option 82</a></li>
</ul>
</li>
<li><a href="#_accounting_and_security">14.5. Accounting and Security</a>
<ul class="sectlevel3">
<li><a href="#_dhcp_accounting">14.5.1. DHCP Accounting</a></li>
<li><a href="#_dhcp_secured_ip_address_assignment">14.5.2. DHCP Secured IP Address Assignment</a></li>
<li><a href="#_dhcp_per_interface_lease_limit_and_statistics">14.5.3. DHCP Per Interface Lease Limit and Statistics</a></li>
<li><a href="#_dhcp_authorized_arp">14.5.4. DHCP Authorized ARP</a></li>
<li><a href="#_arp_auto_logoff">14.5.5. ARP Auto-Logoff</a></li>
</ul>
</li>
<li><a href="#_dhcp_snooping">14.6. DHCP Snooping</a></li>
</ul>
</li>
<li><a href="#_nat">15. NAT</a>
<ul class="sectlevel2">
<li><a href="#_purpose">15.1. Purpose</a></li>
<li><a href="#_inside_and_outside_address">15.2. Inside and Outside Address</a></li>
<li><a href="#_static_nat">15.3. Static NAT</a></li>
<li><a href="#_dynamic_nat_without_pat">15.4. Dynamic NAT Without PAT</a></li>
<li><a href="#_pat">15.5. PAT</a></li>
<li><a href="#_nat_for_overlapping_address">15.6. NAT for Overlapping Address</a></li>
<li><a href="#_tcp_load_distribution_for_nat">15.7. TCP Load Distribution for NAT</a></li>
<li><a href="#_overlapping_networks">15.8. Overlapping Networks</a></li>
<li><a href="#_server_tcp_load_balancing">15.9. Server TCP Load Balancing</a></li>
<li><a href="#_nat_order_of_operations">15.10. NAT Order Of Operations</a>
<ul class="sectlevel3">
<li><a href="#_inside_to_outside">15.10.1. Inside-to-Outside</a></li>
<li><a href="#_outside_to_inside">15.10.2. Outside-to-Inside</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_nhrp">16. NHRP</a></li>
<li><a href="#_ipv6">17. IPv6</a>
<ul class="sectlevel2">
<li><a href="#_ipv6_header">17.1. IPv6 Header</a></li>
<li><a href="#_traffic_class">17.2. Traffic Class</a></li>
<li><a href="#_flow_label">17.3. Flow Label</a></li>
<li><a href="#_payload_length">17.4. Payload Length</a></li>
<li><a href="#_next_header">17.5. Next Header</a>
<ul class="sectlevel3">
<li><a href="#_hop_by_hop_options_and_destination_options">17.5.1. Hop-by-hop options and destination options</a></li>
<li><a href="#_routing_extension_header">17.5.2. Routing Extension Header</a></li>
<li><a href="#_fragment_extension_header">17.5.3. Fragment Extension Header</a></li>
</ul>
</li>
<li><a href="#_fragmentation_and_reassembly">17.6. Fragmentation And Reassembly</a>
<ul class="sectlevel3">
<li><a href="#_fragmenting">17.6.1. Fragmenting</a></li>
<li><a href="#_re_assembly">17.6.2. Re-Assembly</a></li>
<li><a href="#_security">17.6.3. Security</a></li>
</ul>
</li>
<li><a href="#_addressing">17.7. Addressing</a>
<ul class="sectlevel3">
<li><a href="#_ipv4_vs_ipv6">17.7.1. IPv4 Vs IPv6</a></li>
<li><a href="#_address_abbreviation_rules">17.7.2. Address Abbreviation Rules</a></li>
<li><a href="#_address_types">17.7.3. Address Types</a></li>
<li><a href="#_ipv6_address_autoconfiguration">17.7.4. IPv6 Address Autoconfiguration</a></li>
</ul>
</li>
<li><a href="#_basic_ipv6_functionality_protocols">17.8. Basic  IPv6 Functionality Protocols</a>
<ul class="sectlevel3">
<li><a href="#_neighbor_discovery">17.8.1. Neighbor Discovery</a></li>
<li><a href="#_icmpv6">17.8.2. ICMPv6</a></li>
<li><a href="#_dns">17.8.3. DNS</a></li>
<li><a href="#_cdp_2">17.8.4. CDP</a></li>
<li><a href="#_dhcp_2">17.8.5. DHCP</a></li>
<li><a href="#_access_lists">17.8.6. Access Lists</a></li>
</ul>
</li>
<li><a href="#_ipv6_tunneling">17.9. IPv6 tunneling</a>
<ul class="sectlevel3">
<li><a href="#_6in4">17.9.1. 6in4</a></li>
<li><a href="#_6to4">17.9.2. 6to4</a></li>
<li><a href="#_isatap">17.9.3. ISATAP</a></li>
<li><a href="#_6rd">17.9.4. 6RD</a></li>
<li><a href="#_6vpe">17.9.5. 6VPE</a></li>
</ul>
</li>
<li><a href="#_ipv6_routing">17.10. IPv6 Routing</a>
<ul class="sectlevel3">
<li><a href="#_static_routes">17.10.1. Static Routes</a></li>
<li><a href="#_ospfv3">17.10.2. OSPFv3</a></li>
<li><a href="#_eigrpv6">17.10.3. EIGRPv6</a></li>
</ul>
</li>
<li><a href="#_ospfv3_2">17.11. Ospfv3</a></li>
<li><a href="#_readings">17.12. Readings</a>
<ul class="sectlevel3">
<li><a href="#_ipv6_general_prefix">17.12.1. IPv6 General Prefix</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cef">18. CEF</a>
<ul class="sectlevel2">
<li><a href="#_fib">18.1. FIB</a></li>
<li><a href="#_adjacency_table">18.2. Adjacency Table</a>
<ul class="sectlevel3">
<li><a href="#_adjacency_discovery">18.2.1. Adjacency Discovery</a></li>
<li><a href="#_unresolved_adjacency">18.2.2. Unresolved Adjacency</a></li>
</ul>
</li>
<li><a href="#_cef_load_balancing">18.3. CEF Load Balancing</a></li>
</ul>
</li>
<li><a href="#_bfd">19. BFD</a>
<ul class="sectlevel2">
<li><a href="#_bfd_control_packet_format">19.1. BFD Control Packet Format</a></li>
<li><a href="#_bfd_operating_modes">19.2. BFD operating modes</a></li>
<li><a href="#_bfd_session_parameters_on_the_interface">19.3. BFD Session Parameters on the Interface</a></li>
<li><a href="#_bfd_support_for_dynamic_routing">19.4. BFD Support for Dynamic Routing</a></li>
<li><a href="#_bfd_support_for_static_routing">19.5. BFD Support for Static Routing</a></li>
<li><a href="#_bfd_templates_for_multi_hop">19.6. BFD Templates for Multi-Hop</a></li>
<li><a href="#_bfd_multihop_support_for_ipv4_static_routes">19.7. BFD Multihop Support for IPv4 Static Routes</a>
<ul class="sectlevel3">
<li><a href="#_bfdv4_associated_mode">19.7.1. BFDv4 Associated Mode</a></li>
<li><a href="#_bfdv4_unassociated_mode">19.7.2. BFDv4 Unassociated Mode</a></li>
</ul>
</li>
<li><a href="#_bfd_on_multiple_hops">19.8. BFD on Multiple Hops</a></li>
<li><a href="#_bfd_dampening">19.9. BFD dampening</a></li>
</ul>
</li>
<li><a href="#_rip">20. RIP</a>
<ul class="sectlevel2">
<li><a href="#_rip_messages">20.1. RIP Messages</a></li>
<li><a href="#_request_message">20.2. Request Message</a></li>
<li><a href="#_response_message">20.3. Response Message</a></li>
<li><a href="#_default_rip_configuration">20.4. Default RIP Configuration</a></li>
<li><a href="#_basic_configuration_2">20.5. Basic Configuration</a></li>
<li><a href="#_version_2">20.6. Version</a></li>
<li><a href="#_authentication">20.7. Authentication</a></li>
<li><a href="#_summarization">20.8. Summarization</a></li>
<li><a href="#_route_updates">20.9. Route Updates</a></li>
<li><a href="#_route_filtering">20.10. Route Filtering</a></li>
<li><a href="#_route_metric">20.11. Route Metric</a></li>
<li><a href="#_split_horizon">20.12. Split Horizon</a></li>
<li><a href="#_interpacket_delay_for_rip_updates">20.13. Interpacket Delay for RIP Updates</a></li>
<li><a href="#_rip_optimization_over_wan">20.14. Rip Optimization Over WAN</a></li>
<li><a href="#_timers_3">20.15. Timers</a></li>
</ul>
</li>
<li><a href="#_eigrp">21. EIGRP</a>
<ul class="sectlevel2">
<li><a href="#_eigrp_packet_format">21.1. EIGRP Packet Format</a></li>
<li><a href="#_eigrp_messages">21.2. EIGRP Messages</a></li>
<li><a href="#_neighbors_3">21.3. Neighbors</a></li>
<li><a href="#_eigrp_loop_prevention_techniques">21.4. EIGRP Loop Prevention Techniques</a>
<ul class="sectlevel3">
<li><a href="#_split_horizon_2">21.4.1. Split Horizon</a></li>
</ul>
</li>
<li><a href="#_classic_metric">21.5. Classic Metric</a>
<ul class="sectlevel3">
<li><a href="#_bandwith_metric_component">21.5.1. Bandwith Metric Component</a></li>
<li><a href="#_delay_metric_component">21.5.2. Delay Metric Component</a></li>
<li><a href="#_reliability_metric_component">21.5.3. Reliability Metric Component</a></li>
<li><a href="#_load_metric_component">21.5.4. Load Metric Component</a></li>
<li><a href="#_mtu_metric_component">21.5.5. MTU Metric Component</a></li>
<li><a href="#_hop_count_metric_component">21.5.6. Hop Count Metric Component</a></li>
<li><a href="#_routing_metric_offset_lists">21.5.7. Routing Metric Offset Lists</a></li>
</ul>
</li>
<li><a href="#_wide_metric">21.6. Wide Metric</a>
<ul class="sectlevel3">
<li><a href="#_throughput">21.6.1. Throughput</a></li>
<li><a href="#_latency_metric_component">21.6.2. Latency Metric Component</a></li>
<li><a href="#_reliability">21.6.3. Reliability</a></li>
<li><a href="#_load">21.6.4. Load</a></li>
<li><a href="#_mtu">21.6.5. MTU</a></li>
<li><a href="#_hop_count">21.6.6. Hop Count</a></li>
<li><a href="#_extended_metrics">21.6.7. Extended Metrics</a></li>
</ul>
</li>
<li><a href="#_reliable_transport_protocol">21.7. Reliable Transport Protocol</a></li>
<li><a href="#_eigrp_autonomous_system_configuration">21.8. EIGRP Autonomous System Configuration</a></li>
<li><a href="#_eigrp_named_configuration">21.9. EIGRP Named Configuration</a>
<ul class="sectlevel3">
<li><a href="#_address_family_section">21.9.1. Address Family Section</a></li>
<li><a href="#_per_af_interface_section">21.9.2. Per-AF-Interface Section</a></li>
<li><a href="#_per_af_topology_configuration_section">21.9.3. Per-AF-Topology Configuration Section</a></li>
</ul>
</li>
<li><a href="#_dual">21.10. DUAL</a>
<ul class="sectlevel3">
<li><a href="#_topology_table">21.10.1. Topology Table</a></li>
<li><a href="#_feasibility_condition">21.10.2. Feasibility Condition</a></li>
<li><a href="#_topology_changes">21.10.3. Topology Changes</a></li>
<li><a href="#_local_computation">21.10.4. Local Computation</a></li>
<li><a href="#_diffusing_computation">21.10.5. Diffusing Computation</a></li>
<li><a href="#_multiple_topology_changes">21.10.6. Multiple Topology Changes</a></li>
<li><a href="#_stuck_in_active">21.10.7. Stuck-In-Active</a></li>
</ul>
</li>
<li><a href="#_stub_routing">21.11. Stub Routing</a></li>
<li><a href="#_eigrp_stub_routing_leak_map_support">21.12. EIGRP Stub Routing Leak Map Support</a></li>
<li><a href="#_protocol_dependent_modules">21.13. Protocol-Dependent Modules</a></li>
<li><a href="#_goodbye_message_and_graceful_shutdown">21.14. Goodbye Message and Graceful Shutdown</a></li>
<li><a href="#_summarization_2">21.15. Summarization</a>
<ul class="sectlevel3">
<li><a href="#_leak_map">21.15.1. Leak Map</a></li>
<li><a href="#_floating_summary_routes">21.15.2. Floating Summary Routes</a></li>
<li><a href="#_poisoned_floating_summarization">21.15.3. Poisoned Floating Summarization</a></li>
</ul>
</li>
<li><a href="#_eigrp_route_authentication">21.16. EIGRP Route Authentication</a></li>
<li><a href="#_link_bandwidth_percentage">21.17. Link Bandwidth Percentage</a></li>
<li><a href="#_eigrp_autonomous_system_configuration_2">21.18. EIGRP Autonomous System Configuration</a></li>
<li><a href="#_router_id">21.19. Router ID</a></li>
<li><a href="#_unequal_load_balancing">21.20. Unequal Load Balancing</a></li>
<li><a href="#_add_path_support">21.21. Add-Path Support</a></li>
<li><a href="#_passive_interface">21.22. Passive Interface</a></li>
<li><a href="#_eigrp_over_the_top">21.23. EIGRP Over the Top</a>
<ul class="sectlevel3">
<li><a href="#_lisp">21.23.1. LISP</a></li>
<li><a href="#_otp_ce">21.23.2. OTP CE</a></li>
<li><a href="#_otp_route_reflectors">21.23.3. OTP Route Reflectors</a></li>
<li><a href="#_eigrp_logging_and_reporting">21.23.4. EIGRP Logging and Reporting</a></li>
<li><a href="#_soo">21.23.5. SoO</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ospf">22. OSPF</a>
<ul class="sectlevel2">
<li><a href="#_neighbors_4">22.1. Neighbors</a></li>
<li><a href="#_router_id_2">22.2. Router Id</a></li>
<li><a href="#_dr_election">22.3. DR Election</a></li>
<li><a href="#_ospf_cost">22.4. Ospf Cost</a></li>
<li><a href="#_ospf_packet_format">22.5. OSPF Packet Format</a>
<ul class="sectlevel3">
<li><a href="#_common_ospf_packet_header">22.5.1. Common OSPF Packet Header</a></li>
<li><a href="#_hello_packet">22.5.2. Hello Packet</a></li>
<li><a href="#_database_description_packet">22.5.3. Database Description Packet</a></li>
<li><a href="#_link_state_request">22.5.4. Link State Request</a></li>
<li><a href="#_link_state_update">22.5.5. Link State Update</a></li>
<li><a href="#_link_state_acknowledgment">22.5.6. Link State Acknowledgment</a></li>
<li><a href="#_link_state_packets">22.5.7. Link-State Packets</a></li>
</ul>
</li>
<li><a href="#_backbone">22.6. Backbone</a></li>
<li><a href="#_stubby_areas">22.7. Stubby Areas</a>
<ul class="sectlevel3">
<li><a href="#_stubby_area">22.7.1. Stubby Area</a></li>
<li><a href="#_totally_stubby">22.7.2. Totally Stubby</a></li>
<li><a href="#_nssa">22.7.3. NSSA</a></li>
<li><a href="#_totally_nssa">22.7.4. Totally NSSA</a></li>
</ul>
</li>
<li><a href="#_ospf_path_selection">22.8. OSPF Path Selection</a></li>
<li><a href="#_virtual_links">22.9. Virtual Links</a></li>
<li><a href="#_network_types">22.10. Network Types</a></li>
<li><a href="#_graceful_restart">22.11. Graceful Restart</a></li>
<li><a href="#_spf_throttling">22.12. SPF Throttling</a></li>
<li><a href="#_capability_vrf_lite">22.13. Capability Vrf-Lite</a></li>
<li><a href="#_summarization_3">22.14. Summarization</a></li>
<li><a href="#_ospf_states">22.15. OSPF States</a></li>
<li><a href="#_ospf_process">22.16. OSPF Process</a></li>
<li><a href="#_ospf_authentication">22.17. OSPF Authentication</a>
<ul class="sectlevel3">
<li><a href="#_classic_ospf_authentication">22.17.1. Classic OSPF Authentication</a></li>
<li><a href="#_extended_cryptographic_ospf_authentication">22.17.2. Extended Cryptographic OSPF Authentication</a></li>
</ul>
</li>
<li><a href="#_ttl_security_check">22.18. TTL Security Check</a></li>
<li><a href="#_spf">22.19. SPF</a>
<ul class="sectlevel3">
<li><a href="#_spf_timers">22.19.1. Spf Timers</a></li>
<li><a href="#_spf_throttling_2">22.19.2. SPF Throttling</a></li>
<li><a href="#_lsa_throttling">22.19.3. LSA Throttling</a></li>
<li><a href="#_incremental_spf">22.19.4. Incremental SPF</a></li>
</ul>
</li>
<li><a href="#_ospf_filtering">22.20. OSPF Filtering</a>
<ul class="sectlevel3">
<li><a href="#_routes_filtering_not_lsa_filtering">22.20.1. Routes Filtering Not LSA Filtering</a></li>
<li><a href="#_abr_type_3_lsa_filtering">22.20.2. ABR Type 3 LSA Filtering</a></li>
<li><a href="#_using_the_area_range_no_advertise_option">22.20.3. Using the Area Range No-Advertise Option</a></li>
</ul>
</li>
<li><a href="#_ospfv2_prefix_suppression">22.21. OSPFv2 Prefix Suppression</a></li>
<li><a href="#_ospf_stub_router">22.22. OSPF Stub Router</a></li>
<li><a href="#_ospf_graceful_restart">22.23. OSPF Graceful Restart</a></li>
<li><a href="#_ospf_graceful_shutdown">22.24. OSPF Graceful Shutdown</a></li>
</ul>
</li>
<li><a href="#_is_is">23. IS-IS</a>
<ul class="sectlevel2">
<li><a href="#_nsap_address">23.1. NSAP Address</a></li>
<li><a href="#_levels_of_routing">23.2. Levels Of Routing</a></li>
<li><a href="#_adjancency">23.3. Adjancency</a></li>
<li><a href="#_metrics">23.4. Metrics</a></li>
<li><a href="#_packets">23.5. Packets</a>
<ul class="sectlevel3">
<li><a href="#_hello">23.5.1. Hello</a></li>
<li><a href="#_link_state_pdu">23.5.2. Link State PDU</a></li>
<li><a href="#_complete_sequence_numbers_pdu">23.5.3. Complete Sequence Numbers PDU</a></li>
<li><a href="#_partial_sequence_numbers_pdu">23.5.4. Partial Sequence Numbers PDU</a></li>
</ul>
</li>
<li><a href="#_network_types_2">23.6. Network Types</a>
<ul class="sectlevel3">
<li><a href="#_point_to_point_links">23.6.1. Point-to-Point Links</a></li>
<li><a href="#_broadcast_networks">23.6.2. Broadcast Networks</a></li>
</ul>
</li>
<li><a href="#_areas">23.7. Areas</a></li>
<li><a href="#_authentication_2">23.8. Authentication</a></li>
<li><a href="#_ipv6_support">23.9. IPv6 Support</a></li>
</ul>
</li>
<li><a href="#_bgp">24. BGP</a>
<ul class="sectlevel2">
<li><a href="#_bgp_message_format">24.1. BGP Message Format</a>
<ul class="sectlevel3">
<li><a href="#_bgp_header">24.1.1. BGP Header</a></li>
<li><a href="#_open">24.1.2. OPEN</a></li>
<li><a href="#_keepalive">24.1.3. KEEPALIVE</a></li>
<li><a href="#_update">24.1.4. UPDATE</a></li>
<li><a href="#_notification">24.1.5. NOTIFICATION</a></li>
<li><a href="#_bgp_fsm_states">24.1.6. BGP FSM States</a></li>
</ul>
</li>
<li><a href="#_autonomous_systems">24.2. Autonomous Systems</a>
<ul class="sectlevel3">
<li><a href="#_asn_format">24.2.1. ASN Format</a></li>
</ul>
</li>
<li><a href="#_bgp_peers">24.3. BGP Peers</a></li>
<li><a href="#_bgp_peer_groups">24.4. BGP Peer Groups</a></li>
<li><a href="#_bgp_session_reset">24.5. BGP Session Reset</a>
<ul class="sectlevel3">
<li><a href="#_hard_reset">24.5.1. Hard Reset</a></li>
<li><a href="#_soft_reset">24.5.2. Soft Reset</a></li>
<li><a href="#_dynamic_inbound_soft_reset">24.5.3. Dynamic Inbound Soft Reset</a></li>
<li><a href="#_routing_policy_change_management">24.5.4. Routing Policy Change Management</a></li>
</ul>
</li>
<li><a href="#_bgp_route_aggregation">24.6. BGP Route Aggregation</a>
<ul class="sectlevel3">
<li><a href="#_bgp_route_aggregation_generating_as_set_information">24.6.1. BGP Route Aggregation Generating AS_SET Information</a></li>
</ul>
</li>
<li><a href="#_bgp_backdoor_routes">24.7. BGP Backdoor Routes</a></li>
<li><a href="#_best_path_selection_algorithm">24.8. Best Path Selection Algorithm</a></li>
<li><a href="#_community_attributes">24.9. Community Attributes</a></li>
<li><a href="#_bgp_routing_process">24.10. BGP Routing Process</a>
<ul class="sectlevel3">
<li><a href="#_aggregating_route_prefixes_using_bgp">24.10.1. Aggregating Route Prefixes Using BGP</a></li>
</ul>
</li>
<li><a href="#_bgp_routes">24.11. BGP Routes</a></li>
<li><a href="#_peer_session_template">24.12. Peer Session Template</a></li>
<li><a href="#_peer_policy_template">24.13. Peer Policy Template</a></li>
<li><a href="#_bgp_routing_table">24.14. BGP Routing Table</a></li>
<li><a href="#_troubleshoot_2">24.15. Troubleshoot</a></li>
<li><a href="#_todos">24.16. Todos</a></li>
<li><a href="#_bgp_pic">24.17. BGP PIC</a></li>
<li><a href="#_bgp_ttl_security_check">24.18. BGP TTL Security Check</a></li>
</ul>
</li>
<li><a href="#_redistribution">25. Redistribution</a>
<ul class="sectlevel2">
<li><a href="#_administrative_distance">25.1. Administrative Distance</a></li>
<li><a href="#_spot_issues">25.2. Spot Issues</a></li>
<li><a href="#_heuristics">25.3. Heuristics</a></li>
<li><a href="#_connected_routes">25.4. Connected Routes</a></li>
<li><a href="#_static_routes_2">25.5. Static Routes</a></li>
<li><a href="#_rip_2">25.6. RIP</a></li>
<li><a href="#_eigrp_2">25.7. EIGRP</a></li>
<li><a href="#_ospf_redistribution">25.8. OSPF Redistribution</a></li>
<li><a href="#_bgp_redistribution">25.9. BGP Redistribution</a>
<ul class="sectlevel3">
<li><a href="#_igp_to_bgp">25.9.1. IGP to BGP</a></li>
<li><a href="#_bgp_to_igp">25.9.2. BGP to IGP</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_part_iii_vpn_technologies">Part III : VPN Technologies</a>
<ul class="sectlevel1">
<li><a href="#_vrf">26. VRF</a>
<ul class="sectlevel2">
<li><a href="#_vrf_definition">26.1. VRF definition</a></li>
<li><a href="#_route_distinguisher">26.2. Route Distinguisher</a></li>
<li><a href="#_route_target">26.3. Route Target</a></li>
<li><a href="#_vrf_interface">26.4. VRF Interface</a></li>
<li><a href="#_vrf_static_route">26.5. VRF Static Route</a></li>
<li><a href="#_vrf_lite">26.6. VRF lite</a></li>
<li><a href="#_multi_vrf">26.7. Multi-VRF</a></li>
</ul>
</li>
<li><a href="#_mpls">27. MPLS</a>
<ul class="sectlevel2">
<li><a href="#_mpls_label_stack">27.1. MPLS Label Stack</a></li>
<li><a href="#_label_distribution">27.2. Label Distribution</a></li>
<li><a href="#_mpls_ping_and_tracetroute">27.3. MPLS ping and tracetroute</a></li>
<li><a href="#_l3vpns">27.4. L3VPNs</a></li>
<li><a href="#_ipv6_over_mpls_6pe_and_6vpe">27.5. IPv6 over MPLS: 6PE and 6VPE</a></li>
</ul>
</li>
<li><a href="#_ldp">28. LDP</a>
<ul class="sectlevel2">
<li><a href="#_ldp_process">28.1. LDP process</a></li>
<li><a href="#_discovery_of_adjacent_ldp_peers">28.2. Discovery Of Adjacent LDP Peers</a></li>
<li><a href="#_ldp_sessions">28.3. LDP Sessions</a></li>
<li><a href="#_ldp_label_binding_label_spaces_and_identifiers">28.4. LDP label binding, label spaces and identifiers</a></li>
<li><a href="#_ldp_session_protection">28.5. LDP Session protection</a></li>
<li><a href="#_ldp_authentication">28.6. LDP Authentication</a></li>
<li><a href="#_ldp_md5_global_configuration">28.7. LDP MD5 Global Configuration</a></li>
<li><a href="#_ldp_auto_configuration">28.8. LDP Auto-configuration</a></li>
<li><a href="#_ldp_outbound_label_filtering">28.9. LDP outbound label filtering</a></li>
<li><a href="#_ldp_inbound_label_binding_filtering">28.10. LDP Inbound Label Binding Filtering</a></li>
<li><a href="#_ldp_graceful_restart">28.11. LDP Graceful restart</a></li>
</ul>
</li>
<li><a href="#_gre">29. GRE</a>
<ul class="sectlevel2">
<li><a href="#_tunneling">29.1. Tunneling</a></li>
<li><a href="#_gre_header">29.2. GRE Header</a></li>
<li><a href="#_gre_keepalive">29.3. GRE Keepalive</a></li>
<li><a href="#_gre_tunnel">29.4. GRE Tunnel</a>
<ul class="sectlevel3">
<li><a href="#_configuration_example">29.4.1. Configuration Example</a></li>
</ul>
</li>
<li><a href="#_gre_backup_interface">29.5. GRE backup interface</a></li>
<li><a href="#_troubleshooting_4">29.6. Troubleshooting</a>
<ul class="sectlevel3">
<li><a href="#__tun_5_recurdown_error_message_and_flapping_eigrp_ospf_bgp_neighbors_over_a_gre_tunnel">29.6.1. "%TUN-5-RECURDOWN" Error Message and Flapping EIGRP/OSPF/BGP Neighbors Over a GRE Tunnel</a></li>
</ul>
</li>
<li><a href="#_questions">29.7. Questions</a></li>
</ul>
</li>
<li><a href="#_dmvpn">30. DMVPN</a>
<ul class="sectlevel2">
<li><a href="#_phases">30.1. Phases</a></li>
<li><a href="#_dmvpn_with_ipsec_using_pre_shared_key">30.2. DMVPN with IPsec using pre-shared key</a></li>
<li><a href="#_qos_profile">30.3. QoS profile</a></li>
<li><a href="#_qos_pre_classify">30.4. QoS Pre-classify</a></li>
</ul>
</li>
<li><a href="#_ipsec">31. IPSEC</a>
<ul class="sectlevel2">
<li><a href="#_ipsec_with_pre_shared_key">31.1. IPSec with pre-shared key</a>
<ul class="sectlevel3">
<li><a href="#_ipv4_site_to_ipv4_site">31.1.1. IPv4 site to IPv4 site</a></li>
<li><a href="#_ipv6_in_ipv4_tunnels">31.1.2. IPv6 in IPv4 tunnels</a></li>
<li><a href="#_vti">31.1.3. VTI</a></li>
</ul>
</li>
<li><a href="#_get_vpn">31.2. GET VPN</a>
<ul class="sectlevel3">
<li><a href="#_group_member">31.2.1. Group Member</a></li>
<li><a href="#_key_server">31.2.2. Key Server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_l2_vpn">32. L2 VPN</a>
<ul class="sectlevel2">
<li><a href="#_pseudo_wire">32.1. Pseudo-Wire</a></li>
<li><a href="#_l2tpv3">32.2. L2TPv3</a></li>
<li><a href="#_atom">32.3. ATOM</a></li>
<li><a href="#_vpls_2">32.4. VPLS</a></li>
<li><a href="#_otv">32.5. OTV</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_part_iv_infrastructure_security">Part IV : Infrastructure Security</a>
<ul class="sectlevel1">
<li><a href="#_aaa">33. AAA</a>
<ul class="sectlevel2">
<li><a href="#_local_aaa_server">33.1. Local AAA Server</a></li>
<li><a href="#_ppp_security">33.2. PPP Security</a></li>
</ul>
</li>
<li><a href="#_copp">34. CoPP</a></li>
<li><a href="#_cpp">35. CPP</a></li>
<li><a href="#_management_plane_protection">36. Management Plane Protection</a></li>
<li><a href="#_access_control_list">37. Access Control List</a>
<ul class="sectlevel2">
<li><a href="#_references">37.1. References</a></li>
<li><a href="#_reflexive_acl">37.2. Reflexive ACL</a></li>
</ul>
</li>
<li><a href="#_ip_source_guard">38. IP Source Guard</a></li>
<li><a href="#_dynamic_arp_inspection">39. Dynamic ARP Inspection</a>
<ul class="sectlevel2">
<li><a href="#_router_security">39.1. Router Security</a></li>
</ul>
</li>
<li><a href="#_ieee_802_1x">40. IEEE 802.1X</a>
<ul class="sectlevel2">
<li><a href="#_definition">40.1. Definition</a></li>
<li><a href="#_port_security_2">40.2. Port Security</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_part_v_infrastructure_services">Part V : Infrastructure Services</a>
<ul class="sectlevel1">
<li><a href="#_system_management">41. System Management</a>
<ul class="sectlevel2">
<li><a href="#_telnet">41.1. Telnet</a></li>
<li><a href="#_ssh">41.2. SSH</a></li>
<li><a href="#_scp">41.3. SCP</a></li>
<li><a href="#__t_ftp">41.4. [T]FTP</a>
<ul class="sectlevel3">
<li><a href="#_ftp_client">41.4.1. FTP Client</a></li>
<li><a href="#_ftp_server">41.4.2. FTP Server</a></li>
</ul>
</li>
<li><a href="#_snmp">41.5. SNMP</a>
<ul class="sectlevel3">
<li><a href="#_version_3">41.5.1. Version</a></li>
<li><a href="#_mib">41.5.2. MIB</a></li>
<li><a href="#_packet_format_2">41.5.3. Packet Format</a></li>
<li><a href="#_basic_system_information">41.5.4. Basic System Information</a></li>
<li><a href="#_views">41.5.5. Views</a></li>
<li><a href="#_communities">41.5.6. Communities</a></li>
<li><a href="#_traps">41.5.7. Traps</a></li>
<li><a href="#_snmp_v3">41.5.8. SNMP V3</a></li>
<li><a href="#_snmp_manager">41.5.9. SNMP Manager</a></li>
<li><a href="#_snmp_shutdown_mechanism">41.5.10. SNMP Shutdown Mechanism</a></li>
</ul>
</li>
<li><a href="#_rmon">41.6. RMON</a></li>
<li><a href="#_syslog">41.7. Syslog</a></li>
<li><a href="#_ntp">41.8. NTP</a>
<ul class="sectlevel3">
<li><a href="#_ntp_associations">41.8.1. NTP Associations</a></li>
<li><a href="#_ntp_access_groups">41.8.2. NTP Access Groups</a></li>
<li><a href="#_ntp_authentication">41.8.3. NTP Authentication</a></li>
<li><a href="#_source_ip_address">41.8.4. Source IP Address</a></li>
<li><a href="#_authoritative_server">41.8.5. Authoritative Server</a></li>
<li><a href="#_panic_treshold">41.8.6. Panic Treshold</a></li>
<li><a href="#_orphan_mode">41.8.7. Orphan Mode</a></li>
<li><a href="#_external_reference_clock">41.8.8. External Reference Clock</a></li>
<li><a href="#_software_clock">41.8.9. Software Clock</a></li>
<li><a href="#_hardware_clock">41.8.10. Hardware-Clock</a></li>
<li><a href="#_time_ranges">41.8.11. Time Ranges</a></li>
<li><a href="#_vulnerability">41.8.12. Vulnerability</a></li>
<li><a href="#_example">41.8.13. Example</a></li>
</ul>
</li>
<li><a href="#_http">41.9. HTTP</a></li>
<li><a href="#_rtp_rtcp">41.10. RTP/RTCP</a></li>
</ul>
</li>
<li><a href="#_qos">42. QoS</a>
<ul class="sectlevel2">
<li><a href="#_classification_and_marking">42.1. Classification and Marking</a>
<ul class="sectlevel3">
<li><a href="#_fields_that_can_be_marked_for_qos_purposes">42.1.1. Fields That Can Be Marked for QoS Purposes</a></li>
<li><a href="#_nbar">42.1.2. NBAR</a></li>
<li><a href="#_cb_marking">42.1.3. CB Marking</a></li>
<li><a href="#_qos_pre_classification">42.1.4. QoS Pre-Classification</a></li>
<li><a href="#_autoqos">42.1.5. AutoQoS</a></li>
</ul>
</li>
<li><a href="#_congestion_management_and_avoidance">42.2. Congestion Management and Avoidance</a>
<ul class="sectlevel3">
<li><a href="#_queues">42.2.1. Queues</a></li>
<li><a href="#_cbwfq">42.2.2. CBWFQ</a></li>
<li><a href="#_llq">42.2.3. LLQ</a></li>
</ul>
</li>
<li><a href="#_shaping_policing_and_link_fragmentation">42.3. Shaping, Policing and Link Fragmentation</a></li>
<li><a href="#_mqc">42.4. MQC</a>
<ul class="sectlevel3">
<li><a href="#_traffic_class_2">42.4.1. Traffic Class</a></li>
<li><a href="#_elements_of_a_traffic_policy">42.4.2. Elements Of a Traffic Policy</a></li>
<li><a href="#_service_policy">42.4.3. Service Policy</a></li>
</ul>
</li>
<li><a href="#_rsvp">42.5. RSVP</a>
<ul class="sectlevel3">
<li><a href="#_configuration_tasks">42.5.1. Configuration Tasks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_first_host_redundancy_protocols">43. First Host Redundancy Protocols</a>
<ul class="sectlevel2">
<li><a href="#_hsrp">43.1. HSRP</a>
<ul class="sectlevel3">
<li><a href="#_hsrp_packet">43.1.1. HSRP Packet</a></li>
<li><a href="#_hsrp_version">43.1.2. HSRP Version</a></li>
<li><a href="#_hsrp_opcode">43.1.3. HSRP OpCode</a></li>
<li><a href="#_hsrp_state">43.1.4. HSRP State</a></li>
<li><a href="#_priority_2">43.1.5. Priority</a></li>
<li><a href="#_hsrp_timers">43.1.6. HSRP Timers</a></li>
<li><a href="#_hsrp_authentication">43.1.7. HSRP Authentication</a></li>
<li><a href="#_hsrp_and_object_tracking">43.1.8. HSRP and Object Tracking</a></li>
<li><a href="#_hsrp_support_for_icmp_redirects">43.1.9. HSRP Support for ICMP Redirects</a></li>
<li><a href="#_hsrp_virtual_ip_address_and_group">43.1.10. HSRP Virtual IP Address and Group</a></li>
<li><a href="#_multiple_hsrp">43.1.11. Multiple HSRP</a></li>
</ul>
</li>
<li><a href="#_glbp">43.2. GLBP</a>
<ul class="sectlevel3">
<li><a href="#_glbp_packet_type">43.2.1. GLBP Packet Type</a></li>
<li><a href="#_active_virtual_gateway">43.2.2. Active Virtual Gateway</a></li>
<li><a href="#_active_virtual_forwarder">43.2.3. Active Virtual Forwarder</a></li>
<li><a href="#_authentication_3">43.2.4. Authentication</a></li>
</ul>
</li>
<li><a href="#_vrrp">43.3. VRRP</a></li>
<li><a href="#_idrp">43.4. IDRP</a>
<ul class="sectlevel3">
<li><a href="#_message_format_2">43.4.1. Message Format</a></li>
<li><a href="#_configuration">43.4.2. Configuration</a></li>
</ul>
</li>
<li><a href="#_ipv6_ra_rs">43.5. IPv6 RA/RS</a></li>
</ul>
</li>
<li><a href="#_multicast_2">44. Multicast</a>
<ul class="sectlevel2">
<li><a href="#_ip_multicast">44.1. IP Multicast</a>
<ul class="sectlevel3">
<li><a href="#_multicast_ip_addressing">44.1.1. Multicast IP Addressing</a></li>
<li><a href="#_mapping_ip_multicast_address_to_mac_addresses">44.1.2. Mapping IP Multicast Address to MAC Addresses</a></li>
</ul>
</li>
<li><a href="#_igmp">44.2. IGMP</a>
<ul class="sectlevel3">
<li><a href="#_igmp_packet_format">44.2.1. IGMP Packet Format</a></li>
<li><a href="#_messages">44.2.2. Messages</a></li>
<li><a href="#_default_igmp_configuration">44.2.3. Default IGMP Configuration</a></li>
<li><a href="#_igmp_version">44.2.4. IGMP Version</a></li>
<li><a href="#_querier_election">44.2.5. Querier Election</a></li>
<li><a href="#_igmpv2_query_timeout">44.2.6. IGMPv2 Query Timeout</a></li>
<li><a href="#_maximum_response_time_field">44.2.7. Maximum Response Time Field</a></li>
<li><a href="#_join_the_club">44.2.8. Join the Club</a></li>
<li><a href="#_leave_process">44.2.9. Leave Process</a></li>
<li><a href="#_igmp_message_restriction">44.2.10. IGMP Message Restriction</a></li>
<li><a href="#_igmp_proxy">44.2.11. IGMP Proxy</a></li>
<li><a href="#_cgmp">44.2.12. CGMP</a></li>
<li><a href="#_rgmp">44.2.13. RGMP</a></li>
<li><a href="#_igmp_filtering_and_throttling">44.2.14. IGMP Filtering and Throttling</a></li>
<li><a href="#_igmp_snooping">44.2.15. IGMP Snooping</a></li>
<li><a href="#_multicast_router_port">44.2.16. Multicast Router Port</a></li>
<li><a href="#_mvr">44.2.17. MVR</a></li>
<li><a href="#_igmp_filtering_and_throttling_2">44.2.18. IGMP Filtering and Throttling</a></li>
</ul>
</li>
<li><a href="#_pim">44.3. PIM</a>
<ul class="sectlevel3">
<li><a href="#_versions">44.3.1. Versions</a></li>
<li><a href="#_modes_3">44.3.2. Modes</a></li>
<li><a href="#_pim_designated_routers">44.3.3. PIM Designated Routers</a></li>
<li><a href="#_rendez_vous_points">44.3.4. Rendez-Vous Points</a></li>
<li><a href="#_auto_rp">44.3.5. Auto-RP</a></li>
<li><a href="#_bootstrap_router">44.3.6. Bootstrap Router</a></li>
<li><a href="#_neighbor_discovery_2">44.3.7. Neighbor Discovery</a></li>
<li><a href="#_auto_rp_and_bsr_configuration_guidelines">44.3.8. Auto-RP and BSR Configuration Guidelines</a></li>
<li><a href="#_pim_domain_border">44.3.9. PIM Domain Border</a></li>
<li><a href="#_delay_the_use_of_pim_shortest_path_tree">44.3.10. Delay the Use Of PIM Shortest-Path Tree</a></li>
<li><a href="#_troubleshoot_3">44.3.11. Troubleshoot</a></li>
<li><a href="#_misc">44.3.12. Misc</a></li>
<li><a href="#_pim_snooping">44.3.13. PIM snooping</a></li>
<li><a href="#_pim_stub_routing">44.3.14. PIM stub routing</a></li>
</ul>
</li>
<li><a href="#_mld">44.4. MLD</a>
<ul class="sectlevel3">
<li><a href="#_mld_snooping">44.4.1. MLD Snooping</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_network_optimization">45. Network Optimization</a>
<ul class="sectlevel2">
<li><a href="#_ip_sla">45.1. IP SLA</a>
<ul class="sectlevel3">
<li><a href="#_ip_slas_operation_types">45.1.1. IP SLAs Operation Types</a></li>
<li><a href="#_ip_slas_responder">45.1.2. IP SLAs Responder</a></li>
<li><a href="#_ip_slas_operation_scheduling">45.1.3. IP SLAs Operation Scheduling</a></li>
<li><a href="#_ip_slas_operation_threshold_monitoring">45.1.4. IP SLAs Operation Threshold Monitoring</a></li>
<li><a href="#_mpls_vpn_awareness">45.1.5. MPLS VPN Awareness</a></li>
<li><a href="#_history_statistics">45.1.6. History Statistics</a></li>
<li><a href="#_troubleshooting_tips">45.1.7. Troubleshooting Tips</a></li>
</ul>
</li>
<li><a href="#_enhanced_object_tracking">45.2. Enhanced Object Tracking</a>
<ul class="sectlevel3">
<li><a href="#_interface_tracking">45.2.1. Interface Tracking</a></li>
<li><a href="#_ip_route_tracking">45.2.2. IP Route Tracking</a></li>
<li><a href="#_ip_sla_operation_tracking">45.2.3. IP SLA Operation Tracking</a></li>
<li><a href="#_tracked_list">45.2.4. Tracked List</a></li>
</ul>
</li>
<li><a href="#_netflow">45.3. NetFlow</a>
<ul class="sectlevel3">
<li><a href="#_netflow_flows">45.3.1. NetFlow Flows</a></li>
<li><a href="#_netflow_version">45.3.2. NetFlow Version</a></li>
<li><a href="#_netflow_cache">45.3.3. NetFlow Cache</a></li>
<li><a href="#_netflow_data_export">45.3.4. NetFlow Data Export</a></li>
</ul>
</li>
<li><a href="#_embedded_event_manager">45.4. Embedded Event Manager</a></li>
<li><a href="#_embedded_packet_capture">45.5. Embedded Packet Capture</a>
<ul class="sectlevel3">
<li><a href="#_capture_buffer">45.5.1. Capture Buffer</a></li>
<li><a href="#_capture_point">45.5.2. Capture Point</a></li>
<li><a href="#_using_wireshark_trace_analyzer">45.5.3. Using Wireshark trace analyzer</a></li>
</ul>
</li>
<li><a href="#_performance_monitor">45.6. Performance Monitor</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_part_vi_evolving_technologies">Part VI : Evolving Technologies</a>
<ul class="sectlevel1">
<li><a href="#_cloud">46. Cloud</a>
<ul class="sectlevel2">
<li><a href="#_compare_and_contrast_cloud_deployment_models">46.1. Compare and Contrast Cloud Deployment Models</a>
<ul class="sectlevel3">
<li><a href="#_infrastructure_platform_and_software_services_xaas">46.1.1. Infrastructure, Platform, and Software Services [XaaS]</a></li>
<li><a href="#_performance_and_reliability">46.1.2. Performance and Reliability</a></li>
<li><a href="#_security_and_privacy">46.1.3. Security and Privacy</a></li>
<li><a href="#_scalability_and_interoperability">46.1.4. Scalability and Interoperability</a></li>
</ul>
</li>
<li><a href="#_describe_cloud_implementations_and_operations">46.2. Describe Cloud Implementations and Operations</a>
<ul class="sectlevel3">
<li><a href="#_automation_and_orchestration">46.2.1. Automation and Orchestration</a></li>
<li><a href="#_workload_mobility">46.2.2. Workload Mobility</a></li>
<li><a href="#_troubleshooting_and_management">46.2.3. Troubleshooting and Management</a></li>
<li><a href="#_openstack_components">46.2.4. OpenStack Components</a></li>
<li><a href="#_resources_and_references">46.2.5. Resources and References</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_sdn">47. SDN</a>
<ul class="sectlevel2">
<li><a href="#_models">47.1. Models</a></li>
<li><a href="#_describe_functional_elements_of_network_programmability_and_how_they_interact">47.2. Describe Functional Elements Of Network Programmability  and How They Interact</a>
<ul class="sectlevel3">
<li><a href="#_controllers">47.2.1. Controllers</a></li>
<li><a href="#_apis">47.2.2. APIs</a></li>
<li><a href="#_scripting">47.2.3. Scripting</a></li>
<li><a href="#_agents">47.2.4. Agents</a></li>
<li><a href="#_northbound_vs_southbound_protocols">47.2.5. Northbound Vs. Southbound Protocols</a></li>
</ul>
</li>
<li><a href="#_describe_aspects_of_virtualization_and_automation_in_network_environments">47.3. Describe Aspects Of Virtualization and Automation In Network Environments</a>
<ul class="sectlevel3">
<li><a href="#_devops_methodologies_tools_and_workflows">47.3.1. DevOps Methodologies, Tools and Workflows</a></li>
<li><a href="#_network_application_function_virtualization_nfv_afv">47.3.2. Network/Application Function Virtualization [NFV, AFV]</a></li>
<li><a href="#_service_function_chaining">47.3.3. Service Function Chaining</a></li>
<li><a href="#_performance_availability_and_scaling_considerations">47.3.4. Performance, Availability, and Scaling Considerations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_internet_of_things">48. Internet Of Things</a>
<ul class="sectlevel2">
<li><a href="#_describe_architectural_framework_and_deployment_considerations_for_iot">48.1. Describe Architectural Framework and Deployment Considerations for IoT</a>
<ul class="sectlevel3">
<li><a href="#_data_center_dc_cloud">48.1.1. Data center (DC) Cloud</a></li>
<li><a href="#_core_networking_and_services">48.1.2. Core Networking and Services</a></li>
<li><a href="#_multi_service_edge_access_network">48.1.3. Multi-service Edge (access network)</a></li>
<li><a href="#_embedded_systems_smart_things_network">48.1.4. Embedded Systems (Smart Things Network)</a></li>
<li><a href="#_performance_reliability_and_scalability">48.1.5. Performance, Reliability and Scalability</a></li>
<li><a href="#_mobility">48.1.6. Mobility</a></li>
<li><a href="#_security_and_privacy_2">48.1.7. Security and Privacy</a></li>
<li><a href="#_standards_and_compliance">48.1.8. Standards and Compliance</a></li>
<li><a href="#_migration">48.1.9. Migration</a></li>
<li><a href="#_environmental_impacts_on_the_network">48.1.10. Environmental Impacts on the Network</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_appendices">Appendices</a>
<ul class="sectlevel1">
<li><a href="#_lab_equipment_and_ios_releases">49. Lab Equipment and IOS Releases</a></li>
<li><a href="#_ios">50. IOS</a></li>
<li><a href="#_ios_xe">51. IOS-XE</a></li>
<li><a href="#_ios_system_management">52. IOS System Management</a>
<ul class="sectlevel2">
<li><a href="#_configuration_files">52.1. Configuration files</a></li>
</ul>
</li>
<li><a href="#_general">53. General</a></li>
<li><a href="#_notes_to_self">54. Notes To Self</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_dedication">Dedication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To Cyril "Matiere" Kalenga</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<h1 id="_part_i_layer_2_technologies" class="sect0">Part I : Layer 2 Technologies</h1>
<div class="sect1">
<h2 id="_switch_administration">1. Switch Administration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_interface_characteristics">1.1. Interface Characteristics</h3>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swint.html" class="bare">http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swint.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_system_clock">1.2. System Clock</h3>
<div class="ulist">
<ul>
<li>
<p>Can be set manually or dynamic with NTP</p>
</li>
<li>
<p>Keeps track internally based on UTC</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Time Zone</div>
<div class="content">
<pre>(config)# clock timezone &lt;zone&gt; &lt;hours-offset&gt; [&lt;minutes-offset&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use the minutes-offset variable  when the local time zone is a percentage of an hour different from UTC.
For example, the time zone for some sections of Atlantic Canada (AST) is UTC-3.5, where the 3 means 3 hours and.5 means 50 percent.
In this case, the necessary command is <strong>clock timezone AST -3 30</strong>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Reset the Time to UTC</div>
<div class="content">
<pre>(config)# no clock timezone</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the System Clock Manually</div>
<div class="content">
<pre>(config)# clock set &lt;hh:mm:ss month day year&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the Time and Date Configuration</div>
<div class="content">
<pre># sh clock [detail]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure Daylight Saving Time</div>
<div class="content">
<pre>(config)# clock summer-time &lt;zone&gt; recurring [week day month hh : mm : week day month hh : mm [offset]]

Example(config)# clock summer-time PDT recurring 1 Sunday April 2:00 last Sunday Octorber 2:00</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_system_name_and_prompt">1.3. System Name and Prompt</h3>
<div class="listingblock">
<div class="title">Task: Configure a System Name</div>
<div class="content">
<pre>(config)# hostname &lt;name&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_motd_login_banner">1.4. MOTD Login Banner</h3>
<div class="ulist">
<ul>
<li>
<p>MOTD and login not configured by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Message Of the Day Login Banner</div>
<div class="content">
<pre>(config)# banner motd &lt;delimiting-character&gt; &lt;message&gt; &lt;delimiting-character&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_login_banner">1.5. Login Banner</h3>
<div class="ulist">
<ul>
<li>
<p>displayed on all connected terminals</p>
</li>
<li>
<p>appears after the MOTD banner and before the login prompt</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Login Banner</div>
<div class="content">
<pre>(config)# banner login &lt;delimiting-character&gt; &lt;message&gt; &lt;delimiting-character&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mac_address_table">1.6. MAC Address Table</h3>
<div class="ulist">
<ul>
<li>
<p>lists the destination MAC address with the associated VLANs , port number, and the type (static or dynamic)</p>
</li>
<li>
<p>dynamic address are discarded after the <strong>aging time</strong> (300 seconds by default)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display Address Table Entries for the Specified MAC Address</div>
<div class="content">
<pre># sh mac address-table address &lt;MAC&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Only Dynamic MAC Addresses</div>
<div class="content">
<pre># sh mac address-table dynamic</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the Number Of Addresses Present</div>
<div class="content">
<pre># sh mac address-table count</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the MAC Address Table Information for the Specified VLAN</div>
<div class="content">
<pre># sh mac address-table vlan</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the MAC Address Table Information for the Specified Interface</div>
<div class="content">
<pre># sh mac address-table interface</pre>
</div>
</div>
<div class="sect3">
<h4 id="_aging_time">1.6.1. Aging Time</h4>
<div class="ulist">
<ul>
<li>
<p>Default: 300 seconds</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the Length Of Time That a Dynamic Entry Remains In the MAC Address After the Entry Is Used or Updated</div>
<div class="content">
<pre># mac address-table aging-time [0 | 10-1000000] [vlan &lt;1-4094&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Displays the Aging Time</div>
<div class="content">
<pre># sh mac address-table aging-time [&lt;vlan_id&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Remove Dynamic Address Entries</div>
<div class="content">
<pre># clear mac address-table dynamic [&lt;mac-address&gt;]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mac_address_change_notification_traps">1.6.2. MAC Address Change Notification Traps</h4>
<div class="ulist">
<ul>
<li>
<p>send SNMP trap when the switch learns or removes dynamic and secure MAC addresses.</p>
</li>
<li>
<p>do not send trap for self addresses, multicast addresses or static addresses</p>
</li>
<li>
<p>can set a trap-interval time to bundle the notification traps to reduce network traffic</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Send MAC Address Change Notification Traps to an NMS Host</div>
<div class="content">
<pre>(config)# snmp-server host &lt;host-addr&gt; { traps | informs} { version { 1 | 2c | 3 } } &lt;community-string&gt; mac-notification
(config)# snmp-server enable traps mac-notification change
(config)# mac address-table notification change [ interval &lt;seconds&gt; ] [ history-size &lt;i0-1-500&gt; ]
(config)# interface &lt;interface-id&gt;
(config-if)# snmp trap mac-notification change {added | removed }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the MAC Address Table Notification Change Configuration</div>
<div class="content">
<pre># sh mac address-table notification change [interface]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mac_address_move_notification_traps">1.6.3. MAC Address Move Notification Traps</h4>
<div class="ulist">
<ul>
<li>
<p>send a SNMP notification whenever a MAC address moves from one port to another within the same VLAN</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Send MAC Address Move Notification Traps to an NMS Host</div>
<div class="content">
<pre>(config)# snmp-server host &lt;host-addr&gt; { traps | informs} { version { 1 | 2c | 3 } } &lt;community-string&gt; mac-notification
(config)# snmp-server enable traps mac-notification move
(config)# mac address-table notification mac-move</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the MAC Address Table Notification Move Configuration</div>
<div class="content">
<pre># sh mac address-table notification mac-move</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mac_treshold_notification_traps">1.6.4. MAC Treshold Notification Traps</h4>
<div class="ulist">
<ul>
<li>
<p>Send an SNMP notification when a MAC Address table treshold limit is reached or exceeded.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure MAC Treshold Notifcation Traps</div>
<div class="content">
<pre>(config)# snmp-server host &lt;host-addr&gt; { traps | informs} { version { 1 | 2c | 3 } } &lt;community-string&gt; mac-notification
(config)# snmp-server enable traps mac-notification treshold
(config)# mac address-table notification treshold ! to enable the feature
(config)# mac address-table notification treshold [limit &lt;percentage] | [ interval &lt;seconds&gt; ]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the MAC Address Table Notification Treshold Configuration</div>
<div class="content">
<pre># sh mac address-table notification treshold</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_static_address">1.6.5. Static Address</h4>
<div class="ulist">
<ul>
<li>
<p>manually entered in the address table and must be manually removed</p>
</li>
<li>
<p>can be unicast or mcast</p>
</li>
<li>
<p>doesn&#8217;t age  and is retained when the switch restarts</p>
</li>
<li>
<p>must be associated with a VLAN and a interface</p>
<div class="ulist">
<ul>
<li>
<p>A packet with a static address that arrives on a VLAN where
it has not been statically entered is flooded to all ports and not learned</p>
</li>
<li>
<p>if the VLAN is in a private-primary or private-secondary, configure the same static address in all associated VLANs.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Add a Static Address to the MAC Address Table</div>
<div class="content">
<pre>(config)# mac address-table static &lt;MAC&gt; vlan &lt;vlan-id&gt; interface &lt;interface-id&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Only Static MAC Addresses</div>
<div class="content">
<pre># sh mac address-table static</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unicast_mac_address_filtering">1.6.6. Unicast MAC Address Filtering</h4>
<div class="ulist">
<ul>
<li>
<p>Drops packets with specific source or destination MAC addressess</p>
</li>
<li>
<p>disabled by default</p>
</li>
<li>
<p>mcast, bcast and router MAC addresses are not supported</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable Unicast MAC Address Filtering</div>
<div class="content">
<pre>(config)# mac address-table static &lt;MAC&gt; vlan &lt;vlan-id&gt; drop</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mac_address_learning">1.6.7. MAC Address Learning</h4>
<div class="ulist">
<ul>
<li>
<p>enabled by default on a VLANs</p>
</li>
<li>
<p>can be disabled with the following restrictions:</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>If the VLAN has a configured SVI,  the switch then floods all IP packets in the Layer 2 domain.</p>
</li>
<li>
<p>If you disable MAC address learning on a VLAN with more than two ports, every packet entering the switch is flooded in that VLAN domain.</p>
</li>
<li>
<p>You cannot disable MAC address learning on a VLAN that is used internally by the switch. If the VLAN ID that you enter is an internal VLAN, the switch generates an error message and rejects the command. To view internal VLANs in use, enter the show vlan internal usage privileged EXEC command.</p>
</li>
<li>
<p>If you disable MAC address learning on a VLAN configured as a private-VLAN primary VLAN, MAC addresses are still learned on the secondary VLAN that belongs to the private VLAN and are then replicated on the primary VLAN. If you disable MAC address learning on the secondary VLAN, but not the primary VLAN of a private VLAN, MAC address learning occurs on the primary VLAN and is replicated on the secondary VLAN.</p>
</li>
<li>
<p>You cannot disable MAC address learning on an RSPAN VLAN. The configuration is not allowed.</p>
</li>
<li>
<p>If you disable MAC address learning on a VLAN that includes a secure port, MAC address learning is not disabled on that port.
If you disable port security, the configured MAC address learning state is enabled.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Disable MAC Address Learning on an interface</div>
<div class="content">
<pre>(config)# no mac-address-table learning interface &lt;interface-type slot/port&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable MAC Address Learning on an range of VLANs</div>
<div class="content">
<pre>(config)# no mac-address-table learning {vlan &lt;vlan-id&gt; [,&lt;vlan-id&gt; | -&lt;vlan-id&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the MAC Address Learning</div>
<div class="content">
<pre>sh mac address-table learning [vlan &lt;vlan-id&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Reenable MAC Address Learning</div>
<div class="content">
<pre>(config)# default mac address-table learning vlan &lt;vlan-id&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_error_disable">1.7. Error disable</h3>
<div class="ulist">
<ul>
<li>
<p>port disabled due to error condition</p>
<div class="ulist">
<ul>
<li>
<p>no traffic sent or received</p>
</li>
<li>
<p>port LED orange or amber</p>
</li>
</ul>
</div>
</li>
<li>
<p>eliminates the possibility that this port can cause other ports on the module or the entire module to fail.
Such a failure can occur when a bad port monopolizes buffers or port error messages monopolize interprocess communications on the card,
which can ultimately cause serious network issues.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Show which local ports are involved in the errdisabled state.</div>
<div class="content">
<pre># show interfaces status err-disabled

Port    Name  Status          Vlan  Duplex  Speed Type
Gi4/1         err-disabled    100   full    1000 1000BaseSX</pre>
</div>
</div>
<div class="sect3">
<h4 id="_err_disable_detection">1.7.1. Err-Disable detection</h4>
<div class="ulist">
<ul>
<li>
<p>error-disable detection enabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Disable error disable detection</div>
<div class="content">
<pre>(config-if)# no err-disable detect cause</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Shows the reason for the errdisable status.</div>
<div class="content">
<pre># show errdisable detect</pre>
</div>
</div>
<div class="paragraph">
<p>Reasons for the interface to go into errdisable</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Duplex mismatch</p>
</li>
<li>
<p>Port channel misconfiguration</p>
</li>
<li>
<p>BPDU guard violation</p>
</li>
<li>
<p>UDLD condition</p>
</li>
<li>
<p>Late-collision detection</p>
</li>
<li>
<p>Link-flap detection</p>
</li>
<li>
<p>PAgP flap</p>
</li>
<li>
<p>Security violation</p>
</li>
<li>
<p>L2TP guard</p>
</li>
<li>
<p>DHCP snooping rate-limit</p>
</li>
<li>
<p>Incorrect GBIC / Small Form-Factor Pluggable module or cable</p>
</li>
<li>
<p>ARP inspection</p>
</li>
<li>
<p>Inline power</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_link_flap_detection">1.7.2. Link-flap detection</h4>
<div class="ulist">
<ul>
<li>
<p>if the interface goes up and down more than five times in 10 seconds.</p>
</li>
<li>
<p>common cause: Layer 1 issue such as a bad cable, duplex mismatch, or bad GBIC card.</p>
</li>
<li>
<p>console messages or syslog server that state the reason for the port shutdown.</p>
<div class="literalblock">
<div class="content">
<pre>%PM-4-ERR_DISABLE: link-flap error detected on Gi4/1, putting Gi4/1 in err-disable state</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: View the flap values:</div>
<div class="content">
<pre>#show errdisable flap-values

  ErrDisable Reason    Flaps    Time (sec)
  -----------------    ------   ----------
  pagp-flap              3       30
  dtp-flap               3       30
  link-flap              5       10</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loopback_error">1.7.3. Loopback error</h4>
<div class="ulist">
<ul>
<li>
<p>occurs when the keepalive packet is looped back to the port that sent the keepalive.</p>
<div class="literalblock">
<div class="content">
<pre>%PM-4-ERR_DISABLE: loopback error detected on Gi4/1, putting Gi4/1 in err-disable state</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_l2tp_guard">1.7.4. L2TP guard</h4>
<div class="paragraph">
<p>When the Layer 2 PDUs enter the tunnel or access port on the inbound edge switch,
the switch overwrites the customer PDU-destination MAC address
with a well-known Cisco proprietary multicast address (01-00-0c-cd-cd-d0).
If 802.1Q tunneling is enabled, packets are also double-tagged.
The outer tag is the customer metro tag and the inner tag is the customer VLAN tag.
The core switches ignore the inner tags and forward the packet to all trunk ports in the same metro VLAN.
The edge switches on the outbound side restore the proper Layer 2 protocol and
MAC address information and forward the packets to all tunnel or access ports
in the same metro VLAN. Therefore, the Layer 2 PDUs are kept intact and
delivered across the service-provider infrastructure to the other side of the
customer network.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)#interface gigabitethernet 0/7
(config-if)# l2protocol-tunnel {cdp | vtp | stp}</pre>
</div>
</div>
<div class="paragraph">
<p>The interface goes to errdisabled state.
* If an encapsulated PDU (with the proprietary destination MAC address) is received from a tunnel port or access port with Layer 2 tunneling enabled,
the tunnel port is shut down to prevent loops.
* The port also shuts down when a configured shutdown threshold for the protocol is reached.</p>
</div>
<div class="paragraph">
<p>You can manually reenable the port (by issuing a shutdown, no shutdown command sequence)
or if errdisable recovery is enabled, the operation is retried after a specified time interval.</p>
</div>
<div class="paragraph">
<p>The interface can be recovered from errdisable state by reenabling the port using <strong>errdisable recovery cause l2ptguard</strong>.</p>
</div>
<div class="paragraph">
<p>This command is used to configure the recovery mechanism from a Layer 2 maximum
rate error so that the interface can be brought out of the disabled state and
allowed to try again. You can also set the time interval. Errdisable recovery
is disabled by default; when enabled, the default time interval is 300 seconds.</p>
</div>
</div>
<div class="sect3">
<h4 id="_incorrect_gbic_small_form_factor_pluggable_module_or_cable">1.7.5. Incorrect GBIC / Small Form-Factor Pluggable module or cable</h4>
<div class="ulist">
<ul>
<li>
<p>Ports go into errdisable state with the <strong>%PHY-4-SFP_NOT_SUPPORTED</strong> error message
when you connect Catalyst 3560 and Catalyst 3750 Switches using an SFP Interconnect Cable.</p>
</li>
<li>
<p>The Cisco Catalyst 3560 SFP Interconnect Cable (CAB-SFP-50CM=) provides for a low-cost, point-to-point, Gigabit Ethernet connection between Catalyst 3560 Series Switches.
The 50-centimeter cable is an alternative to using SFP transceivers when interconnecting Catalyst 3560 Series Switches through their SFP ports over a short distance.
All Cisco Catalyst 3560 Series Switches support the SFP Interconnect Cable.
When a Catalyst 3560 Switch is connected to a Catalyst 3750 or any other type of Catalyst switch model, you cannot use the CAB-SFP-50CM= cable.</p>
</li>
<li>
<p>You can connect both switches using a copper cable with SFP (GLC-T) on both devices instead of a CAB-SFP-50CM= cable.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_err_disable_recovery">1.7.6. Err-Disable recovery</h4>
<div class="ulist">
<div class="title">Steps</div>
<ul>
<li>
<p>Determine the cause with <strong>sh interfaces status err-disabled</strong></p>
</li>
<li>
<p>Fix the root cause</p>
</li>
<li>
<p>Reenable the Errdisabled ports manually with <strong>shutdown</strong>, <strong>no shutdown</strong> command sequence
or automatically after a specified amount of time with <strong>errdisable recovery</strong> command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Shows the time period after which the interfaces are enabled for errdisable conditions.</div>
<div class="content">
<pre>#show errdisable recovery

  ErrDisable Reason    Timer Status
  -----------------    --------------
  udld                 Enabled
  bpduguard            Enabled
  security-violation   Enabled
  channel-misconfig    Enabled
  pagp-flap            Enabled
  dtp-flap             Enabled
  link-flap            Enabled
  l2ptguard            Enabled
  psecure-violation    Enabled
  gbic-invalid         Enabled
  dhcp-rate-limit      Enabled
  mac-limit            Enabled
  unicast-flood        Enabled
  arp-inspection       Enabled</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_l2_mtu">1.8. L2 MTU</h3>
<div class="ulist">
<ul>
<li>
<p>default size: 1500 bytes</p>
</li>
<li>
<p>max size: 1998 bytes, 9198 bytes for jumbo frames</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Change the MTU size for all Fast Ethernet interfaces on the switch.</div>
<div class="content">
<pre>(config)# system mtu &lt;bytes&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Change the MTU size for all Gigabit and 10-Gigabit Ethernet interfaces on the switch.</div>
<div class="content">
<pre>(config)# system mtu jumbo &lt;bytes&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Change the system MTU for routed ports.</div>
<div class="content">
<pre>(config)# system mtu routing &lt;bytes&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The system routing MTU is the maximum MTU for routed packets and is also the maximum MTU that the switch
advertises in routing updates for protocols such as OSPF.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_switch_internal_processing">1.9. Switch Internal Processing</h3>
<div class="paragraph">
<p>Switches forward frames when necessary, and do not forward when there is no need to do so, thus
reducing overhead.</p>
</div>
<div class="paragraph">
<p>To accomplish this, switches perform three actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Learn MAC addresses by examining the source MAC address of each received frame</p>
</li>
<li>
<p>Decide when to forward a frame or when to filter (not forward) a frame, based on the destination MAC address</p>
</li>
<li>
<p>Create a loop-free environment with other bridges by using the Spanning Tree Protocol</p>
</li>
</ul>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Store-and-forward
</td>
<td class="hdlist2">
<p>The switch fully receives all bits in the frame (store) before forwarding
the frame (forward). This allows the switch to check the FCS before
forwarding the frame, thus ensuring that errored frames are not forwarded.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Cut-through
</td>
<td class="hdlist2">
<p>The switch performs the address table lookup as soon as the Destination
Address field in the header is received. The first bits in the frame can be sent out
the outbound port before the final bits in the incoming frame are received. This
does not allow the switch to discard frames that fail the FCS check, but the
forwarding action is faster, resulting in lower latency.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Fragment-free
</td>
<td class="hdlist2">
<p>This performs like cut-through switching, but the switch waits for 64 bytes to be
received before forwarding the first bytes of the outgoing frame. According to
Ethernet specifications, collisions should be detected during the first 64 bytes of
the frame, so frames that are in error because of a collision will not be forwarded.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_switching_and_bridging_logic">1.10. Switching and Bridging Logic</h3>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type of Address</th>
<th class="tableblock halign-left valign-top">Switch Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Known unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forwards frame out the single interface associated with the destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unknown unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floods frame out all interfaces, except the interface on which the frame was received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Broadcast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floods frame identically to unknown unicasts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floods frame identically to unknown unicasts, unless multicast optimizations are configured</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ethernet">2. Ethernet</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>IEEE 802.3 standards</p>
</li>
<li>
<p>CSMA/CD protocol</p>
</li>
<li>
<p>Medium: coaxial, twisted-pair, optical fiber</p>
</li>
<li>
<p>Data rates: 10/100/1000/10000 Mbps</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_frame_formats">2.1. Frame Formats</h3>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-dix-and-revised-802.3.png" alt="Ethernet (DIX) and Revised (1997) IEEE 802.3" width="521" height="71">
</div>
<div class="title">Figure 1. Ethernet (DIX) and Revised (1997) IEEE 802.3</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-ieee802.3-extended.png" alt="Original IEEE 802.3" width="692" height="71">
</div>
<div class="title">Figure 2. Original IEEE 802.3</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-ieee802.3-snap.png" alt="IEEE 802.3 with SNAP" width="805" height="71">
</div>
<div class="title">Figure 3. IEEE 802.3 with SNAP</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Preamble DIX or Preamble and Start of Frame Delimiter(802.3)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>62 alternating 1s and 0s, and ends with a pair of 1s.</p>
</li>
<li>
<p>For clocking synchronization of the transmitted signal.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Type of protocol</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Length</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Length in bytes of the data following the Length field, up to the Ethernet trailer.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">DA</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Destination address can be an individual or group address</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SA</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source address is always unicast address</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">DSAP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Destination Service Access Protocol</p>
</li>
<li>
<p>The size limitations, along with other Point (802.2) uses of the low-order bits, required the later addition of SNAP headers.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SSAP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source Service Access Protocol</p>
</li>
<li>
<p>Describes the upper-layer protocol Point (802.2) that created the frame.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Control</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Enables both connectionless and connection-oriented operation.</p>
</li>
<li>
<p>Generally used only for connectionless operation by modern protocols, with a 1-byte value of 0x03.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SNAP OUI </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Generally unused today,</p>
</li>
<li>
<p>Providing a place for the sender of the frame to code the OUI representing the manufacturer of the Ethernet NIC.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SNAP Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Using same values as the DIX Type field, overcoming deficiencies with size and use of the DSAP field.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Data</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>N bytes where 46 &#8656; N &#8656; 1500</p>
</li>
<li>
<p>If N &lt; 46, use padding</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">FCS (Frame check sequence)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Contains a 32-bit cyclic redundancy check (CRC) value</p>
</li>
<li>
<p>Calculated by the sending MAC</p>
</li>
<li>
<p>Re-calculated by the receiving MAC to check for damaged frames.</p>
</li>
<li>
<p>Generated from the DA, SA, Length/Type, and Data fields</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_ethernet_mac_addresses">2.2. Ethernet MAC Addresses</h3>
<div class="ulist">
<ul>
<li>
<p>48 bits in hexadecimal</p>
</li>
<li>
<p>Canonical transmission (little endian)= MSO to LSO with LSB to MSB for each octet where</p>
<div class="ulist">
<ul>
<li>
<p>I/G bit: (0/1) Individual or Group address, first bit to be transmitted as LSB of MSO</p>
</li>
<li>
<p>U/L bit: (0/1) Universally or Locally administrated, second bit to be transmitted</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Example: AC-10-7B-3A-92-3C

Convert to Hexa : 10101100 00010000 01101011 00111010 01010010 00111100
Transmission    : 00110101 00001000 11010110 01011100 01001010 00111100</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Change the MAC Address</div>
<div class="content">
<pre>(config-if)# mac-address AC-10-BE-EF-DE-AD</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Even if you change the MAC address of the swithch port,
STP will continue to use the BIA.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_types_of_mac_addresses">2.2.1. Types Of MAC Addresses</h4>
<div class="ulist">
<ul>
<li>
<p>Unicast : I/G bit = 0</p>
</li>
<li>
<p>Multicast: I/G bit = 1</p>
</li>
<li>
<p>Broadcast: all devices in the segment</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rj_45_pinouts_and_cat5_wiring">2.3. RJ-45 Pinouts and Cat5 Wiring</h3>
<div class="ulist">
<ul>
<li>
<p>Defined by <a href="http://www.eia.org">EIA</a> / <a href="http://www.tiaonline.org">TIA</a></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-pinouts.png" alt="Ehernet and ISO" height="50">
</div>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 1. Ethernet Cabling Types</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type of cable</th>
<th class="tableblock halign-left valign-top">Pinouts</th>
<th class="tableblock halign-left valign-top">Key pins connected</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Straight-through</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T568A or T568B both ends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-1; 2-2; 3-3; 6-6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-over</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T568A on one end;  T568B on the other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-3; 2-6; 3-1; 6-2</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Auto-MDIX (automatic medium-dependent interface crossover)</p>
<div class="ulist">
<ul>
<li>
<p>Detects the wrong cable and causes the switch to swap the pair it uses for transmitting and receiving</p>
</li>
<li>
<p>Not supported on all Cisco switch models</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 2. UTP Cabling References</caption>
<colgroup>
<col style="width: 5%;">
<col style="width: 15%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">UTP</th>
<th class="tableblock halign-left valign-top">Speed</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">—</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for telephones and not for data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 Mbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Originally intended to support Token Ring over UTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Mbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">popular option for Ethernet in years past, if Cat 3 cabling for phones was already in place</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 Mbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intended for the fast Token Ring speed option;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Gbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Very popular for cabling to the desktop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Gbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added mainly for the support of copper cabling for Gigabit Ethernet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Gbps+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cat5e replacement, with multi-gigabit support</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_auto_negotiation_speed_and_duplex">2.4. Auto-Negotiation, Speed and Duplex</h3>
<div class="ulist">
<ul>
<li>
<p>By default, Ethernet auto-negotiation uses FLP (Fast Link Pulses) to determine the speed and duplex setting.</p>
</li>
<li>
<p>To disable auto-negotiation, manually configure the speed and the duplex settings.</p>
</li>
<li>
<p>if auto-negotation is disabled on one end by statically setting the speed , the other end</p>
<div class="ulist">
<ul>
<li>
<p>detects the speed based on the incoming electrical signal</p>
</li>
<li>
<p>sets duplex to half for 10 and 100 Mbps and full duplex for 1Gps interfaces</p>
</li>
</ul>
</div>
</li>
<li>
<p>if auto-negotation is disabled on both end and different speeds statically configured, link down</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set Speed for the Interface</div>
<div class="content">
<pre>(config-if)# speed {10 | 100 | 1000 | auto | nonegotiate}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set Duplex Mode for the Interface</div>
<div class="content">
<pre>(config-if)# duplex {auto | full | half}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Show Controllers</div>
<div class="content">
<pre>Router# show controllers fastethernet1
!
Interface FastEthernet1   MARVELL 88E6052
Link is DOWN
Port is undergoing Negotiation or Link down
Speed :Not set, Duplex :Not set
!
Switch PHY Registers:
~~~~~~~~~~~~~~~~~~~~~
00 : 3100   01 : 7849   02 : 0141   03 : 0C1F   04 : 01E1
05 : 0000   06 : 0004   07 : 2001   08 : 0000   16 : 0130
17 : 0002   18 : 0000   19 : 0040   20 : 0000   21 : 0000
!
Switch Port Registers:
~~~~~~~~~~~~~~~~~~~~~~
Port Status Register       [00] : 0800
Switch Identifier Register [03] : 0520
Port Control Register      [04] : 007F
Rx Counter Register        [16] : 000A
Tx Counter Register        [17] : 0008</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_standards">2.5. Standards</h3>
<table class="tableblock frame-none grid-none spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dot1q trunking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rapid STP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1ax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LACP (formerly 802.3ad)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical Link Control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast ethernet over copper and optical cable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gigabit ethernet over optical cable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3ab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gigabit ethernet over copper cable</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 3. Ethernet Types and Cabling Standards</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Standard</th>
<th class="tableblock halign-left valign-top">Cabling</th>
<th class="tableblock halign-left valign-top">Maximum Single Cable Length</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10BASE5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thick coaxial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10BASE2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thin coaxial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">185 m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10BASE-T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTP Cat 3, 4, 5, 5e, 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100BASE-FX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two strands, multimode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400 m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100BASE-T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTP Cat 3, 4, 5, 5e, 6, 2 pair</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100BASE-T4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTP Cat 3, 4, 5, 5e, 6, 4 pair</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100BASE-TX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTP Cat 3, 4, 5, 5e, 6, or STP, 2 pair</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000BASE-LX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long-wavelength laser, MM or SM fiber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 km (SM) 3 km (MM)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000BASE-SX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short-wavelength laser, MM fiber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">220 m with 62.5-micron fiber; 550 m with 50-micron fiber</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000BASE-ZX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended wavelength, SM fiber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 km</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000BASE-CS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STP, 2 pair</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 m 100 m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000BASE-T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTP Cat 5, 5e, 6, 4 pair</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 m</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ethertype">2.6. Ethertype</h3>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">EtherType</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x806</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x800</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPv6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x86DD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MPLS (Unicast)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8847</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MPLS (Multicast)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8848</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PPPoE (Discovery Stage)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8863</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PPPoE (PPP Session Stage)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8864</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RARP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8035</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_troubleshooting">2.7. Troubleshooting</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Runts
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>Runts are frames smaller than 64 bytes.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Overruns
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>The number of times the receiver hardware was unable to hand received data to a hardware buffer.</p>
</li>
<li>
<p>Common Cause: The input rate of traffic exceeded the ability of the receiver to handle the data.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Ignores
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>The number of received packets ignored by the interface because the interface hardware ran low on internal buffers.</p>
</li>
<li>
<p>Common Causes: Broadcast storms and bursts of noise can cause the ignored count to be increased.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
CRC errors
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>The frame’s cyclic redundancy checksum value does not match the one calculated by the switch or router.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Frames
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>Frame errors have a CRC error and contain a noninteger number of octets.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Alignment
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>Alignment errors have a CRC error and an odd number of octets.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Collisions
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>Look for collisions on a full-duplex interface (meaning that the interface operated in half-duplex mode at some point in the past),
or excessive collisions on a half-duplex interface.</p>
</li>
<li>
<p>Excessive collisions occur when a frame is dropped because the switch encounters 16 collisions in a row.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Late collisions on a half-duplex interface
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>A late collision occurs after the first 64 bytes of a frame.</p>
</li>
<li>
<p>Late collisions occur after every device on the wire should have recognized that the wire was in use.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Possible causes of collisions include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A cable that is out of specification (either too long, the wrong type, or defective)</p>
</li>
<li>
<p>A bad network interface card (NIC) card (with physical problems or driver problems)</p>
</li>
<li>
<p>A port duplex misconfiguration</p>
</li>
<li>
<p>A port duplex misconfiguration is a common cause of the errors because of failures to negotiate the speed and duplex properly between two directly connected devices (for example, a NIC that connects to a switch). Only half-duplex connections should ever have collisions in a LAN. Because of the carrier sense multiple access (CSMA) nature of Ethernet, collisions are normal for half duplex, as long as the collisions do not exceed a small percentage of traffic.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_problems_and_approaches">2.7.1. Problems and Approaches</h4>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 50%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Problem</th>
<th class="tableblock halign-left valign-top">Questions?</th>
<th class="tableblock halign-left valign-top">Commands</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Lack of reachability to devices in the same VLAN</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Layer 1 issues ?</p>
</li>
<li>
<p>VLAN exists on the switch?</p>
</li>
<li>
<p>Interface assigned to the correct VLAN?</p>
</li>
<li>
<p>VLAN allowed on the trunk?</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>show interface</p>
</li>
<li>
<p>show vlan</p>
</li>
<li>
<p>show interface switchport</p>
</li>
<li>
<p>traceroute mac source-mac destination-mac</p>
</li>
<li>
<p>show interface trunk</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Intermittent reachability to devices in the same VLAN</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Excessive interface traffic?</p>
</li>
<li>
<p>Unidirectional links?</p>
</li>
<li>
<p>Spanning-tree problems such as BPDU floods or flapping MAC addresses?</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>show interface</p>
</li>
<li>
<p>show spanning-tree</p>
</li>
<li>
<p>show spanning-tree root</p>
</li>
<li>
<p>show mac address-table</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>No connectivity between switches</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Trunk links active?</p>
</li>
<li>
<p>EtherChannels active?</p>
</li>
<li>
<p>BPDU Guard is not enabled on a trunk interface?</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>show interfaces status err-disabled</p>
</li>
<li>
<p>show interfaces trunk</p>
</li>
<li>
<p>show etherchannel summary</p>
</li>
<li>
<p>show spanning-tree detail</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Poor performance across a link</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Duplex mismatch?</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>show interface</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cdp_lldp_and_udld">3. CDP, LLDP and UDLD</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cdp">3.1. CDP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Catalyst3560-X Configuration Guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swcdp.html">CDP</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Layer 2 discovery protocol running on Cisco devices</p>
</li>
<li>
<p>Retrieves device type and SNMP agent address of neighboring devices</p>
</li>
<li>
<p>Send CDP announcements to the multicast destination address 01-00-0c-cc-cc-cc,</p>
</li>
<li>
<p>All CDP packet includes the VLAN ID of the access port or the lowest VLAN ID in a trunk port</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_packet_format">3.1.1. Packet Format</h4>
<div class="ulist">
<ul>
<li>
<p>Header followed by a set of TLV value</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/cdp-frame-format.png" alt="CDP Frame Format" width="512" height="248">
</div>
<div class="title">Figure 4. CDP Frame Format</div>
</div>
</div>
<div class="sect3">
<h4 id="_cdp_operations">3.1.2. CDP Operations</h4>
<div class="ulist">
<ul>
<li>
<p>Enabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display Global Information About CDP Characteristics</div>
<div class="content">
<pre># show cdp

Capability Codes: R - Router, T - Trans Bridge, B - Source Route Bridge
                 S - Switch, H - Host, I - IGMP, r - Repeater

Device ID        Local Intrfce     Holdtme    Capability  Platform  Port ID
Router3             Ser 1          120           R        2500      Ser 0
Router1             Eth 1          180           R        2500      Eth 0
Switch1             Eth 0          240           S        1900      2</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>show cdp entry &lt;entry-name&gt; [protocol | version]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable CDP</div>
<div class="content">
<pre>(config)# no cdp run</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable CDP on an Interface</div>
<div class="content">
<pre>(config-if)# cdp enable</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cdp_updates">3.1.3. CDP Updates</h4>
<div class="ulist">
<ul>
<li>
<p>by default every 60 seconds</p>
</li>
<li>
<p>can be set between 5 to 254 seconds</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the Transmission Frequency Of CDP Updates In Seconds</div>
<div class="content">
<pre>(config)# cdp timer &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Amount Of Time a Receiving Device Should Hold the Information Sent by Your Device</div>
<div class="content">
<pre>(config)# cdp holdtime &lt;seconds&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
default: 180 seconds, range: 10 to 255 seconds
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_version">3.1.4. Version</h4>
<div class="listingblock">
<div class="title">Task: Send Version-2 Advertisements</div>
<div class="content">
<pre>(config)# cdp advertise-v2</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_and_maintenance">3.1.5. Monitoring and Maintenance</h4>
<div class="listingblock">
<div class="title">Task: Reset the Traffic Counters to Zero</div>
<div class="content">
<pre># clear cdp counters</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_neighbors">3.1.6. Neighbors</h4>
<div class="listingblock">
<div class="title">Task: Delete the CDP Table Of Information About Neighbors</div>
<div class="content">
<pre># clear cdp table</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Information About Interfaces Where CDP Enabled</div>
<div class="content">
<pre>sh cdp interface [&lt;interface-id&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Information About Neighbors</div>
<div class="content">
<pre># sh cdp neighbors [&lt;interface-id&gt;] [detail]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display CDP Counters, Including the Number Of Packets Sent and Received and Checksum Errors</div>
<div class="content">
<pre># show cdp traffic

Total packets output: 543, Input: 333
 Hdr syntax: 0, Chksum error: 0, Encaps failed: 0
 No memory: 0, Invalid: 0, Fragmented: 0
 CDP version 1 advertisements output: 191, Input: 187
 CDP version 2 advertisements output: 352, Input: 146</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lldp">3.2. LLDP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Catalyst Configuration Guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swlldp.html">LLDP</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>IEEE 802.1AB link layer discovery protocol</p>
</li>
<li>
<p>Neighbor discovery protocol</p>
</li>
<li>
<p>Advertises TLV(type, length, value) for each attribute</p>
<div class="ulist">
<ul>
<li>
<p>Basic mandatory</p>
<div class="ulist">
<ul>
<li>
<p>port description</p>
</li>
<li>
<p>system name</p>
</li>
<li>
<p>system description</p>
</li>
<li>
<p>system capabilities</p>
</li>
<li>
<p>management address</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional</p>
<div class="ulist">
<ul>
<li>
<p>port vlan ID for ieee 802.1</p>
</li>
<li>
<p>MAC/PHY configuration/status for ieee 802.3</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_lldp_global_state">3.2.1. LLDP Global State</h4>
<div class="ulist">
<ul>
<li>
<p>Disabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable LLDP Globally on the Switch</div>
<div class="content">
<pre>(config)# lldp run</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Global Information, Such As Frequency Of Transmissions, the Holdtime for Packets Being Sent, and the Delay Time Before LLDP Initializes on an Interface.</div>
<div class="content">
<pre># show lldp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display LLDP Counters, Including the Number Of Packets Sent and Received, Number Of Packets Discarded, and Number Of Unrecognized TLVs.</div>
<div class="content">
<pre># show lldp traffic</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Reset the Traffic Counters to Zero.</div>
<div class="content">
<pre># clear lldp counters</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Delete the LLDP Neighbor Information Table.</div>
<div class="content">
<pre># clear lldp table</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Clear the NMSP Statistic Counters.</div>
<div class="content">
<pre># clear nmsp statistics</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lldp_interfaces">3.2.2. LLDP Interfaces</h4>
<div class="ulist">
<ul>
<li>
<p>Disabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable an Interface to Send LLDP Packets</div>
<div class="content">
<pre>(config-if)# lldp transmit</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable an Interface to Receive LLDP Packets</div>
<div class="content">
<pre>(config-if)# lldp receive</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Information About Interfaces with LLDP Enabled.</div>
<div class="content">
<pre># show lldp interface [&lt;interface-id&gt;]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_neighbors_2">3.2.3. Neighbors</h4>
<div class="listingblock">
<div class="title">Task: Display Information About a Specific Neighbor.</div>
<div class="content">
<pre># show lldp entry &lt;entry-name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Information About All Neighbors.</div>
<div class="content">
<pre># show lldp entry *</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Information About Neighbors, Including Device Type, Interface Type and Number, Holdtime Settings, Capabilities, and Port ID.</div>
<div class="content">
<pre># show lldp neighbors [&lt;interface-id&gt;] [detail]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_timers">3.2.4. Timers</h4>
<div class="ulist">
<div class="title">Task: Specify the Amount Of Time a Receiving Device Should Hold the Information from Your Device</div>
<ul>
<li>
<p>default: 120 s, range: 0 - 65535</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# lldp holdtime &lt;seconds&gt;</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Task: Specify the Delay Time In Seconds for LLDP to Initialize on an Interface.</div>
<p>The range is 2 to 5 seconds; the default is 2 seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# lldp reinit delay</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Task: Set the Sending Frequency Of LLDP Updates In Seconds.</div>
<p>The range is 5 to 65534 seconds; the default is 30 seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# lldp timer rate</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tlv">3.2.5. TLV</h4>
<div class="listingblock">
<div class="title">Task: Specify the LLDP TLVs to Send or Receive.</div>
<div class="content">
<pre>(config)# lldp tlv-select</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the LLDP-MED TLVs to Send or Receive.</div>
<div class="content">
<pre>(config)# lldp med-tlv-select</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the LLDP-MED TLV to Send</div>
<div class="content">
<pre>(config-if)# lldp med-tlv-select {inventory-management | location | network-policy | power-management }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure Network Policy TLV</div>
<div class="content">
<pre>(config)# network-policy profile &lt;profile-number&gt;
(config)#  {voice | voice-signaling} vlan [&lt;id&gt;  {cos &lt;cvalue&gt; | dscp &lt;dvalue&gt;}]
            | [[dot1p {cos &lt;cvalue&gt; | dscp &lt;dvalue&gt;}] | none | untagged]
(config-if)# network-policy &lt;profile-number&gt;
(config-if)# lldp med-tlv select network-policy</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>if the interface is configured as a tunnel port, LLDP is automatically disabled.</p>
</li>
<li>
<p>If you first configure a network-policy profile on an interface, you cannot apply the switchport voice vlan command on the interface. If the switchport voice vlan vlan-id is already configured on an interface, you can apply a network-policy profile on the interface. This way the interface has the voice or voice-signaling VLAN network-policy profile applied on the interface.</p>
</li>
<li>
<p>You cannot configure static secure MAC addresses on an interface that has a network-policy profile.</p>
</li>
<li>
<p>You cannot configure a network-policy profile on a private-VLAN port.</p>
</li>
<li>
<p>For wired location to function, you must first enter the ip device tracking global configuration command.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Display the Location Information for an Endpoint.</div>
<div class="content">
<pre># show location</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_network_policy_profiles">3.2.6. Network-Policy Profiles</h4>
<div class="listingblock">
<div class="title">Task: Display the Configured Network-Policy Profiles.</div>
<div class="content">
<pre># show network-policy profile</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the NMSP Information.</div>
<div class="content">
<pre># show nmsp</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lldp_med">3.2.7. LLDP-MED</h4>
<div class="ulist">
<ul>
<li>
<p>LLDP for Media Endpoint Devices</p>
</li>
<li>
<p>operates between endpoint devices (ip phones) and network devices (switches)</p>
</li>
<li>
<p>supports VoIP applications</p>
</li>
<li>
<p>TLVs enabled by default:</p>
<div class="ulist">
<ul>
<li>
<p>LLDP-MED capabilities TLV</p>
</li>
<li>
<p>network policy TLV</p>
</li>
<li>
<p>Power management TLV</p>
</li>
<li>
<p>Inventory management TLV</p>
</li>
<li>
<p>Location TLV</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_wired_location_service">3.2.8. Wired Location Service</h4>
<div class="ulist">
<ul>
<li>
<p>The switch uses the wired location service feature to send location and
attachment tracking information for its connected devices to a Cisco Mobility
Services Engine (MSE). The tracked device can be a wireless endpoint, a wired
endpoint, or a wired switch or controller. The switch notifies the MSE of
device link up and link down events through the Network Mobility Services
Protocol (NMSP) location and attachment notifications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The MSE starts the NMSP connection to the switch, which opens a server port.
When the MSE connects to the switch there are a set of message exchanges to
establish version compatibility and service exchange information followed by
location information synchronization. After connection, the switch periodically
sends location and attachment notifications to the MSE. Any link up or link
down events detected during an interval are aggregated and sent at the end of
the interval.</p>
</div>
<div class="paragraph">
<p>When the switch determines the presence or absence of a device on a link-up or
link-down event, it obtains the client-specific information such as the MAC
address, IP address, and username. If the client is LLDP-MED- or CDP-capable,
the switch obtains the serial number and UDI through the LLDP-MED location TLV
or CDP.</p>
</div>
<div class="paragraph">
<p>Depending on the device capabilities, the switch obtains this client information at link up:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Slot and port specified in port connection</p>
</li>
<li>
<p>MAC address specified in the client MAC address</p>
</li>
<li>
<p>IP address specified in port connection</p>
</li>
<li>
<p>802.1X username if applicable</p>
</li>
<li>
<p>Device category is specified as a wired station</p>
</li>
<li>
<p>State is specified as new</p>
</li>
<li>
<p>Serial number, UDI</p>
</li>
<li>
<p>Model number</p>
</li>
<li>
<p>Time in seconds since the switch detected the association</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on the device capabilities, the switch obtains this client information at link down:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Slot and port that was disconnected</p>
</li>
<li>
<p>MAC address</p>
</li>
<li>
<p>IP address</p>
</li>
<li>
<p>802.1X username if applicable</p>
</li>
<li>
<p>Device category is specified as a wired station</p>
</li>
<li>
<p>State is specified as delete</p>
</li>
<li>
<p>Serial number, UDI</p>
</li>
<li>
<p>Time in seconds since the switch detected the disassociation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the switch shuts down, it sends an attachment notification with the state
delete and the IP address before closing the NMSP connection to the MSE. The
MSE interprets this notification as disassociation for all the wired clients
associated with the switch.</p>
</div>
<div class="paragraph">
<p>If you change a location address on the switch, the switch sends an NMSP
location notification message that identifies the affected ports and the
changed address information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_udld">3.3. UDLD</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Catalyst 3560 Configuration Guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swudld.html">UDLD</span></span></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Problem:  unidirectional links</p>
<div class="ulist">
<ul>
<li>
<p>one of the 2 transmission paths has failed but not both</p>
</li>
<li>
<p>due to miscabling, cutting on fiber cable, unplugging one fiber, GBIC problems, &#8230;&#8203;</p>
</li>
<li>
<p>can cause a loop as the previously blocking port will move to a forwarding state</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/stp-unidirectional-links.png" alt="stp unidirectional links" height="150">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>solutions:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">UDLD <strong>U</strong>ni<strong>D</strong>irectional <strong>L</strong>ink <strong>D</strong>etection</dt>
</dl>
</div>
</li>
<li>
<p>Uses Layer 2 messaging to decide when a switch can no longer receive frames from
a neighbor. The switch whose transmit interface did not fail is placed into an err-disabled state.</p>
</li>
<li>
<p>Cisco Proprietary</p>
</li>
<li>
<p>Multicast Address 01:00:0C:CC:CC:CC</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_operations">3.3.1. Operations</h4>
<div class="ulist">
<ul>
<li>
<p>Each UDLD port  sends protocol messages that contains the own device/port ID and the neighbor&#8217;s IDs seen by UDLD.</p>
</li>
<li>
<p>If the port doesn&#8217;t see its own device/port ID in the incoming UDLD packet for a specific amount of time,
the link is considered unidirectional.</p>
</li>
<li>
<p>It is recommended to keep \$T_(\d\e\t\ection)&lt;T_(reconver\g\ence)\$
by choosing an appropriate message interval
which ensures that UDLD is detected before STP forward delay expires</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_normal_mode">Normal Mode</h5>
<div class="ulist">
<ul>
<li>
<p>default</p>
</li>
<li>
<p>marks as <strong>Undertermined</strong> if port at Layer 1 is still up</p>
</li>
<li>
<p>does NOT shutdown or disable the port</p>
</li>
<li>
<p>does NOt prevent physical loops (informational and less disrupptive)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_aggresive_mode">Aggresive Mode</h5>
<div class="ulist">
<ul>
<li>
<p>Attempts to reconnect with the other switch (eight times)
after realizing no messages have been received.</p>
</li>
<li>
<p>If the other switch does not reply to the repeated additional messages,
both sides become err-disabled.</p>
</li>
<li>
<p>no automatic recovery unless UDLD err-disable recovery is configured</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_default_configuration">3.3.2. Default Configuration</h4>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Default Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDLD global enable state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Globally disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDLD per-port enable state for fiber-optic media</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled on all Ethernet fiber-optic ports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDLD per-port enable state for UTP copper media</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled on all Ethernet 10/100/1000BASE-TX ports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDLD aggressive mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Enable UDLD Globally</div>
<div class="content">
<pre>(config)# udld {aggressive | enable | message time &lt;seconds&gt;}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the period of time between UDLD probe messages</div>
<div class="content">
<pre>(config)# udld message time &lt;seconds&gt;}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>configure the period of time between UDLD probe messages on ports
that are in the advertisement phase and are detected to be bidirectional.</p>
</li>
<li>
<p>range: 1 to 90 seconds</p>
</li>
<li>
<p>default: 15 seconds</p>
</li>
<li>
<p>This command affects fiber-optic ports only. Use <strong>(config-if)# udld</strong>
to enable UDLD on other port types.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Enable UDLD on an Interface</div>
<div class="content">
<pre>(config-if)# udld</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Reset an Interface Disabled by UDLD</div>
<div class="content">
<pre># udld reset</pre>
</div>
</div>
<div class="paragraph">
<p>You can also  restart the disabled port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>shutdown</strong> followed by <strong>no shutdown</strong></p>
</li>
<li>
<p><strong>no udld {aggressive | enable}</strong> followed by <strong>udld {aggressive | enable}</strong></p>
</li>
<li>
<p><strong>no udld port</strong> followed by <strong>udld port [aggressive]</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_udld_error_disabled_state">3.3.3. UDLD Error-Disabled State</h4>
<div class="listingblock">
<div class="title">Task: Recover from the UDLD Error-Disabled State</div>
<div class="content">
<pre>! Enable UDLD to automatically recover
(config)# errdisable recovery cause udld

! Specify the time to recover from the UDLD error-disabled state
(config-if)# errdisable recovery interval &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display UDLD Status</div>
<div class="content">
<pre># show udld [interface-id]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_udld_vs_loop_guard">3.3.4. UDLD vs Loop Guard</h4>
<div class="ulist">
<ul>
<li>
<p>complementary and can be both configured at the same time</p>
<div class="literalblock">
<div class="content">
<pre>In certain designs there are unidirectional links that Loop Guard can prevent
and UDLD cannot, and likewise ones that UDLD can prevent but Loop Guard cannot.
For example, if a loop occurs because of a physical wiring problem (for
example, someone mistakenly mixes up the send and receive pairs of a fiber
link), UDLD can detect this, but Loop Guard cannot. Likewise, if there is a
unidirectional link caused by a failure in the STP software itself, although
much more rare, Loop Guard can detect this but UDLD cannot.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vlans_and_trunking">4. VLANs and Trunking</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_normal_and_extended_vlans">4.1. Normal and Extended VLANs</h3>
<div class="ulist">
<ul>
<li>
<p>Administratively defined subset of switch ports that are in the same broadcast domain</p>
</li>
<li>
<p>Best practice: one VLAN, one IP subnet</p>
</li>
<li>
<p>Traffic inside same VLAN is layer 2 switched</p>
</li>
<li>
<p>Traffic between VLANs is layer 3 routed</p>
</li>
<li>
<p>Can span multiple physical switches over "trunks"</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_vlan_numbering">4.1.1. VLAN Numbering</h4>
<div class="ulist">
<ul>
<li>
<p>VLAN ID = 12 bits</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Reserved [0, 4095] </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Not available for use</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Normal-range [1-1005]</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Advertised and pruned by VTP v1 and v2 except vlan 1, 1002-1005</p>
</li>
<li>
<p>Configured in both vlan database mode and configuration mode</p>
</li>
<li>
<p>Stored in VLAN.DAT file in Flash</p>
</li>
<li>
<p>Special VLANs:</p>
<div class="ulist">
<ul>
<li>
<p>Vlan 1 is the default Ethernet VLAN for all access ports; cannot be deleted or changed.</p>
</li>
<li>
<p>Vlan 1002,1004 : default for FDDI (default, net)</p>
</li>
<li>
<p>Vlan 1003,1005 : default for Token Ring (default,translational bridge).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Extended-range [1006-4094] </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Cannot be advertised or pruned by VTP v1 and v2</p>
</li>
<li>
<p>Configured only in VTP transparent mode</p>
</li>
<li>
<p>Stored only in the running configuration</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_vlan_trunks">4.1.2. VLAN Trunks</h4>
<div class="ulist">
<ul>
<li>
<p>Trunk: point-to-point links for multiple VLANs between devices</p>
</li>
<li>
<p>Trunking add ISL or 802.1q headers to include VLAN id.</p>
<div class="ulist">
<ul>
<li>
<p>ISL : Cisco proprietary, 30-bytes (26-byte header + 4-byte trailer), does not modify original frame</p>
</li>
<li>
<p>802.1q: IEEE standard, 4-byte tag except for native VLAN, modifies original frame</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_basic_configuration">4.1.3. Basic Configuration</h4>
<div class="paragraph">
<p>Configuring VLANs requires few steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the VLAN Itself</p>
</li>
<li>
<p>Associate the Correct Ports with VLAN</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>VLAN creation can be done either in VLAN database mode configuration (after <strong>vlan database</strong> ) or normal configuration mode</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 4. Catalyst 3550 VLAN Database Vs Configuration Mode</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">VLAN Database</th>
<th class="tableblock halign-left valign-top">Configuration</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vtp {domain domain-name | password password | pruning | v2-mode | {server | client | transparent}}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">vtp {domain domain-name | file filename | interface name | mode {client | server | transparent} | password password | pruning | version number}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vlan vlan-id [backupcrf {enable | disable}] [mtu mtu-size] [name vlan-name] [parent parent-vlan-id] [state {suspend | active}]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">vlan vlan-id 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show {current | proposed | difference}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No equivalent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apply | abort | reset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No equivalent</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_vlan_state">4.1.4. VLAN State</h4>
<div class="ulist">
<ul>
<li>
<p>Can be active or suspended</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Modify the Operational State Of a VLAN</div>
<div class="content">
<pre>(config)# vlan &lt;id&gt;
(config-vlan)#state [active | suspend]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshoot">4.1.5. Troubleshoot</h4>
<div class="paragraph">
<p>Check "Creating ethernet VLANs on catalyst switches: troubleshoot tips"</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SVI will be in "up/down" state after being deleted</p>
</li>
<li>
<p>SVI will be in "up/up" if</p>
<div class="ulist">
<ul>
<li>
<p>The VLAN associated with the SVI exists in the VLAN database</p>
</li>
<li>
<p>At least one trunk or access port in the "up/up" state has been assigned to the VLAN</p>
</li>
<li>
<p>Those ports in the "up/up" state are not blocked by STP</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_voice_vlans">4.2. Voice VLANs</h3>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swvoip.html" class="bare">http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swvoip.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_private_vlans">4.3. Private VLANs</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Cat3560-X Configuration Guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swpvlan.html">Private VLANs</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Separate ports as if they are on different VLAN while consuming only one subset.</p>
</li>
<li>
<p>Typically used by service provider in a multi-tenant offerings: one router, one switch, multiple customers</p>
</li>
<li>
<p>PVLAN</p>
<div class="ulist">
<ul>
<li>
<p>one primary VLAN ( promiscuous ports) + multiple secondary VLANs</p>
</li>
<li>
<p>At most one isolated secondary VLAN</p>
</li>
<li>
<p>Zero or more community secondary VLANs</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cannot use vlan 1, 1002-1005 as private vlans</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display Private VLAN Information</div>
<div class="content">
<pre># sh vlan private-vlan [type]

Primary     Secondary   Type                Ports
-------     ---------   ----                ---------------------
10          501         isolated            Gi2/0/1,Gi3/0/1,Gi3/0/2
10          502         community           Gi2/0/11,Gi3/0/1,Gi3/0/4
10          503         non-operational</pre>
</div>
</div>
<div class="sect3">
<h4 id="_primary_vlans">4.3.1. Primary VLANs</h4>
<div class="ulist">
<ul>
<li>
<p>carries unidirectional traffic downstream from promiscuous ports to all ports</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Primary VLAN and Associated Secondary VLANs</div>
<div class="content">
<pre>(config)# vtp mode transparent
(config)# vlan 100
(config-vlan)#private-vlan primary
(config-vlan)#private-vlan association 123-321,999</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_isolated_vlans">4.3.2. Isolated VLANs</h4>
<div class="ulist">
<ul>
<li>
<p>carries unidirectional traffic upstream from the hosts toward the promiscuous ports and the gateway.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Isolated VLANs</div>
<div class="content">
<pre>(config)# vtp mode transparent
(config)# vlan 102
(config-vlan)# private-vlan isolated</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_community_vlans">4.3.3. Community VLANs</h4>
<div class="ulist">
<ul>
<li>
<p>carries unidirectional traffic upstream from the hosts toward the promiscuous ports and the gateway.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Isolated VLANs</div>
<div class="content">
<pre>(config)# vtp mode transparent
(config)# vlan 102
(config-vlan)# private-vlan isolated</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_private_vlan_host_port">4.3.4. Private-Vlan Host Port</h4>
<div class="listingblock">
<div class="title">Task: Configure a Layer 2 Port Interface As a Private-Vlan Host Port</div>
<div class="content">
<pre>(config-if)# switchport mode private-vlan host
(config-if)# switchport private-vlan host-association &lt;primary-vlan-id&gt; &lt;secondary-vlan-ids&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although private VLANs provide host isolation at Layer 2,
hosts can communicate with each other at Layer 3.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_private_vlan_promiscuous_ports">4.3.5. Private-VLAN Promiscuous Ports</h4>
<div class="listingblock">
<div class="title">Task: Configure a Layer 2 Port Interface As a Private-Vlan Promiscuous Port</div>
<div class="content">
<pre>(config-if)# switchport mode private-vlan promiscuous
(config-if)# switchport private-vlan mapping &lt;primary-vlan-id&gt; [add | remove] &lt;secondary-vlan-ids&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_private_vlan_svi">4.3.6. Private-VLAN SVI</h4>
<div class="ulist">
<ul>
<li>
<p>SVI can only be associated to primary VLANs</p>
</li>
<li>
<p>SVIs for secondary VLANs are inactive</p>
</li>
<li>
<p>If you assign an IP subnet to the primary VLAN SVI,
this subnet is the IP subnet address of the entire private VLAN</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Layer 3 Vlan Interface As a Private-Vlan Promiscuous Port</div>
<div class="content">
<pre>(config)# interface vlan &lt;primary-vlan-id&gt;
(config-if)# private-vlan mapping &lt;primary-vlan-id&gt; [add | remove] &lt;secondary-vlan-ids&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Information About the Private-VLAN Mapping for VLAN SVIs</div>
<div class="content">
<pre># sh interface private-vlan mapping</pre>
</div>
</div>
<div class="paragraph">
<p>TODO ip sticky arp</p>
</div>
</div>
<div class="sect3">
<h4 id="_private_vlan_accross_multiple_switches">4.3.7. Private-Vlan Accross Multiple Switches</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/private-vlan-accross-multiple-switches.png" alt="Private-VLAN accross multiple switches" width="400" height="400"></span></p>
</div>
<div class="paragraph">
<p>As with regular VLANs, private VLANs can span multiple switches. A trunk port
carries the primary VLAN and secondary VLANs to a neighboring switch. The trunk
port treats the private VLAN as any other VLAN. A feature of private VLANs
across multiple switches is that traffic from an isolated port in switch A does
not reach an isolated port on Switch B.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Manually configure private VLANs on all switches because VTP (v1 and v2) does not support private VLANs,
-</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>TODO interaction with switch that do not support private-vlan</p>
</div>
<div class="paragraph">
<p>TODO PVLAN Trunk</p>
</div>
<div class="paragraph">
<p>TODO PVLAN Isolated</p>
</div>
<div class="paragraph">
<p>TODO see page 67 Narbick</p>
</div>
</div>
<div class="sect3">
<h4 id="_interaction_with_other_features">4.3.8. Interaction with Other Features</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">VTP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>VTP v1 and v2 don&#8217;t propagate private-vlans</p>
<div class="ulist">
<ul>
<li>
<p>Set transparent mode</p>
</li>
<li>
<p>Save the VTP transparent mode and private-vlan to startup configuration</p>
</li>
</ul>
</div>
</li>
<li>
<p>VTP v3 supports private-vlans</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">STP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>only one STP instance for the entire private-vlan</p>
</li>
<li>
<p>the STP parameters of the primary VLAN are propagated to the secondary VLANs</p>
</li>
<li>
<p>Enable Port Fast and BPDU guard on isolated and community host ports
to prevent STP loops due to misconfigurations and to speed up STP convergence</p>
</li>
<li>
<p>Do not enable Port Fast and BPDU guard on promiscuous ports.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">DHCP snooping</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Can be enabled on the private VLAN</p>
</li>
<li>
<p>propagates to all secondary vlans when enabled on the primary VLAN</p>
</li>
<li>
<p>If you configure DHCP on a secondary VLAN, the configuration does not take
effect if the primary VLAN is already configured (?!)</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">IP source guard</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>enabled only if DHCP snooping is enabled on the primary vlan</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SPAN</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You can configure a private-VLAN port as a SPAN source port.</p>
</li>
<li>
<p>You can use VLAN-based SPAN (VSPAN) on primary, isolated, and community VLANs
or use SPAN on only one VLAN to separately monitor egress or ingress traffic.</p>
</li>
<li>
<p>A private-VLAN host or promiscuous port cannot be a SPAN destination port. If
you configure a SPAN destination port as a private-VLAN port, the port
becomes inactive.</p>
</li>
<li>
<p>A RSPAN vlan can not be a private-vlan primary or secondary vlan.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">PAgP or LACP </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If a port is part of a private vlan, any Etherchannel configuration is inactive</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">IGMP snooping</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When enabled (the default), the switch supports no more than 20 private-vlan domain</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">802.1x</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You can configure IEEE 802.1x port-based authentication on a private-VLAN port,</p>
</li>
<li>
<p>You can not configure IEEE 802.1x with port security, voice VLAN, or per-user
ACL on private-VLAN ports.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Static MAC address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If you configure a static MAC address on a promiscuous port in the primary VLAN,
you must add the same static address to all associated secondary VLANs.</p>
</li>
<li>
<p>If you configure a static MAC address on a host port in a secondary VLAN,
you must add the same static MAC address to the associated primary VLAN.</p>
</li>
<li>
<p>When you delete a static MAC address from a private-VLAN port,
you must remove all instances of the configured MAC address from the private VLAN.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_pvlan_edge_or_protected_ports">4.3.9. PVLAN Edge or Protected Ports</h4>
<div class="ulist">
<ul>
<li>
<p>only local significance to the switch (unlike Private Vlans),</p>
</li>
<li>
<p>no isolation provided between two protected ports located on different switches.</p>
</li>
<li>
<p>A protected port does not forward any traffic (unicast, multicast, or broadcast) to any other
port that is also a protected port in the same switch.</p>
</li>
<li>
<p>Traffic cannot be forwarded between protected ports at L2, all traffic passing between protected
ports must be forwarded through a Layer 3 device.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a protected port</div>
<div class="content">
<pre>(config-if)# switchport protected</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_vtp">4.4. VTP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Catalyst Configuration guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swvtp.html#pgfId-1035238">Configuring VTP</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vlan Trunk Protocol</p>
</li>
<li>
<p>Cisco-proprietary that distributes VLAN information among Catalyst switches</p>
</li>
<li>
<p>Advertises the VLAN ID, Name and Type but not which ports should be in each VLAN</p>
</li>
<li>
<p>Eases administrative burden for addition, deletion and renaming of VLANs</p>
</li>
<li>
<p>Supports 1005 VLANs (IP base or IP services feature set) or 255 VLANs (LAN base feature set)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Show VTP Status</div>
<div class="content">
<pre># show vtp status

VTP Version: 3 (capable)
Configuration Revision: 1
Maximum VLANs supported locally: 1005
Number of existing VLANs: 37
VTP Operating Mode: Server
VTP Domain Name: [smartports]
VTP Pruning Mode: Disabled
VTP V2 Mode: Enabled
VTP Traps Generation: Disabled
MD5 digest : 0x26 0xEE 0x0D 0x84 0x73 0x0E 0x1B 0x69
Configuration last modified by 172.20.52.19 at 7-25-08 14:33:43
Local updater ID is 172.20.52.19 on interface Gi5/2 (first layer3 interface fou)
VTP version running: 2</pre>
</div>
</div>
<div class="sect3">
<h4 id="_vtp_version">4.4.1. VTP Version</h4>
<div class="sect4">
<h5 id="_v1">V1</h5>
<div class="ulist">
<ul>
<li>
<p>Default: version 1</p>
</li>
<li>
<p>supports normal range only</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_v2">V2</h5>
<div class="ulist">
<ul>
<li>
<p>supports for Token Ring Concentrator Relay Function and Bridge Relay Function</p>
</li>
<li>
<p>propagates unknown TLV records</p>
</li>
<li>
<p>Optimized VLAN database consistency checking:</p>
<div class="ulist">
<ul>
<li>
<p>In VTPv1, VLAN database consistency checks are performed whenever the VLAN database is modified, either through CLI, SNMP, or VTP.</p>
</li>
<li>
<p>In VTPv2, these consistency checks are skipped if the change was caused by a received VTP message, as the message itself was originated as a result of a CLI or SNMP action that must already have been sanitized.</p>
</li>
<li>
<p>This is really just an implementation optimization.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_v3">V3</h5>
<div class="ulist">
<ul>
<li>
<p>Supports the whole IEEE 802.1q vlan range up to 4095 ( v1 and v2 support only normal range VLANs 1-1005)</p>
</li>
<li>
<p>Can send private LAN information in addition to normal VLAN information.</p>
</li>
<li>
<p>Backward compatible with VTP 2</p>
</li>
<li>
<p>Add support for databases other than VLAN databases such as MST databases.</p>
</li>
<li>
<p>Clear text or hidden password protection</p>
<div class="ulist">
<ul>
<li>
<p>The encrypted VTP password cannot be displayed back as plaintext.</p>
</li>
<li>
<p>While this encrypted string can be carried over to a different switch to make it a valid member of the domain,
the promotion of a secondary server into the primary server role will require entering the password in its plaintext form.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Supports the <strong>off</strong> mode in which the switch does not participate in VTPv3 operations and drops all received VTP messages:</p>
</li>
<li>
<p>Can deactivate VTP on a per-trunk basis</p>
</li>
<li>
<p>VTPv3 is a generalized mechanism for distributing contents of an arbitrary database,
and is not limited to synchronizing VLAN information over a set of switches:</p>
<div class="ulist">
<ul>
<li>
<p>As an example, VTPv3 is also capable of distributing and synchronizing the MST region configuration among all switches in a VTP domain</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, read
<a href="http://www.cisco.com/c/en/us/products/collateral/switches/catalyst-6500-series-switches/solution_guide_c78_508010.html">VTP version 3</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vtp_message_format">4.4.2. VTP Message Format</h4>
<div class="ulist">
<ul>
<li>
<p>Encapsulated in ISL or 802.1q frames</p>
</li>
<li>
<p>Multicasted to  MAC address: 0100-0CCC-CCCC, LLC code: SNAP (AAAA), Type 2003 in the SNAP Header</p>
</li>
<li>
<p>Carried through trunk ports and VLAN 1</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/vtp-in-isl.png" alt="vtp in isl" height="80">
</div>
<div class="title">Figure 5. Example: VTP Packet Encapsulated In ISL Frame</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The VTP header contains these fields:</p>
<div class="ulist">
<ul>
<li>
<p>VTP protocol version: 1,2,3</p>
</li>
<li>
<p>VTP message types: summary advertisements, subset advertisements, advertisement requests, VTP join messages</p>
</li>
<li>
<p>management domain length</p>
</li>
<li>
<p>management domain name</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_summary_advertisements">Summary Advertisements</h5>
<div class="ulist">
<ul>
<li>
<p>Sent by Server and Client every 5 minutes intervals, and in addition, after each modificaton of the VLAN database</p>
</li>
<li>
<p>carries information about VTP domain name,
revision number,
identity of the last updater,
time stamp of the last update,
MD5 sum computed over the contents of the VLAN database and the VTP password (if configured),
and the number of Subset Advertisement messages that optionally follow this Summary Advertisement.</p>
</li>
<li>
<p>summary messages do not carry VLAN database contents.</p>
</li>
<li>
<p>When the switch receives a summary advertisement packet,</p>
<div class="ulist">
<ul>
<li>
<p>The switch compares the VTP domain name to its own VTP domain name.</p>
</li>
<li>
<p>If the name is different, the switch simply ignores the packet.</p>
</li>
<li>
<p>If the name is the same, the switch then compares the configuration revision to its own revision.</p>
</li>
<li>
<p>If its own configuration revision is higher or equal, the packet is ignored.</p>
</li>
<li>
<p>If it is lower, an advertisement request is sent.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/vtp-summary-advert-packet-format.png.png" alt="VTP Summary Advertisement" width="896" height="312">
</div>
<div class="title">Figure 6. VTP Summary Advertisement</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Followers
</td>
<td class="hdlist2">
<p>Indicates that this packet is followed by a Subset Advertisement packet.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Updater Identity
</td>
<td class="hdlist2">
<p>IP address of the switch that is the last to have incremented the configuration revision.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Update Timestamp
</td>
<td class="hdlist2">
<p>Date and time of the last increment of the configuration revision.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
MD5 Digest
</td>
<td class="hdlist2">
<p>If MD5 is configured and used to authenticate the validation of a VTP update.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_subset_advertisements">Subset Advertisements</h5>
<div class="ulist">
<ul>
<li>
<p>Follows the summary advertisement after addition, deletion or modification of a VLAN.</p>
</li>
<li>
<p>Contains a list of VLAN information.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/vtp-subset-advert-packet-format.png.png" alt="VTP Subset Advertisements" width="896" height="312">
</div>
<div class="title">Figure 7. VTP Subset Advertisements</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Sequence number</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Identify the packet in the stream of packets that follow a summary advertisement</p>
</li>
<li>
<p>Starts with value 1</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_advertisement_request">Advertisement Request</h5>
<div class="paragraph">
<p>A switch needs a VTP advertisement request in these situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The switch has been reset.</p>
</li>
<li>
<p>The VTP domain name has been changed.</p>
</li>
<li>
<p>The switch has received a VTP summary advertisement with a higher configuration revision than its own.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upon receipt of an advertisement request, a VTP device sends a summary advertisement.
One or more subset advertisements follow the summary advertisement. This is an example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/vtp-request-advert-packet-format.png.png" alt="VTP Advertisement Request" width="896" height="216">
</div>
<div class="title">Figure 8. VTP Advertisement Request</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Start-Value</dt>
<dd>
<p>This is used in cases in which there are several subset advertisements.
If the first (n) subset advertisement has been received
and the subsequent one (n+1) has not been received,
the Catalyst only requests advertisements from the (n+1)th one.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_join_message">Join Message</h5>
<div class="ulist">
<ul>
<li>
<p>originated by each VTP Server and Client switch periodically every 6 seconds if VTP Pruning is active.</p>
</li>
<li>
<p>Join messages contain a bit field that, for each VLAN in the normal range, indicates whether it is active or unused (that is, pruned)</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In any VTP version, VTP messages are transmitted and accepted only on trunk ports.
Access ports neither send nor accept VTP messages.
For two switches to communicate in VTP, they must first be interconnected through a working trunk link.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vtp_domain">4.4.3. VTP Domain</h4>
<div class="ulist">
<ul>
<li>
<p>Controls which devices can exchange VTP advertisements</p>
</li>
<li>
<p>Defaults to NULL value</p>
</li>
<li>
<p>Switch inherits VTP domain name of first received advertisement over trunk links</p>
</li>
<li>
<p>A switch can only be part of one domain at a time</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the VTP Domain Name</div>
<div class="content">
<pre>(config)# vtp domain &lt;name&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_revision_number">4.4.4. Configuration Revision Number</h4>
<div class="ulist">
<ul>
<li>
<p>32-bit</p>
</li>
<li>
<p>Incremented by one for each configuration change</p>
</li>
<li>
<p>Higher revision indicates newer database</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a newly connected VTP server or client to change another switch’s VTP database, the following must be true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The new link connecting the new switch is trunking.</p>
</li>
<li>
<p>The new switch has the same VTP domain name as the other switches.</p>
</li>
<li>
<p>The new switch’s revision number is higher than that of the existing switches.</p>
</li>
<li>
<p>The new switch must have the same password, if configured on the existing switches.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_vtp_modes">4.4.5. VTP Modes</h4>
<div class="paragraph">
<p>You can configure a switch to operate in any one of these VTP modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Server</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Default mode</p>
</li>
<li>
<p>Allows addition, deletion and modification of VLAN information</p>
</li>
<li>
<p>Changes on server overwrite the rest of the domain</p>
</li>
<li>
<p>Configuration saved in NVRAM</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Switch As a VTP Server</div>
<div class="content">
<pre>(config)# vtp mode server</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Client</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Cannot add, remove or modify VLAN information</p>
</li>
<li>
<p>Listens for advertisements originated by server, install them and passes them on</p>
</li>
<li>
<p>Configuration saved in NVRAM only for VTPv3</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Switch As a VTP Client</div>
<div class="content">
<pre>(config)# vtp mode client</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Transparent</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Keeps a separate VTP database from the rest of the domain</p>
</li>
<li>
<p>Does not originate advertisements</p>
</li>
<li>
<p>"transparently" passes received advertisements through without installing them</p>
</li>
<li>
<p>Can still create, remove or renamed VLANs which are not advertised to neighboring switches.</p>
</li>
<li>
<p>Need for some applications like Private VLANs</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Setup VTP Transparent Mode</div>
<div class="content">
<pre>(config)# vtp mode transparent</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Off (configurable only in CatOS switches)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Like VTP transparent mode with the exception that VTP advertisements are not forwarded</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 5. VTP Modes and Features</caption>
<colgroup>
<col style="width: 70%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Server Mode</th>
<th class="tableblock halign-left valign-top">Client Mode</th>
<th class="tableblock halign-left valign-top">Transparent Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Originates VTP advertisements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes received advertisements to update its VLAN configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forwards received VTP advertisements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Saves VLAN configuration in NVRAM or vlan.dat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, modify, or delete VLANs using  configuration commands</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_vtp_security">4.4.6. VTP Security</h4>
<div class="ulist">
<ul>
<li>
<p>MD5 authentication prevents against certain attack</p>
<div class="ulist">
<ul>
<li>
<p>Does not prevent against misconfiguration</p>
</li>
<li>
<p>Password must be setup manually because switches only exchanges MD5 digest of the password.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure VTP Authentication</div>
<div class="content">
<pre>(config)# vtp password &lt;string&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Show the VTP Password</div>
<div class="content">
<pre>(config)# sh vtp password</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vtp_pruning">4.4.7. VTP Pruning</h4>
<div class="ulist">
<ul>
<li>
<p>Problem:</p>
<div class="ulist">
<ul>
<li>
<p>Broadcasts and unknown unicast/multicast frame are flooded everywhere in the broadcast domain
included through trunks links</p>
</li>
<li>
<p>Manual editing allowed list is a huge administrative overhead</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/flooding-traffic-without-vtp-pruning.png" alt="Flooding traffic without VTP pruning">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Solution: VTP pruning</p>
<div class="ulist">
<ul>
<li>
<p>Switches advertise what they need</p>
</li>
</ul>
</div>
</li>
<li>
<p>All other VLANs are pruned off the trunk link</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/flooding-traffic-with-vtp-pruning.png" alt="Optimized flooded traffic with VTP pruning">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Restriction:</p>
<div class="ulist">
<ul>
<li>
<p>Pruning does not work in transparent mode. Why?</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_pruning_eligibility">Pruning Eligibility</h5>
<div class="ulist">
<ul>
<li>
<p>When VTP pruning is enabled on a VTP server,
pruning is enabled for the entire management domain
except for pruning-ineligible VLANS ( Vlan 1, 1002-1005, 1006-4094)</p>
</li>
<li>
<p>Making VLANs pruning-eligible or pruning-ineligible affects pruning eligibility for those VLANs on that trunk only
(not on all switches in the VTP domain).</p>
</li>
<li>
<p>VTP pruning takes effect several seconds after you enable it.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting_2">4.4.8. Troubleshooting</h4>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/support/docs/lan-switching/vtp/98155-tshoot-vlan.html#topic9" class="bare">http://www.cisco.com/c/en/us/support/docs/lan-switching/vtp/98155-tshoot-vlan.html#topic9</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dtp">4.5. DTP</h3>
<div class="paragraph">
<p>Dynamic Trunk Protocol</p>
</div>
<div class="ulist">
<ul>
<li>
<p>negotiate trunk status</p>
</li>
<li>
<p>default to <strong>dynamic auto</strong></p>
</li>
<li>
<p>both sides must be on the same VTP domain or one must be in the NULL domain</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 6. Trunking Configuration Options That Lead to a Working Trunk</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Command</th>
<th class="tableblock halign-left valign-top">Short name</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">To trunk other side must be</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode trunk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trunk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always trunks on this end; sends DTP to help other side choose to trunk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On, desirable, auto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode trunk ; switchport nonegotiate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonegotiate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always trunks on this end; does not send DTP messages (good when other switch is a non-Cisco switch)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode dynamic desirable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desirable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sends DTP messages, and trunks if negotiation succeeds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On, desirable, auto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode dynamic auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replies to DTP messages, and trunks if negotiation succeeds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On, desirable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Never trunks; sends DTP to help other side reach same conclusion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Never trunks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode access; switchport nonegotiate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access (with nonegotiate)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Never trunks; does not send DTP messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Never trunks)</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Configure an Inter-Switch Link to Be In Dynamic Desirable State</div>
<div class="content">
<pre>(config-if)# switchport mode dynamic desirable</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable DTP for a Port Administratively Configured As a Trunk</div>
<div class="content">
<pre>(config-if)# switchport mode trunk
(config-if)# switchport nonegotiate</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Put the Interface Into Permanent Nontrunking Mode</div>
<div class="content">
<pre>(config-if)# switchport mode access</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display a Summary Of Trunk-Related Information</div>
<div class="content">
<pre>show interface trunk: Summary of trunk-related information</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: List Trunking Details for a Specified Interface</div>
<div class="content">
<pre>show interface &lt;type number&gt; trunk</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: List Nontrunking Details for a Particular Interface</div>
<div class="content">
<pre>show interface &lt;type number&gt; switchport</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display DTP Information for the Switch</div>
<div class="content">
<pre># show dtp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display DTP Information for a Specific Interface</div>
<div class="content">
<pre># show dtp interface &lt;type slot/number&gt;</pre>
</div>
</div>
<div class="sect3">
<h4 id="_trunking_between_a_switch_and_a_router">4.5.1. Trunking Between a Switch and a Router</h4>
<div class="paragraph">
<p>Because  DTP is not supported on Router</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on the router, create a sub-interface for each desired vlan</p>
</li>
<li>
<p>on the switch, disable DTP and manually configure the trunk</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable Trunking but Disable DTP for Routers</div>
<div class="content">
<pre>! SW1
conf t
int e0/0
  switchport trunk enc dot1q
  switchport mode trunk
  switchport nonegotiate

! R1
conf t
int e0/0.1
  enc dot1q &lt;vlan-id&gt; [native]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_verify">4.5.2. Verify</h4>
<div class="paragraph">
<p>What is TOS/TAT in</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sh dtp interface fa 0/19</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_isl">4.6. ISL</h3>
<div class="ulist">
<ul>
<li>
<p>Inter-Switch Link</p>
</li>
<li>
<p>Cisco proprietary</p>
</li>
<li>
<p>Provides VLAN trunking</p>
</li>
<li>
<p>Supports normal and extended VLANs</p>
</li>
<li>
<p>Encapsulates the original header with 26-byte header</p>
</li>
<li>
<p>Removes the header at the receiving end</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_frame">4.6.1. Frame</h4>
<div class="paragraph">
<p>The ISL frame consists of three fields:
the ISL header( 26 bytes), the original frame and the FCS (4 bytes)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/isl-frame.png" alt="isl frame" height="100">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DA—Destination Address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>40-bit</p>
</li>
<li>
<p>Multicast address: "0100-0C00-00" or "0300-0C00-00".</p>
</li>
<li>
<p>The first 40 bits of the DA field signal the receiver that the packet is in ISL format. ???</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">TYPE—Frame Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>4 bits</p>
</li>
<li>
<p>Indicates the type of the original frame</p>
<div class="ulist">
<ul>
<li>
<p>0000: 	Ethernet</p>
</li>
<li>
<p>0001: 	Token Ring</p>
</li>
<li>
<p>0010: 	FDDI</p>
</li>
<li>
<p>0011: 	ATM</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">USER—User Defined Bits (TYPE Extension)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>4 bits</p>
</li>
<li>
<p>Extends the meaning of the TYPE field</p>
</li>
<li>
<p>Default value: "0000"</p>
</li>
<li>
<p>For Ethernet frames, the USER field bits "0" and "1" indicate the priority of the packet as
it passes through the switch. Whenever traffic can be handled in a manner that
allows it to be forwarded more quickly, the packets with this bit set should
take advantage of the quick path. It is not required that such paths be
provided.</p>
<div class="ulist">
<ul>
<li>
<p>XX00 	Normal Priority</p>
</li>
<li>
<p>XX01 	Priority 1</p>
</li>
<li>
<p>XX10 	Priority 2</p>
</li>
<li>
<p>XX11 	Highest Priority</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SA—Source Address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>48 bits set to set MAC address of the switch port that transmits the frame.</p>
</li>
<li>
<p>May be ignored by the receiving device</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">LEN—Length</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits set to the length of the packet in bytes
with the exclusion of the DA, TYPE, USER, SA, LEN, and FCS fields.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">AAAA03 (SNAP)—Subnetwork Access Protocol (SNAP) and Logical Link Control (LLC)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>24 bits set to "0xAAAA03".</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HSA—High Bits of Source Address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>24 bits set to 0x00-00-0C (Cisco OUI) of the SA field.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">VLAN—Destination Virtual LAN ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>15 bits set to the VLAN ID of the frame</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">BPDU—BPDU and CDP Indicator</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>1 bit set when STP or CDP encapsulates an ISL packet</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">INDX—Index</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits set to the port index of the source of the packet as it exits the switch</p>
</li>
<li>
<p>Used for diagnostic purposes only</p>
</li>
<li>
<p>May be ignored by the receiving bridge</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">RES—Reserved for Token Ring and FDDI</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits used when Token Ring or FDDI packets are encapsulated with an ISL frame</p>
<div class="ulist">
<ul>
<li>
<p>In the case of Token Ring frames, the Access Control (AC) and Frame Control (FC) fields are placed here.</p>
</li>
<li>
<p>In the case of FDDI, the FC field is placed in the Least Significant Byte (LSB) of this field.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For Ethernet packets, the RES field should be set to all zeros.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">ENCAP FRAME—Encapsulated Frame</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Encapsulated data packet with its own CRC value completely unmodified</p>
</li>
<li>
<p>Length from 1 to 24575 bytes</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">FCS—Frame Check Sequence</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>4 bytes set by the sending MAC and recalculated by the receiving bridge</p>
</li>
<li>
<p>New FCS calculated over the entire ISL packet</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ieee_802_1q">4.7. IEEE 802.1Q</h3>
<div class="ulist">
<ul>
<li>
<p>Tags frames on a trunk</p>
<div class="ulist">
<ul>
<li>
<p>Inserts a 4-byte tag into the original frame between the Source Address and the Type/Length field</p>
</li>
<li>
<p>Recomputes the frame check sequence (FCS) before the device sends the frame over the trunk link.</p>
</li>
<li>
<p>Removes the tag at the receiving end</p>
</li>
</ul>
</div>
</li>
<li>
<p>Does not tag frames on the native VLAN.</p>
<div class="ulist">
<ul>
<li>
<p>Must use the same native VLAN on both sides of the trunk</p>
</li>
<li>
<p>Default to VLAN 1</p>
</li>
<li>
<p>enables frames to transit switches not yet capable for 802.1g</p>
</li>
</ul>
</div>
</li>
<li>
<p>Supports up to 4096 VLANs</p>
<div class="ulist">
<ul>
<li>
<p>Defines a single instance of spanning tree that runs on the native VLAN for all the VLANs in the network.</p>
</li>
<li>
<p>lacks the flexibility and load balancing capability of PVST that is available with ISL.</p>
</li>
<li>
<p>PVST+ offers the capability to retain multiple spanning tree topologies with 802.1Q trunking.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_frame_format">4.7.1. Frame Format</h4>
<div class="imageblock">
<div class="content">
<img src="../images/802-1q-frame.png" alt="802.1Q frame">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TPID-Tag Protocol Identifier</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits</p>
</li>
<li>
<p>Value: 08100</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Priority</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>3 bits</p>
</li>
<li>
<p>Called also user priority or IEEE 802.p</p>
</li>
<li>
<p>Indicates the frame priority level</p>
</li>
<li>
<p>Can be used to prioritize the traffic</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">CFI-Canonical Format Indicator</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>1 bit</p>
</li>
<li>
<p>Value: 0 if MAC address is in canonical format otherwise 1</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">VID-VLAN Identifier</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>12 bits</p>
</li>
<li>
<p>Identifies the VLAN to which the frame belongs</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_ethernet_frame_size_with_802_1q_tagging">4.7.2. Ethernet Frame Size with 802.1Q Tagging</h4>
<div class="ulist">
<ul>
<li>
<p>Maximum size: 1522 bytes</p>
</li>
<li>
<p>Minimum size: 68 bytes</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_native_vlan">4.7.3. Native VLAN</h4>
<div class="listingblock">
<div class="title">Task:  Configure a Native VLAN Over a Trunk Link</div>
<div class="content">
<pre>(config-if)# switchport trunk native vlan &lt;id&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>TODO How can you force the tagging of the native vlan?</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_802_1q_in_q_tunneling">4.8. 802.1Q-In-Q Tunneling</h3>
<div class="ulist">
<ul>
<li>
<p>Adds a metro tag or PE-VLAN to the 802.1q tagged packets</p>
</li>
<li>
<p>Expands the VLAN space by double-tagging frames</p>
</li>
<li>
<p>Allows Service Providers</p>
<div class="ulist">
<ul>
<li>
<p>to preserve 802.1Q VLAN tags accross WAN links.</p>
</li>
<li>
<p>to provide services such as Internet access on specific VLANs for specific customers,
yet providing other services on other VLANs</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/q-in-q-basic-operations.png" alt="q in q basic operations" height="150">
</div>
<div class="title">Figure 9. Q-In-Q: Basic Operation</div>
</div>
<div class="sect3">
<h4 id="_frame_2">4.8.1. Frame</h4>
<div class="imageblock">
<div class="content">
<img src="../images/q-in-q-frame.png" alt="802.1Q-in-Q frame">
</div>
</div>
<div class="sect4">
<h5 id="_frame_size">Frame Size</h5>
<div class="ulist">
<ul>
<li>
<p>Recommended minimum MTU: 1504 bytes</p>
<div class="ulist">
<ul>
<li>
<p>default MTU: 1500 bytes</p>
</li>
<li>
<p>outer VLAN tag: 4 bytes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_tpid">TPID</h5>
<div class="ulist">
<ul>
<li>
<p>Contains the modified tag protocol identifier</p>
</li>
<li>
<p>Set to 0x8100 for IEEE 802.1q</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The QinQ frame contains the modified tag protocol identifier (TPID) value of
VLAN Tags. By default, the VLAN tag uses the TPID field to identify the
protocol type of the tag. The value of this field, as defined in IEEE 802.1Q,
is 0x8100.</p>
</div>
<div class="paragraph">
<p>The device determines whether a received frame carries a service provider VLAN
tag or a customer VLAN tag by checking the corresponding TPID value. After
receiving a frame, the device compares the compares the configured TPID value
with the value of the TPID field in the frame. If the two match, the frame
carries the corresponding VLAN tag. For example, if a frame carries VLAN tags
with the TPID values of 0x9100 and 0x8100, respectively, while the configured
TPID value of the service provider VLAN tag is 0x9100 and that of the VLAN tag
for a customer network is 0x8200, the device considers that the frame carries
only the service provider VLAN tag but not the customer VLAN tag.</p>
</div>
<div class="paragraph">
<p>In addition, the systems of different vendors might set the TPID of the outer
VLAN tag of QinQ frames to different values. For compatibility with these
systems, you can modify the TPID value so that the QinQ frames, when sent to
the public network, carry the TPID value identical to the value of a particular
vendor to allow interoperability with the devices of that vendor. The TPID in
an Ethernet frame has the same position with the protocol type field in a frame
without a VLAN tag. In order to avoid problems in packet forwarding and
handling in the network, you cannot set the TPID value to any of the values in
this table:</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Protocol type</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0806</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RARP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8035</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0800</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPv6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x86DD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PPPoE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8863/0x8864</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MPLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8847/0x8848</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IS-IS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LACP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8809</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x888E</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The QinQ Support feature is generally supported on whatever Cisco IOS features
or protocols are supported. For example, if you can run PPPoE on the
subinterface, you can configure a double-tagged frame for PPPoE. IPoQinQ
supports IP packets that are double-tagged for QinQ VLAN tag termination by
forwarding IP traffic with the double-tagged (also known as stacked) 802.1Q
headers.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spanning_tree_protocols">5. Spanning Tree Protocols</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="menuseq"><span class="menu">3750x Configuration Guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swstp.html">STP</span></span></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates loop-free layer 2 topology</p>
</li>
<li>
<p>Prevents broadcast storms</p>
</li>
<li>
<p>STP variations:</p>
<div class="ulist">
<ul>
<li>
<p>802.1d     : Common Spanning Tree</p>
</li>
<li>
<p>PVST/PVST+ : Cisco per-VLAN Spanning Tree</p>
</li>
<li>
<p>802.1w     : Rapid Spanning Tree Protocol</p>
</li>
<li>
<p>802.1s     : Multiple STP</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_802_1d_common_spanning_tree">5.1. 802.1d Common Spanning Tree</h3>
<div class="ulist">
<ul>
<li>
<p>1 instance</p>
</li>
<li>
<p>Uses BPDU</p>
</li>
<li>
<p>Elect one root switch and one designated switch for each segment</p>
</li>
<li>
<p>One root port per non-root switch, one designated port for each segment</p>
</li>
<li>
<p>Other ports on blocking state</p>
</li>
<li>
<p>Steps</p>
<div class="ulist">
<ul>
<li>
<p>Elect the root switch with the lowest bridge id ( 2-byte priority + 6-byte MAC)</p>
</li>
<li>
<p>Determine each switch&#8217;s root port: with the least cost path to the root</p>
</li>
<li>
<p>Determine the designated port for each segment:
the switch that forwards the least cost Hello on the segment</p>
</li>
<li>
<p>If there is a tie, select the lowest port ID</p>
</li>
</ul>
</div>
</li>
<li>
<p>Original IEEE 802.1d bridge Id</p>
<div class="ulist">
<ul>
<li>
<p>2-byte priority</p>
</li>
<li>
<p>6-byte MAC adress</p>
</li>
</ul>
</div>
</li>
<li>
<p>Revised IEEE 802.1d brigde id Priority for MAC address reduction</p>
<div class="ulist">
<ul>
<li>
<p>4 bits : priority multiple of 4096</p>
</li>
<li>
<p>12 bits : system id extension (vlan id ) to support pvst+ and IEEE 802.1s</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/stp-bridge-id.png" alt="Bridge ID">
</div>
</div>
<div class="sect3">
<h4 id="_bpdu">5.1.1. BPDU</h4>
<div class="imageblock">
<div class="content">
<img src="../images/configuration-bpdu.png" alt="Configuration BPDU" width="1630" height="71">
</div>
<div class="title">Figure 10. Configuration BPDU</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The Flags field uses 2 bits out of 8 to handle topology change
events: the Topology Change Acknowledgment flag and the Topology Change flag.</p>
</li>
<li>
<p>The MessageAge field is an estimation of the BPDU’s age since it was
originated by the root bridge. At the root bridge, it is set to 0. Any other
switch will increment this value, usually by 1, before forwarding the BPDU
further. The remaining lifetime of a BPDU after being received by a switch is
MaxAge-MessageAge. Finally, the remaining fields carry the values of STP
timers: MaxAge, HelloTime, ForwardDelay. These timer values always reflect the
timer settings on the root switch. Timers configured on a nonroot switch are
not used and would become effective only if the switch itself became the root switch.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/tcn-bpdu.png" alt="Topology Change Notification BPDU" width="545" height="71">
</div>
<div class="title">Figure 11. Topology Change Notification BPDU</div>
</div>
<div class="paragraph">
<p>TODO: Find a better position</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VLAN1 STP BPDU are sent untagged</p>
<div class="ulist">
<ul>
<li>
<p>to IEEE STP MAC 0180.c200.0000</p>
</li>
<li>
<p>to PVST+</p>
</li>
</ul>
</div>
</li>
<li>
<p>Non-VLAN1 STP BPDU are sent to PVST+ MAC 0100.0CCC.CCCD</p>
</li>
<li>
<p>To determine which  BPDU out of a pair of configuration BPDUs is superior,
compare the following sequence of values,
looking for the first occurrence of a lower value:
 Root Bridge ID,
 Root Path Cost,
 Sender Bridge ID,
 Sender Port ID,
 Receiver Port ID (not included in BPDU; evaluated locally)</p>
</li>
<li>
<p>Each port in STP stores/remembers the superior BPDU it has either sent (DP port) or received (RP and Blocking Ports).
Essentially, each port stores the DP’s BPDU—whether it is the port itself that is Designated or it is a neighbor’s port.
Should a port stores a received BPDU, it must be received again within a time interval of MaxAge-MessageAge seconds;
otherwise it will expire after this period.
This expiry is always driven by the root switch&#8217;s timers in the BPDU.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_root_bridge">5.1.2. Root Bridge</h4>
<div class="ulist">
<ul>
<li>
<p>Election with hello BPDU</p>
<div class="ulist">
<ul>
<li>
<p>Each switch begins its STP logic by creating and sending an Hello BPDU message,
claiming itself to be the root switch.</p>
</li>
<li>
<p>If a switch hears a superior Hello to its own Hello bridge ID,
it stops claiming to be root by ceasing to originate and send Hellos.
Instead, the switch starts forwarding the superior Hellos received from the superior candidate.</p>
</li>
<li>
<p>Eventually, all switches except the switch with the lowest bridge ID cease to originate Hellos;
that one switch wins the election and becomes the root switch.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Force Election Of a Root Bridge</div>
<div class="content">
<pre># spanning-tree vlan &lt;id&gt; root [primary|secondary]</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Going towards root uses priority,
Going away from root uses cost.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_root_port">5.1.3. Root Port</h4>
<div class="ulist">
<ul>
<li>
<p>RP is upstream facing towards Root bridge</p>
</li>
<li>
<p>Lowest root path cost ( cumulative cost of all links to get to the root)</p>
<div class="ulist">
<ul>
<li>
<p>cost = advertised cost in the BPDU hello + cost on the receiving post</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cost based on inverse bandwith</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 7. Default Port Costs</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Speed</th>
<th class="tableblock halign-left valign-top">original</th>
<th class="tableblock halign-left valign-top">revised</th>
<th class="tableblock halign-left valign-top">802.1D-2004</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Mbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 Mbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Gbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Gbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Choose Default STP Path Cost (Original or Revised)</div>
<div class="content">
<pre>(config)# spanning-tree pathcost method {short | long}</pre>
</div>
</div>
<div class="paragraph">
<p>Tie breaker when a switch receives multiple Hellos with equal cost</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Lowest Bridge Id</p>
</li>
<li>
<p>Lowest Port Priority</p>
</li>
<li>
<p>Lowest Port Number</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_designated_port">5.1.4. Designated Port</h4>
<div class="ulist">
<ul>
<li>
<p>Designated switch: send the Hello with the lowest advertised cost for the segment</p>
</li>
<li>
<p>DP: port that forward frames onto that segment</p>
</li>
<li>
<p>DP are downstream facing away from root bridge</p>
</li>
<li>
<p>Elected based on lowest root path cost, BID, port ID</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_blocking_ports">5.1.5. Blocking Ports</h4>
<div class="ulist">
<ul>
<li>
<p>Receive BPDUs</p>
</li>
<li>
<p>Discard all other traffic</p>
</li>
<li>
<p>Cannot send traffic</p>
</li>
<li>
<p>Do not send Hellos</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_convergence">5.1.6. Convergence</h4>
<div class="ulist">
<ul>
<li>
<p>Steady operations: one Root bridge, one RP on each non-root bridge, one DP on each segment, blocking state</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Root Switch Generates a Hello Every 2 Seconds</p>
</li>
<li>
<p>Each RP on Non-Root Switch Receives a Copy Of the Root&#8217;S Hello</p>
</li>
<li>
<p>Each DP Updates and Forwards the Hello Out</p>
</li>
<li>
<p>Each Blocking Port Receives a Copy Of the Hello from the DP Without Forwarding It</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_topology_change_notification">5.1.7. Topology Change Notification</h4>
<div class="ulist">
<ul>
<li>
<p>Topology change: event that occurs when</p>
<div class="ulist">
<ul>
<li>
<p>A TCN BPDU is received by a DP of a switch</p>
</li>
<li>
<p>A port moves to the Forwarding state and the switch has at least one DP
(meaning that it is not a standalone switch with just a Root Port connected to an upstream switch and no other connected ports)</p>
</li>
<li>
<p>A port moves from Learning or Forwarding to Blocking</p>
</li>
<li>
<p>A switch becomes the root switch</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>more at
<a href="http://www.CISCO.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/24062-146.html#topchng">understand new topology changes</a></p>
</div>
<div class="paragraph">
<p>TODO Split this section for 802.1d and 802.1w</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A switch experiencing the STP port state change sends a TCN BPDU out its root port;
it repeats this message every Hello time until it is acknowledged.</p>
</li>
<li>
<p>The next switch receiving that TCN BPDU sends back an acknowledgment via its next
forwarded Hello BPDU by marking the Topology Change Acknowledgment (TCA) bit in the Hello.</p>
</li>
<li>
<p>The switch that was the DP on the segment in the first two steps repeats the first two steps,
sending a TCN BPDU out its Root Port, and awaiting acknowledgment from the DP on that
segment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By each successive switch repeating Steps 1 and 2, eventually the root receives a TCN BPDU.
Once received, the root sets the TC flag on the next MaxAge + ForwardDelay seconds, which are forwarded to all
switches in the network, notifying them that a change has occurred. A switch receiving a Hello
BPDU with the TC flag set uses the short (Forward Delay time) timer to time out entries in the CAM.</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 8. Transitioning from Blocking to Forwarding</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Forward data frames</th>
<th class="tableblock halign-left valign-top">Learn source MAC</th>
<th class="tableblock halign-left valign-top">Stable?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blocking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listening</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Learning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forwarding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_timers_2">5.1.8. Timers</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Hello timer</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>2 seconds</p>
</li>
<li>
<p>Interval at which the root sends Hellos</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Forward delay</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>15 seconds</p>
</li>
<li>
<p>Time that switch leaves a port in listening state and learning state</p>
</li>
<li>
<p>also used for the short CAM timeout timer</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Maxage</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>20 seconds</p>
</li>
<li>
<p>Time without hearing a Hello before believing that the root has failed</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>TODO Add tasks to modify default timers
.Task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)#</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pvst_per_vlan_stp">5.2. PVST+ Per-Vlan STP</h3>
<div class="ulist">
<ul>
<li>
<p>Per-VLAN STP : for better load balancing</p>
<div class="ulist">
<ul>
<li>
<p>One instance of legacy STP per VLAN</p>
</li>
<li>
<p>CISCO ISL support</p>
</li>
</ul>
</div>
</li>
<li>
<p>PVST+</p>
<div class="ulist">
<ul>
<li>
<p>One instance of legacy STP per VLAN</p>
</li>
<li>
<p>CISCO ISL and 802.1q support</p>
</li>
<li>
<p>Interoperability between CST and PVST</p>
</li>
</ul>
</div>
</li>
<li>
<p>default mode on most Catalyst platforms</p>
</li>
<li>
<p>allows root bridge/port placement per VLAN</p>
</li>
<li>
<p>Non-CISCO + 802.1q &#8658; one Common Spanning Tree over vlan  1</p>
</li>
<li>
<p>When mixing CISCO and non CISCO switches with 802.1q trunking,</p>
<div class="ulist">
<ul>
<li>
<p>Send BPDU to multicast destination MAC of 0100.0CCC.CCCD</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO add picture here pp. 78</p>
</div>
<div class="listingblock">
<div class="title">Task: Display Spanning-Tree Information</div>
<div class="content">
<pre># sh spanning-tree root
# sh spanning-tree vlan 1 root detail</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_optimizing_improving_spanning_tree">5.3. Optimizing, Improving Spanning Tree</h3>
<div class="sect3">
<h4 id="_portfast">5.3.1. PortFast</h4>
<div class="ulist">
<ul>
<li>
<p>Used on access ports connected to end users devices not other switches</p>
</li>
<li>
<p>Puts the port into forwarding state immediately</p>
</li>
<li>
<p>Prevent them to generate TCNs</p>
</li>
<li>
<p>Can generate loops if another switch is connected. so must be used with BPDU guard and root guard features</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable Portfast on a given interface</div>
<div class="content">
<pre>(config-if)# spanning-tree portfast</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable Portfast globally</div>
<div class="content">
<pre>(config)# spanning-tree portfast default</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The port must be an access port</p>
</li>
<li>
<p>If the port is configured as trunk,</p>
<div class="ulist">
<ul>
<li>
<p>the global portfast command will not convert the port to an edge port.</p>
</li>
<li>
<p>use <strong>spanning-tree portfast trunk</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>If BPDUs are received on the port, the port may transition to blocking</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_uplinkfast">5.3.2. UplinkFast</h4>
<div class="ulist">
<ul>
<li>
<p>Used on access layer switches that have multiple uplinks to distribution/core switches</p>
</li>
<li>
<p>Immediately replaces a lost RP with an alternate RP</p>
</li>
<li>
<p>Increases the root and all port priority so the switch does not become root or transit switch</p>
</li>
<li>
<p>Time-out the correct entries in their CAMs but doesnt use the TCN process. Instead, finds all the MAC
addresses of local devices and sends one multicast frame with each local addresses as the source MAC
causing all the other switches to update their CAMs. The access switch also clears out the rest of the
entries in its own CAM.</p>
</li>
<li>
<p>Used only if the switch runs lgacy STP because it is built in to RSTP802.1w</p>
</li>
<li>
<p>cannot be enabled on a switch that has its default STP priority modified</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable Uplink Fast</div>
<div class="content">
<pre>(config)#  spanning-tree uplinkfast [max-update-rate rate]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Use default STP priority for all VLANs</div>
<div class="content">
<pre>(config)# default spanning-tree vlan 1-4094 priority</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_backbonefast">5.3.3. BackboneFast</h4>
<div class="ulist">
<ul>
<li>
<p>Used in core switches to detect indirect link failures to the Root</p>
<div class="ulist">
<ul>
<li>
<p>All switches must have backbone fast configured</p>
</li>
<li>
<p>Cisco proprietary for legacy 802.1d STP (now included in RSTP and MSTP)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Do not wait for Maxage to expire when another switch&#8217;s direct link fails</p>
</li>
<li>
<p>Send a Root Link Query out the port in which the missing Hello should arrive.</p>
<div class="ulist">
<ul>
<li>
<p>The RLQ asks the neighboring switch if that neighboring switch is still receiving Hellos from the root.</p>
</li>
<li>
<p>If that neighbor had a direct link failure, it can tell the original switch via another RLQ that this path to the root is lost.</p>
</li>
<li>
<p>Once known, the switch experiencing the indirect link failure can go ahead and converge without waiting for MaxAge to expire</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)#  spanning-tree backbonefast</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Backbone Fast works in two stages. In the first stage, when a switch receives inferior BPDUs through a nondesignated port (NDP), it knows the switch that sent the inferior BPDUs has lost its connection to the root bridge. When the local switch receives the inferior BPDUs, it verifies if the source that generated these messages is from a local segment. If the source is from a local segment, it knows that an indirectly connected link failure has occurred. If the source of the inferior BPDUs is from a switch that is not on a local segment, the local switch will ignore them.
In the second stage, the local switch goes through a verification process. The switch uses a request and response protocol. This process queries other switches to determine if the connection to the root bridge is lost.
The verification process is done by the local switch that received the inferior BPDUs. The switch generates Root Link Query (RLQ) requests. These messages are sent out of the root port(s).
These messages are sent to query the upstream switch(es) if their connection to the root bridge is up. The receiving switch sends RLQ responses to reply to the[…]”
Therefore, it expires the max-age timer in order to speed up the convergence.”</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bpdu_guard">5.3.4. BPDU Guard</h4>
<div class="ulist">
<ul>
<li>
<p>Ensures that unauthorized switches cannot be plugged in to the network</p>
</li>
<li>
<p>Puts a portfast enabled port into the errdisable state when a BPDU is received and shuts down the port</p>
</li>
<li>
<p>The port must be manually re-enabled or it can be recovered automatically through the errdiable timeout function.</p>
</li>
<li>
<p>A port configured with bpdu guard will not be put into the root-inconsistent state.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: disable an interface if a BPDU is detected</div>
<div class="content">
<pre>(config-if)# spanning-tree bpduguard enable</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Re-enable the interface with BPDU Guard after n seconds</div>
<div class="content">
<pre>(config)# errdisable recovery cause bpduguard
(config)# errdisable recovery interval &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the status and reason for a err-disabled interfaces</div>
<div class="content">
<pre># sh interfaces &lt;interface type id&gt; status err-disabled</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bpdu_filter">5.3.5. BPDU Filter</h4>
<div class="ulist">
<ul>
<li>
<p>Filter BPDUs out for all portfast interfaces</p>
</li>
<li>
<p>when configured At interface level</p>
<div class="ulist">
<ul>
<li>
<p>silently drops all received inbound BPDUs</p>
</li>
<li>
<p>doesn&#8217;t send any outbound BPDUs</p>
</li>
<li>
<p>the port never goes into err-disabled state</p>
</li>
<li>
<p>may cause permanent loops if a switch is connected</p>
</li>
</ul>
</div>
</li>
<li>
<p>when configured At switch level</p>
<div class="ulist">
<ul>
<li>
<p>only affected PortFast-enabled ports</p>
</li>
<li>
<p>transmits 10 BPDUS at startup</p>
</li>
<li>
<p>disables portfast and portfast bpdu filtering if BPDU receives during that time</p>
</li>
<li>
<p>after startup, f BPDU are received, disables portfast and bpdufilter and acts as other STP port</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When PortFast is enabled on a port, the port will still send
out BPDUs and it will accept and process received BPDUs. The BPDU
Guard feature would prevent the port from receiving any BPDUs, but it
will not prevent it from sending them. The BPDU Filter feature
effectively disables STP on the selected ports by preventing them
from sending or receiving any BPDUs.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Enable BPDU filter at the interface level</div>
<div class="content">
<pre>(config-if)# spanning-tree bpdufilter enable</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable BPDU filter on all portfast-enabled ports</div>
<div class="content">
<pre>(config)# spanning-tree portfast bpdufilter default</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loop_guard">5.3.6. Loop Guard</h4>
<div class="ulist">
<ul>
<li>
<p>protects against unidirectional links</p>
</li>
<li>
<p>Prevents non-designated ports from inadvertently forming layer 2 switching loops if the flow of BPDUs is interrupted.</p>
</li>
<li>
<p>Puts the port into the <strong>loop-inconsistent</strong> state when the steady flow of BPDUs is interrupted</p>
</li>
<li>
<p>Only used on point-to-point links</p>
</li>
<li>
<p>Can be used with <strong>UDLD aggressive mode</strong> to get extra protection.</p>
</li>
<li>
<p>Cannot be enabled at the time with root guard on the same port</p>
</li>
<li>
<p>When configured at the switch level, only monitors Non-Designated ports</p>
</li>
<li>
<p>takes actions on a per-VLAN level (although configured on a port)</p>
<div class="ulist">
<ul>
<li>
<p>if a trunk port is in blocking state and stops receiving BPDUs for VLAN 8 from the DP on the segment,
it transitions the port into *loop inconsistent only for that VLAN 8</p>
</li>
</ul>
</div>
</li>
<li>
<p>recovers automatically when the port starts receiving BPDUs</p>
<div class="literalblock">
<div class="content">
<pre>STP Loop Guard is an added logic related to receiving BPDUs on Root and Alternate
Ports on point-to-point links. In the case of a unidirectional link, these ports could move
from Root or Alternate to Designated, thereby creating a switching loop. STP Loop
Guard assumes that after BPDUs were being received on Root and Alternate Ports, it is
not possible in a correctly working network for these ports to suddenly stop receiving
BPDUs without them actually going down. A sudden loss of incoming BPDUs on Root
and Alternate Ports therefore suggests that a unidirectional link condition might have
occurred.
Following this logic, STP Loop Guard prevents Root and Alternate Ports from becoming
Designated as a result of total loss of incoming BPDUs. If BPDUs cease being received on
these ports and their stored BPDUs expire, Loop Guard will put them into a loopinconsistent
blocking state. They will be brought out of this state automatically after
they start receiving BPDUs again.
Loop Guard can be activated either globally or on a per-port basis, and is a local protection
mechanism (that is, it does not require other switches to be also configured with
Loop Guard to work properly). If activated globally using the spanning-tree loopguard
default command, it automatically protects all Root and Alternate Ports on STP point-topoint
link types on the switch. Global Loop Guard does not protect ports on shared type
links. It can also be configured on a per-port basis using the spanning-tree guard loop
command, in which case it applies even to ports on shared links</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>“With the Loop Guard feature enabled, switches do an additional check before transitioning to the STP forwarding state. If switches stop receiving BPDUs on a nondesignated port with the Loop Guard feature enabled, the switch places the port into loop-inconsistent blocking state instead of moving through the listening, learning, and forwarding states. If a switch receives a BPDU on a port in the loop-inconsistent STP state, the port will transition through STP states in accordance with the received BPDU. As a result, recovery is automatic, and no manual intervention is necessary.
When implementing Loop Guard, you should be aware of the following implementation guidelines:
 Loop Guard cannot be enabled simultaneously with Root Guard on the same device.
 Loop Guard does not affect UplinkFast or Backbone Fast operation.
 Loop Guard must be enabled on point-to-point links only.
 Loop Guard operation is not affected by the spanning tree timers.
 Loop Guard cannot actually detect a unidirectional link.
 Loop Guard cannot be enabled on PortFast or dynamic VLAN ports.
“state). However, in a case where we are dealing with an aggregated link between two devices, all of the links in the aggregate will transition into the inconsistent state for the particular VLAN that is no longer receiving BPDUs.”</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You configure the Loop Guard feature on a per-port basis, even though the feature is designed to block inconsistent ports on a per-VLAN basis. In other words[…]”</p>
</div>
<div class="paragraph">
<p>Excerpt From: Narbik Kocharians. “CCIE Routing and Switching v5.1 Foundations: Bridging the Gap Between CCNP and CCIE (Christian Christian Kyony&#8217;s Library).” iBooks.</p>
</div>
</div>
<div class="sect3">
<h4 id="_root_guard">5.3.7. Root Guard</h4>
<div class="ulist">
<ul>
<li>
<p>Prevent a port from becoming a root port when receiving a superior BPDU (e.g. inferior priority + mac)</p>
</li>
<li>
<p>It is enabled on ports other than the root port and on switches other than the root</p>
</li>
<li>
<p>Puts the port in <strong>root-inconsistent</strong> state (no data flow) until it stops receiving superior BPDUs.
No traffic is forwarded.</p>
</li>
<li>
<p>Enforce the root bridge placement by ensuring the port on which root guard is enabled is the designated port.</p>
</li>
<li>
<p>Ensures that the port on which root guard is enabled is the designated port.</p>
</li>
<li>
<p>differences with BBPU guard</p>
<div class="ulist">
<ul>
<li>
<p>root-inconsistent state vs err-disabled</p>
</li>
<li>
<p>automatic recovery vs manual recovery</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This message appears after root guard blocks a port:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%SPANTREE-2-ROOTGUARDBLOCK: Port 1/1 tried to become non-designated in VLAN 77.
Moved to root-inconsistent state</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Read more at <a href="http://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/10588-74.html">Root Guard</a>
<a href="https://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/10588-74.html">PortFast BPDU Guard</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_802_1w_rapid_stp">5.4. 802.1w Rapid STP</h3>
<div class="ulist">
<ul>
<li>
<p>Improves convergence by</p>
<div class="ulist">
<ul>
<li>
<p>Waiting for only 3 missed Hellos on an RP before flushing the CAM instead of 10 (10x 2 seconds =MaxAge ) with 802.1d</p>
</li>
<li>
<p>Bypass listening state</p>
</li>
<li>
<p>Includes natively CISCO PortFast, UplinkFast, BackboneFast</p>
</li>
<li>
<p>Add backup DP when multiple ports connected to the same segment</p>
</li>
<li>
<p>Doesn&#8217;t use MessageAge</p>
</li>
<li>
<p>immediate acceptance of inferior BPDUs from DP</p>
<div class="ulist">
<ul>
<li>
<p>an inferior BPDU originated by a designated switch on a segment is
accepted right away, immediately replacing previously stored BPDUs on receiving ports
of attached switches. In other words, if a designated switch on a segment suddenly sends
an inferior BPDU, other switches on the segment will immediately accept it as if the
superior stored BPDU expired just when the inferior BPDU arrived, and reevaluate their
own port roles and states on the segment according to usual rules. This behavior allows a
switch to rapidly react to a situation where the neighboring switch experiences a disruptive
change in its own connectivity toward the root switch</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Backward compatible with 802.1d</p>
</li>
<li>
<p>All bridges generate BPDUs every Hello interval</p>
</li>
<li>
<p>Use a single BPDU,  No TCN BPDU</p>
</li>
<li>
<p>Protocol Version = 0x02</p>
</li>
<li>
<p>The Flags field has been updated.</p>
<div class="ulist">
<ul>
<li>
<p>In 802.1D STP BPDUs, only 2 bits out of 8 are used: TC (Topology Change) and TCA (Topology Change Acknowledgment)</p>
</li>
<li>
<p>RSTP uses the 6 remaining bits as well to encode additional information:
Proposal bit, Port Role bits, Learning bit, Forwarding bit, and Agreement bit.</p>
</li>
<li>
<p>The TCA bit is not used by RSTP.
This change allows implementing the <strong>Proposal/Agreement</strong> mechanism
and also allows a BPDU to carry information about the originating port’s role and state,
forming the basis of RSTP’s <strong>Dispute</strong> mechanism,
protecting against issues caused by unidirectional links.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_rstp_link_types">5.4.1. RSTP Link Types</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Point-to-point</strong>: Switch to Switch (default if full-duplex port )</p>
</li>
<li>
<p><strong>Shared</strong> : Switch to hub (default if half-duplex port)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the RSTP Link-Type</div>
<div class="content">
<pre>spanning-tree link-type { point-to-point | shared }</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rstp_port_types">5.4.2. RSTP Port Types</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Edge</strong> :</p>
</li>
<li>
<p><strong>Non-Edge</strong>: default</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_rstp_port_states">5.4.3. RSTP Port States</h4>
<div class="ulist">
<ul>
<li>
<p>Default to discarding at start</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO Improve the table below with spanning (enabled, discarding) over the row</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Administrative state</th>
<th class="tableblock halign-left valign-top">802.1d</th>
<th class="tableblock halign-left valign-top">802.1w</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blocking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listening</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Learning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Learning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forwarding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forwarding</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_rstp_port_roles">5.4.4. RSTP Port Roles</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Root Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Same role as 802.1d RP</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Designated Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Same role as 802.1d DP</p>
</li>
<li>
<p>Default role at boot</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Alternate Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An alternate root port</p>
</li>
<li>
<p>Same concept as CISCO UplinkFast feature</p>
</li>
<li>
<p>Protects against the loss of a switch&#8217;s RP by keeping track of the AP with a path to the root</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Backup Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>No equivalent CISCO feature</p>
</li>
<li>
<p>Protects against losing the DP attached to a shared link
when the switch has another physical port attached to the same shared segment</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
root bridge ports are all designated ports
unless 2 or more ports of the root bridge are connected together.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
a port needs to receive BPDUs to stay blocked.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Configure Rapid PVST</div>
<div class="content">
<pre>(config)#  spanning-tree mode rapid-pvst</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Rapid PVST+ immediately deletes dynamically learned MAC address entries
when it receives a topology change instead of a timer used by PVST+ or MST</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_proposal_agreement_process">5.4.5. Proposal/Agreement Process</h4>
<div class="literalblock">
<div class="content">
<pre>The Proposal signifies the willingness
of a port to become Designated Forwarding, while the Agreement stands for
permission to do so immediately. After a new link point-to-point link is added between
two switches, ports on both ends will come up as Designated Discarding, the default role
and state for a Non-Edge port. Any Designated Port in a Discarding or Learning state
sends BPDUs with the Proposal bit set. Both switches will therefore attempt to exchange
BPDUs with the Proposal bit set (or simply a Proposal), assuming that they have the
right to be Designated. However, if one of the ports receiving a Proposal discovers that
the Proposal constitutes the best received resulting BPDU, its role will change from
Designated to Root (the state will remain Discarding yet). Other port roles on that switch
will also be updated accordingly. Furthermore, a switch receiving a Proposal on its Root
Port will immediately put all its Non-Edge Designated ports into a Discarding state. This
operation is called Sync . A switch in Sync state is now isolated from the network, preventing
any switching loop from passing through it: Its Root Port is still in the Discarding
state (and even if it was Forwarding, the neighboring Designated Port is still Discarding
or Learning), and its own Designated Ports are intentionally moved to the Discarding
state. Now it is safe to move the new Root Port to the Forwarding state and inform the
upstream switch that it is now allowed to move its Designated Discarding or Learning
port to the Forwarding state. This is accomplished by a switch sending a BPDU with the
Agreement bit set (or simply an Agreement) through its Root Port after performing the
Sync. Upon receiving an Agreement on its Designated Discarding or Learning port, the
upstream switch will immediately move that port into the Forwarding state, completing
the Proposal/Agreement exchange between two switches.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_topology_change_handling">5.4.6. Topology Change Handling</h4>
<div class="ulist">
<ul>
<li>
<p>Only a transition of a Non-Edge port from a non-Forwarding state to the Forwarding state is considered a topology change event</p>
</li>
<li>
<p>a switch that detects a topology change on a port (that is, one of its own Non-Edge ports transitions into the Forwarding state)
or learns about a topology change on a port (a BPDU with the TC flag set is received on its Root or Designated Port) will do the following:</p>
<div class="ulist">
<ul>
<li>
<p>Set a so-called tcWhile timer to the value of the Hello time plus one second (older
revisions of RSTP set this value to twice the Hello time) on all remaining Non-Edge
Designated ports and Root Port if any, except the port on which the topology
change was detected or learned.</p>
</li>
<li>
<p>Immediately flush all MAC addresses learned on these ports.</p>
</li>
<li>
<p>Send BPDUs with the TC flag set on these ports every Hello seconds until the tcWhile timer expires.</p>
</li>
</ul>
</div>
</li>
<li>
<p>This way, information about a topology change is rapidly flooded along the spanning
tree in the form of BPDUs with the TC flag set, and causes switches to immediately flush
their CAM tables for all ports except those ports on which the topology change was
detected or learned, as they point in the direction of the topology change where a set of
MAC addresses might have become reachable through a new or improved path.
Key
Topic
Key
Topic</p>
</li>
<li>
<p>Edge ports never cause a topology change event, and MAC addresses learned on them
are not flushed during topology change event handling.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_802_1s_multiple_spanning_trees">5.5. 802.1s Multiple Spanning Trees</h3>
<div class="ulist">
<ul>
<li>
<p>Multiple VLANs mapped to the same STP instance.</p>
</li>
<li>
<p>Enable load balancing</p>
</li>
<li>
<p>Improves fault tolerance of the network
because a failure in one instance or forwarding path does not affect other instances.</p>
</li>
<li>
<p>Uses 802.1w for rapid convergence</p>
</li>
<li>
<p>Highly scalable</p>
<div class="ulist">
<ul>
<li>
<p>Switches with same instance, configuration revision number and name form a <strong>region</strong></p>
</li>
<li>
<p>Different regions see each other as virtual bridges</p>
</li>
</ul>
</div>
</li>
<li>
<p>generates one single BPDU for all configured instances</p>
</li>
<li>
<p>runs instance 0 which forms the IST, or CIST in the case of multiple MST regions</p>
</li>
<li>
<p>doesn&#8217;t use the message age and maximum age information to compute the STP topology.</p>
<div class="ulist">
<ul>
<li>
<p>use the path cost to the root and a hop-count ( similar to IP TTL)</p>
</li>
<li>
<p>the root bridge sends a BPDU (or M-record) with a cost of 0 and the hop count set the maximum value (20 by default)</p>
</li>
<li>
<p>when a switch receives this BPDU, it removes one to the hop counts before sending downstream</p>
</li>
<li>
<p>when the count reaches zero, the switch discards the BPDU and ages the information it holds for the port</p>
</li>
<li>
<p>the message age and maximum age information in the BPDU remain the same  throughout the region and propagated by the region&#8217;s DP at the boundary.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_mst_region">5.5.1. MST Region</h4>
<div class="ulist">
<ul>
<li>
<p>Each switch have three attributes:</p>
<div class="ulist">
<ul>
<li>
<p>Alphanumeric configuration name (32 bytes)</p>
</li>
<li>
<p>Configuration number (2 bytes)</p>
</li>
<li>
<p>4096-element table that associates each of the potential 4096 VLANs to a map</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: configure a MST region</div>
<div class="content">
<pre>conf t
spanning-tree mode mst
spanning-tree mst configuration
  name &lt;region-name&gt;
  revision &lt;number&gt;
  instance &lt;x&gt; vlan &lt;a-b,c, ...&gt;
  instance &lt;y&gt; vlan &lt;a-b,c, ...&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mst_region_ports">5.5.2. MST region ports</h4>
<div class="ulist">
<ul>
<li>
<p>edge port: connects to a non-bridging device or a hub</p>
</li>
<li>
<p>boundary port: connects to a single region running RSTP, 802.1d or to another MST region</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mst_revision_number">5.5.3. MST Revision Number</h4>

</div>
<div class="sect3">
<h4 id="_mst_instance">5.5.4. MST Instance</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">IST</dt>
<dd>
<p>instance 0</p>
<div class="ulist">
<ul>
<li>
<p>instance that interacts with STP run outside the MST region</p>
</li>
<li>
<p>comprises all VLANs not associated with an instance ???</p>
</li>
<li>
<p>only one BPDU being shared over the native VLAN of the trunk</p>
</li>
<li>
<p>only instance that sends and receives BPDUs</p>
<div class="ulist">
<ul>
<li>
<p>other STP instances are contained in the M-record encapsulated within the BPDU</p>
</li>
<li>
<p>reduces the CPU usages</p>
</li>
</ul>
</div>
</li>
<li>
<p>increments the Root Path Cost and Message Age values at the boundary of the MST region
as thouth the BPDU had traversed only a single switch.</p>
</li>
<li>
<p>elects <strong>IST master</strong></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Common and Instance Spanning Tree</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>union of CST between regions and ISTs inside individual regions, and is a single spanning tree that spans the
entire switched topology. As each MST region has its own IST root, CIST—consisting
of ISTs inside regions and CST between regions—can have multiple root switches as a
result. These switches are recognized as the CIST Root Switch (exactly one for the entire
CIST) and CIST Regional Root Switches (exactly one for the IST inside each region). CIST
Regional Root Switch is simply a different name for an IST root switch inside a particular
region.</p>
</li>
<li>
<p>The CIST Root Switch is elected by the lowest Bridge ID from all switches that participate
The CIST Root Switch is elected by the lowest Bridge ID from all switches that participate
in CIST, that is, from all MST switches across all regions according to their IST
Bridge IDs (composed of IST priority, instance number 0, and their base MAC address),
and from all STP/RSTP switches, if present, according to the only Bridge IDs they have.
If running a pure MST-based network, the CIST Root Switch will be the switch whose
IST priority is the lowest (numerically), and in the case of a tie, the switch with the lowest
base MAC address. This switch will also become the root of IST inside its own MST
region; that is, it will also be the CIST Regional Root Switch. As the CIST Root Switch
has the lowest known Bridge ID in the CST, it is automatically the CST Root as well,
although this observation would be important only in cases of mixed MST and non-MST
environments.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In other MST regions that do not contain the CIST Root Switch, only MST switches at
the region boundary (that is, having links to other regions) are allowed to assert themselves
as IST root switches. This is done by allowing the CIST Regional Root ID to be set
either to the Bridge ID of the switch itself if and only if the switch is also the CIST Root,
or in all other cases, to the Bridge ID of an MST boundary switch that receives BPDUs
from a different region. Remaining internal switches have therefore no way of participating
in IST root elections. From boundary switches, IST root switches are elected first by
their lowest external root path cost to the CIST Root Switch. The external root path cost
is the sum of costs of inter-region links to reach the region with the CIST Root Switch, or
in other words, the CST cost of reaching the region with the CIST Root Switch; costs of
links inside regions are not taken into account. In case of a tie, the lowest IST Bridge ID
of boundary switches is used. Note that these rules significantly depart from the usual
concept of the root switch having the lowest Bridge ID. In MST regions that do not contain
the CIST Root Switch, the regional IST root switches might not necessarily be the
ones with the lowest Bridge IDs.</p>
</div>
<div class="paragraph">
<p>A CIST Regional Root Switch has a particular importance for a region: Its own CIST Root
Port, that is, the Root Port to reach the CIST Root Switch outside the region, is called
the Master port (this is an added port role in MST), and provides connectivity from the
region toward the CIST Root for all MST instances inside the region.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CST</dt>
<dd>
<p>Common Spanning Tree</p>
<div class="ulist">
<ul>
<li>
<p>determines loop-free between regions</p>
</li>
<li>
<p>only spanning tree that can be understood and participated in by non-
MST (that is, STP and RSTP) switches, facilitating the interoperation between MST
and its predecessors. In mixed environments with MST and STP/RSTP, STP/RSTP
switches unknowingly participate in CST. Costs in CST reflect only the costs of links
between regions and in non-MST parts of the network. These costs are called external
costs by MST.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_protecting_against_unidirectional_link_issues">5.6. Protecting Against Unidirectional Link Issues</h3>
<div class="listingblock">
<div class="title">Task: Configure MST path selection with port cost</div>
<div class="content">
<pre>(config-if)# spanning-tree mst &lt;instance-number&gt; cost &lt;number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Modify MST path selection with port priority</div>
<div class="content">
<pre>(config-if)# spanning-tree mst &lt;instance-number&gt; port-priority  &lt;number&gt;</pre>
</div>
</div>
<div class="sect3">
<h4 id="_udld_2">5.6.1. UDLD</h4>
<div class="ulist">
<ul>
<li>
<p>Unidirectional links:</p>
<div class="ulist">
<ul>
<li>
<p>One of the 2 transmission path has failed but not both</p>
</li>
<li>
<p>Due to miscabling, cutting on fiber cable, unplugging one fiber, GBIC problems, &#8230;&#8203;</p>
</li>
<li>
<p>Can cause a loop as the previously blocking port will move to a forwarding state</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/stp-unidirectional-links.png" alt="stp unidirectional links" height="150">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Solutions:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">UDLD <strong>u</strong>ni<strong>d</strong>irectional <strong>l</strong>ink <strong>d</strong>etection</dt>
<dd>
<p>Uses Layer 2 messaging to decide when a switch can no longer receive frames from a neighbor.
The switch whose transmit interface did not fail is placed into an err-disabled state.</p>
</dd>
<dt class="hdlist1">UDLD aggressive mode</dt>
<dd>
<p>Attempts to reconnect with the other switch (eight times) after realizing no messages have been received.
If the other switch does not reply to the repeated additional messages,
both sides become err-disabled.</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_bridge_assurance">5.6.2. Bridge Assurance</h4>
<div class="literalblock">
<div class="content">
<pre>The Bridge Assurance, applicable only with RPVST+ and MST and only on
point-to-point links, is a further extension of the idea used by Loop Guard.
Bridge Assurance modifies the rules for sending BPDUs. With Bridge Assurance
activated on a port, this port always sends BPDUs each Hello interval, whether
it is Root, Designated, Alternate, or Backup. BPDUs thus essentially become a
Hello mechanism between pairs of interconnected switches. A Bridge
Assurance–protected port is absolutely required to receive BPDUs. If no BPDUs
are received, the port will be but into a *BA-inconsistent blocking* state
until it starts receiving BPDUs again. Apart from unidirectional links, Bridge
Assurance also protects against loops caused by malfunctioning switches that
completely stop participating in RPVST+/MST (entirely ceasing to process and
send BPDUs) while opening all their ports. At the time of this writing, Bridge
Assurance was supported on selected Catalyst 6500 and Nexus 7000 platforms.
Configuring it on Catalyst 6500 Series requires activating it both globally
using spanning-tree bridge assurance and on ports on STP point-to-point link
types toward other switches using the spanning-tree portfast network interface
command. The neighboring device must also be configured for Bridge Assurance.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dispute_mechanism">5.6.3. Dispute Mechanism</h4>
<div class="literalblock">
<div class="content">
<pre>The Dispute mechanism is yet another and standardized means to detect a
unidirectional link. Its functionality is based on the information encoded in
the Flags field of RST and MST BPDUs, namely, the role and state of the port
forwarding the BPDU. The principle of operation is very simple: If a port
receives an inferior BPDU from a port that claims to be Designated Learning or
Forwarding, it will itself move to the Discarding state. Cisco has also
implemented the Dispute mechanism into its RPVST+. The Dispute mechanism is not
available with legacy STP/PVST+, as these STP versions do not encode the port
role and state into BPDUs. The Dispute mechanism is an integral part of
RSTP/MST and requires no configuration.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unicast_flooding">5.6.4. Unicast Flooding</h4>

</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_3">5.7. Troubleshooting</h3>
<div class="sect3">
<h4 id="_flapping_port_that_is_generating_bpdus_with_the_tcn_bit_set">5.7.1. Flapping Port That Is Generating BPDUs with the TCN Bit Set</h4>

</div>
</div>
<div class="sect2">
<h3 id="_alternatives_to_stp">5.8. Alternatives to STP</h3>
<div class="ulist">
<ul>
<li>
<p>THRILL</p>
</li>
<li>
<p>FabricPath</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_etherchannel">6. EtherChannel</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_etherchannel_2">6.1. EtherChannel</h3>
<div class="ulist">
<ul>
<li>
<p>EtherChannel aggregates bandwidth of up to 8 physical links</p>
</li>
<li>
<p>Consists of two parts:</p>
<div class="ulist">
<ul>
<li>
<p>Port-channel interface: logical interface representing the bundle</p>
</li>
<li>
<p>Member interfaces: physical links part of the bundle</p>
</li>
</ul>
</div>
</li>
<li>
<p>can be any type of interface: Layer 2 access, trunk, tunnel or layer 3 routed</p>
</li>
<li>
<p>Configured as either Layer 2 or Layer 3 interfaces.</p>
</li>
<li>
<p>To be part of a PortChannel, both sides must agree on:</p>
<div class="ulist">
<ul>
<li>
<p>Same speed and duplex settings</p>
</li>
<li>
<p>If not trunking, same access VLAN</p>
</li>
<li>
<p>If trunking, same trunk type, allowed VLANs, and native VLAN</p>
</li>
<li>
<p>On a single switch, each port in a PortChannel must have the same STP cost per VLAN on all links in the PortChannel</p>
</li>
<li>
<p>No ports with SPAN configured</p>
</li>
</ul>
</div>
</li>
<li>
<p>When several EtherChannel bundles exist between two switches,
STP blocks one of the bundles to prevent redundant links.
When spanning tree blocks one of the redundant links, it blocks one EtherChannel,
thus blocking all the ports belonging to this EtherChannel link.</p>
</li>
<li>
<p>Where there is only one EtherChannel link,
all physical links in the EtherChannel are active because STP sees only one (logical) link.</p>
</li>
<li>
<p>If a link within an EtherChannel fails,
traffic previously carried over that failed link changes to the remaining links within the EtherChannel.
A trap is sent for a failure, identifying the switch, the EtherChannel, and the failed link.
Inbound broadcast and multicast packets on one link in an EtherChannel are blocked from returning on any other link of the EtherChannel.</p>
</li>
<li>
<p>Each EtherChannel has a logical port-channel interface numbered from 1 to 64.
The channel groups are also numbered from 1 to 64.</p>
</li>
<li>
<p>When a port joins an EtherChannel, the physical interface for that port is shut down.</p>
</li>
<li>
<p>When the port leaves the port-channel, its physical interface is brought up,
and it has the same configuration as it had before joining the EtherChannel.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_link_aggregation_protocol">6.1.1. Link Aggregation Protocol</h4>
<div class="ulist">
<ul>
<li>
<p>PAgP</p>
<div class="ulist">
<ul>
<li>
<p>Maximum 8 ports</p>
</li>
</ul>
</div>
</li>
<li>
<p>LACP</p>
<div class="ulist">
<ul>
<li>
<p>Maximum 16 ports</p>
</li>
<li>
<p>Maximum 8 active ports and 8 standby ports</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Verify Which Negotiation Protocol Has Been Used for the EtherChannel</div>
<div class="content">
<pre># show etherchannel protocol</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Link Aggregation Protocol Globally</div>
<div class="content">
<pre>(config-if)# channel-protocol {pagp | lacp}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <strong>channel-group</strong> interface configuration command can also set the mode for the EtherChannel</p>
</li>
<li>
<p>If you set the protocol by using <strong>channel-protocol</strong>,
the setting is not overriden by the <strong>channel-group</strong> interface configuration command.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_layer_2_etherchannels">6.1.2. Layer 2 EtherChannels</h4>
<div class="ulist">
<ul>
<li>
<p>Logical interfaces are dynamically created when using <strong>channel-group</strong> command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Layer 2 EtherChannels</div>
<div class="content">
<pre>conf t
interface &lt;type slot/number&gt;
  switchport mode {access | trunk}
  channel-group &lt;n&gt; mode {active | passive | on | {auto [non-silent] | desirable [non-silent]  }</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_layer_3_etherchannels">6.1.3. Layer 3 EtherChannels</h4>
<div class="listingblock">
<div class="title">Task: Create the Port Channel Logical Interface</div>
<div class="content">
<pre>conf t
interface port-channel &lt;number&gt;
  no switchport
  ip address &lt;a.b.c.d&gt; &lt;mask&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Assign the Physical Interfaces to the Layer 3 Port Channel</div>
<div class="content">
<pre>conf t
interface &lt;type id&gt;
  no switchport
  no ip address
  channel-group &lt;n&gt; mode {active | passive | on | {auto [non-silent] | desirable [non-silent]  }</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Always issue the <strong>no switchport</strong> command before the <strong>channel-group</strong> command</p>
</li>
<li>
<p>If L3 port-channel configured properly, the <strong>show etherchannel summary</strong> command should show <strong>RU</strong> for routed and in use</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/etherchannel-relationships.png" alt="etherchannel relationships" height="150">
</div>
<div class="title">Figure 12. Relationship Of Physical Ports, Logical Port Channels, and Channel Groups</div>
</div>
</div>
<div class="sect3">
<h4 id="_etherchannel_modes">6.1.4. EtherChannel Modes</h4>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 9. EtherChannel Modes</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Cisco PAgP</th>
<th class="tableblock halign-left valign-top">802.1AD LACP</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disable negotiation and forces the port into the portChannel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disable negotiation and prevents the ports to be part of the portChannel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">desirable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initiates the negotiation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">passive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">waits on other side to start negotiation</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Display EtherChannel Status</div>
<div class="content">
<pre># show etherchannel [group-number]</pre>
</div>
</div>
<div class="sect4">
<h5 id="_pagp_and_lacp_interaction_with_other_features">PAgP and LACP Interaction with Other Features</h5>
<div class="ulist">
<ul>
<li>
<p>DTP and CDP send and receive packets over the physical interfaces in the EtherChannel.</p>
</li>
<li>
<p>PAgP and LACP transmit PDUs on the lowest numbered VLAN on the interfaces enable for (desirable,auto or active,passive)</p>
</li>
<li>
<p>STP sends packets over the first interface in the Etherchannel</p>
</li>
<li>
<p>The MAC address of a Layer 3 EtherChannel is the MAC address of the first interface in the port-channel.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_load_balancing_and_forwarding_modes">Load Balancing and Forwarding Modes</h5>
<div class="ulist">
<ul>
<li>
<p>Load balancing between member interface based on a combination of</p>
<div class="ulist">
<ul>
<li>
<p>Source MAC address</p>
</li>
<li>
<p>Destination MAC address</p>
</li>
<li>
<p>Source IP address</p>
</li>
<li>
<p>Destination IP address</p>
</li>
</ul>
</div>
</li>
<li>
<p>Uses only source MAC address by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the EtherChannel Load-Balancing Method</div>
<div class="content">
<pre>(config)# port-channel load-balance { dst-ip | dst-mac | src-dst-ip | src-dst-mac | src-ip | src-mac}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the EtherChannel Load-Balancing Method</div>
<div class="content">
<pre># show etherchannel load-balance

EtherChannel Load-Balancing Configuration:
src-mac

EtherChannel Load-Balancing Addresses Used Per-Protocol:
Non-IP: Source MAC address
IPv4: Source MAC address
IPv6: Source MAC address</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_etherchannel_misconfiguration_guard">6.1.5. EtherChannel Misconfiguration Guard</h4>
<div class="ulist">
<ul>
<li>
<p>This mechanism makes an assumption that if multiple ports are correctly bundled
into a Port-channel at the neighbor side, all BPDUs received over links in this
Port-channel must have the same source MAC address in their Ethernet header, as
the Port-channel interface inherits the MAC address of one of its physical
member ports. If BPDUs sourced from different MAC addresses are received on a
Port-channel interface, it is an indication that the neighbor is still treating
the links as individual, and the entire Port-channel will be err-disabled</p>
</li>
<li>
<p>Enabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Deactivate EtherChannal Misconfig Guard</div>
<div class="content">
<pre>(config)# no spanning-tree etherchannel guard misconfig</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vlan_internal_allocation_policy">6.1.6. Vlan internal allocation policy</h4>
<div class="listingblock">
<div class="title">Task: manage the vlan internal allocation policy</div>
<div class="content">
<pre>(config)# vlan internal allocation policy ascending</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lacp">6.2. LACP</h3>
<div class="ulist">
<ul>
<li>
<p>IEEE 802.3ad</p>
</li>
<li>
<p>Automatic creation of port channels</p>
</li>
<li>
<p>Multicast address IEEE 802.3 Slow Protocols: 0180-C200-0002</p>
</li>
<li>
<p>EtherType value: 0x8809</p>
</li>
<li>
<p>Timers: hellos every second during hand shake</p>
</li>
<li>
<p>Maximum: 16 ports with max 8 active</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_restrictions">6.2.1. Restrictions</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="_modes">6.2.2. Modes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Passive</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Does not initiate LACP negotiation but responds to LACP packets</p>
</li>
<li>
<p>Default mode</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Active</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Initiate LACP negotiation by sending LACP packets</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">On</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Forces the interface to the channel without PAgP or LACP</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Working Etherchannel for On-On, Passive-Active, Active-Active</p>
</div>
</div>
<div class="sect3">
<h4 id="_lacp_hot_standby_ports">6.2.3. LACP Hot-Standby Ports</h4>
<div class="ulist">
<ul>
<li>
<p>Only 8 LACP links can be active at one time</p>
</li>
<li>
<p>Any additional links are in hot-standby mode</p>
</li>
<li>
<p>If one of the active links becomes inactive,
a hot-standby link becomes active in its place</p>
</li>
<li>
<p>Each link is assigned a unique priority in this order</p>
<div class="ulist">
<ul>
<li>
<p>LACP system priority (1..65535, default: 32768)</p>
</li>
<li>
<p>System ID ( the switch MAC address)</p>
</li>
<li>
<p>LACP port priority</p>
</li>
<li>
<p>Port number</p>
</li>
</ul>
</div>
</li>
<li>
<p>In priority comparisons, lower values have higher priority.</p>
</li>
<li>
<p>To determine which ports are active and which ports are hot standby,</p>
<div class="ulist">
<ul>
<li>
<p>Select the master switch with a low system priority and system-id</p>
</li>
<li>
<p>Select the master ports with the low port priority and number.
The port-priority and port-number of the slave switch are not used.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Check Which Ports Are In the Hot-Standby Mode</div>
<div class="content">
<pre># show etherchannel summary</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the LACP System Priority</div>
<div class="content">
<pre>(config)# lacp system-priority &lt;priority&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Show the LACP System Priority</div>
<div class="content">
<pre># show lacp sys-id</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: LACP Port Priority</div>
<div class="content">
<pre>(config-if)# lacp port-prioriy</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lacp_port_channel_maxbundle_feature">6.2.4. LACP Port-Channel MaxBundle Feature</h4>
<div class="ulist">
<ul>
<li>
<p>Control the number of ports allowed to be bundled into the etherchannel</p>
</li>
<li>
<p>Allows hot-standby ports with fewer bundled ports</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Maximum Number Of Bundled Ports Allowed In a LACP Port Channel</div>
<div class="content">
<pre>(config-if)# lacp max-bundle</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lacp_port_channel_min_links_feature">6.2.5. LACP Port-Channel Min-Links Feature</h4>
<div class="ulist">
<ul>
<li>
<p>Only for LACP Etherchannel</p>
</li>
<li>
<p>Prevents low-bandwidth interface from becoming active</p>
</li>
<li>
<p>Causes LACP etherChannels to become inactive if they have too few active members ports to supply the required minimum bandwith</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Minimum Number Of Member Ports That Must Be In the Link-Up State and Bundled In the Etherchannel for the Port Channel Interface to Transition to the Link-Up State</div>
<div class="content">
<pre>(config-if)# port-channel min-link n</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pagp">6.3. PAgP</h3>
<div class="ulist">
<ul>
<li>
<p><strong>P</strong>ort <strong>Ag</strong>gregation <strong>P</strong>rotocol</p>
</li>
<li>
<p>Cisco proprietary</p>
</li>
<li>
<p>Automatic creation of a EtherChannel.</p>
</li>
<li>
<p>Sends PagP packets every 30 seconds to multicast 0100-0CCC-CCCC</p>
</li>
<li>
<p>Same destination address than CDP, UDLD, VTP, and DTP.</p>
</li>
<li>
<p>Checks for configuration consistency and manages link additions and failures between two switches.</p>
</li>
<li>
<p>Protocol value: 0x104</p>
</li>
<li>
<p>Cannot be enabled on cross-stack EtherChannel</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display PAgP Status</div>
<div class="content">
<pre># show pagp [channel-group-number]</pre>
</div>
</div>
<div class="sect3">
<h4 id="_modes_2">6.3.1. Modes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Auto </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Never initiates PAgP communications but instead listen passively for any received PAgP packets
before creating an EtherChannel with the neighboring switch.</p>
</li>
<li>
<p>Default mode</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Desirable </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Initiates negotiations with other interfaces by sending PAgP packets.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">On </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Forces the interface to channel without PAgP.</p>
</li>
<li>
<p>Do not exchange PAgP packets.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Etherchannel formed for on-on, desirable-auto, desirable-desirable combinations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_physical_vs_aggregate_learners">6.3.2. Physical Vs Aggregate Learners</h4>
<div class="paragraph">
<p>Switches running PAgP are classified as:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">PAgP physical learners</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>learn MAC addresses using the physical ports within the EtherChannel instead
of via the logical EtherChannel link.</p>
</li>
<li>
<p>forward traffic to addresses based on the physical port via which the address
was learned.  The switch will send packets to the neighboring switch using
the same port in the EtherChannel from which it learned the source address.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Aggregate learners</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>learns addresses based on the aggregate or logical EtherChannel port.</p>
</li>
<li>
<p>transmit packets to the source by using any of the interfaces in the EtherChannel.</p>
</li>
<li>
<p>Aggregate learning is the default.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>By default, PAgP is not able to detect whether a neighboring switch is a
physical learner. Therefore, when configuring PAgP EtherChannels on switches
that support only physical learning, the learning method must be manually set
to physical learning. It is important when running in this mode, to set the
load-distribution method to source-based distribution so that any given source
MAC address is always sent on the same physical port.</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure the PAgP Learning Method</div>
<div class="content">
<pre>(config-if)# pagp learn-method {physical-port | aggregation-port&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the PAgP Learning Method</div>
<div class="content">
<pre># show pagp [channel-group-number] internal</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_priority">6.3.3. Priority</h4>
<div class="ulist">
<ul>
<li>
<p>Range: 0..255</p>
</li>
<li>
<p>Default: 128</p>
</li>
<li>
<p>The higher the priority, the more likely that the port will be used for PAgP transmission</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Assign a Priority So That the Selected Port Is Chosen for Packet Transmission.</div>
<div class="content">
<pre>(config-if)# pagp port-priority &lt;priority&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_restrictions_2">6.3.4. Restrictions</h4>
<div class="paragraph">
<p>While PAgP allows for all links within the EtherChannel to be used to forward
and receive user traffic, there are some restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DTP and CDP send and receive packets over all the physical interfaces in the EtherChannel,
while PAgP sends and receives PAgP PDU only from interfaces that are
up and have PAgP enabled for auto or desirable modes.</p>
</li>
<li>
<p>When an EtherChannel bundle is configured as a trunk port,
the trunk sends and receives PAgP frames on the lowest numbered VLAN.
STP always chooses the first operational port in an EtherChannel bundle.</p>
</li>
<li>
<p>When configuring additional STP features such as Loop Guard on an EtherChannel,
remember that if Loop Guard blocks the first port,
no BPDUs will be sent over the channel,
even if other ports in the channel bundle are operational.
This is because PAgP will enforce uniform Loop Guard configuration on all of the ports that are part of the EtherChannel group.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Validate the Port That Will Be Used by STP to Send Packets and Receive Packets</div>
<div class="content">
<pre>Switch#show pagp neighbor
Flags:  S – Device is sending Slow hello.  C – Device is in Consistent state.
A – Device is in Auto mode.        P – Device learns on physical port.

Channel group 4 neighbors
Partner     Partner             Partner         Partner   Group
Port        Name                Device ID       Port       Age  Flags   Cap.
Gi1/1/3     Switch.1            00c5.a003.0080   Gi0/1     4s   SC      10001
Gi1/1/4     Switch.1            00c5.a003.0080   Gi0/2     3s   SC      10001</pre>
</div>
</div>
<div class="paragraph">
<p>STP will send packets only out of port Gi1/1/3
because it is the first operational interface.
If that port fails,
STP will send packets out of Gi1/1/4.</p>
</div>
</div>
<div class="sect3">
<h4 id="_silent_mode">6.3.5. Silent Mode</h4>
<div class="listingblock">
<div class="title">Task: Configure a Switch Port for Nonsilent Operation</div>
<div class="content">
<pre>TODO</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Switch Port for Nonsilent Operation</div>
<div class="content">
<pre>TODO</pre>
</div>
</div>
<div class="paragraph">
<p>TODO
You can also configure a single interface within the group for all
transmissions and use other interfaces for hot standby. The unused interfaces
in the group can be swapped into operation in just a few seconds if the
selected single interface loses hardware-signal detection.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_span_rspan_and_erspan">6.4. SPAN , RSPAN and ERSPAN</h3>
<div class="ulist">
<ul>
<li>
<p>SPAN (Switch Port Analyzer) mirrors monitored (TX,RX or Both) traffic
on source ports or VLANs to a destination port for analysis.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_local_span_sessions">6.4.1. Local SPAN Sessions</h4>
<div class="ulist">
<ul>
<li>
<p>Source and destination on the same switch</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/span-topology.png" alt="SPAN Topology">
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display SPAN  Status</div>
<div class="content">
<pre>Switch# show monitor session

Session 1
==========

Type              : Local Session
Source Ports      :
    RX Only       : None
    TX Only       : None
    Both          : Fa0/4
Source VLANs      :
    RX Only       : None
    TX Only       : None
    Both          : None
Source RSPAN VLAN : None
Destination Ports : Fa0/5
    Encapsulation: DOT1Q
          Ingress: Enabled, default VLAN = 5
Reflector Port    : None
Filter VLANs      : None
Dest RSPAN VLAN   : None</pre>
</div>
</div>
<div class="sect4">
<h5 id="_source">Source</h5>
<div class="ulist">
<ul>
<li>
<p>Can not mix source ports and source VLANs in a single session</p>
</li>
<li>
<p>Monitored traffic directions can be</p>
<div class="ulist">
<ul>
<li>
<p>Rx :  before any modification or processing by ACL or QoS or VACL</p>
</li>
<li>
<p>Tx : after all modification and processing performed by the switch.</p>
</li>
<li>
<p>Both: by default</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Span Source Ports/VLANs</div>
<div class="content">
<pre>monitor session &lt;1-66&gt; source {interface &lt;id&gt; | vlan &lt;id&gt;} [, | -] [both | rx | tx]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>(Optional) [, | -] Specify a series or range of interfaces. Enter a space before and after the comma; enter a space before and after the hyphen.</p>
</li>
<li>
<p>A single session can include multiple sources (ports or VLANs), defined in a series of commands, but you cannot combine source ports and source VLANs in one session.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_source_ports">Source Ports</h6>
<div class="ulist">
<ul>
<li>
<p>Can be physical interfaces</p>
</li>
<li>
<p>Can be port-channel logical interfaces with port-channel numbers in (1..48)</p>
</li>
<li>
<p>Can be an access port, trunk port, routed port, or voice VLAN port.</p>
</li>
<li>
<p>Cannot be a destination port</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_source_vlans">Source VLANs</h6>
<div class="ulist">
<ul>
<li>
<p>All active ports in the source VLAN are included as source ports and can be monitored in either or both directions.</p>
</li>
<li>
<p>On a given port, only traffic on the monitored VLAN is sent to the destination port.</p>
</li>
<li>
<p>If a destination port belongs to a source VLAN, it is excluded from the source list and is not monitored.</p>
</li>
<li>
<p>If ports are added to or removed from the source VLANs, the traffic on the source VLAN received by those ports is added to or removed from the sources being monitored.</p>
</li>
<li>
<p>You cannot use filter VLANs in the same session with VLAN sources.</p>
</li>
<li>
<p>You can monitor only Ethernet VLANs.</p>
</li>
<li>
<p>Ignores CDP, BPDU, VTP, DTP and PAgP frames unless <strong>encapsulation replicate</strong> is configured</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_destination_port">Destination Port</h5>
<div class="ulist">
<ul>
<li>
<p>Must be a physical port</p>
</li>
<li>
<p>Cannot be a source port</p>
</li>
<li>
<p>By default, send packets untagged</p>
<div class="ulist">
<ul>
<li>
<p>can replicate the source interface encapsulation</p>
</li>
</ul>
</div>
</li>
<li>
<p>By default, disable the ingress traffic forwarding</p>
<div class="ulist">
<ul>
<li>
<p>can accept incoming packets with dot1q, ISL or untagged</p>
</li>
</ul>
</div>
</li>
<li>
<p>Only one SPAN/RSPAN session can send traffic to a single destination port, cannot be used by two SPAN sessions</p>
</li>
<li>
<p>Only monitored traffic passes through the SPAN destination port</p>
</li>
<li>
<p>Entering SPAN configuration commands does not remove previously configured SPAN parameters.
Enter the <strong>no monitor session {session_number | all | local | remote}</strong> global configuration command to delete configured SPAN parameters.</p>
</li>
<li>
<p>For local SPAN, outgoing packets through the SPAN destination port carry the original encapsulation headers—untagged, ISL, or IEEE 802.1Q
If the encapsulation replicate keywords are specified.
If the keywords are not specified, the packets are sent in native form.
For RSPAN destination ports, outgoing packets are not tagged.</p>
</li>
<li>
<p>You can configure a disabled port to be a source or destination port,
but the SPAN function does not start until the destination port and at least one source port or source VLAN are enabled.</p>
</li>
<li>
<p>You cannot mix source VLANs and filter VLANs within a single SPAN session.</p>
</li>
<li>
<p>Up to 64 SPAN destination ports can be configured on a switch</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Destination Port for a SPAN Session</div>
<div class="content">
<pre>(config)# monitor &lt;session-number&gt;
                    destination interface &lt;interface-id&gt;
                    [encapsulation replicate]
                    [ingress {dot1q vlan &lt;vlan-id&gt; | isl | untagged vlan &lt;vlan-id&gt;} ]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_vlan_filtering">VLAN Filtering</h5>
<div class="ulist">
<ul>
<li>
<p>To limit SPAN traffic monitoring on trunk source ports to specific VLANs by using VLAN filtering.</p>
</li>
<li>
<p>Applies only to trunk ports or to voice VLAN ports.</p>
</li>
<li>
<p>Applies only to port-based sessions</p>
</li>
<li>
<p>Not  allowed in sessions with VLAN sources.</p>
</li>
<li>
<p>When a VLAN filter list is specified, only those VLANs in the list are monitored on trunk ports or on voice VLAN access ports.</p>
</li>
<li>
<p>SPAN traffic coming from other port types is not affected by VLAN filtering; that is, all VLANs are allowed on other ports.</p>
</li>
<li>
<p>VLAN filtering affects only traffic forwarded to the destination SPAN port and does not affect the switching of normal traffic.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Limit SPAN Source to Specific VLANs</div>
<div class="content">
<pre>(config)# monitor &lt;session-number&gt; filter vlan &lt;vlan-ids&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_remote_span_sessions">6.4.2. Remote SPAN Sessions</h4>
<div class="paragraph">
<p>RSPAN consists of at least one RSPAN source session, an RSPAN VLAN, and at least one RSPAN destination session.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/rspan-topology.png" alt="RSPAN Topology">
</div>
</div>
<div class="paragraph">
<div class="title">Restrictions and Considerations</div>
<p>When RSPAN is enabled, each packet being monitored is transmitted twice,
once as normal traffic and once as a monitored packet.
Therefore monitoring a large number of ports or VLANs could potentially generate large amounts of network traffic.</p>
</div>
<div class="sect4">
<h5 id="_rspan_vlan">RSPAN VLAN</h5>
<div class="ulist">
<ul>
<li>
<p>Can be propagated to all switches by VTP if 1 &lt; RSPAN VLAN &lt; 1002</p>
</li>
<li>
<p>Must be created manually on extended-range VLAN</p>
</li>
<li>
<p>Can not be vlan 1, 1002-1005</p>
</li>
<li>
<p>Can served multiple RSPAN source/destination sessions</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Restrictions</div>
<ul>
<li>
<p>You can apply an output ACL to RSPAN traffic to selectively filter or monitor specific packets. Specify these ACLs on the RSPAN VLAN in the RSPAN source switches.</p>
</li>
<li>
<p>For RSPAN configuration, you can distribute the source ports and the destination ports across multiple switches in your network.</p>
</li>
<li>
<p>RSPAN does not support BPDU packet monitoring or other Layer 2 switch protocols.</p>
</li>
<li>
<p>The RSPAN VLAN is configured only on trunk ports and not on access ports.
To avoid unwanted traffic in RSPAN VLANs,
make sure that the VLAN remote-span feature is supported in all the participating switches.</p>
</li>
<li>
<p>Access ports (including voice VLAN ports) on the RSPAN VLAN are put in the inactive state.</p>
</li>
<li>
<p>RSPAN VLANs are included as sources for port-based RSPAN sessions when source trunk ports have active RSPAN VLANs. RSPAN VLANs can also be sources in SPAN sessions. However, since the switch does not monitor spanned traffic, it does not support egress spanning of packets on any RSPAN VLAN identified as the destination of an RSPAN source session on the switch.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure RSPAN VLAN on All Participating Switches</div>
<div class="content">
<pre>(config)# vlan &lt;rspan-vlan-id&gt;
(config-vlan)# remote-span</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rspan_source_session">RSPAN Source Session</h5>
<div class="ulist">
<ul>
<li>
<p>Must be configured on the monitored port&#8217;s switch</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the RSPAN Source Session</div>
<div class="content">
<pre>monitor session &lt;session-number&gt; source {interface &lt;interface-id&gt; | vlan &lt;vlan-id&gt;} [, | -] [both | rx | tx]
monitor session &lt;session-number&gt; destination remote vlan &lt;rspan-vlan-id&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rspan_destination_session">RSPAN Destination Session</h5>
<div class="ulist">
<ul>
<li>
<p>Takes all packets received on the RSPAN VLAN, strips off the VLAN tagging, and presents them on the destination port.</p>
</li>
<li>
<p>Excludes Layer 2 control</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the RSPAN Destination Session on a Different Switch (Not the Switch on Which the Source Session Was Configured)</div>
<div class="content">
<pre>(config)# monitor session &lt;session-number&gt; source remote vlan &lt;rspan-vlan-id&gt;
(config)#  monitor session &lt;session-number&gt; destination interface &lt;interface-id&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_encapsulated_rspan">6.4.3. Encapsulated RSPAN</h4>
<div class="ulist">
<ul>
<li>
<p>ERSPAN consists of an ERSPAN source session, routable ERSPAN GRE encapsulated traffic, and an ERSPAN destination session.</p>
</li>
<li>
<p>Supported only on high-end switches (ASR1000, Catalyst 6500/7600, Nexus platforms ) or IOS-XE</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/erspan.png" alt="erspan">
</div>
</div>
<div class="sect4">
<h5 id="_erspan_source_session">ERSPAN Source Session</h5>
<div class="listingblock">
<div class="title">Task: Configure ERSPAN Source Session</div>
<div class="content">
<pre>(config)# monitor session &lt;id&gt; type erspan-source
(config-mon-erspan-src)# source { interface &lt;interface-id&gt; | vlan &lt;vlan-ids&gt; [rx|tx|both]}
(config-mon-erspan-src)# destination
(config-mon-erspan-src-dst)# erspan-id &lt;erspan-flow-id&gt;
(config-mon-erspan-src-dst)# mtu &lt;size&gt;
(config-mon-erspan-src-dst)# origin ip address &lt;a.b.c.d&gt; [force]
(config-mon-erspan-src-dst)# no shutdown</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_erspan_destination_session">ERSPAN Destination Session</h5>
<div class="listingblock">
<div class="title">Task: Configure ERSPAN Destination Session</div>
<div class="content">
<pre>(config)# monitor session &lt;id&gt; type erspan-destination
(config-mon-erspan-dst)# destination interface &lt;interface-id&gt;
(config-mon-erspan-dst)# source
(config-mon-erspan-dst-src)# erspan-id &lt;erspan-flow-id&gt;
(config-mon-erspan-dst-src)# mtu &lt;size&gt;
(config-mon-erspan-dst-src)# ip address &lt;a.b.c.d&gt; [force]
(config-mon-erspan-dst-src)# no shutdown</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_espan_dummy_mac_address_rewrite">ESPAN Dummy MAC Address Rewrite</h5>
<div class="ulist">
<ul>
<li>
<p>Supports customized MAC value for WAN interface and tunnel interface</p>
</li>
<li>
<p>Monitor the traffic going through WAN interface</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure ESPAN Dummy MAC Address</div>
<div class="content">
<pre>(config)# monitor session &lt;session-id&gt; type erspan-source
(config-mon-erspan-src-dst)# s-mac &lt;mac-address&gt;
(config-mon-erspan-src-dst)# d-mac &lt;mac-address&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_interaction_with_other_features_2">6.4.4. Interaction with Other Features</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Routing </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>SPAN does not monitor routed traffic.</p>
</li>
<li>
<p>RSPAN only monitors traffic that enters or exits the switch, not traffic that is routed between VLANs.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">STP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A destination port does not participate in STP while its SPAN or RSPAN session is active.</p>
</li>
<li>
<p>The destination port can participate in STP after the SPAN or RSPAN session is disabled.</p>
</li>
<li>
<p>On a source port, SPAN does not affect the STP status. STP can be active on trunk ports carrying an RSPAN VLAN.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">CDP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A SPAN destination port does not participate in CDP while the SPAN session is active.</p>
</li>
<li>
<p>After the SPAN session is disabled, the port again participates in CDP.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">VTP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You can use VTP to prune an RSPAN VLAN between switches.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">VLAN and trunking</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You can modify VLAN membership or trunk settings for source or destination ports at any time.</p>
</li>
<li>
<p>However, changes in VLAN membership or trunk settings for a destination port do not take effect until you remove the SPAN destination configuration.</p>
</li>
<li>
<p>Changes in VLAN membership or trunk settings for a source port immediately take effect, and the respective SPAN sessions automatically adjust accordingly.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">EtherChannel</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You can configure an EtherChannel group as a source port but not as a SPAN destination port.</p>
</li>
<li>
<p>When a group is configured as a SPAN source, the entire group is monitored.</p>
</li>
<li>
<p>If a physical port is added to a monitored EtherChannel group, the new port is added to the SPAN source port list.</p>
</li>
<li>
<p>If a port is removed from a monitored EtherChannel group, it is automatically removed from the source port list.</p>
</li>
<li>
<p>A physical port that belongs to an EtherChannel group can be configured as a SPAN source port and still be a part of the EtherChannel.</p>
</li>
<li>
<p>In this case, data from the physical port is monitored as it participates in the EtherChannel.
However, if a physical port that belongs to an EtherChannel group is configured as a SPAN destination, it is removed from the group.
After the port is removed from the SPAN session, it rejoins the EtherChannel group.
Ports removed from an EtherChannel group remain members of the group, but they are in the inactive or suspended state.</p>
</li>
<li>
<p>If a physical port that belongs to an EtherChannel group is a destination port and the EtherChannel group is a source,
the port is removed from the EtherChannel group and from the list of monitored ports.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Multicasting</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Multicast traffic can be monitored.</p>
</li>
<li>
<p>For egress and ingress port monitoring, only a single unedited packet is sent to the SPAN destination port.</p>
</li>
<li>
<p>It does not reflect the number of times the multicast packet is sent.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Private VLAN</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A private-VLAN port cannot be a SPAN destination port.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Secure port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A secure port cannot be a SPAN destination port.</p>
</li>
<li>
<p>For SPAN sessions, do not enable port security on ports with monitored egress when ingress forwarding is enabled on the destination port.
For RSPAN source sessions, do not enable port security on any ports with monitored egress.</p>
</li>
<li>
<p>An IEEE 802.1x port can be a SPAN source port.
You can enable IEEE 802.1x on a port that is a SPAN destination port; however,
IEEE 802.1x is disabled until the port is removed as a SPAN destination.</p>
</li>
<li>
<p>For SPAN sessions, do not enable IEEE 802.1x on ports with monitored egress when ingress forwarding is enabled on the destination port.
For RSPAN source sessions, do not enable IEEE 802.1x on any ports that are egress monitored.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_virtual_switch_system">6.5. Virtual Switch System</h3>
<div class="imageblock" style="float: right">
<div class="content">
<img src="../images/vss.png" alt="Virtual Switch System" width="500" height="500">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>VSS makes two physical switches to act and appear as one single logical network element.</p>
</li>
<li>
<p>VSS manages the redundant links from access switches  as single Multi-chassis Etherchannel</p>
<div class="ulist">
<ul>
<li>
<p>No need for spanning-tree to block one of the links</p>
</li>
<li>
<p>two active links instead of one 1/10/40b interfaces</p>
</li>
</ul>
</div>
</li>
<li>
<p>on Cat6500, Cat4500 running IOS-XE</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_vss_active_and_standby_switch">6.5.1. VSS Active and Standby Switch</h4>
<div class="ulist">
<ul>
<li>
<p>Uses VLSP to negotiate the active and standby roles at start</p>
</li>
<li>
<p>The VSS active switch</p>
<div class="ulist">
<ul>
<li>
<p>controls the VSS, running the Layer 2 and Layer 3 control protocols for the switching modules on both switches.</p>
</li>
<li>
<p>provides management functions for the VSS, such as module online insertion and removal (OIR)
and the console interface.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The VSS active and standby switches perform packet forwarding for ingress data traffic
on their locally hosted interfaces. However, the VSS standby switch sends all control traffic
to the VSS active switch for processing</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure VSS Domain Number and Switch Number</div>
<div class="content">
<pre>(config)# switch virtual domain &lt;1..255&gt;
(config-vs-domain)# switch [1 | 2]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure VSS Switch Priority</div>
<div class="content">
<pre>(config-vs-domain)# switch [1 | 2 ] priority [&lt;number&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
1 lowest priority 255 highest priority 100 default
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_virtual_switch_link">6.5.2. Virtual Switch Link</h4>
<div class="imageblock" style="float: right">
<div class="content">
<img src="../images/vss-logical.png" alt="Virtual Switch Link" width="250" height="250">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Normally built as etherchannel with up to 8 links</p>
</li>
<li>
<p>carries system control information
(
hot-standby supervisor programming,
line card status,
Distributed Forwarding Card (DFC) card programming,
system management, diagnostics, &#8230;&#8203;
)</p>
</li>
<li>
<p>carries user data traffic when necessary</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Create VSL</div>
<div class="content">
<pre>(config)#interface port channel 5
(config-if)# switchport
(config-if)# switch virtual link 1
(config-if)# no shut
(config-if)# exit
#! add physical interface to port channel
(config)# interface range gi 7/4 - 5
(config-if)# channel group 5 mode one
(config-if)# exit</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Convert the Switch to Virtual</div>
<div class="content">
<pre>(config)# switch convert mode virtual</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Displays the VSS Information</div>
<div class="content">
<pre># sh switch virtual [role | link]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Example</div>
<div class="literalblock">
<div class="content">
<pre>Executing the command on VSS member switch role = VSS Active, id = 1
RRP information for Instance 1
--------------------------------------------------------------------
Valid Flags Peer  Preferred Reserved
            Count Peer      Peer
--------------------------------------------------------------------
TRUE   V    1     1         1</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Switch  Switch Status     Preempt    Priority   Role      Local Remote
        Number            Oper(Conf) Oper(Conf)           SID   SID
--------------------------------------------------------------------
LOCAL   1      UP         FALSE(N ) 100(100)    ACTIVE    0     0
REMOTE  2      UP         FALSE(N ) 100(100)    STANDBY   6834  6152</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Peer 0 represents the local switch
Flags : V - Valid
In dual-active recovery mode: No</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Executing the command on VSS member switch role = VSS Standby, id = 2
RRP information for Instance 2
--------------------------------------------------------------------
Valid Flags Peer  Preferred Reserved
            Count Peer      Peer
--------------------------------------------------------------------
TRUE  V     1     1         1</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Switch  Switch Status Preempt     Priority    Role    Local Remote
        Number        Oper(Conf)  Oper(Conf)          SID   SID
--------------------------------------------------------------------
LOCAL   2       UP    FALSE(N )   100(100)    STANDBY 0     0
REMOTE  1       UP    FALSE(N )   100(100)    ACTIVE 6152 6834</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Peer 0 represents the local switch
Flags : V - Valid
In dual-active recovery mode: No</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Displays the VSL Information</div>
<div class="content">
<pre># sh switch virtual link</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Example</div>
<div class="listingblock">
<div class="content">
<pre>  Executing the command on VSS member switch role = VSS Active, id = 1
  VSL Status : UP
  VSL Uptime : 3 minutes
  VSL Control Link : Gi1/7/4
  Executing the command on VSS member switch role = VSS Standby, id = 2
  VSL Status : UP
  VSL Uptime : 3 minutes
  VSL Control Link : Gi2/4/45</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_multi_chassis_ethernet_channel">6.5.3. Multi-chassis Ethernet Channel</h4>
<div class="ulist">
<ul>
<li>
<p>VSS enables the creation of Multichassis EtherChannel (MEC), which is an EtherChannel whose member ports can be
distributed across the member switches in a VSS.</p>
</li>
<li>
<p>Because non-VSS switches connected to a VSS view the MEC as a standard EtherChannel,
non-VSS switches can connect in a dual-homed manner.</p>
</li>
<li>
<p>Traffic traversing the MEC can be load balanced locally within a VSS member switch much like that of standard EtherChannels.</p>
</li>
<li>
<p>Cisco MEC supports dynamic configuration (LACP and PAgP) as well as static EtherChannel configuration.</p>
</li>
<li>
<p>In total, a VSS can support a maximum of 256 EtherChannels. This limit applies to the total number of regular EtherChannels and
MECs.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_vpc">6.6. vPC</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stackwise">7. Stackwise</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
<div class="paragraph">
<p>Cisco StackWise technology provides a new method for collectively utilizing the capabilities of a
stack of switches. Individual switches intelligently join to create a single switching unit with a 32-
Gbps switching stack interconnect. Configuration and routing information is shared by every
switch in the stack, creating a single switching unit. Switches can be added to and deleted from
a working switch stack without affecting performance.</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 10. Rules and their respective priority order</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Priority</th>
<th class="tableblock halign-left valign-top">Rule</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The switch that is currently the stack master</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The switch that is currently the stack master</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The switch that uses the non-default interface-level configuration</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The switch with the higher Hardware/Software priority.
    These switch software versions are listed from highest to lowest priority :
      1. Cryptographic IP services image software
      2. Noncryptographic IP services image software
      3. Cryptographic IP base image software
      4. Noncryptographic IP base image software</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The switch with the longest system up-time</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The switch with the lowest MAC address</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_port_based_traffic_control">7.1. Port-Based Traffic Control</h3>
<div class="sect3">
<h4 id="_storm_control">7.1.1. Storm Control</h4>
<div class="ulist">
<ul>
<li>
<p>limits the amount of broadcast, multicast or unicast traffic received inbound on a physical interface.</p>
</li>
<li>
<p>blocks the port when the rising threshold is reached</p>
</li>
<li>
<p>resumes normal forwards when the traffic rate drops below falling threshold</p>
</li>
<li>
<p>the threshold can be expressed in</p>
<div class="ulist">
<ul>
<li>
<p>pps (packet per second)</p>
</li>
<li>
<p>bps (bits per seconds)</p>
</li>
<li>
<p>pps for small frames (&lt; 67 bytes)</p>
</li>
<li>
<p>percentage of the available bandwidth of the port</p>
</li>
</ul>
</div>
</li>
<li>
<p>by default, filters outs the traffic and err-disable the port</p>
</li>
<li>
<p>can be configured to send a SNMP trap</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure storm control</div>
<div class="content">
<pre>(config-if)# storm-control {broadcast | multicast | unicast}
                     level {&lt;rising-thresholdl&gt; [&lt;failing-threshold&gt;] | bps &lt;bps&gt; [&lt;bps-low&gt;] | pps &lt;pps&gt; [&lt;pps-low&gt;] }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Limit traffic in packet per second</div>
<div class="content">
<pre>(config-if)# storm-control {broadcast | multicast | unicast} level pps &lt;rising-threshold&gt; [&lt;falling-threshold] }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Limit traffic in bits per second</div>
<div class="content">
<pre>(config-if)# storm-control {broadcast | multicast | unicast} level bps &lt;rising-threshold&gt; [&lt;falling-threshold] }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Limit traffic in  as a percentage of the bandwidth</div>
<div class="content">
<pre>(config-if)# storm-control {broadcast | multicast | unicast} level &lt;rising-threshold&gt; [&lt;falling-threshold] }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Err-disable a port during a storm</div>
<div class="content">
<pre>(config-if)# storm-control action shutdown</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Generate an SNMP trap when a storm is detected</div>
<div class="content">
<pre>(config-if)# storm-control action trap</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the storm control suppression levels set on the interface</div>
<div class="content">
<pre>sh storm-control [&lt;interface-id&gt;] [broadcast|multicast|unicast]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_protocol_storm_protection">7.1.2. Protocol Storm Protection</h4>
<div class="paragraph">
<p>TODO
<a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_1_se/configuration/guide/3750xcg/swtrafc.html#71262" class="bare">https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_1_se/configuration/guide/3750xcg/swtrafc.html#71262</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_protected_port">7.1.3. Protected Port</h4>
<div class="paragraph">
<p>TODO
<a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_1_se/configuration/guide/3750xcg/swtrafc.html#71262" class="bare">https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_1_se/configuration/guide/3750xcg/swtrafc.html#71262</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_port_blocking">7.1.4. Port Blocking</h4>
<div class="ulist">
<ul>
<li>
<p>blocks a port from flooding unknown unicast or multicast to other ports</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Block unknown multicast forwarding out of the port</div>
<div class="content">
<pre>(config-if)# switchport block multicast</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Only pure L2 multicast traffic is blocked</p>
</li>
<li>
<p>multicast packets that contain IPv4 or IPv6 information in the header are not blocked</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Block unknown unicast forwarding out of the port</div>
<div class="content">
<pre>(config-if)# switchport block unicast</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_port_security">7.1.5. Port Security</h4>
<div class="paragraph">
<p>TODO
<a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_1_se/configuration/guide/3750xcg/swtrafc.html#71262" class="bare">https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_1_se/configuration/guide/3750xcg/swtrafc.html#71262</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wan">8. WAN</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_hdlc">8.1. HDLC</h3>
<div class="ulist">
<ul>
<li>
<p>High-Level Data Link Control</p>
</li>
<li>
<p>Layer 2 on point-to-point links</p>
</li>
<li>
<p>bit oriented synchronous, without retransmission</p>
</li>
<li>
<p>uses SLARP to send keepalives</p>
</li>
<li>
<p>developed by the ISO (ISO 3309)</p>
</li>
<li>
<p>modified by Cisco by adding a proprietary 2-byte Type field to the frame.</p>
<div class="ulist">
<ul>
<li>
<p>enabled by default on IOS serial links</p>
</li>
<li>
<p>On a Cisco router, HDLC encapsulation can only connect with another Cisco router</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_hdlc_frame_format">8.1.1. HDLC Frame Format</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="_encapsulation">8.1.2. Encapsulation</h4>
<div class="ulist">
<ul>
<li>
<p>default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set Encapsulation to HDLC</div>
<div class="content">
<pre>(config-if)# encapsulation hdlc</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Statistics</div>
<div class="content">
<pre>sh controllers serial</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clock_rate">8.1.3. Clock Rate</h4>
<div class="ulist">
<ul>
<li>
<p>Automatically set</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Modify the Clock Rate</div>
<div class="content">
<pre>(config-if)# clock-rate &lt;bps&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Clock Rate Is In the Network</div>
<div class="content">
<pre>(config-if)# clock-rate line</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ppp">8.2. PPP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Cisco Cloud Routers Configuration guides</span>&#160;&#9656; <span class="submenu">WAN</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/wan_mlp/configuration/xe-16/wan-mlp-xe-16-book/dia-media-ind-multi-ppp-xe.html#GUID-382A6E17-B674-431A-AA62-6DF387F9E0FB">PPP</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>error detection, error recovery, standard protocol Type field, supports synchronous and asynchronous links</p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc1661">RFC 1661</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc1662">RFC 1662</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ppp_frame_format">8.2.1. PPP Frame Format</h4>
<div class="ulist">
<ul>
<li>
<p>Replaces proprietary type with standard protocol</p>
</li>
<li>
<p>Adds padding so the frame has even number of bytes</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ppp-vs-hdlc.png" alt="PPP vs HDLC">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>FCS:: Frame Checksum calculated over the address, control, protocol, information and payload fields</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ppp_lcp">8.2.2. PPP LCP</h4>
<div class="ulist">
<ul>
<li>
<p>link control protocol</p>
</li>
<li>
<p>controls features independent of any Layer 3 protocol</p>
</li>
<li>
<p>establishes a PPP sesion between 2 link partners.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure PPP</div>
<div class="content">
<pre>(config-if)# encapsulation ppp</pre>
</div>
</div>
<div class="sect4">
<h5 id="_lcp_operations">LCP Operations:</h5>
<div class="literalblock">
<div class="content">
<pre>When a PPP serial link first comes up—for example, when a router senses the
Clear to Send (CTS), Data Send Read (DSR), and Data Carrier Detect (DCD) leads
come up at the physical layer—LCP begins parameter negotiation with the other
end of the link. For example, LCP controls the negotiation of which
authentication methods to attempt, and in what order, and then allows the
authentication protocol (for example, CHAP)
to complete its work. After all LCP negotiation has completed
successfully, LCP is considered to be “up.”</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_lcp_features">LCP Features</h5>
<div class="ulist">
<ul>
<li>
<p>LQM link quality monitoring: drop if % of error frames above a configured value</p>
</li>
<li>
<p>looped link detection: drop link if a router receives its own randomly chosen magic number</p>
</li>
<li>
<p>layer 2 load balancing: fragment frames over multilink PPP</p>
</li>
<li>
<p>authentication: chap, pap</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Configuration</div>
<ul>
<li>
<p>minimal with <strong>encapsulation ppp</strong></p>
</li>
<li>
<p>optional authentication, quality</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# encapsulation ppp
(config-if)# ppp quality &lt;percent&gt;
(config-if)# ppp authentication {chap | pap}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Drop the Link If Router Receives Its Own Magic Number</div>
<div class="content">
<pre></pre>
</div>
</div>
<div class="sect5">
<h6 id="_lqm">LQM</h6>
<div class="ulist">
<ul>
<li>
<p>When LQM is enabled, every keepalive period is sent to Link Quality Reports
(LQRs) in place of keepalives. All incoming keepalives are responded to
properly.</p>
</li>
<li>
<p>If LQM is not configured, keepalives are sent every keepalive period and all incoming LQRs are responded to with an LQR.</p>
</li>
<li>
<p>LQM is incompatible with Multilink PPP</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Monitor PPP Link Quality</div>
<div class="content">
<pre>(config-if)# ppp quality &lt;percent&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multilink_ppp">8.2.3. Multilink PPP</h4>
<div class="ulist">
<ul>
<li>
<p>originally intended to combine multiple ISDN B-channels without requiring any Layer 3 load balancing</p>
</li>
<li>
<p>now load balance traffic accross any type of point-to-point serial link</p>
</li>
<li>
<p>add a header ( 2 or 4 bytes ) to allow reassembly on the receiving end</p>
</li>
<li>
<p>configuration with multilink interfaces or virtual templates</p>
</li>
<li>
<p>fragmenting each data link layer frame, either based on the number of parallel links or on a configured fragmentation delay.</p>
<div class="ulist">
<ul>
<li>
<p>sends the fragments over different links at the same time.</p>
</li>
<li>
<p>adds a header (4 or 2 bytes for Sequence Number and Flags bit) to allow reassembly on the receiving end, MLP adds a header (either 4 or 2 bytes)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_lfi">LFI</h5>
<div class="ulist">
<ul>
<li>
<p>LFI (link fragmentation and interleaving )</p>
</li>
<li>
<p>prevents small, delay sensitive packets from having to wait on longer, delay-insensitive packets to be completely serialized out an interface.</p>
</li>
<li>
<p>the queuing scheduler generally LLQ on the multilink interface determines the next packet to send:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ppp-lfi.png" alt="LFI example">
</div>
</div>
<div class="listingblock">
<div class="title">Task: Allow Interleave</div>
<div class="content">
<pre>(config-if)# ppp multilink interleave</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Define LFI Fragment Size</div>
<div class="content">
<pre>(config-if)# ppp multilink fragment-delay &lt;microseconds&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
defines the fragment size based on \$"Size" = x * "Bandwidth"\$
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>interface Multilink1
  bandwidth 256
  ip address 10.1.34.3 255.255.255.0
  encapsulation ppp
  ppp multilink
  ppp multilink group 1
  ppp multilink fragment-delay 10
  ppp multilink8 interleave
  service-policy output queue-on-dsc</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ppp_compression">8.2.4. PPP Compression</h4>
<div class="ulist">
<ul>
<li>
<p>uses L2 payload compression ( ip + tcp + data + DL) : best with longer packet</p>
</li>
<li>
<p>TCP header compression ( ip + tcp )</p>
</li>
<li>
<p>RTP header compression (ip + udp + rtp)</p>
</li>
<li>
<p>payload compression works best with longer packets, and header with shorter packets</p>
</li>
<li>
<p>header compression : achieves better compression ration 10:1 to 20:1</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_layer_2_compression">Layer 2 Compression</h5>
<div class="ulist">
<ul>
<li>
<p>options: LZS (Lempel-Ziv Stacker), MPPC (microsoft point-to-point compression), Predictor</p>
</li>
<li>
<p>LZS use more CPU and less RAM than Predictor algorithm and have better compression ratio</p>
</li>
<li>
<p>stacker: supports hdlc, ppp, FR, ATM</p>
</li>
<li>
<p>mppc: ppp, atm</p>
</li>
<li>
<p>predictor: ppp, atm</p>
</li>
<li>
<p>configuration with a matching <strong>compress</strong> command under each interface on both end of the links</p>
</li>
<li>
<p>once configured, ppp starts ccp (compression control protocol) which is another NCP</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_header_compression">Header Compression</h5>
<div class="ulist">
<ul>
<li>
<p>configured with legacy commands or MQC commands</p>
</li>
<li>
<p>legacy under the serial (ppp) or multilink interface</p>
</li>
<li>
<p><strong>ip tcp header-compression [passive]</strong></p>
</li>
<li>
<p><strong>ip rtp header-compression [passive]</strong></p>
</li>
<li>
<p>add also MQC commands</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ppp_authentication">8.2.5. PPP Authentication</h4>
<div class="listingblock">
<div class="title">Task: Enable PPP Authentication</div>
<div class="content">
<pre>ppp authentication {chap | chap pap | pap chap | pap} [if-needed] [&lt;list-name&gt; | default] [callin]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Debug Ppp Authentication</div>
<div class="content">
<pre>debug ppp authentication</pre>
</div>
</div>
<div class="paragraph">
<p>read
<a href="http://www.cisco.com/c/en/us/support/docs/wan/point-to-point-protocol-ppp/25440-debug-ppp-negotiation.html#sampdebug">understanding debug ppp negotiation</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_mlpp">8.2.6. MLPP</h4>
<div class="paragraph">
<p>TODO</p>
</div>
<div class="ulist">
<ul>
<li>
<p>load-balancing over multiple WAN links</p>
</li>
<li>
<p>multi-vendor</p>
</li>
<li>
<p>packet fragmentation, sequencing, load calculation</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pppoe">8.3. PPPoE</h3>
<div class="ulist">
<ul>
<li>
<p>Ethertype:	0x8863 (Discovery Stage), 0x8864 (PPP Session Stage)</p>
</li>
<li>
<p>used for digital subscriber line (DSL) Internet access
because the public telephone network uses ATM for its transport protocol;
therefore, Ethernet frames must be encapsulated in a protocol supported over both Ethernet and ATM.</p>
</li>
<li>
<p>The PPP Client feature permits a Cisco IOS router, rather than an endpoint host, to serve as the client in a network.
This permits multiple hosts to connect over a single PPPoE connection.</p>
</li>
<li>
<p>In a DSL environment, PPP interface IP addresses are derived from an upstream DHCP server
using IP Configuration Protocol (IPCP). Therefore, IP address negotiation must be enabled on the
router’s dialer interface. This is done using the <strong>ip address negotiated</strong> command in the dialer
interface configuration.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_pppoe_packets">8.3.1. PPPoE packets</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because PPPoE introduces an 8-byte overhead (2 bytes for the PPP header and 6
bytes for PPPoE), the MTU for PPPoE is usually decreased to 1492 bytes so
that the entire encapsulated frame fits within the 1500-byte Ethernet frame.
Additionally, for TCP sessions, the negotiated Maximum Segment Size is
clamped down to 1452 bytes, allowing for 40 bytes in TCP and IP headers and 8
bytes in the PPPoE, totaling 1500 bytes that must fit into an ordinary
Ethernet frame. A MTU mismatch can prevent a
PPPoE connection from coming up or from properly carrying large datagrams.
Checking the MTU setting is a good first step when troubleshooting PPPoE connections.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/pppoe-packet-format.png" alt="PPPoE Header Format" width="896" height="184">
</div>
<div class="title">Figure 13. PPPoE Header Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Length</dt>
<dd>
<p>Size of the data field in bytes</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>mnemo (ROTIS, SORTI)</p>
</div>
<div class="ulist">
<div class="title">Packet types</div>
<ul>
<li>
<p>PADR</p>
</li>
<li>
<p>PADO</p>
</li>
<li>
<p>PADT</p>
</li>
<li>
<p>PADI</p>
</li>
<li>
<p>PADS</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_pppoe_server">8.3.2. PPPoE Server</h4>
<div class="ulist">
<ul>
<li>
<p>on the ISP side</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO: Replace the task below with step-by-step instructions</p>
</div>
<div class="listingblock">
<div class="title">Task: Create a Broad Band Aggregation Group</div>
<div class="content">
<pre>(config)# bba-group pppoe &lt;name&gt;
(config-bba-group)# virtual-template 1</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Limit the Number Of Sessions on the Associated MAC</div>
<div class="content">
<pre>(config-bba-group)# sessions per-mac limit &lt;number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Create the Virtual Template Interface</div>
<div class="content">
<pre>(config)# interface virtual-template 1
(config-if)# ip address 10.0.0.1 255.255.255.0
(config-if)# peer default ip address pool &lt;pool-name&gt;

(config)# ip local pool &lt;pool-name&gt; &lt;ip-start&gt; &lt;ip-finish&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable PPPoE Group on the Interface</div>
<div class="content">
<pre>(config-if)#
(config)# interface f0/0
(config-if)# no ip address
(config-if)# pppoe enable group MyGroup
(config-if)# no shutdown</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pppoe_client">8.3.3. PPPOE Client</h4>
<div class="imageblock">
<div class="content">
<img src="../images/pppoe-topology-example.png" alt="pppoe topology example" height="150">
</div>
</div>
<div class="listingblock">
<div class="title">Example Of Config on the Edge Router</div>
<div class="content">
<pre># conf t
(config)# interface fa0/1
(config-if)# ip address 192.168.100.1 255.255.255.0
(config-if)# ip nat inside
(config)# interface fa0/1
(config-if)# pppoe-client dial-pool-number 1
(config-if)# exit
(config)# interface dialer1
(config-if)# mtu 1492
(config-if)# encapsulation ppp
(config-if)# ip address negotiated
(config-if)# ppp authentication chap

!The remaining CHAP commands have been omitted for brevity.

(config-if)# ip nat outside
(config-if)# dialer pool 1
(config-if)# dialer-group 1
(config-if)# exit
(config)# dialer-list 1 protocol ip permit
(config)# ip nat inside source list 1 interface dialier1 overload
(config)# access-list 1 permit 192.168.100.0 0.0.0.255
(config)# ip route 0.0.0.0 0.0.0.0 dialer1</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify PPPoE Connectivity</div>
<div class="content">
<pre>show pppoe session</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Debug</div>
<div class="content">
<pre>debug pppoe [data | errors | events | packets]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pppoe_authentication">8.3.4. PPPoE Authentication</h4>
<div class="paragraph">
<p>TODO: Add section from configuration guides</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ethernet_wan">8.4. Ethernet WAN</h3>
<div class="paragraph">
<p>EWAN</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Virtual Private LAN Services (VPLS),</p>
</li>
<li>
<p>Multi-Protocol Label Switching (MPLS),</p>
</li>
<li>
<p>Any-Transport Over MPLS (ATOM),</p>
</li>
<li>
<p>Dot1Q-in-Dot1Q Tunnels (QnQ Tunnels),</p>
</li>
<li>
<p>Metro-Ethernet.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_vpls">8.4.1. VPLS</h4>
<div class="ulist">
<ul>
<li>
<p>Virtual Private LAN Service</p>
</li>
<li>
<p>various WAN connections (over either IP or MPLS networks)</p>
</li>
<li>
<p>uses QoS for audio and video</p>
</li>
<li>
<p>provide multipoint Ethernet LAN services, or Transparent LAN Service (TLS).</p>
<div class="ulist">
<ul>
<li>
<p>A multipoint network service is one that allows a customer edge (CE)
endpoint or node to communicate directly with all other CE nodes associated
with the multipoint service.</p>
</li>
<li>
<p>By contrast, using a point-to-point network
service such as ATM, the end customer typically designates one CE node to
be the hub to which all spoke sites are connected. In this scenario, if a
spoke site needs to communicate with another spoke site, it must
communicate through the hub, and this requirement can introduce
transmission delay.</p>
</li>
</ul>
</div>
</li>
<li>
<p>To provide multipoint Ethernet capability, the IETF VPLS drafts describe the
concept of linking virtual Ethernet bridges using MPLS Pseudo-Wires (PW). As a
VPLS forwards Ethernet frames at Layer 2, the operation of VPLS is exactly the
same as that found within IEEE 802.1 bridges in that VPLS will self-learn the
source MAC address to port associations, and frames are forwarded based upon
the destination MAC address. If the destination address is unknown, or is a
broadcast or multicast address, the frame is flooded to all ports associated
with the virtual bridge.</p>
</li>
<li>
<p>Although the forwarding operation of VPLS is relatively simple, the VPLS
architecture needs to be able to perform other operational functions, such as</p>
<div class="ulist">
<ul>
<li>
<p>Autodiscover other provider edges (PE) associated with a particular VPLS instance</p>
</li>
<li>
<p>Signaling of PWs to interconnect VPLS virtual switch instances (VSI)</p>
</li>
<li>
<p>Loop avoidance</p>
</li>
<li>
<p>MAC address withdrawal</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_metro_ethernet">8.4.2. Metro-Ethernet</h4>
<div class="ulist">
<ul>
<li>
<p>Ethernet on the metropolitan-area network (MAN) can be used as pure Ethernet,
Ethernet over MPLS, or Ethernet over Dark Fiber, but regardless of the
transport medium, we have to recognize that in network deployments requiring
medium-distance backhaul or metropolitan (in the same city) connectivity,
this Ethernet WAN technology is king. Why do we have so many different types
of Metro-E solutions? The answer is that each has advantages and
disadvantages. As an example, pure Ethernet-based deployments are cheaper but
less reliable and scalable, and are usually limited to small-scale or
experimental deployments. Dark Fiber–based deployments are useful when there
is an existing infrastructure already in place, whereas solutions that are
MPLS based are costly but highly reliable and scalable, and as such are used
typically by large corporations.</p>
</li>
<li>
<p>MPLS-based Metro-Ethernet network uses MPLS in the service
provider’s network. The subscriber will get an Ethernet interface on copper
(for example, 100BASE-TX) or fiber (such as 100BASE-FX). The customer’s
Ethernet packet is transported over MPLS, and the service provider network
uses Ethernet again as the underlying technology to transport MPLS. So
MPLS-based Metro-E is effectively Ethernet over MPLS over Ethernet.</p>
</li>
<li>
<p>Label Distribution Protocol (LDP) signaling can be used to provide
site-to-site signaling for the inner label (VC label) and Resource
Reservation Protocol-Traffic Engineering (RSVP-TE), or LDP can be used to
provide the network signaling for the outer label.</p>
</li>
<li>
<p>It should also be noted that a typical Metro-Ethernet system has a star
network or mesh network topology, with individual routers or servers
interconnected through cable or fiber-optic media. This is important when it
becomes necessary to troubleshoot Metro-Ethernet solutions.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ethernet_private_line_epl">8.4.3. Ethernet Private Line (EPL)</h4>
<div class="paragraph">
<p>The Ethernet Private Line service is used to deploy private line WAN connectivity across the
Metro network. Typically the Ethernet service will forward packets to a long haul SONET
network where Ethernet packets are encapsulated in SONET frames.
The Ethernet packets are stripped off (de-encapsulated) at the SONET Provider Edge (PE)
equipment and forwarded to the local Metro service provider network. The Ethernet private line
is similar to any WAN link where VLAN information isn&#8217;t sent between routers. The service
provider does the rate limiting of traffic based on the CIR selected by the customer. The CIR is
the guaranteed data rate service level agreement with the ISP. Traffic shaping or rate limiting of
packets should be done at the Customer Edge (CE) on the CPE Ethernet interface to make sure
packets are not dropped by the service provider.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ethernet_virtual_private_line_evpl">8.4.4. Ethernet Virtual Private Line (EVPL)</h4>
<div class="paragraph">
<p>The Ethernet virtual private line service is deployed for trunking of multiple VLANs across a
Metro network (i.e. multiplexing multiple point to point EVCs). The 802.1q encapsulation
protocol is the new standard that works with Cisco and other vendor equipment. The customer
edge device uses 802.1q protocol to tag each Ethernet packet with VLAN membership before
forwarding it across the virtual point to point Metrolink. QoS is applied at the Customer Edge
(CE) Ethernet interface using per VLAN or per Class per VLAN traffic shaping.</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/Ffsq5o" class="bare">http://goo.gl/Ffsq5o</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<h1 id="_part_ii_layer_3_technologies" class="sect0">Part II : Layer 3 Technologies</h1>
<div class="sect1">
<h2 id="_ipv4">9. IPv4</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>RFC 791</p>
</li>
<li>
<p>IP Ethernet protocol: 0x0800</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_ip_packet_format">9.1. IP Packet Format</h3>
<div class="imageblock">
<div class="content">
<img src="../images/ipv4-packet-format.png" alt="IP Header Format" width="896" height="376">
</div>
<div class="title">Figure 14. IP Header Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">IP Header Length (IHL)</dt>
<dd>
<p>Datagram header length in 32-bit words.
Minimum value = 5</p>
</dd>
<dt class="hdlist1">DSCP</dt>
<dd>
<p>Differentied Service Code Protocol.
Previously known as ToS Type of Service.
Specifies how an upper-layer protocol would like a current datagram to be handled,
and assigns datagrams various levels of importance.</p>
</dd>
<dt class="hdlist1">ECN</dt>
<dd>
<p>Explicit Congestion Notification
RFC 3168</p>
</dd>
<dt class="hdlist1">Total Length</dt>
<dd>
<p>Length, in bytes, of the entire IP packet,
including the data and header.</p>
</dd>
<dt class="hdlist1">Identification</dt>
<dd>
<p>Integer that identifies the current datagram.
Uses for fragmentation and re-assembly</p>
</dd>
<dt class="hdlist1">Flags</dt>
<dd>
<p>3-bits in order from most significant to least significant</p>
<div class="ulist">
<ul>
<li>
<p>bit 0: Reserved; must be zero.</p>
</li>
<li>
<p>bit 1: Don&#8217;t Fragment (DF)</p>
</li>
<li>
<p>bit 2: More Fragments (MF)</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Fragment Offset</dt>
<dd>
<p>Indicates the position of the fragment&#8217;s data relative to the beginning of the data in the original datagram,
which allows the destination IP process to properly reconstruct the original datagram.</p>
</dd>
<dt class="hdlist1">Time-to-Live</dt>
<dd>
<p>Maintains a counter that gradually decrements down to zero,
at which point the datagram is discarded.
This keeps packets from looping endlessly.</p>
</dd>
<dt class="hdlist1">Protocol</dt>
<dd>
<p>Indicates which upper-layer protocol receives incoming packets after IP processing is complete.</p>
</dd>
<dt class="hdlist1">Header Checksum</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>equals to the one’s complement of the one’s complement sum of all 16 bit
words in the IP header.</p>
</li>
<li>
<p>initialized to all zeros at computation.</p>
</li>
<li>
<p>included</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Options</dt>
<dd>
<p>Allows IP to support various options, such as security.</p>
</dd>
<dt class="hdlist1">Data</dt>
<dd>
<p>Contains upper-layer information.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_ip_address">9.2. IP Address</h3>
<div class="ulist">
<ul>
<li>
<p>32-bits written in "dotted decimal"</p>
</li>
<li>
<p>Classes: A,B,C,D,E</p>
</li>
<li>
<p>Classless : prefix + host</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Assign an IP Address to an Interface</div>
<div class="content">
<pre>(config-if)# ip address &lt;a.b.c.d&gt; &lt;e.f.g.h&gt; [secondary]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the IP Parameters for the Interface</div>
<div class="content">
<pre># show ip interface</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the IP Networks the Device Is Connected To</div>
<div class="content">
<pre># show ip route connected</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cidr">9.3. CIDR</h3>
<div class="ulist">
<ul>
<li>
<p>Classless interdomain routing</p>
</li>
<li>
<p>Defined in RFC 1517-1520</p>
</li>
<li>
<p>Administrative assigment of large address blocks and the related summarized
routes for the purpose of reducing the size of the Internet routing table</p>
</li>
<li>
<p>Enabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Disable Classless Addressing</div>
<div class="content">
<pre>(config)# no ip classless</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Format In Which Netmask Appear for the Current Session</div>
<div class="content">
<pre>(config)# line vty &lt;first&gt; &lt;last&gt;
(config-line)# term ip netmask-format {bitcount | decimal | hexadecimal}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Format In Which Netmask Appear for the Current Line</div>
<div class="content">
<pre>(config)# line vty &lt;first&gt; &lt;last&gt;
(config-line)# term ip netmask-format {bitcount | decimal | hexadecimal}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_private_addressing">9.4. Private Addressing</h3>
<div class="ulist">
<ul>
<li>
<p>RFC 1918</p>
</li>
<li>
<p>10.0.0.0/8</p>
</li>
<li>
<p>172.16.0.0/12</p>
</li>
<li>
<p>192.168.0.0/16</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vlsm">9.5. VLSM</h3>
<div class="ulist">
<ul>
<li>
<p>Variable length subnet mask</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_subnet_zero">9.6. Subnet Zero</h3>
<div class="listingblock">
<div class="title">Task: Allow IP Subnet Zero</div>
<div class="content">
<pre>(config)# ip subnet-zero</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_unnumbered_interfaces">9.7. Unnumbered Interfaces</h3>
<div class="ulist">
<ul>
<li>
<p>Borrow the IP address of another interface</p>
</li>
<li>
<p>Only point-to-point (non-multiaccess) WAN interfaces</p>
</li>
<li>
<p>You cannot reboot a IOS image over an ip unnumbered interface</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Unnumbered Interfaces on Point-to-Point WAN Interfaces</div>
<div class="content">
<pre>(config-if)# ip unnumbered &lt;interface-type interface-id&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_31_bit_prefix">9.8. 31-Bit Prefix</h3>
<div class="ulist">
<ul>
<li>
<p>Conserve IP address space</p>
</li>
<li>
<p>Since RFC 3021</p>
</li>
<li>
<p>Only on point-to-point WAN interfaces</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Use a 31-Bit Prefix on Point-to-Point WAN Interfaces</div>
<div class="content">
<pre>(config)# ip classless
(config-if)# ip address a.b.c.d 255.255.255.254</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_checksum">9.9. Checksum</h3>
<div class="ulist">
<ul>
<li>
<p>IP checksum is a 16-bit field in IP header used for error detection for IP header.
It equals to the one’s complement of the one’s complement sum of all 16 bit words in the IP header. The checksum field is initialized to all zeros at computation.</p>
</li>
<li>
<p>One’s complement sum is calculated by summing all numbers and adding the carries to the result.
And one’s complement is defined by inverting all 0s and 1s in the number’s bit representation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if an IP header is 0x4500003044224000800600008c7c19acae241e2b.</p>
</div>
<div class="sect3">
<h4 id="_sender">9.9.1. Sender</h4>
<div class="paragraph">
<p>First, divide the header hex into 16 bits each and sum them up,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>4500 + 0030 + 4422 + 4000 + 8006 + 0000 + 8c7c + 19ac + ae24 + 1e2b = 2BBCF</pre>
</div>
</div>
<div class="paragraph">
<p>Next fold the result into 16 bits by adding the carry to the result,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 +  BBCF  = BBD1</pre>
</div>
</div>
<div class="paragraph">
<p>The final step is to compute the one’s complement of the one’s complement’s sum,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>BBD1 = 1011101111010001</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>IP checksum = one’s complement(1011101111010001) = 0100010000101110 = 442E</pre>
</div>
</div>
<div class="paragraph">
<p>Note that IP header needs to be parsed at each hop,
because IP addresses are needed to route the packet.
To detect the errors at IP header, the checksum is validated at every hop.</p>
</div>
</div>
<div class="sect3">
<h4 id="_receiver">9.9.2. Receiver</h4>
<div class="paragraph">
<p>The validation is done using the same algorithm.
But this time the initialized checksum value is 442E.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>2BBCF + 442E = 2FFFD, then 2 + FFFD = FFFF</pre>
</div>
</div>
<div class="paragraph">
<p>Take the one’s complement of FFFF = 0.</p>
</div>
<div class="paragraph">
<p>At validation, the checksum computation should evaluate to 0 if the IP header is correct.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_protocol">9.10. Protocol</h3>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Number</th>
<th class="tableblock halign-left valign-top">Protocol</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>1</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ICMP</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>2</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>IGMP</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>6</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>TCP</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>17</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>UDP</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>45</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>IRDP</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>46</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>RSVP</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>47</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>GRE</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>51</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>AH IPSec</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>50</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ESP IPSec</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>58</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ICMPv6</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>88</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>EIGRP</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>89</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>OSPF</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>103</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>PIM</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>112</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>VRRP</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ip_options">9.11. IP Options</h3>
<div class="ulist">
<ul>
<li>
<p>by default, cisco routers process IP options</p>
</li>
<li>
<p>TLV</p>
<div class="ulist">
<ul>
<li>
<p>Option-Type: 8bit</p>
</li>
<li>
<p>Option-Length: 8 bit</p>
</li>
<li>
<p>Option-Data: Variable</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ip-options-format.png" alt="IP Options Format" width="896" height="184">
</div>
<div class="title">Figure 15. IP Options Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Copied Flag</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>1 when the option is copied to each fragment</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Option Class</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>0 for Control</p>
</li>
<li>
<p>2 for debugging and measurement for Internet Timestamp option</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Option Number</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>0  <strong>End of the option list</strong>,</p>
</li>
<li>
<p>1  <strong>No Operation</strong>, again the option field is just one octet with no length or data fields.</p>
</li>
<li>
<p>2  <strong>Security</strong>,  the length is 11 octets and the various security codes can be found in RFC 791.</p>
</li>
<li>
<p>3  <strong>Loose Source Route</strong> which is IP routing based on information supplied by the source station where the routers can forward the datagram to any number of intermediate routers in order to get to the destination.</p>
</li>
<li>
<p>4  <strong>Internet Timestamp</strong></p>
</li>
<li>
<p>7  <strong>Record Route</strong> records the route that a datagram takes.</p>
</li>
<li>
<p>8  <strong>Stream ID</strong> has a length of 4 octets.</p>
</li>
<li>
<p>9  <strong>Strict Source Route</strong> which is IP routing based on information supplied by the source station where the routers can only forward the datagram to a directly connected router in order to get to the next hop indicated in the source route path.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Ignore all IP options</div>
<div class="content">
<pre>(config)# ip options drop</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Discard any IP datagram containing a source-route option</div>
<div class="content">
<pre>(config)# no ip source-route</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ip_fragmentation_and_re_assembly">9.12. IP fragmentation and Re-assembly</h3>
<div class="ulist">
<ul>
<li>
<p>Fields used: Identification, DF, MF, Offset (and total length of each fragment)</p>
</li>
<li>
<p>when one fragment is lost, the entire IP datagram is resent</p>
<div class="ulist">
<ul>
<li>
<p>IP doesn&#8217;t have any timeout or retransmission</p>
</li>
<li>
<p>TCP or higher layers have</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the IP MTU packet size for an interface.</div>
<div class="content">
<pre>(config-if)# ip mtu &lt;bytes&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_icmp">10. ICMP</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Internet Control Management Protocol</p>
</li>
<li>
<p>RFC 792</p>
</li>
<li>
<p>Generates error messages</p>
</li>
<li>
<p>Protocol Number: 1</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_header">10.1. Header</h3>
<div class="imageblock">
<div class="content">
<img src="../images/icmp-header.png" alt="ICMP Header Format" width="896" height="184">
</div>
<div class="title">Figure 16. ICMP Header Format</div>
</div>
</div>
<div class="sect2">
<h3 id="_control_messages">10.2. Control Messages</h3>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Echo reply (used to ping)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unassigned 	Reserved</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_icmp_unreachable_messages">10.3. ICMP Unreachable Messages</h3>
<div class="paragraph">
<p>Type: 3</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>0</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Destination network unreachable</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>1</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Destination host unreachable</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>2</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Destination protocol unreachable</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>3</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Destination port unreachable</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>4</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Fragmentation required, and DF flag set</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>5</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Source route failed</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>6</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Destination network unknown</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>7</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Destination host unknown</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>8</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Source host isolated</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>9</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Network administratively prohibited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>10</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Host administratively prohibited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>11</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Network unreachable for ToS</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>12</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Host unreachable for ToS</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>13</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Communication administratively prohibited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>14</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Host Precedence Violation</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>15</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Precedence cutoff in effect</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Disable the sending of ICMP protocol unreachable and host unreachable messages</div>
<div class="content">
<pre>(config-if)# no ip unreachables</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Disabling the unreachable messages also disables IP Path MTU Discovery because path discovery works by having the software send unreachable messages.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Clear all current ICMP unreachable statistics for all configured interfaces</div>
<div class="content">
<pre># clear ip icmp rate-limit [&lt;interface type number&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the rate limitation of ICMP unreachable destination messages and the error message log threshold for generating a message</div>
<div class="content">
<pre>(config-if)# ip icmp rate-limit unreachable [df] [&lt;ms&gt;] [log [&lt;packets&gt;] [&lt;interval-ms&gt;]]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default is no unreachable messages are sent more often than once every half second.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Display all current ICMP unreachable statistics for all configured interfaces.</div>
<div class="content">
<pre># show ip icmp rate-limit [&lt;interface type number&gt;]

  Interval (millisecond)     500                       500
  Interface                  # DF bit unreachables     # All other unreachables
  ---------                  ---------------------     ------------------------
  Ethernet0/0                0                         0
  Ethernet0/2                0                         0
  Serial3/0/3                0                         19
  The greatest number of unreachables is on serial interface 3/0/3.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_icmp_source_quench_messages">10.4. ICMP Source Quench Messages</h3>
<div class="paragraph">
<p>Type: 4</p>
</div>
<div class="paragraph">
<p>4 – Source Quench 	0 	deprecated 	Source quench (congestion control)</p>
</div>
</div>
<div class="sect2">
<h3 id="_icmp_redirect_messages">10.5. ICMP Redirect Messages</h3>
<div class="paragraph">
<p>Type: 5</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">code</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>0</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Redirect Datagram for the Network</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>1</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Redirect Datagram for the Host</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>2</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Redirect Datagram for the ToS &amp; network</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>3</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Redirect Datagram for the ToS &amp; host</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>6</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>deprecated 	Alternate Host Address</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><div><div class="paragraph">
<p>7</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>unassigned 	Reserved</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Disable the sending of ICMP redirect messages to learn routes</div>
<div class="content">
<pre>(config-if)# no ip redirects</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the address of the default router and the address of hosts for which an ICMP redirect message has been received</div>
<div class="content">
<pre># show ip redirects

Default gateway is 172.16.80.29

Host               Gateway           Last Use    Total Uses  Interface
172.16.1.111      172.16.80.240         0:00             9  Ethernet0
172.16.1.4        172.16.80.240         0:00             4  Ethernet0</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_icmp_echo_request">10.6. ICMP Echo Request</h3>
<div class="paragraph">
<p>8 – Echo Request</p>
</div>
</div>
<div class="sect2">
<h3 id="_icmp_router_messages">10.7. ICMP Router  Messages</h3>
<div class="paragraph">
<p>9 – Router Advertisement
10 – Router Solicitation</p>
</div>
</div>
<div class="sect2">
<h3 id="_icmp_time_exceeded">10.8. ICMP Time Exceeded</h3>
<div class="paragraph">
<p>11 – Time Exceeded</p>
</div>
<div class="paragraph">
<p>0 		TTL expired in transit
1 		Fragment reassembly time exceeded</p>
</div>
</div>
<div class="sect2">
<h3 id="_parameter_problem">10.9. Parameter Problem</h3>
<div class="paragraph">
<p>12 – Parameter Problem: Bad IP header</p>
</div>
<div class="paragraph">
<p>0 		Pointer indicates the error
1 		Missing a required option
2 		Bad length</p>
</div>
</div>
<div class="sect2">
<h3 id="_timestamp_messages">10.10. Timestamp Messages</h3>
<div class="paragraph">
<p>13 – Timestamp
14 – Timestamp Reply</p>
</div>
</div>
<div class="sect2">
<h3 id="_information_request">10.11. Information Request</h3>
<div class="paragraph">
<p>15 – Information Request
16 – Information Reply</p>
</div>
</div>
<div class="sect2">
<h3 id="_address_mask_messages">10.12. Address Mask Messages</h3>
<div class="paragraph">
<p>17 – Address Mask Request
18 – Address Mask Reply</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To request the subnet mask for a particular subnetwork</p>
</li>
<li>
<p>Can be used by an attacker to gain network mapping information</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Disable the sending of ICMP mask reply messages</div>
<div class="content">
<pre>(config-if)# no ip mask-reply</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ping">10.13. Ping</h3>
<div class="ulist">
<ul>
<li>
<p>Packet InterNet Groper</p>
</li>
<li>
<p>uses two ICMP query messages, ICMP echo requests, and ICMP echo replies to determine whether a remote host is active</p>
<div class="ulist">
<ul>
<li>
<p>The ping command first sends an echo request packet to an address, and then it waits for a reply.</p>
</li>
<li>
<p>The ping is successful only if the ECHO REQUEST gets to the destination, and the destination is able to get an ECHO REPLY back to the
source of the ping within a predefined time interval.</p>
</li>
</ul>
</div>
</li>
<li>
<p>measures the amount of time it takes to receive the echo reply</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_traceroute">10.14. Traceroute</h3>
<div class="ulist">
<ul>
<li>
<p>records the source of each ICMP "TIME EXCEEDED" message in order to provide a trace of the path the packet took
to reach the destination.</p>
</li>
<li>
<p>sends out a sequence of UDP datagrams,
each with incrementing TTL values, to an invalid port address (Default 33434) at the remote host.</p>
<div class="ulist">
<ul>
<li>
<p>First, three datagrams are sent, each with a TTL field value set to 1. The TTL
value of 1 causes the datagram to "timeout" as soon as it hits the first router
in the path. This router then responds with an ICMP "time exceeded" message
which indicates that the datagram has expired.</p>
</li>
<li>
<p>Next, three more UDP messages are sent, each with the TTL value set to 2. This
causes the second router in the path to the destination to return ICMP "time
exceeded" messages.</p>
</li>
<li>
<p>This process continues until the packets reach the destination and until the
system that originates the traceroute receives ICMP "time exceeded" messages
from every router in the path to the destination. Since these datagrams try to
access an invalid port (Default 33434) at the destination host, the host
responds with ICMP "port unreachable" messages that indicate an unreachable
port. This event signals the traceroute program to finish.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Disable the generation of ICMP unreachable messages</div>
<div class="content">
<pre>(config-if)# no ip unreachables</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tcp">11. TCP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Transmission Control Protocol</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provides a reliable, connection-oriented, byte stream, transport layer
service.</p>
<div class="ulist">
<ul>
<li>
<p>packetizes the user data into segments,</p>
</li>
<li>
<p>sets a timeout any time it sends data,</p>
</li>
<li>
<p>acknowledges data received by the other end,</p>
</li>
<li>
<p>reorders out-of-order data,</p>
</li>
<li>
<p>discards duplicate data,</p>
</li>
<li>
<p>provides end-to-end flow control, and</p>
</li>
<li>
<p>calculates and verifies a mandatory end-to-end checksum.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Protocol Number: 6</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/tcp-header-format.svg" alt="TCP Header Format" width="896" height="312">
</div>
<div class="title">Figure 17. TCP Header Format</div>
</div>
<div class="sect2">
<h3 id="_connection_establishment">11.1. Connection establishment</h3>
<div class="paragraph">
<div class="title">Three-Hand Shake</div>
<p>SYN seq(A), SYN-ACK seq(B) ack(A+1), ACK seq(B+1)</p>
</div>
<div class="listingblock">
<div class="title">Task: Set the amount of time before attempting to establish a TCP connection.</div>
<div class="content">
<pre>(config)# ip tcp synwait-time &lt;seconds&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default is 30 seconds.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_tcp_mss">11.2. TCP MSS</h3>
<div class="ulist">
<ul>
<li>
<p>Maximimum Segment Size: max amount of data that a host is willing to receive in a single TCP datagram</p>
</li>
<li>
<p>sent as TCP option in TCP SYN segment</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_tcp_window">11.3. TCP Window</h3>
<div class="paragraph">
<p>amount of unacknowledged data a sender can send on a particular connection
before it gets an acknowledgment back from the receiver,
that it has received some of the data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sliding_window_operations">11.4. Sliding window operations</h3>
<div class="paragraph">
<p>todo: Excellent lessons
<a href="http://www.omnisecu.com/tcpip/tcp-sliding-window.php" class="bare">http://www.omnisecu.com/tcpip/tcp-sliding-window.php</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_tcp_options">11.5. TCP Options</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_ident">11.6. Ident</h3>
<div class="ulist">
<ul>
<li>
<p>TCP client Identify Protocol</p>
</li>
<li>
<p>RFC 1413,</p>
</li>
<li>
<p>allows a system to query the identity of a user initiating a TCP connection
or a host responding to a TCP connection.</p>
<div class="ulist">
<ul>
<li>
<p>When implemented, the Ident service
allows a user to obtain identity information by simple connecting to a TCP
port on a system, and issuing a simple text string requesting information.</p>
</li>
</ul>
</div>
</li>
<li>
<p>disabled by default for security reasons</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# no ip identd</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tcp_small_servers">11.7. TCP Small Servers</h3>
<div class="ulist">
<ul>
<li>
<p>echo, chargen, daytime , discard services</p>
</li>
<li>
<p>disabled by default</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The TCP small servers are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Echo: Echoes back whatever you type through the telnet x.x.x.x echo command.</p>
</li>
<li>
<p>Chargen: Generates a stream of ASCII data. Use the telnet x.x.x.x chargen
command.</p>
</li>
<li>
<p>Discard: Throws away whatever you type. Use the telnet x.x.x.x discard
command.</p>
</li>
<li>
<p>Daytime: Returns system date and time, if it is correct. It is correct if you run
Network Time Protocol (NTP), or have set the date and time manually from the exec level. Use the telnet x.x.x.x daytime command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable TCP small servers</div>
<div class="content">
<pre>(config)# service tcp-small-servers</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_udp">12. UDP</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Protocol number: 17</p>
</li>
<li>
<p>RFC 768</p>
<div class="dlist">
<dl>
<dt class="hdlist1">MSS</dt>
</dl>
</div>
</li>
<li>
<p>Default 536 bytes ??</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_message_format">12.1. Message Format</h3>
<div class="imageblock">
<div class="content">
<img src="../images/udp-header.png" alt="UDP Header Format" width="896" height="184">
</div>
<div class="title">Figure 18. UDP Header Format</div>
</div>
</div>
<div class="sect2">
<h3 id="_udp_checksum">12.2. UDP checksum</h3>

</div>
<div class="sect2">
<h3 id="_udp_dominance">12.3. UDP dominance</h3>
<div class="ulist">
<ul>
<li>
<p>TCP starvation</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_udp_small_servers">12.4. UDP Small Servers</h3>
<div class="ulist">
<ul>
<li>
<p>echo, chargen,  discard services</p>
</li>
<li>
<p>disabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable UDP small servers</div>
<div class="content">
<pre>(config)# service udp-small-servers</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_arp">13. ARP</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">IP Addressing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipaddr_arp/configuration/15-mt/arp-15-mt-book.html">ARP</span></span> </a></p>
</li>
<li>
<p><a href="https://wwwietf.org/rfc/rfc826.txt">RFC 826</a></p>
</li>
<li>
<p>Finds MAC address of a host given IP address</p>
</li>
<li>
<p>maintains ARP cache</p>
</li>
<li>
<p>ARP Ethernet protocol: 0x0806</p>
</li>
<li>
<p>ARP request for the same address rate-limited to one request every 2 seconds</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_protocol_2">13.1. Protocol</h3>
<div class="paragraph">
<p>TODO: better work to show that ARP is encapsulated in Ethernet frame, use color</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-arp.png" alt="ARP" width="557" height="71">
</div>
<div class="title">Figure 19. ARP</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/arp.png" alt="Header Format" width="896" height="344">
</div>
<div class="title">Figure 20. Header Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">OpCode</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>1 for request</p>
</li>
<li>
<p>2 for response</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_static_arp_entries">13.2. Static ARP Entries</h3>
<div class="listingblock">
<div class="title">Task: Enable the Interface Encapsulation</div>
<div class="content">
<pre>(config-if)# arp {arpa | frame-relay | snap}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Define Static ARP Entries</div>
<div class="content">
<pre>(config)# arp &lt;ip-address&gt;  &lt;hardware-address&gt; &lt;encapsulation-type&gt; [&lt;interface-type&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Define Static ARP Entries for a Specific VRF</div>
<div class="content">
<pre># arp vrf &lt;name&gt;  &lt;hardware-address&gt; &lt;encapsulation-type&gt; [&lt;interface-type&gt;]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_arp_entries">13.3. Dynamic ARP Entries</h3>
<div class="ulist">
<ul>
<li>
<p>Stored in ARP cache</p>
</li>
<li>
<p>Timeout: 4 hours by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Clear the Entire ARP Cache on an Interface</div>
<div class="content">
<pre># clear arp interface &lt;type-number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Clear All Dynamic Entries from the ARP Cache, the Fast-Switchig Cache, and the IP Route Cache</div>
<div class="content">
<pre># clear arp-cache</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set an Expiration Time for Dynamic Entries In the Arp Cache</div>
<div class="content">
<pre>(config-if)# arp timeout &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the Arp Cache</div>
<div class="content">
<pre># show ip arp

Protocol    Address            Age (min)   Hardware Addr      Type    Interface
Internet    10.108.42.112      120         0000.a710.4baf     ARPA    Ethernet3
AppleTalk   4028.5             29          0000.0c01.0e56     SNAP    Ethernet2
Internet    110.108.42.114     105         0000.a710.859b     ARPA    Ethernet3
AppleTalk   4028.9             -           0000.0c02.a03c     SNAP    Ethernet2
Internet    10.108.42.121      42          0000.a710.68cd     ARPA    Ethernet3
Internet    10.108.33.9        -           0000.0c01.7bbd     SNAP    Fddi0</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display ARP and RARP Processes</div>
<div class="content">
<pre># sh processes cpu | include (ARP|PID)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_proxy_arp">13.4. Proxy ARP</h3>
<div class="ulist">
<ul>
<li>
<p>Same message as ARP</p>
</li>
<li>
<p>Allows response for IP address in remote subnet.</p>
</li>
<li>
<p>RFC 1027</p>
</li>
<li>
<p>Mostly replaced by DHCP nowadays</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Disable Proxy ARP Globally</div>
<div class="content">
<pre># ip arp proxy disable</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable Proxy ARP on an Interface</div>
<div class="content">
<pre>(config-if)# no ip proxy-arp</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>High CPU utilization in the ARP input process occurs if the router has to originate an excessive
number of ARP requests. The router uses ARP for all hosts, not just those on the local subnet,
and ARP requests are sent out as broadcasts, which causes more CPU utilization on every host
in the network. ARP requests for the same IP address are rate-limited to one request every two
seconds, so an excessive number of ARP requests would have to originate for different IP
addresses. This can happen if an IP route has been configured pointing to a broadcast interface
(as opposed to next-hop). A most common example is a default route such as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ip route 0.0.0.0 0.0.0.0 Fastethernet0/0</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the router generates an ARP request for each IP address that is not reachable
through more specific routes, which practically means that the router generates an ARP request
for almost every address on the Internet.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the router needs to route a packet which matches an entry in the routing
  table with a next-hop value, it performs Layer 3 to Layer 2 resolution for the
  next-hop address. If it matches an entry in the routing table with just the
  outgoing/exit local interface, without a next-hop value, it performs Layer 3 to
  Layer 2 resolution for the final destination of the IP packet.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_gratuitous_arp">13.5. Gratuitous ARP</h3>
<div class="ulist">
<ul>
<li>
<p>broadcast ARP messages where the SPA=TPA and THA=FF:FF:FF:FF:FF:FF</p>
<div class="ulist">
<ul>
<li>
<p>to detect IP address conflit</p>
</li>
<li>
<p>to update other machine ARP table</p>
</li>
<li>
<p>to update mac table of the connected switche</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If we see multiple gratitous ARPs from the same host frequently,
it can be an indication of bad Ethernet NICs
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rarp_and_bootp_as_dhcp_precursors">13.6. RARP and BootP As DHCP Precursors</h3>
<div class="imageblock">
<div class="content">
<img src="../images/rarp-bootp.png" alt="RARP and BootP before DHCP">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A RARP request is a host&#8217;s attempt to find its own IP address. So RARP uses the
same old ARP message, but the ARP request lists a MAC address target of its own
MAC address and a target IP address of 0.0.0.0. A preconfigured RARP server,
which must be on the same subnet as the client, receives the request and
performs a table lookup in its configuration. If that target MAC address listed
in the ARP request is configured on the RARP server, the RARP server sends an
ARP reply, after entering the configured IP address in the Source IP address
field.</p>
</li>
<li>
<p>BOOTP was defined in part to improve IP address assignment features of RARP.
BOOTP uses a completely different set of messages, defined by RFC 951, with the
commands encapsulated inside an IP and UDP header. With the correct router
configuration, a router can forward the BOOTP packets to other subnets—allowing
the deployment of a centrally located BOOTP server. Also, BOOTP supports the
assignment of many other tidbits of information, including the subnet mask,
default gateway, DNS addresses, and its namesake, the IP address of a boot (or
image) server. However, BOOTP does not solve the configuration burden of RARP,
still requiring that the server be preconfigured with the MAC addresses and IP
addresses of each client.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_arp_vulnerabilities">13.7. ARP vulnerabilities</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Since ARP does not authenticate requests or replies, ARP Requests and Replies can be forged</p>
</li>
<li>
<p>ARP is stateless: ARP Replies can be sent without a corresponding ARP Request</p>
</li>
<li>
<p>According to the ARP protocol specification, a node receiving an ARP
packet (Request or Reply) must update its local ARP cache with the
information in the source fields, if the receiving node already has an entry
for the IP address of the source in its ARP cache.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Typical exploitation of these vulnerabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ARP poisoning: a  forged ARP Request or Reply can be used to update the ARP cache of
a remote system with a forged entry</p>
</li>
<li>
<p>This can be used to redirect IP traffic to other hosts</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dhcp">14. DHCP</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration guides</span>&#160;&#9656; <span class="submenu">IP Addressing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipaddr_dhcp/configuration/15-mt/dhcp-15-mt-book/dhcp-overview.html">DHCP</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://tools.ietf.org/html/rfc2131">RFC 2131</a></p>
</li>
<li>
<p>Dynamic Host Configuration Protocol</p>
</li>
<li>
<p>Based on BOOTP (itself based on RARP)</p>
</li>
<li>
<p>Client/agent relay/server model</p>
</li>
<li>
<p>UDP port 67 (server), port 68 (client)</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/dhcp-request.png" alt="DHCP request for an IP address from a DHCP Server">
</div>
<div class="title">Figure 21. DHCP Request for an IP Address from a DHCP Server</div>
</div>
<div class="sect2">
<h3 id="_protocol_operations">14.1. Protocol Operations</h3>
<div class="imageblock">
<div class="content">
<img src="../images/dhcp.png" alt="DHCP" width="527" height="60">
</div>
<div class="title">Figure 22. DHCP</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/dhcp-message-format.png.png" alt="DHCP Message" width="896" height="440">
</div>
<div class="title">Figure 23. DHCP Message</div>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 9.5238%;">
<col style="width: 4.7619%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-center valign-top">Octets</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>op</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Message op code / message type.   1 = BOOTREQUEST, 2 = BOOTREPLY</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>htype</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Hardware address type for the local network, same value than ARP HRD field</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>hlen</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Hardware address length, same value than ARP HLN</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>hops</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Set to zero by clients, optionally incremented by 1 by each relay agent</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>xid</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Transaction ID, a random number chosen by the client, used by the client and server to match replies with requests</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>secs</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Filled in by client, seconds elapsed since client began address acquisition or renewal process. This may be used by a busy DHCP server to prioritize replies when multiple client requests are outstanding.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>flags</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Flags. Actually 1 B bit is used. if Broadcast flag set by a client, the server or relay knows that they should reply with a broadcast.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ciaddr</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Client IP address; only filled in if client is in BOUND, RENEW or REBINDING state and can respond to ARP requests. The client does not use this field to request a particular IP address in a lease; it uses the Requested IP Address DHCP option.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>yiaddr</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>'your' (client) IP address assigned by the DHCP server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>siaddr</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>IP address of next server to use in bootstrap returned in DHCPOFFER, DHCPACK by server which may not be the server sending this reply.
The sending server always includes its own IP address in the Server Identifier DHCP option.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>giaddr</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Relay agent IP address, used in booting via a relay agent.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>chaddr</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Client L2 hardware address.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>sname</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Optional server host name, null terminated string.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>file</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Boot file name, null terminated string; "generic" name or null in DHCPDISCOVER, fully qualified directory-path name in DHCPOFFER.
Optionally used by a client to request a particular type of boot file in a DHCPDISCOVER message.
Used by a server in a DHCPOFFER to fully specify a boot file directory path and filename.
This field may also be used to carry DHCP options, using the “option overload” feature, indicated by the value of the DHCP Option Overload option.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>options</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">var</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Optional parameters field.
The first four bytes contain the same BOOTP <strong>magic cookie</strong>  (decimal) values 99, 130, 83 and 99.
The remainder of the field consists of a list of tagged TLV options.</p>
</div>
<div class="ulist horizontal">
<div class="title">Commonly used options</div>
<ul class="horizontal">
<li>
<p>0 Pad</p>
</li>
<li>
<p>1 Subnet Mask</p>
</li>
<li>
<p>3 Router Address</p>
</li>
<li>
<p>6 Domain Name Server</p>
</li>
<li>
<p>15 Domain Name</p>
</li>
<li>
<p>50 Requested IP Address</p>
</li>
<li>
<p>51 Address Lease Time</p>
</li>
<li>
<p>52 Option Overload</p>
</li>
<li>
<p>53 DHCP Message Type</p>
</li>
<li>
<p>54 Server Identifier</p>
</li>
<li>
<p>55 Parameter Request List</p>
</li>
<li>
<p>56 DHCP Error Message</p>
</li>
<li>
<p>58 Lease Renewal Time</p>
</li>
<li>
<p>59 Lease Rebinding Time</p>
</li>
<li>
<p>61 Client Identifier</p>
</li>
<li>
<p>82 DHCP Relay</p>
</li>
<li>
<p>119 Domain Search List</p>
</li>
<li>
<p>255 End</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The DHCP Message Type option (53) is a 1-byte-long option that is always used with DHCP messages
and has the following possible values: DHCPDISCOVER (1), DHCPOFFER (2), DHCPREQUEST (3),
DHCPDECLINE (4), DHCPACK (5), DHCPNAK (6), DHCPRELEASE (7), DHCPINFORM (8),
DHCPFORCERENEW (9), DHCPLEASEQUERY (10), DHCPLEASEUNASSIGNED (11),
DHCPLEASEUNKNOWN (12), and DHCPLEASEACTIVE (13).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dhcp_client">14.2. DHCP Client</h3>
<div class="imageblock">
<div class="content">
<img src="../images/diag-e88058f85bb0ce078fafbb296e441e93.png" alt="DHCP Client State Machine" width="2107" height="205">
</div>
<div class="title">Figure 24. DHCP Client State Machine</div>
</div>
<div class="listingblock">
<div class="title">Task: Acquire an IP Address on an Interface from DHCP</div>
<div class="content">
<pre>(config-if)# ip address dhcp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the DHCP Packets Sent and Received During Troubleshooting on the Client Side</div>
<div class="content">
<pre># debug dhcp detail</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Force a Release Of a DHCP Lease</div>
<div class="content">
<pre># release dhcp</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>release dhcp</strong> command</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Starts the process to immediately release a DHCP lease for the specified interface.</p>
</li>
<li>
<p>Does not deconfigure the <strong>ip address dhcp</strong> command specified in the configuration file for the interface.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Force a Renewal Of a DHCP Lease</div>
<div class="content">
<pre># renew dhcp</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <strong>renew dhcp</strong> command advances the DHCP lease timer to the next stage,
at which point one of the following occurs:</p>
<div class="ulist">
<ul>
<li>
<p>If the lease is currently in a BOUND state, the lease is advanced to the RENEW state and a DHCP RENEW request is sent.</p>
</li>
<li>
<p>If the lease is currently in a RENEW state, the timer is advanced to the REBIND state and a DHCP REBIND request is sent.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If there is no response to the RENEW request,
the interface remains in the RENEW state.
In this case, the lease timer will advance to the REBIND state and subsequently send a REBIND request.</p>
</li>
<li>
<p>If a NAK response is sent in response to the RENEW request, the interface is deconfigured.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configurable_dhcp_client_feature">14.2.1. Configurable DHCP Client Feature</h4>
<div class="ulist">
<ul>
<li>
<p>Allows a client to use a user-specified client identifier, class identifier or suggested lease time when requesting an address from a DHCP server.</p>
</li>
<li>
<p>Options available:</p>
<div class="ulist">
<ul>
<li>
<p>Option 33: configure a list of static routes in the client.</p>
</li>
<li>
<p>Option 51: request a lease time for the IP address.</p>
</li>
<li>
<p>Option 55: request certain options from the DHCP server</p>
</li>
<li>
<p>Option 60: configure the vendor class identifier string to use in the DHCP interaction.</p>
</li>
<li>
<p>Option 61: specify their unique identifier</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_forcerenew_message_handling">14.2.2. FORCERENEW Message Handling</h4>
<div class="paragraph">
<p>TODO: Explain the feature</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure FORCERENEW Message Handling</div>
<div class="content">
<pre>! Specify the key chain to be used in authenticating a request
(config)# key chain &lt;name&gt;
(config-keychain)# key &lt;id&gt;
(config-keychain-key)# key-string &lt;text&gt;
!
! Specify the type of authentication
(config)# interface &lt;type number&gt;
(config-if)# ip dhcp client authentication key-chain &lt;name&gt;
(config-if)# ip dhcp client authentication mode &lt;type&gt;
!
# ip dhcp-client forcerenew</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dhcp_server">14.3. DHCP Server</h3>
<div class="ulist">
<ul>
<li>
<p>Accepts address assignment requests and renewals from clients</p>
</li>
<li>
<p>Assign address, name server, gateways, &#8230;&#8203;</p>
</li>
<li>
<p>Accepts broadcasts from local clients or relay agents</p>
</li>
<li>
<p>Database as a tree used for attribute inheritance</p>
<div class="ulist">
<ul>
<li>
<p>Root: address pool for natural networks</p>
</li>
<li>
<p>Branches: subnetwork address pools</p>
</li>
<li>
<p>Leaves: manual bindings</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Clear DHCP Server Variables</div>
<div class="content">
<pre>clear ip dhcp binding { &lt;address&gt; | * }
clear ip dhcp conflict { &lt;address&gt; | * }
clear ip dhcp server statistics</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Troubleshoot DHCP IP Address Assignments, Lease Expirations, and Database Chnages</div>
<div class="content">
<pre># debug ip dhcp server events</pre>
</div>
</div>
<div class="sect3">
<h4 id="_database_agent">14.3.1. Database Agent</h4>
<div class="ulist">
<ul>
<li>
<p>Host (ftp, tftp, rcp) or storage that stores the DHCP bindings database.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Save Automatic Bindings on a Remote Host</div>
<div class="content">
<pre>ip dhcp database &lt;url&gt; [timeout &lt;seconds&gt;] [ write-delay &lt;seconds&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><strong>url</strong>: can be ftp,tftp, rcp, flash, disk</p>
</li>
<li>
<p><strong>timeout</strong>: how long the DHCP server wait before aborting database transfer. default: 5 minutes</p>
</li>
<li>
<p><strong>write-delay</strong>: how soon the DHCP server should send database updates. default:  5 minutes, minimum: 60 seconds</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Run DHCP Server Without Database Agent</div>
<div class="content">
<pre>(config)# no ip dhcp conflict logging</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Not recommended</p>
</li>
<li>
<p>TODO: add the reason</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_address_pool">14.3.2. Address Pool</h4>
<div class="ulist">
<ul>
<li>
<p>Specify which DHCP options to use for the client</p>
<div class="ulist">
<ul>
<li>
<p>If the client is not directly connected to the DHCP server (the giaddr field of the DHCPDISCOVER broadcast message is nonzero), the server matches the DHCPDISCOVER with the DHCP pool that has the subnet that contains the IP address in the giaddr field.</p>
</li>
<li>
<p>If the client is directly connected to the DHCP server (the giaddr field is zero), the DHCP server matches the DHCPDISCOVER with DHCP pools that contain the subnets configured on the receiving interface. If the interface has secondary IP addresses, subnets associated with the secondary IP addresses are examined for possible allocation only after the subnet associated with the primary IP address (on the interface) is exhausted.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Create a Pool</div>
<div class="content">
<pre>(config)# ip dhcp pool &lt;name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Subnet Network Number and Mask Of the Address Pool</div>
<div class="content">
<pre>(dhcp-config)# network &lt;network-number&gt; [mask | prefix-length]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Secondary Subnets</div>
<div class="content">
<pre>(dhcp-config)# network &lt;network-number&gt; [mask | prefix-length] secondary</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Exclude IP Address</div>
<div class="content">
<pre>(config)# ip dhcp excluded-address &lt;low-address&gt; [&lt;high-address&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Domain Name</div>
<div class="content">
<pre>(dhcp-config)# domain-name &lt;example.com&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Name Server Per Order Of Preference</div>
<div class="content">
<pre>(dhcp-config)# dns-server &lt;address&gt; [&lt;address2&gt; ... &lt;address8&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Default Boot Image for a Client</div>
<div class="content">
<pre>(dhcp-config)# bootfile &lt;filename&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Netbios Server</div>
<div class="content">
<pre>(dhcp-config)# netbios-name-server &lt;address&gt; [&lt;address2&gt; ... &lt;address8&gt;]
(dhcp-config)# netbios-node-type &lt;type&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Gateway</div>
<div class="content">
<pre>(dhcp-config)# default-router  &lt;address&gt; [&lt;address2&gt; ... &lt;address8&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify  a Custom DHCP Code</div>
<div class="content">
<pre>(dhcp-config)# option &lt;code&gt; [instance &lt;number&gt;] {ascii &lt;string&gt; | hex &lt;string&gt; | &lt;ip-address&gt;}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Duration Of the Lease</div>
<div class="content">
<pre>(dhcp-config)# lease &lt;days&gt; [&lt;hours&gt; [&lt;minutes&gt;] ]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Lease for Ever</div>
<div class="content">
<pre>(dhcp-config)# lease infinite</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The DHCPOFFER message includes the lease time (T), which provides
the upper bound on the amount of time the address can be used if it is not renewed. The message also
contains the renewal time (T1), which is the amount of time before the client should attempt to renew its
lease with the server from which it acquired its lease, and the rebinding time (T2), which bounds the time
in which it should attempt to renew its address with any DHCP server. By default, T1 = (T/2) and T2 =
(7T/8).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Utilization Mark Of the Current Address Pool Size</div>
<div class="content">
<pre>(dhcp-config)# utilization mark high &lt;percentage-number&gt; [log]
(dhcp-config)# utilization mark low &lt;percentage-number&gt; [log]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a DHCP Address Pool with Secondary Subnets</div>
<div class="content">
<pre>(dhcp-config)# override default-router ??
(dhcp-config)# override utilization high &lt;percentage&gt;
(dhcp-config)# override utilization low &lt;percentage&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>TODO: add explanation</p>
</div>
<div class="listingblock">
<div class="title">Task: Verify the DHCP Address Pool Configuration</div>
<div class="content">
<pre># show ip dhcp pool [name]
# show ip dhcp binding [address]
# show ip dhcp conflict [name]
# show ip dhcp database [url]
# show ip dhcp server statistics [type-number]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_address_bindings">14.3.3. Address Bindings</h4>
<div class="ulist">
<ul>
<li>
<p>Mapping between the IP address and MAC address of a client</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display the Current Mapping</div>
<div class="content">
<pre># show ip dhcp binding</pre>
</div>
</div>
<div class="sect4">
<h5 id="_automatic_bindings">Automatic Bindings</h5>
<div class="ulist">
<ul>
<li>
<p>Dynamically maps hardware address to an IP address from a pool.</p>
</li>
<li>
<p>Stored in volatile RAM and periodically copied to database agent</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_manual_binding">Manual Binding</h5>
<div class="ulist">
<ul>
<li>
<p>MAC address of hosts are found in the DHCP database</p>
</li>
<li>
<p>Stored in NVRAM</p>
</li>
<li>
<p>Can be configured</p>
<div class="ulist">
<ul>
<li>
<p>Individually and stored in NVRAM</p>
</li>
<li>
<p>In batch from text files</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify the IP Address and Subnet Mask Of the Client</div>
<div class="content">
<pre>(dhcp-config)# host &lt;address&gt; [&lt;mask&gt;| &lt;/prefix-length]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Unique Identifier for a DHCP Client</div>
<div class="content">
<pre>(dhcp-config)# client-identifier &lt;unique-identifier&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Send with DHCP option 61</p>
</li>
<li>
<p>Unique identifier</p>
<div class="ulist">
<ul>
<li>
<p>7-byte: 1byte for the media , 6 byte for the MAC address</p>
</li>
<li>
<p>27-byte: vendor, MAC address, source interface of the client</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Determine the Client Identifier</div>
<div class="content">
<pre># debug ip dhcp server packet

DHCPD:DHCPDISCOVER received from client 0b07.1134.a029 through relay 10.1.0.253.
DHCPD:assigned IP address 10.1.0.3 to client 0b07.1134.a029.</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task:</div>
<div class="content">
<pre>(dhcp-config)# hardware-address &lt;hw-address&gt; [&lt;protocol-type&gt; | &lt;hw-number&gt;]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>For client who can not send a client identifier in the packet</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task:</div>
<div class="content">
<pre>(dhcp-config)# client-name &lt;name&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not include the domain name</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_static_mapping">14.3.4. Static Mapping</h4>
<div class="ulist">
<ul>
<li>
<p>From customer-created text file that DHCP server reads at boot</p>
<div class="ulist">
<ul>
<li>
<p>Short configuration: no need for several numerous host pools with manual bindings</p>
</li>
<li>
<p>Reduce space required in NVRAM to maintain address pools</p>
</li>
</ul>
</div>
</li>
<li>
<p>The file format has the following elements:</p>
<div class="ulist">
<ul>
<li>
<p>Database version number</p>
</li>
<li>
<p>End-of-file designator</p>
</li>
<li>
<p>Hardware type</p>
</li>
<li>
<p>Hardware address</p>
</li>
<li>
<p>IP address</p>
</li>
<li>
<p>Lease expiration</p>
</li>
<li>
<p>Time the file was created</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>*time* Jan 21 2005 03:52 PM
*version* 2
!IP address    Type    Hardware address     Lease expiration
10.0.0.4 /24   1       0090.bff6.081e       Infinite
10.0.0.5 /28   id      00b7.0813.88f1.66    Infinite
10.0.0.2 /21   1       0090.bff6.081d       Infinite
*end*</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the DHCP Server to Read a Static Mapping Text File</div>
<div class="content">
<pre>(dhcp-config)# origin file &lt;url&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pings">14.3.5. Pings</h4>
<div class="ulist">
<ul>
<li>
<p>DHCP server pings an IP address twice before assigning it to a client.</p>
</li>
<li>
<p>If the ping is unanswered after waiting for 2 seconds, the server assumes that the address is not in use.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Number Of Packets Sent to a Pool Address Before Assigning It to a Client</div>
<div class="content">
<pre>(config)# ip dhcp ping packets &lt;number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify How Long a DHCP Server Waits for a Ping Reply from an Address Pool</div>
<div class="content">
<pre>(config)# ip dhcp ping timeout &lt;milliseconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bootp_interoperability">14.3.6. BOOTP Interoperability</h4>
<div class="listingblock">
<div class="title">Task: Configure the DHCP Server to Not Reply to Any BOOTP Requests.</div>
<div class="content">
<pre>(config)# ip dhcp boot ignore</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Forward Ignored BOOTP Request Packets to Another DHCP Server</div>
<div class="content">
<pre>(config)# ip helper-address &lt;a.b.c.d&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_central_dhcp_server">14.3.7. Central DHCP Server</h4>
<div class="ulist">
<ul>
<li>
<p>Updates specific DHCP options for remote DHCP server</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Import DHCP Option Parameters from Central DHCP Server</div>
<div class="content">
<pre>(dhcp-config)# import all
(config)# interface &lt;type&gt; &lt;number&gt;
(config-if)# ip address dhcp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the Options That Are Imported from the Central DHCP Server</div>
<div class="content">
<pre># sh ip dhcp import</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_option_82">14.3.8. Option 82</h4>
<div class="ulist">
<ul>
<li>
<p>DHCP option contains information known by the relay agent</p>
</li>
<li>
<p>For dynamic IP addresses allocation</p>
</li>
<li>
<p>TOBECOMPLETED</p>
</li>
<li>
<p>By default, OS DHCP server uses info provided by option 82</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable DHCP Address Allocation with Option 82</div>
<div class="content">
<pre>(config)# ip dhcp use class</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Define a DHCP Class and Relay Agent Information Patterns</div>
<div class="content">
<pre>(config)# ip dhcp class &lt;name&gt;
(dhcp-class)# relay agent information
(dhcp-class-info)# relay-information hex &lt;pattern&gt; [*] [bitmask &lt;mask&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display DHCP Class Matching Results</div>
<div class="content">
<pre># debug ip dhcp server class</pre>
</div>
</div>
<div class="sect4">
<h5 id="_static_route_with_the_next_hop_dynamically_obtained_through_dhcp">Static Route with the Next-Hop Dynamically Obtained Through DHCP</h5>
<div class="paragraph">
<p>TODO: explanation/context</p>
</div>
<div class="listingblock">
<div class="title">Task: Assign a Static Route for the Default Next-Hop Device When the DHCP Server Is Accessed for an IP Address</div>
<div class="content">
<pre># ip route &lt;prefix&gt; &lt;mask&gt; {&lt;ip-address&gt; | &lt;interface-number&gt; [&lt;ip-number&gt;]} dhcp [&lt;distance&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Ensure that the DHCP client and server are defined to supply a DHCP device option 3 of the DHCP packet.</p>
</li>
<li>
<p>If the DHCP client is not able to obtain an IP address or the default device IP address, the static route is not installed in the routing table.</p>
</li>
<li>
<p>If the lease has expired and the DHCP client cannot renew the address, the DHCP IP address assigned to the client is released and any associated static routes are removed from the routing table.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_statistics">14.3.9. Statistics</h4>
<div class="listingblock">
<div class="title">Task: Display Server Statistics</div>
<div class="content">
<pre># show ip dhcp server statistics</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Reset All DHCP Server Counters to 0</div>
<div class="content">
<pre># clear ip dhcp server statistics</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dhcp_relay_agent">14.4. DHCP Relay Agent</h3>
<div class="ulist">
<ul>
<li>
<p>Forwards requests and replies between clients and servers not on the same physical subnet</p>
</li>
<li>
<p>Sets the <strong>giaddr</strong> field and adds option 82</p>
</li>
<li>
<p>DHCP server and relay agent are enabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Packet Forwarding Address</div>
<div class="content">
<pre>(config-if)# ip helper-address &lt;a.b.c.d&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Reduce the Frequency with Which DHCP Clients Change Their Addresses and Forwards Client Requests to the Server That Handle the Previous Request.</div>
<div class="content">
<pre>(config-if)# ip dhcp relay prefer known-good-server</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The relay agent deletes the ARP entries for addresses offered to the client
on unnumbered interfaces.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Disable the DHCP Relay Agent Service</div>
<div class="content">
<pre># no service dhcp</pre>
</div>
</div>
<div class="sect3">
<h4 id="_option_82_2">14.4.1. Option 82</h4>
<div class="imageblock">
<div class="content">
<img src="../images/dhcp-relay-agent-option-82.png" alt="dhcp relay agent option 82">
</div>
</div>
<div class="listingblock">
<div class="title">Task: Insert the DHCP Relay Agent Information Option In BOOTREQUEST Messages Forwarded to a DHCP Server</div>
<div class="content">
<pre># ip dhcp relay information option</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>This function is disabled by default</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Check Whethers the Relay Agent Information Option Forwarded BOOTREPLY Message Is Valid</div>
<div class="content">
<pre># ip dhcp relay information check</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Reforwarding Policy</div>
<div class="content">
<pre># ip dhcp relay information policy {drop | keep | replace }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure All Interfaces As Trusted Sources Of the DHCP Relay Information Option.</div>
<div class="content">
<pre># ip dhcp relay information trust-all</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure an Interface As Trusted Sources Of the DHCP Relay Information Option.</div>
<div class="content">
<pre>(config-if)# ip dhcp relay information trusted</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display All Interfaces That Are Configure to Be a Trusted Source for the DHCP Relay Information Option.</div>
<div class="content">
<pre># show ip dhcp relay information trusted-sources</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure Per-Interface Support for the Relay Agent Information Option</div>
<div class="content">
<pre>(config-if)# ip dhcp relay information option-insert [none]
(config-if)# ip dhcp relay information check-reply [none]
(config-if)# ip dhcp relay information policy-action {drop | keep | replace}</pre>
</div>
</div>
<div class="paragraph">
<p>See more optional tasks
<a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipaddr_dhcp/configuration/15-mt/dhcp-15-mt-book/config-dhcp-relay-agent.html#GUID-B4DA9D20-F7A3-44BC-8019-D120136458DC">here</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_accounting_and_security">14.5. Accounting and Security</h3>
<div class="ulist">
<ul>
<li>
<p>Address vulnerability in PWLAN</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_dhcp_accounting">14.5.1. DHCP Accounting</h4>
<div class="ulist">
<ul>
<li>
<p>add AAA and RADIUS support to DHCP configuration</p>
</li>
<li>
<p>sends secure START/STOP accounting messages upon lease assignment/termination</p>
</li>
<li>
<p>Restrictions:</p>
<div class="ulist">
<ul>
<li>
<p>AAA and RADIUS must be enabled</p>
</li>
<li>
<p>only for network pools with automatic bindings</p>
</li>
<li>
<p><strong>clear ip dhcp binding</strong> or <strong>no service dhcp</strong> triggers accounting STOP messages</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable DHCP Accounting If a Specifier Server Group Is Configured to Run RADIUS Accounting</div>
<div class="content">
<pre>(dhcp-config)# accounting &lt;method-list-name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Troubleshoot DHCP Accounting</div>
<div class="content">
<pre>debug radius accounting
debug ip dhcp server events
debug aaa accounting
debug aaa id</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dhcp_secured_ip_address_assignment">14.5.2. DHCP Secured IP Address Assignment</h4>
<div class="ulist">
<ul>
<li>
<p>Secures and synchronizes the MAC address of the client to the DHCP binding,
preventing hackers form spoofing the DHCP server and taking over a DHCP lease of an authorized client</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Secure ARP Table Entries to DHCP Leases In the DHCP Database</div>
<div class="content">
<pre>(dhcp-config)# update arp</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Existing active DHCP leases will not be secured until they are renewed.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Renewal Policy for Unknown Clients</div>
<div class="content">
<pre>(dhcp-config)# renew deny unknown</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>In some usage scenarios, such as a wireless hotspot,
where both DHCP and secure ARP are configured, a
connected client device might go to sleep or suspend for
a period of time. If the suspended time period is
greater than the secure ARP timeout (default of 91
seconds), but less than the DHCP lease time, the client
can awake with a valid lease, but the secure ARP timeout
has caused the lease binding to be removed because the
client has been inactive. When the client awakes, the
client still has a lease on the client side but is
blocked from sending traffic. The client will try to
renew its IP address but the DHCP server will ignore the
request because the DHCP server has no lease for the
client. The client must wait for the lease to expire
before being able to recover and send traffic again.</p>
</li>
<li>
<p>To remedy this situation, use the <strong>renew deny unknown</strong>
command in DHCP pool configuration mode. This command
forces the DHCP server to reject renewal requests from
clients if the requested address is present at the
server but is not leased. The DHCP server sends a
DHCPNAK denial message to the client, which forces the
client back to its initial state. The client can then
negotiate for a new lease immediately, instead of
waiting for its old lease to expire.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dhcp_per_interface_lease_limit_and_statistics">14.5.3. DHCP Per Interface Lease Limit and Statistics</h4>
<div class="ulist">
<ul>
<li>
<p>Allows an ISP to limit the number of DHCP leases allowed on an interface.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a DHCP Lease Limit to Control the Number Of Subscribers on an Interface</div>
<div class="content">
<pre>(config)#  ip dhcp limit lease log
(config-if)# ip dhcp limit lease &lt;max-users&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the DHCP Lease Limit Configuration</div>
<div class="content">
<pre># show ip dhcp limit lease</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Clear the Stored Lease Violation Entries</div>
<div class="content">
<pre># clear ip dhcp limit lease</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dhcp_authorized_arp">14.5.4. DHCP Authorized ARP</h4>
<div class="listingblock">
<div class="title">Task: Disable Dynamic ARP Learning on an Interface</div>
<div class="content">
<pre>(config-if)# arp authorized</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure How Long an Entry Remains In the ARP Cache</div>
<div class="content">
<pre>(config-if)# arp timeoute &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task:</div>
<div class="content">
<pre># show arp</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arp_auto_logoff">14.5.5. ARP Auto-Logoff</h4>
<div class="ulist">
<ul>
<li>
<p>enhances DHCP authorized ARP by providing finer control and probing authorized clients to detect a logoff.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure an Interval and Number Of Probe Retries for ARP</div>
<div class="content">
<pre>(config-if)# arp probe interval &lt;seconds&gt; count &lt;number&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dhcp_snooping">14.6. DHCP Snooping</h3>
<div class="ulist">
<ul>
<li>
<p>Prevent rogue DHCP servers from answering before the real DHCP server(s).
Rogue DHCP servers would likely be interested in handing out a malicious default gateway that could intercept information before handing it off to the real default gateway.</p>
</li>
<li>
<p>Prevent a malicious "client" from requesting hundreds of addresses and using up the entire pool; a DOS-style attack, where new clients would be unable to get an address.</p>
</li>
<li>
<p>IP Source Guard (discussed later)</p>
</li>
<li>
<p>Dynamic ARP Inspection (discussed later)</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">TODO</div>
<p>add information about option 82</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nat">15. NAT</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">IP Addressing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipaddr_nat/configuration/15-mt/nat-15-mt-book/iadnat-addr-consv.html#GUID-C79465FE-A23C-4341-88DC-E43E342D4977">NAT</span></span> </a></p>
</li>
<li>
<p><a href="https://www.ietf.org/rfc/rfc1631.txt">RFC 1631</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_purpose">15.1. Purpose</h3>
<div class="ulist">
<ul>
<li>
<p>IPv4 address conservation</p>
</li>
<li>
<p>can be static, dynamic or pat</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_inside_and_outside_address">15.2. Inside and Outside Address</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Inside local address
</td>
<td class="hdlist2">
<p>The (private) IP address that is assigned to a host on the inside network.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Inside global address
</td>
<td class="hdlist2">
<p>A (public) IP address that represents one or more inside local IP addresses to the outside world.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Outside local address
</td>
<td class="hdlist2">
<p>The (private) IP address of an outside host as it appears to the inside network.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Outside global address
</td>
<td class="hdlist2">
<p>The (public) IP address assigned to a host on the outside network by the owner of the host.</p>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Display NAT Translation Information</div>
<div class="content">
<pre>show ip nat translations [verbose]
show ip nat statistics</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_static_nat">15.3. Static NAT</h3>
<div class="ulist">
<ul>
<li>
<p>Statically correlates the same local host to the same public IP address.</p>
</li>
<li>
<p>Does not conserve IP addresses.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Static Translation Of Inside Source Address</div>
<div class="content">
<pre>conf t
ip nat inside source static &lt;local-ip&gt; &lt;global-ip&gt;

interface &lt;type number&gt;
  ip address &lt;ip-address&gt; &lt;mask&gt; [secondary]
  ip nat inside

interface type number
  ip address &lt;ip-address&gt; &lt;mask&gt;
  ip nat outside</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_nat_without_pat">15.4. Dynamic NAT Without PAT</h3>
<div class="ulist">
<ul>
<li>
<p>One local host uses an available public IP address in a pool.</p>
</li>
<li>
<p>Does not conserve IP addresses.</p>
</li>
<li>
<p>Timeout after period of nonuse</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Dynamic Translation Of Inside Source Address</div>
<div class="content">
<pre>ip nat pool &lt;name&gt; &lt;start-ip&gt; &lt;end-ip&gt; {netmask &lt;mask&gt; | prefix-length &lt;length&gt;}
access-list &lt;acl&gt; permit source [&lt;w.i.l.d&gt;]
ip nat inside source list &lt;acl&gt; pool &lt;name&gt;

interface &lt;type number&gt;
  ip address &lt;ip-address&gt; &lt;mask&gt;
  ip nat inside

interface &lt;type number&gt;
  ip address &lt;ip-address&gt; &lt;mask&gt;
  ip nat outside</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Change Timeouts Value</div>
<div class="content">
<pre>ip nat translation &lt;seconds&gt;
ip nat translation udp-timeout &lt;seconds&gt;
ip nat translation dns-timeout &lt;seconds&gt;
ip nat translation tcp-timeout &lt;seconds&gt;
ip nat translation finrst-timeout &lt;seconds&gt;
ip nat translation icmp-timeout &lt;seconds&gt;
ip nat translation syn-timeout &lt;seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pat">15.5. PAT</h3>
<div class="ulist">
<ul>
<li>
<p>Like dynamic NAT but multiple local hosts share a single public address by multiplexing TCP/UDP ports.</p>
</li>
<li>
<p>Conserves IP addresses.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_nat_for_overlapping_address">15.6. NAT for Overlapping Address</h3>
<div class="ulist">
<ul>
<li>
<p>Can be done with any of the first three types.</p>
</li>
<li>
<p>Translates both source and destination addresses, instead of just the source (for packets going from
enterprise to the Internet).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_tcp_load_distribution_for_nat">15.7. TCP Load Distribution for NAT</h3>
<div class="ulist">
<ul>
<li>
<p>Round-robin allocation of a virtual host that coordinates load sharing among real hosts.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/nat-tcp-load-distribution.png" alt="nat tcp load distribution">
</div>
<div class="title">Figure 25. NAT TCP Load Distribution</div>
</div>
<div class="listingblock">
<div class="title">Task: Allow Internal Users Access to the Internet</div>
<div class="content">
<pre>ip nat pool &lt;name&gt; &lt;start-ip&gt; &lt;end-ip&gt; {netmask netmask | prefix-length prefix-length}
access-list number permit a.b.c.d [e.f.g.h]
ip nat inside source list number pool name overload

interface type number
  ip address ip-address mask
  ip nat inside

interface type number
  ip address ip-address mask
  ip nat outside
end</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_overlapping_networks">15.8. Overlapping Networks</h3>
<div class="paragraph">
<p>Configure dynamic translation of overlapping networks if your IP addresses in the stub network are
legitimate IP addresses belonging to another network and you want to communicate with those hosts or
routers using dynamic translation.</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure Overlapping Network</div>
<div class="content">
<pre>ip nat pool name start-ip end-ip {netmask netmask | prefix-length prefix-length}
access-list access-list-number permit source [source-wildcard]
ip nat outside source list access-list-number pool name

interface type number
  ip address ip-address mask
  ip nat inside

interface type number
  ip address ip-address mask
  ip nat outside</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server_tcp_load_balancing">15.9. Server TCP Load Balancing</h3>
<div class="listingblock">
<div class="content">
<pre>ip nat pool name start-ip end-ip {netmask netmask | prefix-length prefix-length} type rotary
access-list access-list-number permit source [source-wildcard]
ip nat inside destination-list access-list-number pool name

interface type number
  ip address ip-address mask
  ip nat inside

interface type number
  ip address ip-address mask
  ip nat outside</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Clear NAT Entries Before the Timeout</div>
<div class="content">
<pre>clear ip nat translation inside global-ip local-ip outside local-ip global-ip
clear ip nat translation outside global-ip local-i p
clear ip nat translation protocol inside global-ip global-port local-ip local-port outside local-ip local-port-global-ip global-port
clear ip nat translation {* | [forced] | [inside global-ip local-ip] [outside local-ip global-ip]}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable Syslog for Logging NAT Translations</div>
<div class="content">
<pre>ip nat log translations syslog
no logging console</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nat_order_of_operations">15.10. NAT Order Of Operations</h3>
<div class="sect3">
<h4 id="_inside_to_outside">15.10.1. Inside-to-Outside</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If IPSec Then Check Input Access List</p>
</li>
<li>
<p>Decryption - for CET (Cisco Encryption Technology) or IPSec</p>
</li>
<li>
<p>Check Input Access List</p>
</li>
<li>
<p>Check Input Rate Limits</p>
</li>
<li>
<p>Input Accounting</p>
</li>
<li>
<p>Redirect to Web Cache</p>
</li>
<li>
<p>Policy Routing</p>
</li>
<li>
<p>Routing</p>
</li>
<li>
<p>NAT Inside to Outside (Local to Global Translation)</p>
</li>
<li>
<p>Crypto (Check Map and Mark for Encryption)</p>
</li>
<li>
<p>Check Output Access List</p>
</li>
<li>
<p>Inspect (Context-Based Access Control (CBAC))</p>
</li>
<li>
<p>TCP Intercept</p>
</li>
<li>
<p>Encryption</p>
</li>
<li>
<p>Queueing</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_outside_to_inside">15.10.2. Outside-to-Inside</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If IPSec Then Check Input Access List</p>
</li>
<li>
<p>Decryption - for CET or IPSec</p>
</li>
<li>
<p>Check Input Access List</p>
</li>
<li>
<p>Check Input Rate Limits</p>
</li>
<li>
<p>Input Accounting</p>
</li>
<li>
<p>Redirect to Web Cache</p>
</li>
<li>
<p>NAT Outside to Inside (Global to Local Translation)</p>
</li>
<li>
<p>Policy Routing</p>
</li>
<li>
<p>Routing</p>
</li>
<li>
<p>Crypto (Check Map and Mark for Encryption)</p>
</li>
<li>
<p>Check Output Access List</p>
</li>
<li>
<p>Inspect CBAC</p>
</li>
<li>
<p>TCP Intercept</p>
</li>
<li>
<p>Encryption</p>
</li>
<li>
<p>Queueing</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Read more:
<a href="http://www.cisco.com/c/en/us/support/docs/ip/network-address-translation-nat/6209-5.html#topic1NAT">Order of operations</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nhrp">16. NHRP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TIP:
if dmvpn phase 3, the tunnel key must be the same as the tunnel key ???</p>
</div>
<div class="listingblock">
<div class="content">
<pre>!! DMVPN HUB
int f0/0.123
	enc dot1q 123
	ip address 10.0.0.1 255.255.255.0
	no shut
int t123
  ip add 129.99.123.1 255.255.255.0
  tunnel source f0/0.123
  tunnel mode gre multipoint
  tunnel key 123
  ip nhrp network-id 123
  ip nhrp map multicast dynamic
  ip nhrp network-id 321

!! DMVPN SPOKE
int f0/0.123
	desc ospf
	enc dot1q 123
	ip address 10.0.0.2 255.255.255.0
int t123
  ip add 129.99.123.2 255.255.255.0
  tunnel source f0/0.123
  tunnel destination 10.0.0.1
  tunnel key 123
  ip nhrp network-id 123
  ip nhrp nhs 129.99.123.1
  ip nhrp map multicast 10.0.0.1
  ip nhrp map 129.99.123.1 10.0.0.1</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify That NHRP Registration Has Been Sent from Spokes to the Hub</div>
<div class="content">
<pre>R1#sh ip nhrp

129.99.123.2/32 via 129.99.123.2
   Tunnel123 created 00:08:18, expire 01:54:55
   Type: dynamic, Flags: unique registered
   NBMA address: 10.0.0.2
129.99.123.3/32 via 129.99.123.3
   Tunnel123 created 00:09:22, expire 01:54:57
   Type: dynamic, Flags: unique registered
   NBMA address: 10.0.0.3</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Troubleshoot nhrp</div>
<div class="content">
<pre># debug nhrp</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ipv6">17. IPv6</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">IP</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipv6/configuration/15-2mt/ip6-15-2mt-book.html">IPv6</span></span> </a></p>
</div>
<div class="sect2">
<h3 id="_ipv6_header">17.1. IPv6 Header</h3>
<div class="imageblock">
<div class="content">
<img src="../images/ipv6-header-format.png" alt="IPv6 Base Header Format" width="896" height="248">
</div>
<div class="title">Figure 26. IPv6 Base Header Format</div>
</div>
<div class="dlist">
<div class="title">Comparison with IPv4</div>
<dl>
<dt class="hdlist1">Streamlined</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Fixed length header + optional extension header</p>
</li>
<li>
<p>Fragmentation fields moved out of base header</p>
</li>
<li>
<p>IP options moved out of base header</p>
</li>
<li>
<p>Header checksum eliminated</p>
</li>
<li>
<p>Header length field eliminated</p>
</li>
<li>
<p>Length field excludes IPv6 header</p>
</li>
<li>
<p>Alignment changed from 32 to 64 bits</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Revised</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Time to live &#8594; hop limit</p>
</li>
<li>
<p>Protocol &#8594; next header</p>
</li>
<li>
<p>Precedence and TOS &#8594; traffic class</p>
</li>
<li>
<p>Addresses increased 32 bits &#8594; 128 bits</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Extended</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Flow label field added</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_traffic_class">17.2. Traffic Class</h3>
<div class="ulist">
<ul>
<li>
<p>6 bits for ToS</p>
</li>
<li>
<p>2 bits for ECN</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_flow_label">17.3. Flow Label</h3>
<div class="ulist">
<ul>
<li>
<p>Sequence in a particular flow</p>
</li>
<li>
<p>Originally created for giving real-time applications special service.</p>
</li>
<li>
<p>when set to a non-zero value now serves as a hint to routers and
switches with multiple outbound paths that these packets should stay on the
same path so that they will not be reordered.</p>
</li>
<li>
<p>may be used to help detect spoofed packets</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_payload_length">17.4. Payload Length</h3>
<div class="ulist">
<ul>
<li>
<p>Size in bytes of the payload including any extensionn header</p>
</li>
<li>
<p>Set to zero when a <strong>Hop-by-Hop</strong> extension header carries a <strong>Jumbo Payload</strong> option.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO jumbo-grams</p>
</div>
</div>
<div class="sect2">
<h3 id="_next_header">17.5. Next Header</h3>
<div class="ulist">
<ul>
<li>
<p>Specifies the type of the next header.</p>
</li>
<li>
<p>usually specifies the transport layer protocol used by a packet&#8217;s payload.</p>
</li>
<li>
<p>When extension headers are present in the packet this field indicates which extension header follows.</p>
</li>
<li>
<p>The values are shared with those used for the IPv4 protocol field</p>
</li>
<li>
<p>Extension headers only examined at the destination, except for the 'hop-by-hop options'.</p>
</li>
<li>
<p>If a node does not recognize a specific extension header, it should discard the
packet and send a Parameter Problem message (ICMPv6 Type 4, Code 1).</p>
</li>
<li>
<p>When a Next Header value 0 appears in a header other than the fixed header a node
should do the same.</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 11. Recommended order of extension header</caption>
<colgroup>
<col style="width: 44.4444%;">
<col style="width: 11.1111%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Next Header Type</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hop-by-Hop Options Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read by all devices in transit network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination Option Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read by the final destination device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Routing Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support routing decision making</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fragment Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">44</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains parameters of datagram fragmentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">51</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encapsulating Security Payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carries encrypted data for secure communication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination Option Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read by the final destination device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upper-Layer Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upper-Layer Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mobility Header (currently without upper layer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">135</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used with Mobile IPv6</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Value 59 means <strong>No Next Header</strong></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_hop_by_hop_options_and_destination_options">17.5.1. Hop-by-hop options and destination options</h4>
<div class="ulist">
<ul>
<li>
<p>Hop-by-Hop Options extension headers examined by all nodes on the packet&#8217;s path, including sending and receiving nodes.</p>
</li>
<li>
<p>The Destination Options extension header need to be examined by the destination node(s) only.</p>
</li>
<li>
<p>The extension headers are both at least 8 octets in size;</p>
<div class="ulist">
<ul>
<li>
<p>if more options are present than will fit in that space,
blocks of 8 octets are added to the header repeatedly—containing options and
padding—until all options are represented.</p>
</li>
</ul>
</div>
</li>
<li>
<p>the <strong>header ext len</strong> is the size of this header in bytes excluding the first 8 octets</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ipv6-hop-by-hop-options.png" alt="IPv6 Hop-By-Hop Options" width="896" height="152">
</div>
<div class="title">Figure 27. IPv6 Hop-By-Hop Options</div>
</div>
</div>
<div class="sect3">
<h4 id="_routing_extension_header">17.5.2. Routing Extension Header</h4>
<div class="ulist">
<ul>
<li>
<p>Directs a packet to one or more intermediate nodes before being sent to its destination.</p>
</li>
<li>
<p>At least 8 octets in size;</p>
<div class="ulist">
<ul>
<li>
<p>if more Type-specific Data is needed than will fit in 4 octets, blocks of 8 octets are added to the header repeatedly, until all Type-specific Data is placed.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Routing types:</p>
<div class="ulist">
<ul>
<li>
<p>0 deprecated, because of DoS</p>
</li>
<li>
<p>1 used by the Nimrod project</p>
</li>
<li>
<p>2 for IPv6 Mobile</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ipv6-routing-options.png" alt="IPv6 Routing Options" width="896" height="216">
</div>
<div class="title">Figure 28. IPv6 Routing Options</div>
</div>
<div class="paragraph">
<p>TODO
.Task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# no ipv6 source-route</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fragment_extension_header">17.5.3. Fragment Extension Header</h4>
<div class="ulist">
<ul>
<li>
<p>In order to send a packet that is larger than the path MTU,
the sending node splits the packet into fragments.</p>
</li>
<li>
<p>The Fragment extension header carries the information necessary to reassemble the original (unfragmented) packet.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ipv6-fragment-options.png" alt="IPv6 Fragment Options" width="896" height="184">
</div>
<div class="title">Figure 29. IPv6 Fragment Options</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fragmentation_and_reassembly">17.6. Fragmentation And Reassembly</h3>
<div class="ulist">
<ul>
<li>
<p>Unlike in IPv4, IPv6 routers never fragment IPv6 packets.</p>
<div class="ulist">
<ul>
<li>
<p>Packets exceeding the size of the maximum transmission unit of the destination link are dropped</p>
</li>
<li>
<p>The router sends a <strong>Packet too Big ICMPv6 Type 2</strong> message to the originating node
, similarly to the IPv4 method when the Don&#8217;t Fragment bit is set.</p>
</li>
</ul>
</div>
</li>
<li>
<p>End nodes in IPv6 are expected to perform path MTU discovery to determine the
maximum size of packets to send, and the upper-layer protocol is expected to
limit the payload size. However, if the upper-layer protocol is unable to do
so, the sending host may use the Fragment extension header in order to
perform end-to-end fragmentation of IPv6 packets. Any data link layer
conveying IPv6 data must be capable of delivering an IP packet containing
<strong>1280 bytes</strong> without the need to invoke end-to-end fragmentation at the IP
layer.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_fragmenting">17.6.1. Fragmenting</h4>
<div class="ulist">
<ul>
<li>
<p>A packet containing a fragment of an original (larger) packet consists of two
parts: the unfragmentable part of the original packet (which is the same for
all fragments), and a piece of the fragmentable part of the original packet,
identified by a Fragment Offset. The Fragment Offset of the first ("leftmost")
fragment is 0.</p>
</li>
<li>
<p>The unfragmentable part of a packet consists of the fixed header and some of
the extension headers of the original packet (if present): all extension
headers up to and including the Routing extension header, or else the
Hop-by-Hop extension header. If neither extension headers are present, the
unfragmentable part is just the fixed header.</p>
</li>
<li>
<p>The Next Header value of the last (extension) header of the unfragmentable part
is set to 44 to indicate that a Fragment extension header follows. After the
Fragment extension header a fragment of the rest of the original packet
follows.</p>
</li>
<li>
<p>The first fragment(s) hold the rest of the extension headers (if present).
After that the rest of the payload follows. Each fragment is a multiple of 8
octets in length, except the last fragment.</p>
</li>
<li>
<p>Each Fragment extension header has its M flag set to 1 (indicating more
fragments follow), except the last, whose flag is set to 0.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_re_assembly">17.6.2. Re-Assembly</h4>
<div class="ulist">
<ul>
<li>
<p>The original packet is reassembled by the receiving node by collecting all
fragments and placing each fragment at the right offset and discarding the
Fragment extension headers of the packets that carried them. Packets
containing fragments need not arrive in sequence; they will be rearranged by
the receiving node.</p>
</li>
<li>
<p>If not all fragments are received within 60 seconds after receiving the first
packet with a fragment, reassembly of the original packet is abandoned and
all fragments are discarded. If the first fragment was received (which
contains the fixed header), a Time Exceeded message (ICMPv6 type 3, code 1)
is returned to the node originating the fragmented packet, if the packet was
discarded for this reason.</p>
</li>
<li>
<p>Receiving hosts must make a best-effort attempt to reassemble fragmented IP
datagrams that, after reassembly, contain up to 1500 bytes. Hosts are
permitted to make an attempt to reassemble fragmented datagrams larger than
1500 bytes, but they are also permitted to silently discard any datagram
after it becomes apparent that the reassembled packet would be larger than
1500 bytes. Therefore, senders should avoid sending fragmented IP datagrams
with a total reassembled size larger than 1500 bytes, unless they have
previous assurance that the receiver is capable of reassembling such large
datagrams</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_security">17.6.3. Security</h4>
<div class="ulist">
<ul>
<li>
<p>Research has shown that the use of fragmentation can be leveraged to evade
network security controls.</p>
</li>
<li>
<p>As a result, RFC 7112 requires that the first fragment of an IPv6 packet
contains the entire IPv6 header chain, such that some very pathological
fragmentation cases are forbidden.</p>
</li>
<li>
<p>Additionally, as a result of research on the evasion of RA-Guard in RFC 7113,
RFC 6980 has deprecated the use of fragmentation with Neighbor Discovery, and
discouraged the use of fragmentation with Secure Neighbor Discovery (SEND).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_addressing">17.7. Addressing</h3>
<div class="ulist">
<ul>
<li>
<p>128 bits</p>
</li>
<li>
<p>Represented in hexadecimal and uses 8 colon-separated fields of 16 bits.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ipv4_vs_ipv6">17.7.1. IPv4 Vs IPv6</h4>
<div class="ulist">
<ul>
<li>
<p>Multiple ipv6 addresses on a logical or physical interface with equal precedence on IOS (only one primary
ipv4 with optional secondary address)</p>
</li>
<li>
<p>Automatic configuration of globally unique address (without the need of DHCP)</p>
</li>
<li>
<p>Built-in neighbor discovery of neighbors, routers and gateways</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_address_abbreviation_rules">17.7.2. Address Abbreviation Rules</h4>
<div class="ulist">
<ul>
<li>
<p>Whenever one or more successive 16-bit groups in an IPv6 address consist of all 0s, that
portion of the address can be omitted and represented by two colons (::). The two-colon
abbreviation can be used only once in an address, to eliminate ambiguity.</p>
</li>
<li>
<p>When a 16-bit group in an IPv6 address begins with one or more 0s, the leading 0s can be
omitted. This option applies regardless of whether the double-colon
abbreviation method is used anywhere in the address.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>2001:0001:0000:0000:00A1:0CC0:01AB:397A

2001:1:0:0:A1:CC0:1AB:397A
2001:0001::00A1:0CC0:01AB:397A
2001:1::A1:CC0:1AB:397A</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_address_types">17.7.3. Address Types</h4>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address Type</th>
<th class="tableblock halign-left valign-top">Range</th>
<th class="tableblock halign-left valign-top">Application</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggregatable global unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000::/3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host-to-host communication; same as IPv4 unicast.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF00::/8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One-to-many and many-to-many communication; same as IPv4 multicast.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anycast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as Unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application-based, including load balancing, optimizing traffic for a particular service, and
redundancy. Relies on routing metrics to determine the best destination for a particular host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link-local  unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FE80::/10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connected-link communications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solicited-node multicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::1:FF00:0/104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Neighbor solicitation.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_unicast">Unicast</h5>
<div class="sect5">
<h6 id="_aggregatable_global_addresses">Aggregatable Global Addresses</h6>
<div class="ulist">
<ul>
<li>
<p>Begin with binary 001 (hexadeximal= 2000::/3)</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ipv6-unicast-address-format.png" alt="ipv6 unicast address format" height="150">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_link_local_addresses">Link-Local Addresses</h6>
<div class="ulist">
<ul>
<li>
<p>Starts with FE80::/10</p>
</li>
<li>
<p>Follows by 54 bits set to 0</p>
</li>
<li>
<p>Interface ID</p>
</li>
<li>
<p>only one link-local address per interface</p>
</li>
<li>
<p>Routers do not forward link-local traffic to other segments.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_ipv4_compatible_addresses">IPv4-Compatible Addresses</h6>
<div class="ulist">
<ul>
<li>
<p>One option is to have first 96 bits set to 0</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>0:0:0:0:0:10:10:100:16
::10:10:100:16
::A:A:64:10</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>::ffff:0:0/96 prefix is designated as an IPv4-mapped IPv6 address.  With a
few exceptions, this address type allows the transparent use of the Transport
Layer protocols over IPv4 through the IPv6 networking.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_assign_an_ipv6_unicast_address_to_a_router_interface">Assign an IPv6 Unicast Address to a Router Interface</h6>
<div class="listingblock">
<div class="title">Task: Enable Ipv6 on the Router</div>
<div class="content">
<pre>(config)# ipv6 unicast-routing</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Global Unicast Address</div>
<div class="content">
<pre>(config-if)# ipv6 address 2014:10:12::19:66/64</pre>
</div>
</div>
<div class="paragraph">
<p>Router automatically configure a link local address on all IPv6 enabled interfaces.
However, you can explicitly configure one</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ipv6 address fe80::1 link-local</pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, the configured interface automatically joins the
following required multicast groups for that link:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Solicited-node multicast group FF02:0:0:0:0:1:FF00::/104 for each unicast and anycast address assigned to the interface</p>
</li>
<li>
<p>All-nodes link-local multicast group FF02::1</p>
</li>
<li>
<p>All-routers link-local multicast group FF02::2</p>
</li>
<li>
<p>IPv6 redistribution ignores the “local” routes in the IPv6 routing table
(the /128 host routes for a router’s own interface IPv6 addresses)
whereas IPv4 has no such concept.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multicast">Multicast</h5>
<div class="sect5">
<h6 id="_ipv6_multicast_address_format">IPv6 Multicast Address Format</h6>
<div class="ulist">
<ul>
<li>
<p>Begin with FF as the first octect, or FF00::/8</p>
</li>
<li>
<p>The second octet specifies lifetime (permanent or temporary) and the scope (node, link, site, organization, global)</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ipv6-multicast-address-format.png" alt="ipv6 multicast address format">
</div>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 12. IPv6 Multicast Well-Known Addresses</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Multicast Group</th>
<th class="tableblock halign-left valign-top">IPv4 Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subnet broadcast address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OSPFv3 routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OSPFv3 designated routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIGRP routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIM routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.13</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each router must join the <strong>solicited-node group</strong> (FF02::1:FF00:0000/104)  for all unicast and anycast traffic.
The last 24 bits come from the corresponding last 24 bits of the unicast or anycast address.
The <strong>neighbor discovery</strong> process uses solicited-node addresses.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_anycast">Anycast</h5>
<div class="paragraph">
<p>Anycast addresses can be assigned to any number of hosts that provide the same service; when other hosts access this
service, the specific server they hit is determined by the unicast routing metrics on the path to that
particular group of servers. This provides geographic differentiation, enhanced availability, and
load balancing for the service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ipv6 address 3001:fffe::104/64 anycast</pre>
</div>
</div>
<div class="paragraph">
<p>All IPv6 routers additionally must support the subnet router anycast address. This anycast address
is a prefix followed by all 0s in the interface ID portion of the address. Hosts can use a subnet
router anycast address to reach a particular router on the link identified by the prefix given in the
subnet router anycast address.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_unspecified_address">The Unspecified Address</h5>
<div class="ulist">
<ul>
<li>
<p>Represented by <strong>::</strong></p>
</li>
<li>
<p>Used as source address by an interface that has not yet learned its unicast addresses.</p>
</li>
<li>
<p>Cannot be assigned to an interface</p>
</li>
<li>
<p>Cannot be used as a destination address</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_embed_an_rp_address_within_a_multicast_group_address">How to Embed an RP Address Within a Multicast Group Address</h5>
<div class="paragraph">
<p><a href="https://www.ietf.org/rfc/rfc2373.txt">RFC 2373</a></p>
</div>
<div class="paragraph">
<p>Given address 2001:DB*:0717::A,
Follow the structure FF<em>7</em><strong>X</strong>:0<strong>Y</strong>30:2001:DB8:0717::<strong>group</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>FF for a multicast address</p>
</li>
<li>
<p>7 indicates that the RP address is embedded in the multicast address</p>
</li>
<li>
<p>X for the multicast scope</p>
<div class="ulist">
<ul>
<li>
<p>1 node-local</p>
</li>
<li>
<p>2 link-local</p>
</li>
<li>
<p>5 site-local</p>
</li>
<li>
<p>8 organization-local</p>
</li>
<li>
<p>E global</p>
</li>
<li>
<p>F reserved</p>
</li>
</ul>
</div>
</li>
<li>
<p>0 in the first character of the second hextet</p>
</li>
<li>
<p>Y for the RP interface ID from 1 to F</p>
</li>
<li>
<p>30 for the mask for the network (0x30 = decimal 48)</p>
</li>
<li>
<p>Remaining hextets for the network prefix</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ipv6_address_autoconfiguration">17.7.4. IPv6 Address Autoconfiguration</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Stateful autoconfiguration</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Assigns a host its entire 128-bit address using DHCP</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Stateless autoconfiguration</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Assigns a host a 64-bit prefix,
and the host derives the last bit using EUI-64 process.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="_eui_64_address">EUI-64 Address</h5>
<div class="ulist">
<ul>
<li>
<p>Split 48-bit MAC address in two 24-bit parts</p>
</li>
<li>
<p>Place FFFE in the middle</p>
</li>
<li>
<p>Set to 1 the universal/local bit (7th bit in the interface id )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given the IPv6 prefix 2001:128:1f:633 and MAC address 00:07:85:80:71:B8,
the resulting EUI-address is 2001:128:1f:633:<strong>2</strong>07:85<strong>FF:FE</strong>80:71B8/64</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ipv6 address 2001:128:1f:633::/64 eui-64</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>RFC2373</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_basic_ipv6_functionality_protocols">17.8. Basic  IPv6 Functionality Protocols</h3>
<div class="sect3">
<h4 id="_neighbor_discovery">17.8.1. Neighbor Discovery</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.ietf.org/rfc/rfc2461.txt">RFC 2461</a></p>
</li>
<li>
<p>Discover and track other IPv6 hosts on connected interfaces</p>
</li>
<li>
<p>Uses ICMPv6 messages and Solicited-node multicast addresses</p>
</li>
<li>
<p>Major roles</p>
<div class="ulist">
<ul>
<li>
<p>Stateless address autoconfiguration (detailed in <a href="https://www.ietf.org/rfc/rfc2462.txt">RFC 2462</a></p>
</li>
<li>
<p>Duplicate address detection (DAD)</p>
</li>
<li>
<p>Router discovery</p>
</li>
<li>
<p>Prefix discovery</p>
</li>
<li>
<p>Parameter discovery (link MTU, hop limits)</p>
</li>
<li>
<p>Neighbor discovery</p>
</li>
<li>
<p>Neighbor address resolution (replaces ARP, both dynamic and static)</p>
</li>
<li>
<p>Neighbor and router reachability verification</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_neighbor_advertisements">Neighbor Advertisements</h5>
<div class="ulist">
<div class="title">ICMPv6 Messages Used by ND</div>
<ul>
<li>
<p>Host advertises their pr</p>
</li>
<li>
<p>Source addresses</p>
</li>
<li>
<p>Destination addresses</p>
</li>
<li>
<p>Icmp type, code: 134,0</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_neighbor_solicitation">Neighbor Solicitation</h5>
<div class="ulist">
<ul>
<li>
<p>NS messages to find the link-layer of a specific neighbor</p>
</li>
<li>
<p>Source address: manual assigned or ::</p>
</li>
<li>
<p>Destination address: target address or solicited-node multicast address</p>
</li>
<li>
<p>ICMP type, code: 135,0</p>
</li>
<li>
<p>Uses in 3 operations: duplicate address detection, neighbor reachability verification, layer 3 to layer 2 address resolution.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IPv6 does not include ARP as a protocol but rather integrates the same functionality into ICMP as part of neighbor discovery.
The response to an NS message is an NA message .
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ipv6-neighbor-discovery.png" alt="ipv6 neighbor discovery">
</div>
<div class="title">Figure 30. Neighbor Discovery Between Two Hosts</div>
</div>
</div>
<div class="sect4">
<h5 id="_router_advertisement">Router Advertisement</h5>
<div class="ulist">
<ul>
<li>
<p>Routers advertise their presence and link prefixes, MTU, hop limits</p>
</li>
<li>
<p>Source address: router&#8217;s link-local address</p>
</li>
<li>
<p>Destination address: all-nodes FF02::1 for periodic broadcasts, querying host address for response</p>
</li>
<li>
<p>Icmp type, code: 134,0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A Cisco IPv6 router begins sending RA messages for each of its configured interface prefixes
when the <strong>ipv6 unicast-routing</strong> command is configured. You can change the default RA interval
(200 seconds) using the command <strong>ipv6 nd ra-interval</strong>. Router advertisements on a given interface
include all of the 64-bit IPv6 prefixes configured on that interface. This allows for stateless address
autoconfiguration using EUI-64 to work properly. RAs also include the link MTU, hop limits, and
whether a router is a candidate default router.</p>
</div>
<div class="paragraph">
<p>IPv6 routers send periodic RA messages to inform hosts about the IPv6 prefixes used on the link
and to inform hosts that the router is available to be used as a default gateway.
By default, a Cisco router running IPv6 on an interface advertises itself as a candidate default router.</p>
</div>
<div class="listingblock">
<div class="title">Task: Prevent Router to Advertise Itself As a Default Candidate but Do Not Hide Its Presence</div>
<div class="content">
<pre>ipv6 nd ra-lifetime 0</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Hide Presence Of a Router Running IPv6</div>
<div class="content">
<pre>ipv6 nd suppress-ra</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_router_solicitation">Router Solicitation</h5>
<div class="ulist">
<ul>
<li>
<p>Host query for the presence of routers on the link</p>
</li>
<li>
<p>Source address: querying host interface, or :: if not assigned</p>
</li>
<li>
<p>Destination address: FF02::2</p>
</li>
<li>
<p>Icmp type, code : 133,0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At startup, IPv6 hosts can send RS messages to the all-routers multicast address.
Hosts do this to learn the addresses of routers on a given link, as well as their various
parameters, without waiting for a periodic RA message. If a host has no configured IPv6 address,
it sends an RS using the unspecified address as the source. If it has a configured address, it sources
the RS from the configured address.</p>
</div>
</div>
<div class="sect4">
<h5 id="_duplicate_address_detection">Duplicate Address Detection</h5>
<div class="paragraph">
<p>To verify that autoconfigured or statically address is unique,
the host sends an NS message to its own autoconfigured address&#8217;s corresponding solicited-node multicast address.
This message is sourced from the unspecified address ::.
In the target address field in the NS is the address the host seeks to verify.
If an NA from another host results, the sending host knows that the address is not unique</p>
</div>
</div>
<div class="sect4">
<h5 id="_neighbor_unreachability_detection">Neighbor Unreachability Detection</h5>
<div class="paragraph">
<p>2 options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a host sends a probe to the desired host&#8217;s solicited-node multicast address and receives an RA or an NA in response.</p>
</li>
<li>
<p>a host, in communication with the desired host, receives a clue from higher-layer protocol (e.g. TCP ACK)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_icmpv6">17.8.2. ICMPv6</h4>
<div class="ulist">
<ul>
<li>
<p>RFC 2463</p>
</li>
<li>
<p>Two groups of messages: error reporting messages and informational messages</p>
</li>
<li>
<p>IOS implements ICMP rate limiting by setting the minimum interval between error messages and build a token bucket</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Limit ICMPv6 error messages with default interval 100 ms , and default token-bucket size 10.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ipv6 icmp error-interval seconds ???</pre>
</div>
</div>
<div class="sect4">
<h5 id="_unicast_reverse_path_forwarding">Unicast Reverse Path Forwarding</h5>
<div class="ulist">
<ul>
<li>
<p>Protects router from DoS attacks from spoofed IPv6 host address.</p>
</li>
<li>
<p>Performs a recursive lookup in the ipv6 routing table
to verify that the packet came in on the correct interface.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ipv6 verify unicast reverse-path</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dns">17.8.3. DNS</h4>
<div class="ulist">
<ul>
<li>
<p>Provides resolution of domain names</p>
</li>
<li>
<p>DNS records: AAAA (RFC 1886), A6 (RFC 2874)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_cdp_2">17.8.4. CDP</h4>
<div class="ulist">
<ul>
<li>
<p>Cisco Discovery Protocol</p>
</li>
<li>
<p>Provides extensive information about the configuration and functionality of Cisco devices.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display IPv6 Information Transmitted In CDP</div>
<div class="content">
<pre># show cdp neighbors detail</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dhcp_2">17.8.5. DHCP</h4>
<div class="ulist">
<ul>
<li>
<p>RFC 3315</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Two conditions can cause a host to use DHCPv6:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The host is explicitly configured to use DHCPv6 based on an implementation-specific setting.</p>
</li>
<li>
<p>An IPv6 router advertises in its RA messages that it wants hosts to use DHCPv6 for
addressing. Routers do this by setting the M flag (Managed Address Configuration) in RAs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use stateful autoconfiguration, a host sends a DHCP request to one of two well-known IPv6
multicast addresses on UDP port 547:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FF02::1:2, all DHCP relay agents and servers</p>
</li>
<li>
<p>FF05::1:3, all DHCP servers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The DHCP server then provides the necessary configuration information in reply to the host on UDP port 546.
This information can include the same types of information used in an IPv4 network,
but additionally it can provide information for multiple subnets,
depending on how the DHCP server is configured.</p>
</div>
<div class="paragraph">
<p>To configure a Cisco router as a DHCPv6 server,
you first configure a DHCP pool, just as in IPv4
then enable the DHCPv6 service using the <strong>ipv6 dhcp server pool-name</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_access_lists">17.8.6. Access Lists</h4>
<div class="paragraph">
<p>Similar with IPv4 access lists except that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Because Neighbor Discovery is a key protocol in IPv6 networks, access lists implicitly permit
ND traffic. This is necessary to avoid breaking ND’s ARP-like functionality.
You can override this implicit-permit behavior using deny statements in IPv6 access lists.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure an Interface to Filter Traffic Using an Access List</div>
<div class="content">
<pre>ipv6 traffic-filter access-list-name {in | out}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>IPv6 access lists are always named; they cannot be numbered (unless you use a number as a name).</p>
</li>
<li>
<p>IPv6 access lists are configured in named access-list configuration mode, which is like IPv4
named access-list configuration mode. However, you can also enter IPv4-like commands that
specify an entire access-list entry on one line. The router will convert it to the correct
configuration commands for named access-list configuration mode.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ipv6_tunneling">17.9. IPv6 tunneling</h3>
<div class="sect3">
<h4 id="_6in4">17.9.1. 6in4</h4>
<div class="ulist">
<ul>
<li>
<p>mechanism for migrating from IPv4 to IPv6 (RFC 4213)</p>
</li>
<li>
<p>uses tunneling to encapsulate IPv6 traffic over explicitly-configured IPv4 links</p>
<div class="ulist">
<ul>
<li>
<p>The 6in4 traffic is sent over the IPv4 Internet inside IPv4 packets whose
IP headers have the IP protocol number set to 41.</p>
</li>
<li>
<p>In 6in4, the IPv4 packet header is immediately followed by the IPv6 packet being carried.
This means that the encapsulation overhead is simply the size of the IPv4 header of 20 bytes.
With an Ethernet MTU of 1500 bytes,
one can thus send IPv6 packets of 1480 bytes without fragmentation.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Also referred to as proto-41 static because the endpoints are configured statically.</p>
</li>
<li>
<p>generally manually configured</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/6in4.png" alt="Manually configuration" width="dual-stack">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_6to4">17.9.2. 6to4</h4>
<div class="ulist">
<ul>
<li>
<p>encapsulates the IPv6 packets into IPv4 which allows remote IPv6 networks to communicate across the IPv4
infrastructure(core network or Internet).</p>
</li>
<li>
<p>The main difference between the manual tunnels and automatic 6to4 tunnels is
that the tunnel is not point-to-point but it is point-to-multipoint.</p>
</li>
<li>
<p>In automatic 6to4 tunnels, the IPv4 infrastructure is treated as a virtual non-broadcast multi-
access (NBMA). The IPv4 address embedded
in the IPv6 address is used to find the other end of the automatic tunnel.</p>
</li>
<li>
<p>Point-to-multipoint 6to4 tunnels that can be used to connect isolated IPv6 sites can use
addresses from the 2002::/16 prefix.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_isatap">17.9.3. ISATAP</h4>
<div class="ulist">
<ul>
<li>
<p>automatic overlay tunneling mechanism that uses the underlying IPv4 network as
a NBMA link layer for IPv6.</p>
</li>
<li>
<p>Overlay tunneling encapsulates IPv6 packets in IPv4 packets for delivery across an IPv4
infrastructure (a core network). By using overlay tunnels, you can communicate with isolated
IPv6 networks without upgrading the IPv4 infrastructure between them. Overlay tunnels can be
configured between border devices or between a border device and a host; however, both
tunnel endpoints must support both the IPv4 and IPv6 protocol stacks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>IPv6 supports the following types of overlay tunneling mechanisms:
- Manual
- GRE
- IPv4-compatible
- 6to4
- Intra-site Automatic Tunnel Addressing Protocol (ISATAP)</p>
</div>
</div>
<div class="sect3">
<h4 id="_6rd">17.9.4. 6RD</h4>
<div class="paragraph">
<p>IPv6 Rapid Deployment (6rd) is a stateless tunneling mechanism which allows a Service
Provider to rapidly deploy IPv6 in a lightweight and secure manner without requiring upgrades to
existing IPv4 access network infrastructure. While there are a number of methods for carrying
IPv6 over IPv4, 6rd has been particularly successful due to its stateless mode of operation
which is lightweight and naturally scalable, resilient, and simple to provision.</p>
</div>
<div class="paragraph">
<p><a href="http://goo.gl/JXYWEc">Further Reading</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_6vpe">17.9.5. 6VPE</h4>
<div class="paragraph">
<p>The 6PE feature is particularly applicable to Service Providers who already run an MPLS
network or plan to do it. One of the Cisco 6PE advantages is that there is no need to upgrade
the hardware, software or configuration of the core network. Thus it eliminates the impact on the
operations and the revenues generated by the existing IPv4 traffic. MPLS has been chosen by
many Service Providers as a vehicle to deliver services to customers. MPLS as a multi-service
infrastructure technology is able to provide layer 3 VPN, QoS, traffic engineering, fast re-routing
and integration of ATM and IP switching. It is in a very natural manner that MPLS is put to
contribution to ease IPv6 introduction in existing production networks.</p>
</div>
<div class="paragraph">
<p>MPLS decoupling of the control plane and data plane provide an interesting alternative to the
integration and coexistence of IPv4, IPv6 and ATM over a single infrastructure, thus fulfilling
environments such as 3G networks where UMTS Release 5 needs in terms of transport: Cisco
6PE for IPv6 traffic, ATM over MPLS and regular IPv4 switching with its VPN, traffic engineering
and QoS extensions. From an operational standpoint, new CEs introduction is straightforward
and painless as it leverages the Layer 3 VPN scalability. Using tunnels on the CE routers is the
simplest way to deploy IPv6 over MPLS networks. It has no impact on the operation or
infrastructure of MPLS, and requires no changes to either the P routers (they don’t have to be
IPv6 aware) in the core or the PE routers connected to the customers.</p>
</div>
<div class="paragraph">
<p>6VPE is a technology that allows IPv6 VPN customers to communicate with each other over an
IPv4 MPLS Provider without any tunnel setup, by having the customer VPNv6 prefixes using a
v4-mapped IPv6 address as next-hop inside the provider&#8217;s network and using IPv4 LSPs
between the 6VPEs. In 6VPE, labels must be exchanged between the 6VPEs for their VPNv6
prefixes, which means that the VPNv6 address-family must be activated on the IPv4 iBGP
session between the 6VPEs.</p>
</div>
<div class="paragraph">
<p>By default, the <strong>mpls ip propagate-ttl</strong> command is enabled and the IP TTL value is copied to the
MPLS TTL field during label imposition.
To disable TTL propagation for all packets, use the <strong>no mpls ip propagate-ttl</strong> command.
To disable TTL propagation for only forwarded packets, use the <strong>no mpls ip propagate forwarded</strong> command.
Disabling TTL propagation of forwarded packets allows the structure of the MPLS network to be hidden from customers, but not the provider.</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/vuPAxm" class="bare">http://goo.gl/vuPAxm</a>
<a href="http://goo.gl/Hu78Cr" class="bare">http://goo.gl/Hu78Cr</a></p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/xEL1XF" class="bare">http://goo.gl/xEL1XF</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ipv6_routing">17.10. IPv6 Routing</h3>
<div class="sect3">
<h4 id="_static_routes">17.10.1. Static Routes</h4>
<div class="paragraph">
<p>Similar to IPv4 static routes except that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An IPv6 static route to an interface has an administrative distance of 1, not 0 as in IPv4.</p>
</li>
<li>
<p>An IPv6 static route to a next-hop IP address also has an administrative distance of 1, like IPv4.</p>
</li>
<li>
<p>Floating static routes work the same way in IPv4 and IPv6.</p>
</li>
<li>
<p>An IPv6 static route to a broadcast interface type, such as Ethernet, must also specify a next-hop IPv6 address because</p>
<div class="ulist">
<ul>
<li>
<p>IPv6 does not use ARP</p>
</li>
<li>
<p>There is no concept of proxy ARP</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ipv6 route 2001:128::/64 2001::207:85FF:FE80:7208</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>show ipv6 route</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ospfv3">17.10.2. OSPFv3</h4>
<div class="paragraph">
<p><a href="http://www.cisco.com/en/US/docs/ios/ipv6/configuration/guide/ip6-ospf.html#wp1069821">implementing OSPF for IPv6</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_eigrpv6">17.10.3. EIGRPv6</h4>

</div>
</div>
<div class="sect2">
<h3 id="_ospfv3_2">17.11. Ospfv3</h3>
<div class="ulist">
<ul>
<li>
<p>Router id is highest ipv4 loopback, highest ipv4, or <strong>router-id</strong> id command</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_readings">17.12. Readings</h3>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/ios/12_4/interface/configuration/guide/inb_tun.html#wp1045782">Implement tunnels</a></p>
</div>
<div class="sect3">
<h4 id="_ipv6_general_prefix">17.12.1. IPv6 General Prefix</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cef">18. CEF</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>enabled by default</p>
</li>
<li>
<p>can be central or distributed accross multiple line cards</p>
</li>
<li>
<p>Uses the FIB and the adjacency table</p>
</li>
<li>
<p>Improves over process switching and fast switching methods</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Switching Path</th>
<th class="tableblock halign-left valign-top">Forwarding Information stores</th>
<th class="tableblock halign-left valign-top">Load-Balancing Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process switching</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Routing table</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Per packet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast switching</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast-switching cache (per flow route cache)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Per destination IP address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CEF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIB tree and adjacency table</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Per a hash of the packet source and destination</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Disable CEF</div>
<div class="content">
<pre>(config)# no ip cef [distributed]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable CEF on an Interface</div>
<div class="content">
<pre>(config-if)# no ip route-cache cef [distributed]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify That CEF Is Enabled</div>
<div class="content">
<pre># sh cef interface &lt;type number&gt; [detail]
# sh ip interface &lt;type number&gt;</pre>
</div>
</div>
<div class="sect2">
<h3 id="_fib">18.1. FIB</h3>
<div class="ulist">
<ul>
<li>
<p>contains the prefixes and next-hop address from each entry in the IP routing table structured in a way that is optimized for forwarding.</p>
</li>
<li>
<p>no need for route cache maintenance because there is a one-to-one correlation between FIB entries and routing table entries</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display the FIB Contents</div>
<div class="content">
<pre># sh ip cef

Prefix              Next Hop            Interface
[...]
10.2.61.8/24        192.168.100.1       FastEthernet1/0/0
                    192.168.101.1       FastEthernet6/1
[...]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adjacency_table">18.2. Adjacency Table</h3>
<div class="ulist">
<ul>
<li>
<p>stores outbound interface and MAC header rewrite for adjacent nodes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display the Contents Of the Adjacency Table</div>
<div class="content">
<pre># show adjacency [detail]

Protocol       Interface            Address

IPV6           Serial0/0/0          point2point(12)
IP             Serial0/0/0          point2point(13)
IP             Serial0/0/1          point2point(15)
IPV6           Serial0/0/1          point2point(10)
IPV6           FastEthernet0/0.2    FE80:24::4(12)
...</pre>
</div>
</div>
<div class="sect3">
<h4 id="_adjacency_discovery">18.2.1. Adjacency Discovery</h4>
<div class="ulist">
<ul>
<li>
<p>adjacent nodes are discovered automatically (ARP) or added manually</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 13. Adjacency Types That Required Special Handling</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Adjacency Type</th>
<th class="tableblock halign-left valign-top">Actions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Null adjacency</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Packets destined for a Null0 interface are dropped.
Null adjacency can be used as an effective form of access filtering.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Glean adjacency</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>When a device is connected to a multiaccess medium
, the FIB table on the device maintains a prefix for the subnet rather than for
the individual host prefixes. The subnet prefix points to a glean adjacency. A
glean adjacency entry indicates that a particular next hop should be directly
connected , but there is no MAC header rewrite information available. When the
device needs to forward packets to a specific host on a subnet , CEF requests an ARP entry for the specific prefix , ARP sends the MAC
address , and the adjacency entry for the host is built.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Punt adjacency</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The device forwards packets requiring special handling or
packets sent by features not yet supported in CEF switching paths to the next
higher switching level for handling.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Discard adjacency</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The device discards the packets.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Drop adjacency</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The device drops the packets.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_unresolved_adjacency">18.2.2. Unresolved Adjacency</h4>
<div class="paragraph">
<p>When a link-layer header is prepended to a packet,
the FIB requires the prepended header to point to an adjacency corresponding to the next hop.
If an adjacency was created by the FIB and not discovered through a mechanism such as ARP,
the Layer 2 addressing information is not known and the adjacency is considered incomplete or unresolved.
Once the Layer 2 information is known, the packet is forwarded to the RP, and the adjacency is determined through ARP.
Thus, the adjacency is resolved.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cef_load_balancing">18.3. CEF Load Balancing</h3>
<div class="ulist">
<ul>
<li>
<p>per-destination (default)</p>
</li>
<li>
<p>per-packet: round-robin method over multiple links</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Disable Per-Destination</div>
<div class="content">
<pre>(config-if)# no ip load-sharing per-destination</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable Per-Packet Load Balancing</div>
<div class="content">
<pre>(config-if)# ip load-sharing per-packet</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Select CEF Load Balancing Algorithm</div>
<div class="content">
<pre>(config)# ip cef load-sharing algorithm {original | universal | tunnel | include-ports [source | destination | source destination] }</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Original algorithm
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>produces distortions in load sharing across multiple routers
because the same algorithm is used on every router.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Universal algorithm
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>allows each router on the network to make a different load sharing decision for each source-destination address pair,</p>
</li>
<li>
<p>avoids original CEF polarization</p>
</li>
<li>
<p>Use a randomly generated Universal ID as seed for the hash function</p>
</li>
<li>
<p>default</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Tunnel algorithm
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>when there are only a few source and destination pairs</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Include-ports algorithm
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>uses Layer 4 source and destination ports in the load-balancing decision.</p>
</li>
<li>
<p>benefits traffic streams running over equal cost paths that are not load shared
because the majority of the traffic is between peer addresses that use different port numbers, Real-Time Protocol (RTP) streams.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
GTP-U TEID-Based ECMP Load-Balancing Algorithm
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>for Cisco IOS XE Software</p>
</li>
<li>
<p>for mobile devices</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Specify custom ID to be used as in the Hash function of the universal algorithm</div>
<div class="content">
<pre>(config)# ip cef load-sharing algorithm universal &lt;id&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bfd">19. BFD</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">IP Routing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/iproute_bfd/configuration/15-mt/irb-15-mt-book/irb-bi-fwd-det.html">Bidirectional Forwarding Detection</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://tools.ietf.org/html/rfc5880">RFC 5880</a></p>
<div class="literalblock">
<div class="content">
<pre>independently of media, data protocols, and routing protocols.</pre>
</div>
</div>
</li>
<li>
<p>provides a low-overhead, sub-second method of detecting failures in the
forwarding path between two adjacent routers, including the interfaces, data
links, and forwarding engines.</p>
</li>
<li>
<p>detection protocol enabled at the interface and protocol levels.</p>
<div class="ulist">
<ul>
<li>
<p>supports BFD asynchronous mode, which depends on the sending of
BFD control packets between two systems to activate and maintain BFD neighbor
sessions between routers.</p>
</li>
<li>
<p>must be configured on both systems (or BFD peers)</p>
</li>
</ul>
</div>
</li>
<li>
<p>benefits of implementing BFD over reduced timer mechanisms for EIGRP, IS-IS, and OSPF:</p>
<div class="ulist">
<ul>
<li>
<p>sub-second failure detection ( vs 1 or 2 seconds )</p>
</li>
<li>
<p>not tied to any any particular routing protocol or media</p>
</li>
<li>
<p>less CPU-intensive because some parts of BFD can be distributed to the data plane (vs control plane )</p>
</li>
</ul>
</div>
</li>
<li>
<p>always run in a unicast, point-to-point mode.</p>
</li>
<li>
<p>UDP</p>
<div class="ulist">
<ul>
<li>
<p>BFD control packets sourced from 49152 and sent to 3784.</p>
</li>
<li>
<p>BFD echo packets sourced from 3785 and sent to 3785</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_bfd_control_packet_format">19.1. BFD Control Packet Format</h3>
<div class="ulist">
<ul>
<li>
<p>Mandatory  Control section + Optional Authentication section</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/bfd-header-format.png" alt="BFD Control Packet Format" width="896" height="312">
</div>
<div class="title">Figure 31. BFD Control Packet Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Diagnostic Code(Diag)</dt>
<dd>
<p>local system&#8217;s reason for the last change in session state.</p>
<div class="ulist">
<ul>
<li>
<p>0 No Diagnostic</p>
</li>
<li>
<p>1 Control Detection Time Expired</p>
</li>
<li>
<p>2 Echo Function Failed</p>
</li>
<li>
<p>3 Neighbor Signaled Session Down</p>
</li>
<li>
<p>4 Forwarding Plane Reset</p>
</li>
<li>
<p>5 Path Down</p>
</li>
<li>
<p>6 Concatenated Path Down</p>
</li>
<li>
<p>7 Administratively Down</p>
</li>
<li>
<p>8 Reverse Concatenated Path Down</p>
</li>
<li>
<p>9-31 Reserved for future use</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">State (Sta)</dt>
<dd>
<p>Current BFD session state as seen by the transmitting system.</p>
<div class="ulist">
<ul>
<li>
<p>0  AdminDown</p>
</li>
<li>
<p>1  Down</p>
</li>
<li>
<p>2  Init</p>
</li>
<li>
<p>3  Up</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Poll (P)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If set, the transmitting system is requesting verification of
connectivity, or of a parameter change, and is expecting a packet
with the Final (F) bit in reply.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Fnal (F)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If set,  If set, the transmitting system is responding to a received BFD
Control packet that had the Poll (P) bit set.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Control Plane Independent &#169;</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If set, the transmitting system&#8217;s BFD implementation does not
share fate with its control plane (in other words, BFD is
implemented in the forwarding plane and can continue to function
through disruptions in the control plane).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Authentication Present (A)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If set, the Authentication Section is present and the session is
to be authenticated</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Demand (D)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If set, Demand mode is active in the transmitting system (the
system wishes to operate in Demand mode, knows that the session is
Up in both directions, and is directing the remote system to cease
the periodic transmission of BFD Control packets).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Multipoint (M)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Reserved for future point-to-multipoint extensions to</p>
</li>
<li>
<p>Must be zero on both transmit and receipt.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Detection Time Multiplier (Detect Mult)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The negotiated transmit interval, multiplied by this value, provides the Detection Time for the
receiving system in Asynchronous mode.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Length</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Length of the BFD Control packet, in bytes.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">My Discriminator</dt>
<dd>
<p>Unique, nonzero discriminator value generated by the transmitting system</p>
<div class="ulist">
<ul>
<li>
<p>Used to demultiplex multiple BFD sessions
between the same pair of systems.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Your Discriminator</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The discriminator received from the corresponding remote system.
This field reflects back the received value of My Discriminator,
or is zero if that value is unknown.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Desired Min TX Interval</dt>
<dd>
<p>minimum interval in microseconds, that the local
system would like to use when transmitting BFD Control packets, less any jitter applied</p>
<div class="ulist">
<ul>
<li>
<p>The value zero is reserved.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Required Min RX Interval</dt>
<dd>
<p>minimum interval, in microseconds, between received
BFD Control packets that this system is capable of supporting,
less any jitter applied by the sender.</p>
<div class="ulist">
<ul>
<li>
<p>If this value is zero, the transmitting system does not want the
remote system to send any periodic BFD Control packets.</p>
</li>
<li>
<p>Required Min Echo RX Interval: minimum interval, in microseconds, between received
BFD Echo packets that this system is capable of supporting, less
any jitter applied by the sender .</p>
</li>
<li>
<p>If this value is zero, the transmitting system does not support the
receipt of BFD Echo packets.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/bfd-authentication-format.png" alt="Optional Authentication Section" width="896" height="152">
</div>
<div class="title">Figure 32. Optional Authentication Section</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Auth Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>0  Reserved</p>
</li>
<li>
<p>1  Simple Password</p>
</li>
<li>
<p>2  Keyed MD5</p>
</li>
<li>
<p>3  Meticulous Keyed MD5</p>
</li>
<li>
<p>4  Keyed SHA1</p>
</li>
<li>
<p>5  Meticulous Keyed SHA1</p>
</li>
<li>
<p>6-255  Reserved for future use</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Auth Len</dt>
<dd>
<p>length, in bytes, of the authentication section, including the
Auth Type and Auth Len fields.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_bfd_operating_modes">19.2. BFD operating modes</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Asynchronous mode</dt>
<dd>
<p>The systems periodically send BFD Control packets to one
another, and if a number of those packets in a row are not received by the
other system, the session is declared to be down.</p>
<div class="ulist">
<ul>
<li>
<p>requires half as many packets to achieve a particular Detection Time as does the Echo function.</p>
</li>
<li>
<p>used when the Echo function cannot be supported for some reason.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Demand mode</dt>
<dd>
<p>It is assumed that a system has an independent way of verifying
that it has connectivity to the other system.  Once a BFD session is
established, such a system may ask the other system to stop sending BFD Control
packets, except when the system feels the need to verify connectivity
explicitly, in which case a short sequence of BFD Control packets is exchanged,
and then the far system quiesces.  Demand mode may operate independently in
each direction, or simultaneously.</p>
<div class="ulist">
<ul>
<li>
<p>useful in situations where the overhead of a periodic
protocol might prove onerous, such as a system with a very large
number of BFD sessions.</p>
</li>
<li>
<p>useful when the Echo function is
being used symmetrically.</p>
</li>
<li>
<p>may not be used when the path round-trip time is greater than
the desired Detection Time, or the protocol will fail to work
properly</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Echo mode</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Enabled by default,</p>
<div class="ulist">
<ul>
<li>
<p>can be used with both Asynchronous and Demand mode</p>
</li>
<li>
<p>can be disabled to run independently in each direction.</p>
</li>
<li>
<p>Described as <em>without asymmetry</em> when it is running on both sides (both BFD neighbors are running echo mode).</p>
</li>
</ul>
</div>
</li>
<li>
<p>works asynchronously between 2 BFD neighbors R1 and R2</p>
<div class="ulist">
<ul>
<li>
<p>R1 sends an echo packet (instead of a control packet) to R2, formatted as:</p>
<div class="literalblock">
<div class="content">
<pre>L3 Source: R1 (192.168.12.1)
L3 Destination: R1 (192.168.12.1)
MAC Source: Itself (000c.298f.aca3)
MAC Destination: (000c.29cf.21ff)</pre>
</div>
</div>
</li>
<li>
<p>R2&#8217;s receives this packet, sees this packet, and CEF-switches it straight back to R1!</p>
</li>
<li>
<p>In this fashion, R1 knows that R2 is reachable.</p>
</li>
<li>
<p>R2 would perform similar behavior towards R1, for it&#8217;s own echo process.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Control-plane CPU-intensive packets are still sent, but they are sent at the "slow timers" speed.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Before using BFD echo mode, disable ICMP redirect messages ( <strong>no ip redirects</strong> command ) to avoid high CPU utilization.</p>
</li>
<li>
<p>Don&#8217;t enable bothBFD echo mode and uRPF. The session will flap</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Disable BFD Echo Mode Without Asymmetry</div>
<div class="content">
<pre>(config)# no bfd echo</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
No echo packets will be sent by the router, and the router will not forward BFD echo packets that are received from any neighbor routers.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Configure the BFD slow timer.</div>
<div class="content">
<pre>(config-if)# bfd slow-timer &lt;milliseconds&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bfd_session_parameters_on_the_interface">19.3. BFD Session Parameters on the Interface</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
interval 
</td>
<td class="hdlist2">
<p>Rate in milliseconds (50..999) at which BFD control packets will be sent to BFD peers.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
min_rx
</td>
<td class="hdlist2">
<p>Rate in milliseconds (50..999) at which BFD control packets will be expected to be received from BFD peers.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
multiplier 
</td>
<td class="hdlist2">
<p>Number (3..50) of consecutive BFD control packets that must be missed from a BFD peer before BFD declares that the peer is unavailable and the Layer 3 BFD peer is informed of the failure.</p>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Enables BFD on the interface.</div>
<div class="content">
<pre>(config-if)# bfd interval &lt;milliseconds&gt; min_rx &lt;milliseconds&gt; multiplier &lt;interval-multiplier&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The bfd interval configuration is removed when the subinterface on which it is configured is removed.</p>
</li>
<li>
<p>The bfd interval configuration is not removed when:</p>
<div class="ulist">
<ul>
<li>
<p>an IPv4 address is removed from an interface</p>
</li>
<li>
<p>an IPv6 address is removed from an interface</p>
</li>
<li>
<p>IPv6 is disabled from an interface</p>
</li>
<li>
<p>an interface is shutdown</p>
</li>
<li>
<p>IPv4 CEF is disabled globally or locally on an interface</p>
</li>
<li>
<p>IPv6 CEF is disabled globally or locally on an interface</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_bfd_support_for_dynamic_routing">19.4. BFD Support for Dynamic Routing</h3>
<div class="ulist">
<ul>
<li>
<p>BFD has no neighbor detection.</p>
<div class="ulist">
<ul>
<li>
<p>When the routing protocol needs to monitor a neighbor, it informs BFD, and BFD establishes the neighbor relationship at that point.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Various routing protocols can piggyback a single BFD session.</p>
<div class="ulist">
<ul>
<li>
<p>If you have BGP and EIGRP running between the same two subnets on the same two routers, there&#8217;s no need to have two BFD sessions for checking the same exact topology.</p>
</li>
</ul>
</div>
</li>
<li>
<p>enabled globally at the router level or a per interface basis</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable BFD for all interfaces participating in the routing process</div>
<div class="content">
<pre>(config-router)#  bfd all-interfaces</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable BFD for all interfaces participating in the routing process. Use address-family interface configuration mode</div>
<div class="content">
<pre>(config-router-af-interface)# bfd</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure BFD for BGP</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; fall-over bfd</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable HSRP support for BFD on the interface.</div>
<div class="content">
<pre>(config-if)# standby bfd</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
CEF must be enabled
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Display a line-by-line listing of existing BFD adjacencies</div>
<div class="content">
<pre># sh bfd neighbors</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Sample Output</div>
<div class="listingblock">
<div class="content">
<pre>OurAddr       NeighAddr      LD/RD RH  Holdown(mult) State     Int
 172.16.10.1   172.16.10.2    1/6  1   260  (3 )      Up        Fa0/1</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Display a line-by-line listing of existing BFD adjacencies with details</div>
<div class="content">
<pre># sh bfd neighbors details</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Sample Output</div>
<div class="listingblock">
<div class="content">
<pre>NeighAddr                         LD/RD    RH/RS     State     Int
 10.1.1.2                           1/1         1(RH) Up        Et0/0
 Session state is UP and not using echo function.
 OurAddr: 10.1.1.1
 Local Diag: 0, Demand mode: 0, Poll bit: 0
 MinTxInt: 50000, MinRxInt: 50000, Multiplier: 3 Received MinRxInt: 50000, Received
Multiplier: 3 Holddown (hits): 150(0), Hello (hits): 50(2223) Rx Count: 2212, Rx Interval
(ms) min/max/avg: 8/68/49 last: 0 ms ago Tx Count: 2222, Tx Interval (ms) min/max/avg:
40/60/49 last: 20 ms ago Elapsed time watermarks: 0 0 (last: 0) Registered protocols: CEF Stub
 Uptime: 00:01:49
 Last packet: Version: 0                  - Diagnostic: 0
              I Hear You bit: 1           - Demand bit: 0
              Poll bit: 0                 - Final bit: 0
              Multiplier: 3               - Length: 24
              My Discr.: 1                - Your Discr.: 1
              Min tx interval: 50000      - Min rx interval: 50000
              Min Echo interval: 50000</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read  <a href="https://brbccie.blogspot.co.za/2014/06/everything-bfd.html">Jeff Kronlage&#8217;s blog on BFD</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_bfd_support_for_static_routing">19.5. BFD Support for Static Routing</h3>
<div class="ulist">
<ul>
<li>
<p>Supports RIPv2, EIGRP, OSPF, IS-IS, BGP, HSRP</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specifies a static route BFD neighbor.</div>
<div class="content">
<pre>(config)# ip route static bfd &lt;interface-type number&gt; &lt;ip-address&gt; [group &lt;group-name&gt; [passive]]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>interface-type</strong>, <strong>interface-number</strong>, and <strong>ip-address</strong> arguments are required because BFD support exists only for directly connected neighbors.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Displays information about the static BFD configuration from the configured BFD groups and nongroup entries</div>
<div class="content">
<pre># sh ip static route bfd</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bfd_templates_for_multi_hop">19.6. BFD Templates for Multi-Hop</h3>
<div class="ulist">
<ul>
<li>
<p>Template can be used to define timers and authentication independently from the interface</p>
</li>
<li>
<p>use <strong>bfd map</strong> to associate the template with unique source-destination address pairs for multihop BFD sessions.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a BFD template</div>
<div class="content">
<pre>configure terminal
  bfd-template multi-hop &lt;template-name&gt;
  interval min-tx &lt;milliseconds&gt; min-rx &lt;milliseconds&gt; multiplier &lt;multiplier-value&gt;
  authentication &lt;authentication-type&gt; keychain &lt;keychain-name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a BFD Map</div>
<div class="content">
<pre>(config)# bfd mapipv4 vrf &lt;name&gt; &lt;destination&gt; &lt;length&gt; &lt;source-address&gt; &lt;length&gt; &lt;template-name&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bfd_multihop_support_for_ipv4_static_routes">19.7. BFD Multihop Support for IPv4 Static Routes</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The following section can be skipped
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Enables detection of IPv4 network failure between paths that are not directly connected.</p>
<div class="ulist">
<ul>
<li>
<p>If a BFD session is up , IPv4 static routes that are associated with IPv4 static BFD configuration are added to a routing table.
If the BFD session is down, the routing table removes all associated static routes from the routing table.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Applicable on different kinds of interfaces such as physical, subinterface, and virtual tunnels and across intra-area and interarea topologies.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_bfdv4_associated_mode">19.7.1. BFDv4 Associated Mode</h4>
<div class="paragraph">
<p>In BFDv4 associated mode, an IPv4
static route is automatically associated with an IPv4 static BFDv4 multihop
destination address if the static route next hop exactly matches the static
BFDv4 multihop destination address.</p>
</div>
<div class="paragraph">
<p>The state of the BFDv4 session is used to determine whether the associated IPv4
static routes are added in the IPv4 RIB. For
example, static routes are added in the IPv4 RIB only if the BFDv4 multihop
destination is reachable, and the static routes are removed from the IPv4 RIB
if the BFDv4 multihop destination subsequently becomes unreachable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bfdv4_unassociated_mode">19.7.2. BFDv4 Unassociated Mode</h4>
<div class="paragraph">
<p>In unassociate mode, a BFD neighbor is not associated with a static route, and the BFD
sessions are requested if the IPv4 static BFD is configured.</p>
</div>
<div class="paragraph">
<p>Unassociated mode is useful in the following scenario:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Absence of an IPv4 static route—This scenario occurs when a static route is on
device A, and device B is the next hop. In associated mode, you must create
both a static BFD multihop destination address and a static route on both
devices to bring up the BFDv4 session from device B to device A. Specifying the
static BFD multihop destination in unassociated mode on device B avoids the
need to configure an unwanted static route.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configuring BFD Multihop IPv4 Static Routes</div>
<div class="content">
<pre># ip route static bfd &lt;multihop-destination-address&gt; &lt;multihop-source-address&gt; unassociate</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Before you begin the configuration</div>
<div class="ulist">
<ul>
<li>
<p>Specify a BFD destination address which is same as the IPv4 static route next hop or gateway address.</p>
</li>
<li>
<p>Configure a BFD map and a BFD multihop template for an interface on the device. The destination address and source address configured for a BFD map must match the BFD static multihop configuration and the source address must be a valid IP address configured for an interface in the routing table.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bfd_on_multiple_hops">19.8. BFD on Multiple Hops</h3>
<div class="ulist">
<ul>
<li>
<p>for a destination more than one hop, and up to 255 hops, away</p>
</li>
<li>
<p>Cisco IOS Release 15.1(3)S and later</p>
</li>
<li>
<p>set up between a unique source-destination address pair provided by the client.</p>
</li>
<li>
<p>need to  configure the <strong>bfd-template</strong> and <strong>bfd map</strong> commands to create a multihop template and associate it with one or more maps of destinations and associated BFD timers. You can enable authentication and configure a key chain for BFD multihop sessions.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bfd_dampening">19.9. BFD dampening</h3>
<div class="ulist">
<ul>
<li>
<p>configures exponential delay mechanism to suppress the excessive effect of remote node reachability events flapping with BFD.</p>
</li>
<li>
<p>improves the convergence time and stability throughout the network</p>
</li>
<li>
<p>can be applied to all types of BFD sessions, including IPv4/single-hop/multihop, MPLS-TP, and Pseudo Wire (PW) Virtual Circuit Connection Verification (VCCV).</p>
</li>
<li>
<p>can be configured at the BFD template level (both single-hop and multihop templates).</p>
<div class="ulist">
<ul>
<li>
<p>Dampening is applied to all the sessions that use the BFD template.</p>
</li>
<li>
<p>If you do not want a session to be dampened, you should use a new BFD template without dampening for the new session.</p>
</li>
<li>
<p>not enabled by default</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a device to dampen a flapping BFD session.</div>
<div class="content">
<pre>(config-bfd)# dampening [ &lt;half-life-period&gt; &lt;reuse-threshold&gt; &lt;suppress-threshold&gt; &lt;max-suppress-time&gt;]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rip">20. RIP</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">IP Routing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/iproute_rip/configuration/15-mt/irr-15-mt-book/irr-cfg-info-prot.html#GUID-2651B980-3A1B-489F-98D0-93A7102AEA5D">Routing Internet Protocol</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Distance vector protocol</p>
</li>
<li>
<p>Transport: UDP 520</p>
</li>
<li>
<p>Update destination:</p>
<div class="ulist">
<ul>
<li>
<p>Broadcast 255.255.255.255 for RIPv1</p>
</li>
<li>
<p>Multicast 224.0.0.9 for RIPv2</p>
</li>
</ul>
</div>
</li>
<li>
<p>Full updates every 30 seconds</p>
</li>
<li>
<p>Trigerred updates</p>
</li>
<li>
<p>Multiple routes to the same subnet with equal metric:</p>
<div class="ulist">
<ul>
<li>
<p>Default = 4</p>
</li>
<li>
<p>Configured with <strong>ip maximum-paths <em>n</em></strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Metric: hop count with</p>
<div class="ulist">
<ul>
<li>
<p>1 signifying a directly connected network of the advertising router</p>
</li>
<li>
<p>16 signifying an unreachable network.</p>
</li>
</ul>
</div>
</li>
<li>
<p>AD: 120</p>
</li>
<li>
<p>Support CIDR, VLSM, authentication</p>
</li>
<li>
<p>Periodic updates every 30 seconds to multicast address 224.0.0.9</p>
</li>
<li>
<p>Split horizon (without poison reverse on Cisco)</p>
</li>
<li>
<p>Subnet mask included in route entry</p>
</li>
<li>
<p>Administrative distance: 120</p>
</li>
<li>
<p>Route tags when routes are redistributed into RIP</p>
</li>
<li>
<p>Can advertise a next-hop router that is different from itself</p>
<div class="ulist">
<ul>
<li>
<p>Not implemented in Cisco IOS</p>
</li>
</ul>
</div>
</li>
<li>
<p>Does not keep a separate topology table</p>
</li>
<li>
<p>Does not form neighbor relationship</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_rip_messages">20.1. RIP Messages</h3>
<div class="imageblock">
<div class="content">
<img src="../images/rip-header-format.png" alt="RIP Header Format" width="896" height="472">
</div>
<div class="title">Figure 33. RIP Header Format</div>
</div>
</div>
<div class="sect2">
<h3 id="_request_message">20.2. Request Message</h3>
<div class="ulist">
<ul>
<li>
<p>Command value = 1</p>
</li>
<li>
<p>ask a neighbor to send a partial or a full RIP update immediately,</p>
</li>
<li>
<p>Do not wait for the Update timer to expire</p>
</li>
<li>
<p>Full RIP update</p>
<div class="ulist">
<ul>
<li>
<p>if one routing entry with AF = 0 and metric = 16</p>
</li>
<li>
<p>sent when RIP process start, RIP-enabled interfaces comes up, or <strong>clear ip route</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Partial update</p>
<div class="ulist">
<ul>
<li>
<p>if one or more route entry</p>
</li>
<li>
<p>Seldom used in Cisco IOS</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_response_message">20.3. Response Message</h3>
<div class="ulist">
<ul>
<li>
<p>Command value = 2</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_default_rip_configuration">20.4. Default RIP Configuration</h3>
<div class="ulist">
<ul>
<li>
<p>Version : 1</p>
</li>
<li>
<p>Auto-summary : enable</p>
</li>
<li>
<p>Authentication : disable</p>
</li>
<li>
<p>Authentication mode: text</p>
</li>
<li>
<p>Split-horizon : enable</p>
</li>
<li>
<p>Interpacket delay : no</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_basic_configuration_2">20.5. Basic Configuration</h3>
<div class="listingblock">
<div class="content">
<pre>(config)#router rip
(config-router)#version 2
(config-router)#network 10.0.0.0
(config-router)#no auto-summary</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_version_2">20.6. Version</h3>
<div class="listingblock">
<div class="title">Task: Specify the RIP Version Globally</div>
<div class="content">
<pre>(config-router)# version {1 | 2}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure an Interface to Send Only a RIPv2 Packets</div>
<div class="content">
<pre>(config-if)ip rip send version [1] [2]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure an Interface to Receive Only a RIPv2 Packets</div>
<div class="content">
<pre>(config-if)ip rip receive version [1] [2]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authentication">20.7. Authentication</h3>
<div class="paragraph">
<p>When authentication is enabled,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The maximum number of advertised prefixes is reduced to 24.</p>
</li>
<li>
<p>The first route entry in each RIPv2 message would be carrying 20 bytes of
authentication data.</p>
</li>
<li>
<p>If cryptographic authentication methods are used, further authentication data
is placed after the entire RIPv2 message.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable RIP Authentication</div>
<div class="content">
<pre>(config-if)# ip rip authentication key-chain &lt;name&gt;
(config-if)# ip rip authentication mode {text | md5}</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use <strong>show key chain</strong> to spot invisible blank space after passwords
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_summarization">20.8. Summarization</h3>
<div class="ulist">
<ul>
<li>
<p>Default: auto-summarization</p>
<div class="ulist">
<ul>
<li>
<p>Summarizes prefixes to the classful network boundaries
when classful network boundaries are crossed.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Supernet advertisement not allowed</p>
<div class="ulist">
<ul>
<li>
<p>E.g. <strong>ip summary-address rip 10.0.0.0 252.0.0.0</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Disable Automatic Route Summarization</div>
<div class="content">
<pre>(config-router)# no auto-summary</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Summarize a Prefix</div>
<div class="content">
<pre>(config-if)# ip summary-address rip &lt;ip-address&gt; &lt;mask&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_route_updates">20.9. Route Updates</h3>
<div class="listingblock">
<div class="title">Task: Disable Sending RIP Updates on an Interface but Continue to Receive the Update</div>
<div class="content">
<pre>(config-if)# passive-interface { default | &lt;type number&gt;}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable the Validation Of the Source IP Address Of Incoming RIP Routing Updates</div>
<div class="content">
<pre>(config-router)# no validate-update-source</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Send Updates As Broadcast</div>
<div class="content">
<pre>(config-if)# ip rip v2-broadcast</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Send Updates As Unicast</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the <strong>neighbor</strong> statement does not automatically suppres sthe ssending of the broadcast or multicast update.
The additional <strong>passive-interface</strong> is required.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_route_filtering">20.10. Route Filtering</h3>
<div class="listingblock">
<div class="title">Task: Stop Advertising a Route with a Prefix-List</div>
<div class="content">
<pre>(config-router)# distribute-list prefix-list &lt;name&gt; {in | out}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Filter Out RIP Routes with Extended Access Lists</div>
<div class="content">
<pre>(config-router)# distribute-list &lt;extended-acl&gt; {in|out} [&lt;interface-id&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The source field in the ACL matches the update source of the route</p>
</li>
<li>
<p>The destination field represents the network address</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_route_metric">20.11. Route Metric</h3>
<div class="ulist">
<ul>
<li>
<p>16 unreachable network</p>
</li>
<li>
<p>Ripv2 adds 1 to the route metric while sending updates.</p>
<div class="ulist">
<ul>
<li>
<p>RIPNg and EIGRIP increment metric when they receive updates</p>
</li>
</ul>
</div>
</li>
<li>
<p>maximum routes with same metric to the same subnet</p>
<div class="ulist">
<ul>
<li>
<p>4 by default</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Add an Offset to Incoming and Outgoing Metrics to RIP Routes</div>
<div class="content">
<pre>(config-router)# offset-list &lt;acl&gt; {in | out } &lt;offset&gt; [&lt;interface-type-number&gt;]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_split_horizon">20.12. Split Horizon</h3>
<div class="listingblock">
<div class="title">Task: Disable Split Horizon</div>
<div class="content">
<pre>(config-if)# no ip split-horizon</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interpacket_delay_for_rip_updates">20.13. Interpacket Delay for RIP Updates</h3>
<div class="ulist">
<ul>
<li>
<p>Useful when high-end router send RIP updates to low-end router</p>
</li>
<li>
<p>Default: 0 in range 8 to 50 milliseconds</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Interpacket Delay</div>
<div class="content">
<pre>(config-if)# output-delay &lt;milliseconds&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rip_optimization_over_wan">20.14. Rip Optimization Over WAN</h3>
<div class="listingblock">
<div class="title">Task: Enable Triggered Extensions for RIP</div>
<div class="content">
<pre>(config)# int serial &lt;controller-number&gt;
(config-if)# ip rip triggerred</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_timers_3">20.15. Timers</h3>
<div class="listingblock">
<div class="title">Task: Configure RIP Timers</div>
<div class="content">
<pre>(config-router)# timers basic &lt;update&gt; &lt;invalid&gt; &lt;holddown&gt; &lt;flush&gt; [&lt;sleeptime&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Update timer</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Interval between updates.</p>
</li>
<li>
<p>Default: 30 seconds</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Invalid After timer</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Time in seconds after which a route is declared invalid.</p>
</li>
<li>
<p>Default: 180 seconds</p>
</li>
<li>
<p>Reset after update is received</p>
</li>
<li>
<p>Should be at least 3 times the update timer.</p>
</li>
<li>
<p>Invalid routes are still used for forwarding packets</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Holdown timer</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Interval during which routing information about better paths is suppressed.</p>
</li>
<li>
<p>Default: 180 seconds</p>
</li>
<li>
<p>Should be at least 3 times the update timer</p>
</li>
<li>
<p>The route is marked inaccessible and advertised as unreachable.</p>
</li>
<li>
<p>Holdown routes are still used for forwarding packets</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Flush After timer</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Amount of time that must pass before a route is removed from the RIB.</p>
</li>
<li>
<p>Default: 240 seconds</p>
</li>
<li>
<p>Starts at the same time than Invalid After timer</p>
</li>
<li>
<p>Cisco IOS checks this timer only after the Invalid After timer expired</p>
<div class="ulist">
<ul>
<li>
<p>No consequence If Flush timer &lt; Invalid Timer</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Sleep time</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Amount of time for which routing updates will be postponed.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Specify a Default Update Interval on an Interface</div>
<div class="content">
<pre>(config-if)# ip rip advertise &lt;seconds&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The command above overrides the update timers set by <strong>timers basic</strong> command.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eigrp">21. EIGRP</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>classless protocol (VLSM, summarization)</p>
</li>
<li>
<p>multiprotocol support (ipv4, ipv6, ipx, appletalk, )</p>
</li>
<li>
<p>uses its own transport protocol</p>
<div class="ulist">
<ul>
<li>
<p>IP protocol 88: RTP</p>
</li>
<li>
<p>Uses multicast to 224.0.0.10 and unicast</p>
</li>
</ul>
</div>
</li>
<li>
<p>Administrative distance : 90 internal routes, 5 summary routes , 170 external routes</p>
</li>
<li>
<p>Forms active neighbor adjacencies</p>
</li>
<li>
<p>DUAL for loop-free topology and fast convergence</p>
</li>
<li>
<p>granular metric</p>
</li>
<li>
<p>unequal cost load balancing</p>
</li>
<li>
<p>summarization</p>
</li>
<li>
<p>Supports MD5 and SHA based authentication</p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc7868">rfc7868</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_eigrp_packet_format">21.1. EIGRP Packet Format</h3>
<div class="imageblock">
<div class="content">
<img src="../images/eigrp-header-format.png" alt="EIGRP Packet Format" width="896" height="312">
</div>
<div class="title">Figure 34. EIGRP Packet Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Opcode</dt>
<dd>
<p>EIGRP packet type</p>
<div class="ulist">
<ul>
<li>
<p>1 = Update, 3 = Query, 4 = Reply, 5 = Hello/Ack, 10 = SIA Query, 11 = SIA Reply.</p>
</li>
<li>
<p>Other types have been allocated for different, mostly unimplemented
purposes, or are obsolete</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Checksum</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>based on the entire EIGRP packet excluding the IP header.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Flags</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>0x1 = Init (used during initial adjacency buildup)</p>
</li>
<li>
<p>0x2 = Conditional Receive (used by RTP to allow this message to be received only by a subset of receivers)</p>
</li>
<li>
<p>0x4 = Restart (indicates that a router has restarted)</p>
</li>
<li>
<p>0x8 = End-of-Table (indicates that the transmission of the entire EIGRP database is complete).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Sequence</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Facilates orderly delivery of packets</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Acknowledgement</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>sequence number of the last packet heard from the neighbor to which this
packet is being sent.</p>
</li>
<li>
<p>A Hello packet with a nonzero ACK field  will be treated as an ACK packet rather than as a Hello.</p>
</li>
<li>
<p>only unicast because acknowledgments are never multicasted.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Virtual Router Id</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>0x1 = Unicast Address Family</p>
</li>
<li>
<p>0x2 = Multicast Address Family</p>
</li>
<li>
<p>0x8000 = Unicast Service Address Family (in service advertisement framework)</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">TLV</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Field used to carry route entries as well as provide EIGRP DUAL information.</p>
<div class="ulist">
<ul>
<li>
<p>0x0001 EIGRP Parameters (General TLV Types)</p>
</li>
<li>
<p>0x0002 Authentication Type (General TLV Types)</p>
</li>
<li>
<p>0x0003 Sequence (General TLV Types)</p>
</li>
<li>
<p>0x0004 Software Version (General TLV Types)</p>
</li>
<li>
<p>0x0005 Next Multicast Sequence (General TLV Types)</p>
</li>
<li>
<p>0x0102 IPv4 Internal Routes (IP-Specific TLV Types)</p>
</li>
<li>
<p>0x0103 IPv4 External Routes (IP-Specific TLV Types)</p>
</li>
<li>
<p>0x0402 IPv6 Internal Routes (IP-Specific TLV Types)</p>
</li>
<li>
<p>0x0403 IPv6 External Routes (IP-Specific TLV Types)</p>
</li>
<li>
<p>0x0602 Multi Protocol Internal Routes (AFI-Specific TLV Types)</p>
</li>
<li>
<p>0x0603 Multi Protocol External Routes (AFI-Specific TLV Types)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_eigrp_messages">21.2. EIGRP Messages</h3>
<div class="ulist">
<ul>
<li>
<p>Unreliable packets: Hello and Ack (with Seq=0)</p>
</li>
<li>
<p>Reliable packets: Update, Query/Reply, SIA-Query/SIA-Reply</p>
<div class="ulist">
<ul>
<li>
<p>sent with non-zero SEQ</p>
</li>
<li>
<p>Must be ACK</p>
</li>
<li>
<p>are retransmitted at most 16 times for a max window of 5 secons</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Hello</dt>
</dl>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Opcode = 5</p>
</li>
<li>
<p>Multicast to 224.0.0.10 or FF02::A</p>
</li>
<li>
<p>unicast to static neighbors</p>
</li>
<li>
<p>Do not require acknowlegment</p>
</li>
<li>
<p>Can be used as Ack if sent without data</p>
</li>
<li>
<p>every 5 seconds or 60 seconds on NBMA interfaces with &lt; 1 Mbps bandwidth</p>
</li>
<li>
<p>Non-reliable</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Ack</dt>
</dl>
</div>
</li>
<li>
<p>unicast in response to Update, Query, Reply, SIA-Query, and SIA-Reply packets</p>
</li>
<li>
<p>contains a nonzero acknowledgement number set to the Sequence number of the reliable packet being acknowledged.</p>
</li>
<li>
<p>uses the same Opcode as the Hello packet</p>
</li>
<li>
<p>Non-reliable</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
it is allowed to use any unicast reliable packet to also carry an acknowledgment number.
If a router has both a unicast reliable packet to send to a neighbor and also needs to acknowledge a previously received reliable packet from that neighbor,
the sequence number of the received reliable packet can be sent along with the outbound reliable packet in its Acknowledgment number field.
It is not necessary to send a standalone ACK in this case;
the unicast reliable packet carrying a nonzero Acknowledgment number field will be processed by its recipient both by its true type and as an ACK.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Update</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>reliable</p>
</li>
<li>
<p>unicast during a new adjacency buildup, Update packets are unicasted between the
newly discovered neighbors.</p>
<div class="ulist">
<ul>
<li>
<p>In specific cases, when multiple new neighbors are detected on a single multiaccess interface in a short time span,
EIGRP might choose to synchronize to them using multicasts for efficiency reasons
(for example, when a hub router in a DMVPN network starts and detects tens or hundreds of spoke routers).</p>
</li>
</ul>
</div>
</li>
<li>
<p>multicast after routers have fully synchronized</p>
</li>
<li>
<p>unicast if a neighbor does not acknowledge the arrival of an Update packet</p>
</li>
<li>
<p>always unicasts on point-to-point interfaces and for statically configured neighbors</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Query</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Opcode = 3</p>
</li>
<li>
<p>reliable</p>
</li>
<li>
<p>multicast unless in response to a received query</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Reply</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Opcode = 4</p>
</li>
<li>
<p>unicast</p>
</li>
<li>
<p>indicates that it does not need to go into Active state
because it has a FS</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Request</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unicast or multicast</p>
</li>
<li>
<p>get specific info from neighbors</p>
</li>
<li>
<p>used in route server applications</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SIA-Query</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Opcode = 10</p>
</li>
<li>
<p>unicast</p>
</li>
<li>
<p>used during a prolonged diffusing computation to verify whether a neighbor
that has not yet sent a Reply to a Query is truly reachable and still engaged
in the corresponding diffusing computation. The SIA-Query packet is used to
ask a particular neighbor to confirm that it is still working on the original
Query. If the neighbor is reachable and is still engaged in the diffusing
computation for the destination specified in the SIA-Query, it will
immediately respond with an SIA-Reply packet.  As a result, the timer that
governs the maximum time a diffusing computation is allowed to run is reset,
giving the computation extra time to finish</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SIA-Request</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Opcode = 11</p>
</li>
<li>
<p>unicast</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Show Statistics About Messages Sent and Received</div>
<div class="content">
<pre># show ip eigrp traffic

EIGRP-IPv4 VR(CCIE) Address-Family Traffic Statistics for AS(1)
  Hellos sent/received: 1132/6090
  Updates sent/received: 169/428
  Queries sent/received: 0/0
  Replies sent/received: 0/0
  Acks sent/received: 74/191
  SIA-Queries sent/received: 0/0
  SIA-Replies sent/received: 0/0
  Hello Process ID: 246
  PDM Process ID: 244
  Socket Queue: 0/10000/7/0 (current/max/highest/drops)
  Input Queue: 0/2000/7/0 (current/max/highest/drops)</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Debug EIGRP</div>
<div class="content">
<pre>debug ip eigrp packet [hello | ack | update } quey | reply]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_neighbors_3">21.3. Neighbors</h3>
<div class="ulist">
<ul>
<li>
<p>Discovered with Hello packets</p>
</li>
<li>
<p>can be set manually</p>
</li>
<li>
<p>must agree on</p>
<div class="ulist">
<ul>
<li>
<p>Primary IPv4 subnet</p>
</li>
<li>
<p>Autonomous System Number</p>
</li>
<li>
<p>Authentication</p>
</li>
<li>
<p>K values</p>
</li>
</ul>
</div>
</li>
<li>
<p>Do not need to agree on timers</p>
<div class="ulist">
<ul>
<li>
<p>The hold time is included in the hello packets so each neighbor should stay alive even though the hello interval and hold timers do not match.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
After a static neighbor is defined, all EIGRP multicasts on the
interface through which the neighbor is reachable will be disabled. As a
result, EIGRP-enabled routers will not establish an adjacency if one router is
configured to use unicast (static) while another uses multicast (dynamic) on
the same link. Here’s another way of putting this rule: Either all neighbors on
a common network segment are statically configured for each other, or none of
them are.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Adjust EIGRP Hello Interval</div>
<div class="content">
<pre>(config-if)# ip hello-interval eigrp &lt;asn&gt; &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Adjust EIGRP Holdown Time</div>
<div class="content">
<pre>(config-if)# ip hold-time eigrp &lt;asn&gt; &lt;seconds&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Changing the Hello interval does not result in automatic recalculation
of the Hold time. This can, under certain circumstances, result in problems
with flapping adjacencies if the Hello interval is manually configured to be
close or even higher than the default Hold time, without changing the Hold
timer itself.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Verify Neighbor Adjacencies</div>
<div class="content">
<pre># sh ip eigrp neighbors [detail]

IP-EIGRP neighbors for process 1
H  Address    Interface  Hold Uptime    SRTT   RTO  Q  Seq
                         (sec)           (ms)       Cnt Num
1  10.10.10.3 Fa0/0       11   00:00:08    87   522  0   6
0  10.10.10.2 Fa0/0       14   00:01:54  1300  5000  0   3</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Q Cnt indicates the number of enqueued reliable packets, that is, packets that
have been prepared for sending and even possibly sent but for which no ACK has been received yet from the neighbor. In a stable network, the Q Cnt value must be zero; non- zero values are normal during initial router database synchronization or during network convergence. If the Q Cnt value remains nonzero for prolonged periods of time, however, it indicates a communication problem with the neighbor.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Exchange EIGRP Packets Only As Unicast</div>
<div class="content">
<pre>(config-router)# neighbor &lt;a.b.c.d&gt; &lt;interface-id&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Exchange EIGRP Packets Only As Unicast In Named Configuration</div>
<div class="content">
<pre>(config-router-af-interface)# neighbor &lt;a.b.c.d&gt; &lt;interface-id&gt;</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/eigrp-adjacency-creation.svg" alt="Adjacency Formation" width="582" height="608">
</div>
<div class="title">Figure 35. Adjacency Formation</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
EIGRP does not build peer relationships over secondary addresses. All EIGRP traffic is sourced from the primary address of the interface.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_eigrp_loop_prevention_techniques">21.4. EIGRP Loop Prevention Techniques</h3>
<div class="sect3">
<h4 id="_split_horizon_2">21.4.1. Split Horizon</h4>
<div class="ulist">
<ul>
<li>
<p>Enabled by default on all interfaces</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Disable Split Horizon for EIGRP</div>
<div class="content">
<pre>(config-if)# no ip split-horizon eigrp &lt;asn&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable Split Horizon In Named Configuration</div>
<div class="content">
<pre>(config-router-af-interface)# no split-horizon</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_classic_metric">21.5. Classic Metric</h3>
<div class="paragraph">
<p>\$Metric = 256 * ((k_1 * B\a\n\dwidth + (k_2 * B\a\n\dwidth)/(256 - Load) + k_3 * Delay)) * ( k_5 / (Reliability + k_4) )\$</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default Values: \$k_1,k_2,k_3,k_4,k_5 = 1,0,1,0,0\$</p>
</li>
<li>
<p>The values of K must match for the neighbors to become adjacents</p>
</li>
<li>
<p>EIGRP uses integer division while calculating the metric</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Description</div>
<div class="content">
<pre>(config-router)# metric weights</pre>
</div>
</div>
<div class="sect3">
<h4 id="_bandwith_metric_component">21.5.1. Bandwith Metric Component</h4>
<div class="ulist">
<ul>
<li>
<p>\$frac {10^(7)} { "minimum Bandwidth in Kbps"} \$</p>
</li>
<li>
<p>Range: 1 Mbps to 10 Gpbs</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Bandwidth Of an Interface</div>
<div class="content">
<pre>(config-if)# bandwidth &lt;kbps&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delay_metric_component">21.5.2. Delay Metric Component</h4>
<div class="ulist">
<ul>
<li>
<p>in tens-of-microseconds</p>
</li>
<li>
<p>sum of delay on the path to the destination</p>
</li>
<li>
<p>Range: 1..16_777_214</p>
</li>
<li>
<p>EIGRP split horizon with poison reverse, route withdrawal uses max delay 16,777,215 to indicate an  unreachable network</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>show ip interface</strong> displays delay in micro-seconds
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Delay Of an Interface</div>
<div class="content">
<pre>(config-if)# delay &lt;tens-of-microseconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reliability_metric_component">21.5.3. Reliability Metric Component</h4>
<div class="ulist">
<ul>
<li>
<p>likelihood of successful packet transmission with 0 means 0% and 255 means 100%</p>
</li>
<li>
<p>Minimum value along the path</p>
</li>
<li>
<p>EIGRP does not send a new update every time the reliability changes along the path</p>
</li>
<li>
<p>The reliability metric of a route is just a snapshot of its then-current reliability when it was last advertised.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_load_metric_component">21.5.4. Load Metric Component</h4>
<div class="ulist">
<ul>
<li>
<p>Maximum effective Txload of the route with 255 means 100% loading</p>
</li>
<li>
<p>To account for large differences in the momentary load caused by bursty traffic,
IOS actually computes an exponentially weighted average over the
momentary load that smooths out short-lived load swings.</p>
</li>
<li>
<p>Because an interface can be differently utilized in the ingress and egress data flow direction,
IOS maintains two independent load metric counters, the Txload for outgoing traffic and Rxload for incoming traffic.</p>
</li>
<li>
<p>EIGRP does not send a new update every time the load changes along the path</p>
</li>
<li>
<p>The load metric of a route is just a snapshot of its then-current load when it was last advertised.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mtu_metric_component">21.5.5. MTU Metric Component</h4>
<div class="ulist">
<ul>
<li>
<p>minimum Maximum transmission unit</p>
</li>
<li>
<p>advertised but not factored into the composite metric calculation and does not impact the best-path selection in any way</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_hop_count_metric_component">21.5.6. Hop Count Metric Component</h4>
<div class="ulist">
<ul>
<li>
<p>Default max value: 100, can be set to 255</p>
</li>
<li>
<p>not factored into the composite metric calculation and does not impact the best-path selection in any way</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Change the max hop count</div>
<div class="content">
<pre>(config-router)# metric maximum-hops &lt;1-255&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_routing_metric_offset_lists">21.5.7. Routing Metric Offset Lists</h4>
<div class="paragraph">
<p>TODO</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When trying to manually influence EIGRP path selection through interface bandwidth/delay configuration,
the modification of bandwidth is discouraged for following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The change will only affect the path selection
if the configured value is the lowest bandwidth over the entire path. Changing the bandwidth can have
impact beyond affecting the EIGRP metrics. For example, QoS also looks at the bandwidth on an interface.</p>
</li>
<li>
<p>EIGRP by default throttles to use 50 percent of the configured bandwidth.
Lowering the bandwidth can cause problems like starving EIGRP neighbors from
getting packets because of the throttling back. Configuring an excessively
high bandwidth can lead EIGRP to consume more bandwidth than physically
avail- able, leading to packet drops.</p>
</li>
<li>
<p>Changing the delay does not impact other protocols nor does it cause EIGRP to
throttle back, and because, as it’s the sum of all delays, has a direct
effect on path selection.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wide_metric">21.6. Wide Metric</h3>
<div class="paragraph">
<p>TODO Narbick figure 8.2</p>
</div>
<div class="paragraph">
<p>\$Metric = ((k_1* Throughput + (k_2* (Throughput )/ (256-Load) + (k_3*TotalLatency) + (k_6*ExtendedA\t\t\ributes))* (k_5/(k_4 + Reliability)) \$</p>
</div>
<div class="ulist">
<ul>
<li>
<p>uses by default in Named Configuration Mode</p>
</li>
<li>
<p>Use one of the following commands to confirm wide metric support:</p>
<div class="ulist">
<ul>
<li>
<p><strong>sh eigrp plugins</strong></p>
</li>
<li>
<p><strong>sh eigrp tech-support</strong></p>
</li>
<li>
<p><strong>sh ip protocols</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>needs to be downscaled because the RIB can only handle 32-bit metric</p>
<div class="ulist">
<ul>
<li>
<p>default value: 128</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Change the Scale</div>
<div class="content">
<pre>(config-router)# metric rib-scale &lt;1..255&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The downscaled value is not used by EIGRP in any way. EIGRP makes all its path selections based on the
Wide Metrics composite value; only after a best path toward a destination is selected, its
composite metric value is downscaled as the route is installed to the RIB.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_throughput">21.6.1. Throughput</h4>
<div class="ulist">
<ul>
<li>
<p>~ bandwidth</p>
</li>
<li>
<p>65536 * 10^7 / bandwitdh_in_kbps</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_latency_metric_component">21.6.2. Latency Metric Component</h4>
<div class="ulist">
<ul>
<li>
<p>~ delay</p>
</li>
<li>
<p>On interfaces physically operating on speeds of 1 Gbps and lower without bandwidth and delay commands,
the interface delay is simply its IOS-based default delay converted to picoseconds.</p>
</li>
<li>
<p>On interfaces physically operating on speeds over 1 Gbps without bandwidth and delay commands, the interface delay is computed as 10<sup>13</sup> / interface default bandwidth.</p>
</li>
<li>
<p>On interfaces configured with the explicit bandwidth command and without the delay command, regardless of their physical operating speed,
the interface delay is the IOS-based default delay converted to picoseconds.</p>
</li>
<li>
<p>On interfaces configured with explicit delay command, regardless of their physical operating speed and the bandwidth setting,
the interface delay is computed as its specified delay value converted to picoseconds, that is, 10<sup>7</sup> * value of the delay command
(recall that the delay command defines the delay in tens of microseconds)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_reliability">21.6.3. Reliability</h4>
<div class="ulist">
<ul>
<li>
<p>same than Classic Reliability</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_load">21.6.4. Load</h4>
<div class="ulist">
<ul>
<li>
<p>same than Classic Load</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mtu">21.6.5. MTU</h4>
<div class="ulist">
<ul>
<li>
<p>same than classic MTU</p>
</li>
<li>
<p>advertised but unused</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_hop_count">21.6.6. Hop Count</h4>
<div class="ulist">
<ul>
<li>
<p>same than classic Hop Count metric component</p>
</li>
<li>
<p>advertised but unusedd</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_extended_metrics">21.6.7. Extended Metrics</h4>
<div class="ulist">
<ul>
<li>
<p>placeholders for future extensions to the composite metric computation.</p>
</li>
<li>
<p>As of this writing, three extended metrics were defined: Jitter, Energy, and Quiescent Energy.</p>
</li>
<li>
<p>Uses K6</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reliable_transport_protocol">21.7. Reliable Transport Protocol</h3>
<div class="ulist">
<ul>
<li>
<p>guarantees delivery in order</p>
</li>
<li>
<p>Update, Query, Reply, SIA-Query, SIA-Request packets</p>
</li>
<li>
<p>uses Conditional Receive for reliable and efficient multicast</p>
<div class="ulist">
<ul>
<li>
<p>partition all its neighbors on a multiaccess interface into two groups: a
group of well-behaved neighbors that have been able to acknowledge all
multicast messages sent so far and a group of “lagging” routers that have
failed to acknowledge at least one transmitted reliable EIGRP packet and that
must be handled individually. If EIGRP wants to continue sending the
multicast packets in parallel with retransmitting the unacknowledged packets
to the lagging routers as unicasts, it has to send the in-order multicast
packets with a special flag saying “this packet is only for those routers
that have received all multicast packets so far.”</p>
</li>
<li>
<p>accomplished by the sender first transmitting a Hello packet with two
specific TLVs called the Sequence TLV and the Next Multicast Sequence TLV,
often called a Sequenced Hello. The Next Multicast Sequence TLV contains the
upcoming sequence number of the next reliable multicasted message. The
Sequence TLV contains a list of all lagging neighbors by their IP address, in
effect saying “whoever finds himself in this list, ignore the next multicast
message with the indicated sequence number.” A neighbor receiving this
Sequenced Hello packet and not finding itself in the Sequence TLV will know
that it is expected to receive the upcoming multicast packet, and will put
itself into a so-called Conditional Receive mode (CR-mode). A neighbor
receiving this Sequenced Hello packet and finding itself in the Sequence TLV,
or a neighbor not receiving this Hello packet at all for whatever reason will
not put itself into the CR-mode.  Afterward, the sending router will send the
next multicast packet with the CR flag set in its Flags field. Routers in
CR-mode will process this packet as usual and then exit the CR-mode; routers
not in CR-mode will ignore it. As a result, the router is able to continue
using multicast with those routers that have no issues receiving and
acknowledging it, while making sure that the lagging neighbors won’t process
the multicasts until they are able to catch up. Each lagging neighbor that has
not acknowledged one or more multicast packets will be sent these packets as
unicasts in their proper sequence.</p>
</li>
<li>
<p>multicast flow timer: time to wait for an ACK before declaring a neighbor as lagging and switching from multicast to unicast</p>
</li>
<li>
<p>RTO (Retransmission Time Out): the time between the subsequent unicasts</p>
</li>
<li>
<p>SRTT (Smooth Round Trip Time): average elapsed time in milliseconds, between the transmission of a reliable packet to the neighbor and the receipt of an acknowledgment.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_eigrp_autonomous_system_configuration">21.8. EIGRP Autonomous System Configuration</h3>
<div class="ulist">
<ul>
<li>
<p>created with the command  <strong>router eigrp</strong> &lt;autonomous-system-number&gt;</p>
</li>
<li>
<p>EIGRP VPNs can be configured only under IPv4 address family. A VRF instance and route distinguisher must be defined before the address family session can be created.</p>
</li>
<li>
<p>recommendation: configure the asn when the address family is configured by <strong>router eigrp</strong> &lt;asn&gt; <strong>address-family</strong> or seperately using the <strong>autonomous-system</strong> command.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_eigrp_named_configuration">21.9. EIGRP Named Configuration</h3>
<div class="ulist">
<ul>
<li>
<p>Global params under SAFI or in <strong>config-router-topology base</strong> mode</p>
</li>
<li>
<p>interface params in <strong>config-router-af-interface</strong> mode</p>
</li>
<li>
<p>wide-meric scaling automatic enabled</p>
</li>
<li>
<p>can be configured in IPv4 and IPv6 named configuration</p>
</li>
<li>
<p>VRF instance and a RD are optional</p>
</li>
<li>
<p>EIGRP IPv6 VRF-lite feature is available only in EIGRP named configuration</p>
</li>
<li>
<p>EIGRP VPNs can be configured. A VRF and RD must be defind before the address-family session can be created.</p>
</li>
<li>
<p>a single EIGRP routing process can support multiple VRFs.  However, a single VRF can be supported by each VPN . Redistribution between VRFs is not supported.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Basic EIGRP Named Configuration</div>
<div class="content">
<pre>(config)# router eigrp &lt;virtual-instance-name&gt;
(config-router)# address-family ipv4 [multicast] [umicast] [vrf &lt;vrf-name&gt;] autonomous-system &lt;asn&gt;
(config-router-af)# network &lt;a.b.c.d&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Convert Classic Configuration to EIGRP Named Configuration</div>
<div class="content">
<pre># eigrp upgrade-cli name</pre>
</div>
</div>
<div class="sect3">
<h4 id="_address_family_section">21.9.1. Address Family Section</h4>
<div class="listingblock">
<div class="content">
<pre>(config-router-af)# ?
Address Family configuration commands:
  af-interface        : Enter Address Family interface configuration
  default             : Set a command to its defaults
  eigrp               : EIGRP Address Family specific commands
  exit-address-family : Exit Address Family configuration mode
  maximum-prefix      : Maximum number of prefixes acceptable in aggregate
  metric              : Modify metrics and parameters for advertisement
  neighbor            : Specify an IPv4 neighbor router
  network             : Enable routing on an IP network
  shutdown            : Shutdown address family
  timers              : Adjust peering based timers
  topology            : Topology configuration mode</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_per_af_interface_section">21.9.2. Per-AF-Interface Section</h4>
<div class="listingblock">
<div class="content">
<pre>(config-router-af-interface)# ?
Address Family Interfaces configuration commands:

add-paths          : Advertise add paths
authentication     : authentication subcommands
bandwidth-percent  : Set percentage of bandwidth percentage limit
bfd                : Enable Bidirectional Forwarding Detection
dampening-change   : Percent interface metric must change to cause update
dampening-interval : Time in seconds to check interface metrics
default            : Set a command to its defaults
exit-af-interface  : Exit from Address Family Interface configuration mode
hello-interval     : Configures hello interval
hold-time          : Configures hold time
next-hop-self      : Configures EIGRP next-hop-self
passive-interface  : Suppress address updates on an interface
shutdown           : Disable Address-Family on interface
split-horizon      : Perform split horizon
summary-address    : Perform address summarization</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_per_af_topology_configuration_section">21.9.3. Per-AF-Topology Configuration Section</h4>
<div class="paragraph">
<p>Within the context of Multi Topology Routing, a topology is defined as a subset
of rout- ers and links in a network for which a separate set of routes is
calculated. The entire net- work itself, for which the usual set of routes is
calculated, is known as the base topology. The base topology is the default
routing environment that exists prior to enabling MTR. Any additional
topologies are known as class-specific topologies and are a subset of the base
topology. Each class-specific topology carries a class of traffic and is
characterized by an independent set of Network Layer Reachability Information
(NLRI) that is used to maintain separate routing tables and FIB databases. This
design allows the router to per- form independent route calculation and
forwarding for each topology. Multiple topolo- gies can be used to segregate
different classes of traffic, such as data, voice, and video, and carry them
over different links in the same physical network, or to keep separate and
independent topologies for IPv4 and IPv6 routing. Multiple topologies are not
equivalent to Virtual Routing and Forwarding (VRF) tables because they share
the common address space, and they are not intended to provide address
conservation or reuse.</p>
</div>
<div class="paragraph">
<p>EIGRP is capable of keeping separate routing information for different
topologies, and its behavior per specific topology within an address family can
be configured in the per-AF- topology section. On routers without MTR support,
only the topology base command will be available; on routers supporting MTR,
the topology command will allow referenc- ing a particular separate topology
table definition by its name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router-af-topology)# ?
Address Family Topology configuration commands:

auto-summary        : Enable automatic network number summarization
default             : Set a command to its defaults
default-information : Control distribution of default information
default-metric      : Set metric of redistributed routes
distance            : Define an administrative distance
distribute-list     : Filter entries in eigrp updates
eigrp               : EIGRP specific commands
exit-af-topology    : Exit from Address Family Topology configuration mode
maximum-paths       : Forward packets over multiple paths
metric              : Modify metrics and parameters for advertisement
offset-list         : Add or subtract offset from EIGRP metrics
redistribute        : Redistribute IPv4 routes from another routing protocol
snmp                : Modify snmp parameters
summary-metric      : Specify summary to apply metric/filtering
timers              : Adjust topology specific timers
traffic-share       : How to compute traffic share over alternate paths
variance            : Control load balancing variance</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Modify administrative distance</div>
<div class="content">
<pre>(config-router)# distance eigrp &lt;internal-routes&gt; &lt;external-routes&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Modify the administrative distance on a per-prefix basis</div>
<div class="content">
<pre>(config-router)# distance &lt;1-255&gt; &lt;source-ip&gt; &lt;source-wild-card&gt; [&lt;acl&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The AD for EIGRP internal routes can be changed on a per-prefix basis,
but external EIGRP routes cannot
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dual">21.10. DUAL</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Diffusing Computation</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A distributed computation in which a single starting node commences the
computation by delegating subtasks of the computation to its neighbors that
may, in turn, recursively delegate sub-subtasks further, including a
signaling scheme allowing the starting node to detect that the computation
has finished while avoiding false terminations.</p>
</li>
<li>
<p>In DUAL, the task of coordinated updates of routing tables and resulting best
path computation is performed as a diffusing computation.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Diffusing Update Algorithm (DUAL)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A loop-free routing algorithm used with distance vectors or link states
that provides a diffused computation of a routing table.</p>
</li>
<li>
<p>works very well in the presence of multiple topology changes with low overhead.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_topology_table">21.10.1. Topology Table</h4>
<div class="ulist">
<ul>
<li>
<p>stores information about every known destination</p>
</li>
<li>
<p>network prefix/length, FD, CD, RD and route state</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display EIGRP Topology Table</div>
<div class="content">
<pre># show ip eigrp topology [as-number | [[ip-address] mask]] [active | all-links | pending | summary | zero-successors]

IP-EIGRP Topology Table for process 77

Codes: P - Passive, A - Active, U - Update, Q - Query, R - Reply,
      r - Reply status

P 172.16.90.0 255.255.255.0, 2 successors, FD is 0
         via 172.16.80.28 (46251776/46226176), Ethernet0
         via 172.16.81.28 (46251776/46226176), Ethernet1
         via 172.16.80.31 (46277376/46251776), Serial0
P 172.16.81.0 255.255.255.0, 1 successors, FD is 307200
         via Connected, Ethernet1
         via 172.16.81.28 (307200/281600), Ethernet1
         via 172.16.80.28 (307200/281600), Ethernet0
         via 172.16.80.31 (332800/307200), Serial0</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">P - Passive</dt>
<dd>
<p>No EIGRP computations are being performed for this destination.</p>
</dd>
<dt class="hdlist1">A - Active</dt>
<dd>
<p>EIGRP computations are being performed for this destination.</p>
</dd>
<dt class="hdlist1">U - Update</dt>
<dd>
<p>Indicates that an update packet was sent to this destination.</p>
</dd>
<dt class="hdlist1">Q - Query</dt>
<dd>
<p>Indicates that a query packet was sent to this destination.</p>
</dd>
<dt class="hdlist1">R - Reply</dt>
<dd>
<p>Indicates that a reply packet was sent to this destination.</p>
</dd>
<dt class="hdlist1">r - Reply</dt>
<dd>
<p>status Flag that is set after the software has sent a query and is waiting for a reply.</p>
</dd>
<dt class="hdlist1">RD</dt>
<dd>
<p>Reported Distance</p>
</dd>
<dt class="hdlist1">CD</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Computed Distance = RD + link cost</p>
</li>
<li>
<p>Total metric along a path from the current router to a destination network
through a particular neighbor computed using that neighbor&#8217;s Reported
Distance (RD) and the cost of the link between the two routers.</p>
</li>
<li>
<p>Exactly one CD is computed and maintained per the [Destination, Advertising
Neighbor] pair.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">FD</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Feasible Distance</p>
</li>
<li>
<p>least-known total metric to a destination from the current router
since the last transition from the Active to Passive state.</p>
</li>
<li>
<p>not necessarily equal to the current best CD to a destination.</p>
<div class="ulist">
<ul>
<li>
<p>There is exactly one FD per each destination, regardless of the number of neighbors.</p>
</li>
<li>
<p>FD is an internal variable maintained for each network known to EIGRP
whose value is never advertised to another router.</p>
</li>
</ul>
</div>
</li>
<li>
<p>lowest bandwidth on the path to this destination as reported by the upstream neighbor</p>
</li>
<li>
<p>total delay</p>
</li>
<li>
<p>path reliability</p>
</li>
<li>
<p>path loading</p>
</li>
<li>
<p>minimum path maximum transmission unit (MTU)</p>
</li>
<li>
<p>feasible distance</p>
</li>
<li>
<p>reported distance</p>
</li>
<li>
<p>route source (external routes are marked)</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_feasibility_condition">21.10.2. Feasibility Condition</h4>
<div class="ulist">
<ul>
<li>
<p>Feasibility condition: RD &lt; FD</p>
<div class="ulist">
<ul>
<li>
<p>sufficient but not necessary condition</p>
</li>
<li>
<p>not every loop-free path satisfies the FC</p>
</li>
<li>
<p>proven by Dr. J. J. Garcia-Luna-Aceves</p>
</li>
<li>
<p>also called the Source Node Condition</p>
</li>
</ul>
</div>
</li>
<li>
<p>Feasible Successor: Neighbor that satisfy the FC</p>
</li>
<li>
<p>successor: Feasible Successor with the least CD</p>
<div class="dlist">
<dl>
<dt class="hdlist1">SDAG</dt>
</dl>
</div>
</li>
<li>
<p>Successor&#8212;&#8203;Directed Acyclic Graph</p>
</li>
<li>
<p>For a particular destination, a graph defined by routing table contents of
individual routers in the topology, such that nodes of this graph are the
routers themselves and a directed edge from router X to router Y exists if
and only if router Y is router X&#8217;s successor.</p>
</li>
<li>
<p>After the network has converged, in the absence of topological changes, SDAG is a tree.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_topology_changes">21.10.3. Topology Changes</h4>
<div class="ulist">
<ul>
<li>
<p>A topology change occurs whenever the distance to a network changes or a new neighbor comes online that advertises the network.</p>
<div class="ulist">
<ul>
<li>
<p>The distance change can be detected either through receiving an Update, Query, Reply, SIA- Query, or SIA-Reply packet from a neighbor that carries updated
metric information about the network, or because a local interface metric has changed.</p>
</li>
<li>
<p>Also, the event of a neighbor going down is processed by setting the CD/RD of all networks reachable through that neighbor to infinity.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Whenever EIGRP detects a topology change,</p>
<div class="ulist">
<ul>
<li>
<p>it first records the change into the topology table and updates the RD and CD of the neighbor that advertised
the change (in case of a received EIGRP message) or was influenced by it (in case of a link metric change).</p>
</li>
<li>
<p>From among all neighbors that advertise the network, EIGRP identifies the one
that provides the least CD, taking into account the updated CDs. Note that the
FC is not invoked at this step.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Only after identifying the neighbor offering the least CD, EIGRP verifies
whether this neighbor meets the FC and is therefore a Feasible Successor. If it
is, EIGRP will promote it to the Successor and start using it right away. If,
however, that neighbor does not meet the FC, EIGRP will put the route into the
Active state and send out Queries, asking its neighbors to assist in locating
the best route.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_local_computation">21.10.4. Local Computation</h4>
<div class="ulist">
<ul>
<li>
<p>After a topology changes, if the best path is through a Feasible Successor,
do the following:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the Feasible Successor Providing the Least CD Is Made the New Successor.</p>
</li>
<li>
<p>If the CD Over the New Successor Is Less Than the Current FD, the FD Will Be Updated to the New CD; Otherwise It Stays at Its Current Value.</p>
</li>
<li>
<p>the Routing Table Is Updated to Point Toward the New Successor.</p>
</li>
<li>
<p>If the Current Distance to the Destination Has Changed As a Result Of Switching to a New Successor, an Update Packet Is Sent to All Neighbors, Advertising the Router’S Updated Distance to the Destination.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_diffusing_computation">21.10.5. Diffusing Computation</h4>
<div class="paragraph">
<p>If after a topology changes , if the router finds out that the new shortest path is provided by a neighbor that is not a Feasible Successor,
do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The entry in the routing table, still pointing to the current unchanged Successor, is locked: It must not be removed nor its next hop changed until the diffusing compu- tation is finished and the route has been moved to the Passive state again.</p>
</li>
<li>
<p>The FD is set to the current (possibly increased) CD through the current unchanged Successor. Also, if this router ever needs to advertise its distance to the network while in the Active state, it will also use the value of the current CD through the Successor.</p>
</li>
<li>
<p>The network is put into the Active state and the router sends out a Query packet to all its neighbors. This Query packet contains the Active network’s prefix and the router’s current CD toward it.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_one_single_topology_change">One Single Topology Change</h5>
<div class="paragraph">
<p>Each neighbor receiving a Query packet will process it by updating its own
topology table using the distance information advertised in the Query and
reevaluating its own choice of Successors and Feasible Successors.
Two possibilities now exist: Either the neighbor still has its own Feasible
Successor or a Successor that provides it with the least- cost loop-free path,
or the information contained in the Query causes the neighbor to stop
considering the path through its current Successor the shortest available and
none of its own neighbors that offer the shortest path are a Feasible
Successor.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_topology_changes">21.10.6. Multiple Topology Changes</h4>
<div class="ulist">
<ul>
<li>
<p>Uses DUAL Finite State Machine to handle multiple topology changes occuring a simple diffusing computation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/eigrp-dual-fsm.png" alt="DUAL finite state machine" width="600" height="800"></span></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">States</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>P : Passive</p>
</li>
<li>
<p>A0: Local Origin with Distance Increase</p>
</li>
<li>
<p>A1: Local Origin</p>
</li>
<li>
<p>A2: Multiple Origins</p>
</li>
<li>
<p>A3: Successor Origin</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Rules</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Unless a change in distance occurs such that the neighbor providing the least CD fails to meet the FC,
the route remains passive.</p>
</li>
<li>
<p>If a Query is received from the current Successor and, after processing the
distance indicated in this Query, the neighbor that provides the least
CD fails to meet the FC, the route will enter the A3 active state.</p>
<div class="ulist">
<ul>
<li>
<p>The router will send out Queries and wait for Replies.</p>
</li>
<li>
<p>If no further distance increase is detected while waiting for the Replies,
the last Reply allows the router to
transition back to the Passive state,
reinitialize the FD,
and choose any neighbor that provides the least CD as the new Successor.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If a distance change caused by other means than a Query from a Successor is
detected (this can be caused by receiving an Update, changing an interface
metric, or losing a neighbor) and after processing the change, the neighbor
that provides the least Computed Distance fails to meet the Feasibility
Condition, the route will enter the A1 active state, also called the Local
Origin Active State. The router will send out Queries and wait for Replies.
If no further distance increase or Query from the current Successor is
received while waiting for the Replies, the last Reply allows the router to
transition back to the Passive state, reinitialize the Feasible Distance, and
choose any neighbor that provides the least Computed Distance as the new
Successor.</p>
</li>
<li>
<p>If during the stay in the A3 (Successor Origin) or A1 (Local Origin) active
states, another distance increase caused by other means than the Successor’s
Query is detected, another topology change during the diffusing computation
has occurred.  Because the router cannot advertise this updated distance
while it is in the Active state, other routers might not be informed about it
and their Replies might not take this new increased distance into account.
Therefore, extra scrutiny is applied to the received Replies instead of
simply choosing the neighbor that provides the least Computed Distance.  This
is accomplished first by changing the state from A3 (Successor Origin) to A2
(called Multiple Origins), or from A1 (Local Origin) to A0 (no official name;
we will call it Local Origin with Distance Increase) states.  In A2 or A0
states, the router waits to receive all remaining Replies. When the last
Reply arrives, the router will first check whether the neighbor providing the
least Computed Distance passes the Feasible Condition check using the
Feasibility Distance value set when the route entered the Active state
(recall that it was set to the increased distance through the current
Successor at the moment of transition- ing to the Active state). This extra
check essentially mimics a situation in which the router is actually using
the path through the current Successor and has just detected the distance
increase, so it uses the current value of Feasibility Distance to verify
whether the neighbor providing the least Computed Distance passes the
Feasibility Condition. If it does, the route becomes Passive again, and the
neighbor is chosen as the Successor. If it does not, however, the route will
return from A0 (Local Origin with Distance Increase) to A1 (Local Origin) or
from A2 (Multiple Origins) to A3 (Successor Origin) and the router will
commence another diffusing computation by again sending a Query.</p>
</li>
<li>
<p>If during the stay in A1 (Local Origin) or A0 (Local Origin with Distance
Increase) active states a Query from the Successor is received, another
topology change dur- ing the diffusing computation has occurred. Because the
router cannot advertise this updated distance while it is in the Active
state, other routers might not be informed about it and their Replies might
not take this new increased distance into account. Therefore, extra scrutiny
is applied to the received Replies. This is accomplished by changing the
state to A2 (Multiple Origins) and then proceeding from that state just like
in the previous case</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Display Details on EIGRP Active States</div>
<div class="content">
<pre># sh ip eigrp topology active</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_stuck_in_active">21.10.7. Stuck-In-Active</h4>
<div class="ulist">
<ul>
<li>
<p>when all expected Replies are not received before the <strong>Active</strong> timer ( default= 3 minutes ) expires after first Query</p>
<div class="ulist">
<ul>
<li>
<p>The neighbors that did not reply will be removed from the neighbor table and
their adjacencies torn down, and the diffusing computation will consider these neighbors to have responded with an infinite metric.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If a neighbor does not respond to a Query message with its Reply within half of
the Active timer time, the router will send the neighbor a SIA-Query message.
The SIA- Query stands for a message saying “Are you still working on my Query?”
If the neigh- bor is able to receive and process this SIA-Query, it will
immediately respond with the SIA-Reply message. The contents of the SIA-Reply
can either say “Yes, I still expect my own neighbors to send me the Replies
I’ve asked them for” or “No, the computation is finished; this is my current
metric to the destination.” In any case, the SIA-Reply is sent immediately as a
response to the SIA-Query message; there is nothing to wait for. Receiving an
SIA-Reply allows the Active timer to be reset, giving the diffusing computa-
tion an additional time to complete. At most three SIA-Queries can be sent,
each after half of the Active timer. If the diffusing computation is not
finished by the time the third SIA-Query was replied to by an SIA-Reply and the
half of the Active timer expired again, the adjacency to the neighbor will be
dropped. The same will happen if an SIA-Query
is not responded to by an SIA-Reply within the next half of the Active timer.
With the default setting of the Active timer to 180 seconds, three consecutive
SIA-Query packets allow extending the diffusing computation to a maximum of 4 ×
90 = 360 seconds (90 seconds to the first SIA-Query, plus each SIA-Query buying
another 90 seconds).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Control the Time That the Router Waits (After Sending a Query) Before Declaring the Route to Be In the Stuck In Active State.</div>
<div class="content">
<pre>(config-router)# timers active-time [&lt;minutes&gt;| disabled]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
default wait time = 3 minutes
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Reasons a router doesn&#8217;t respond to EIGRP Query:</p>
<div class="ulist">
<ul>
<li>
<p>The neighbor router’s CPU is overloaded and the router either cannot respond in time or is even unable to process all incoming packets including the EIGRP packets.</p>
</li>
<li>
<p>Quality issues on the link are causing packets to be lost.</p>
</li>
<li>
<p>Low-bandwidth links are congested and packets are being delayed or dropped.</p>
</li>
<li>
<p>The network topology is excessively large or complex, either requiring the Query to propagate to a significant depth or causing an inordinate number of prefixes to be impacted by a single link or node failure.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Troubleshooting SIA routes is generally a three-step process:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find the Routes That Are Consistently Being Reported As SIA.</p>
</li>
<li>
<p>Find the Router That Is Consistently Failing to Answer Queries for These Routes</p>
</li>
<li>
<p>Find the Reason That Router Is Not Receiving or Answering Queries.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first step should be fairly easy.
If you are logging console messages, a quick perusal of the log indicates which routes are most frequently marked SIA.</p>
</div>
<div class="paragraph">
<p>The second step is more difficult. The command to gather this information is show ip eigrp topology active:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Codes: P - Passive, A - Active, U - Update, Q - Query, R - Reply,
       r - Reply status

A 10.2.4.0/24, 0 successors, FD is 512640000, Q
    1 replies, active 00:00:01, query-origin: Local origin
         via 10.1.2.2 (Infinity/Infinity), Serial1
    1 replies, active 00:00:01, query-origin: Local origin
         via 10.1.3.2 (Infinity/Infinity), r, Serial3
    Remaining replies:
         via 10.1.1.2, r, Serial0</pre>
</div>
</div>
<div class="paragraph">
<p>Any neighbors that show an R have yet to reply (the active timer shows how long
the route has been active). Note that these neighbors may not show up in the
Remaining replies section; they may appear among the other RDBs. Pay particular
attention to routes that have outstanding replies and have been active for some
time, generally two to three minutes. Run this command several times and you
begin to see which neighbors are not responding to queries (or which interfaces
seem to have a lot of unanswered queries). Examine this neighbor to see if it
is consistently waiting for replies from any of its neighbors. Repeat this
process until you find the router that is consistently not answering queries.
You can look for problems on the link to this neighbor, memory or CPU
utilization, or other problems with this neighbor.</p>
</div>
<div class="paragraph">
<p>If you run into a situation where it seems that the query range is the problem,
it is always best to reduce the query range rather than increasing the SIA
timer.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stub_routing">21.11. Stub Routing</h3>
<div class="paragraph">
<p>TODO Better explanation of this feature</p>
</div>
<div class="ulist">
<ul>
<li>
<p>improves network scalability and stability.</p>
</li>
<li>
<p>commonly used in hub-and-spoke networks.</p>
</li>
<li>
<p>configured only on spoke routers.</p>
</li>
<li>
<p>announces its stub router status using an additional TLV in its EIGRP Hello messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The results of configuring a router as a stub are multifold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A stub router does not propagate routes learned through EIGRP to its neighbors, with the exception of <strong>leak-map</strong> routes .
 This prevents a stub router from ever being considered a Feasible Successor for remote networks by its
neighbors and possibly becoming a transit router at some point in the future.</p>
</li>
<li>
<p>A stub router advertises only a subset of its own EIGRP-enabled networks to
its neighbors. This subset can be defined in the <strong>eigrp stub</strong> command using the
<strong>summary</strong>, <strong>connected</strong>, <strong>static</strong>, <strong>redistributed</strong>, and <strong>receive-only</strong> keywords.</p>
</li>
<li>
<p>Neighbors of a stub router aware of its stub status (thanks to the specific
TLV in the stub router’s Hello packets) will never send a Query packet to a
stub router. This prevents the neighbors from converging through a stub
router to reach networks that are remote to the stub router.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following rules summarize the stub router behavior with respect to handling Query packets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Originating Query packets is not modified in any way. Rules for entering the
Active state and sending Queries are precisely the same.</p>
</li>
<li>
<p>Processing received Query packets depends on what network was queried for. If
the network in the received Query is a network the stub router is allowed to
adver- tise, meaning that it falls under the configured category of summary,
connected, static, or redistributed, the router will process the Query
normally (even possi- bly causing the stub router to become Active itself)
and send back an appropriate Reply. The same is valid for an EIGRP-learned
network that is allowed to be further advertised using a leak-map—a Query for
such a network would be processed and responded to in the usual way. If the
Query contains a network that the stub router knows about but is not allowed
to advertise (the network does not fall under the configured category, or is
learned through EIGRP but not allowed for further adver- tisement by a
leak-map), it will be processed in the usual way as described earlier, but
the Reply will always indicate infinite distance, regardless of what the stub
router truly knows about the network. Receiving a Query for an unknown
network will immediately cause the router to respond with a Reply and an
infinite distance; how- ever, this is regular EIGRP behavior not related to
the stub feature.</p>
</li>
<li>
<p>At this point, you might ask why a stub router would receive a Query, as its
stub status should instruct its neighbors to avoid sending Queries to it. There
are two primary rea- sons why even a stub router might receive a Query. First,
a stub router’s neighbor might be running an old IOS that does not recognize
the stub TLV yet. Such a neighbor will cre- ate an adjacency to a stub router
just fine, but it will also happily send Queries to it, not knowing that the
router is a stub router. Second, if there are multiple routers on a com- mon
segment and all of them are configured as stub routers, if any of these stub
routers need to send a Query, it will also send it to all its stub neighbors.
This is done to support multihomed branch offices that usually have two branch
routers configured as stubs. Each of these branch routers is connected to the
headquarters through its own uplink, and they are also connected together by a
common intra-site link. If the uplink on one of the branch routers fails, the
affected router needs to converge through its neighbor branch router, and this
might require a permission to send Queries to its fellow stub neighbor.
Therefore, on a common segment with all routers configured as stubs, Queries
are sent as usual.</p>
</li>
<li>
<p>In case of multiaccess segments with mixed neighbors (stub and nonstub), EIGRP
solves the problem of sending Queries only to nonstub neighbors in two ways:
Either it sends the Queries as unicasts to the nonstub neighbors or it uses the
Conditional Receive mode in RTP to send multicast Queries in such a way that
only nonstub routers will process them. The choice of a particular mechanism
depends on the number of nonstub neighbors. While mixing stub and nonstub
routers on a common segment is not a recom- mended practice, it is inevitable,
for example, in cases where the hubs and spokes are interconnected by a DMVPN
or a VPLS service.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure EIGRP Stub</div>
<div class="content">
<pre>(config-router)# eigrp stub {[received-only] | [connected] [static] [ leak-map &lt;name&gt;] [redistributed] [summary]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">receive-only</dt>
<dd>
<p>does not advertise any prefixes.</p>
<div class="ulist">
<ul>
<li>
<p>only receives prefixes advertised to it by its neighbors.</p>
</li>
<li>
<p>either static routing on its neighbors or NAT/PAT on the stub router is
required in this case to allow the networks behind the stub router to
communicate with the outside world.</p>
</li>
<li>
<p>cannot be used with any other keywords when configuring stub routing.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">leak-map</dt>
<dd>
<p>Allows some prefix to be advertised</p>
<div class="ulist">
<ul>
<li>
<p>crucial in scenarios where a branch office uses a pair of interconnected
routers configured as stub routers. If these routers are to provide backup
connectivity to each other, they must be allowed to readvertise EIGRP-learned
routes to each other, even in stub mode.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">connected</dt>
<dd>
<p>Advertises connected subnets.</p>
<div class="ulist">
<ul>
<li>
<p>directly connected interfaces will not be advertised automatically;
it is still necessary to add them to EIGRP using the usual <strong>network</strong> command</p>
</li>
<li>
<p>option enabled by default</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">static</dt>
<dd>
<p>Advertises static routes.</p>
<div class="ulist">
<ul>
<li>
<p>The static routes need to be redistributed into EIGRP to be advertised.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">summary</dt>
<dd>
<p>Advertises Summary routes</p>
<div class="ulist">
<ul>
<li>
<p>summary routes can be created manually (<strong>summary-address</strong>)  or automatically at a major network border router (<strong>auto-summary</strong>).</p>
</li>
<li>
<p>option enabled by default</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">redistributed</dt>
<dd>
<p>Advertises redistributed routes</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the stub router feature has no impact on what routes the hub router
will advertise to its stub spokes. Without an additional configuration on the
hub router, the spokes will be populated with full routing tables. Considering
the fact that in a hub-and-spoke network, any other network beyond the branch
networks is reachable through the hub, having full routing tables on spoke
routers with most of their entries pointing toward the hub router is not
particularly useful. Therefore, in these networks, the stub feature on spokes
is usually combined with route filtering and summarization on the hub router.
The hub router can be configured to advertise only the default route to the
spoke router(s), filtering out all other more specific route entries,
effectively reducing the routing table on the spoke to a single EIGRP-learned
default route entry.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_eigrp_stub_routing_leak_map_support">21.12. EIGRP Stub Routing Leak Map Support</h3>

</div>
<div class="sect2">
<h3 id="_protocol_dependent_modules">21.13. Protocol-Dependent Modules</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_goodbye_message_and_graceful_shutdown">21.14. Goodbye Message and Graceful Shutdown</h3>
<div class="ulist">
<ul>
<li>
<p>broadcast when an EIGRP routing process is shut down</p>
</li>
<li>
<p>Speeds convergence as peers don&#8217;t have to wait the hold timer expiration</p>
</li>
<li>
<p>Hello Message with all K-values set to 255</p>
</li>
<li>
<p>Normal message displayed by routers that support Good Bye message</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>*Apr 26 13:48:42.523: %DUAL-5-NBRCHANGE: IP-EIGRP(0) 1: Neighbor 10.1.1.1
(Ethernet0/0) is down: Interface Goodbye received</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Misleading message displayed by router which doesn&#8217;t support the Goodbye message</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>*Apr 26 13:48:41.811: %DUAL-5-NBRCHANGE: IP-EIGRP(0) 1: Neighbor
(Ethernet0/0) is down: K-value mismatch</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The receipt of a goodbye message by a non supporting peer does not disrupt normal network operations.</p>
</li>
<li>
<p>The nonsupporting peer will terminate the session when the hold timer expires</p>
</li>
<li>
<p>The sending and receiving routers will converge normally after the sender reloads</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_summarization_2">21.15. Summarization</h3>
<div class="ulist">
<ul>
<li>
<p>All subnets are suppressed</p>
</li>
<li>
<p>Creates boundary for Query propagation</p>
<div class="ulist">
<ul>
<li>
<p>If a router receives a Query for a network it does not have in its topology
table, it will immediately send back a Reply indicating an unreachable
destination, without itself going active and propagating the Query further.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable Auto-Summarization</div>
<div class="content">
<pre>(config-router)# auto-summarization</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Cannot be used in divergent networks</p>
</li>
<li>
<p>create null0 summary</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Advertise a Single Summary In EIGRP Classic Mode</div>
<div class="content">
<pre>(config-if)# ip summary-address eigrp &lt;asn&gt; &lt;prefix&gt; &lt;mask&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Advertise a Single Summary In EIGRP Named Mode</div>
<div class="content">
<pre>(config-router-af-interface)# summary-address &lt;prefix&gt; &lt;mask&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure Summarization to Advertise a Default Route Into EIGRP</div>
<div class="content">
<pre>(config-if)# ip summary-address eigrp &lt;asn&gt; 0.0.0.0 0.0.0.0</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>All subnets will be suppressed because all IPv4 networks are subnet of 0/0</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Fixed Metric for EIGRP Summary Address</div>
<div class="content">
<pre>(config-router)# summary-metric &lt;network-address&gt; &lt;subnet-mask&gt;
                                { &lt;bandwidth&gt; &lt;delay&gt; &lt;reliability&gt; &lt;load&gt; &lt;mtu&gt; [ distance &lt;ad&gt;  ] | distance  &lt;ad&gt;}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When EIGRP creates a summary route, it includes a metric with the route in
order to advertise it. EIGRP searches for components of the summary to be
suppressed and represented by the summary. EIGRP finds the component with the
best metric and copies the metric from the component into the summary.
Components of the summary may change often, which means that every time the
best component metric changes, the summary needs to be readvertised to all its
peers. Even if the best component metric is not the one that changed, EIGRP
still has to search every topology entry to make sure the summary is not
affected. This can add a significant processing overhead.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_leak_map">21.15.1. Leak Map</h4>
<div class="listingblock">
<div class="title">Task: Advertise Specific Subnets Of a EIGRP Summary</div>
<div class="content">
<pre>(config-if)# ip summary-address eigrp &lt;asn&gt; &lt;prefix&gt; &lt;mask&gt; leak-map &lt;route-maps&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_floating_summary_routes">21.15.2. Floating Summary Routes</h4>
<div class="paragraph">
<p>TODO
- By default, summarization install a route to Null0 to match the summary
  to prevent forwarding traffic for unreachable destinations.
-</p>
</div>
</div>
<div class="sect3">
<h4 id="_poisoned_floating_summarization">21.15.3. Poisoned Floating Summarization</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eigrp_route_authentication">21.16. EIGRP Route Authentication</h3>
<div class="ulist">
<ul>
<li>
<p>Supports MD5 in classic mode</p>
</li>
<li>
<p>Supports MD5 and SHA-256 in multi-af mode</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Use MD5 Password In EIGRP Classic Mode</div>
<div class="content">
<pre>(config-if)# ip authentication mode eigrp &lt;asn&gt; md5
(config-if)# ip authentication key-chain eigrp &lt;asn&gt; &lt;password&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Use MD5 Password In EIGRP Named Mode</div>
<div class="content">
<pre>(config-router-af-interface)# authentication mode md5
(config-router-af-interface)# authentication key-chain &lt;sesame&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Authenticate EIGRP Neighbor with SHA-256 Password</div>
<div class="content">
<pre>(config-router-af-interface)# authenticate mode hmac-sha-256 &lt;password&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Can be applied at the <strong>af-interface-default</strong> in multi-af mode</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_link_bandwidth_percentage">21.17. Link Bandwidth Percentage</h3>
<div class="ulist">
<ul>
<li>
<p>by default, EIGRP packets consume  max 50% of the link bandwidth as configured by the <strong>bandwith</strong> command</p>
</li>
<li>
<p>bandwidth configured by <strong>bandwidth</strong> in AS configuration and <strong>bandwith-percent</strong> for named configuration</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_eigrp_autonomous_system_configuration_2">21.18. EIGRP Autonomous System Configuration</h3>
<div class="listingblock">
<div class="title">Task: Create a Basic EIGRP AS System Configuration</div>
<div class="content">
<pre>(config)# router eigrp asn
(config-router)# network a.b.c.d [e.f.g.h]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A maximum of 30 EIGRP can be configured</p>
</li>
<li>
<p>EIGRP sends updates only interfaces in the specified networks</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Verify Eigrp Topology</div>
<div class="content">
<pre>show ip eigrp topology [all-links]
show ip eigrp topology [prefix/len]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_router_id">21.19. Router ID</h3>
<div class="ulist">
<ul>
<li>
<p>Used to avoid routing loops</p>
</li>
<li>
<p>Advertised inside internal and external routes (in later IOS)</p>
</li>
<li>
<p>same rule as OSPF</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify the EIGRP Router ID</div>
<div class="content">
<pre>(config-router)# eigrp router-id &lt;a.b.c.d&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
0.0.0.0 and 255.255.255.255 are not allowed
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_unequal_load_balancing">21.20. Unequal Load Balancing</h3>
<div class="paragraph">
<p>If CD is the Computed Distance, then the eligible Feasible successor must satisfy the inequality below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CD  via Successor &lt; CD via Feasible Successor &lt; variance * CD via Successor</pre>
</div>
</div>
<div class="paragraph">
<p>The amount of traffic flowing over a particular path can be computed as this ratio:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Highest Installed Path Metric / Path Metric</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The unequal-cost paths installed into the routing table also count toward the
maximum number of parallel paths to a destination configured using the
maximum-paths command. Depending on your network topology and requirements, it
might be necessary to modify this setting.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable EIGRP Unequal Load Balancing</div>
<div class="content">
<pre>(config-router)# variance &lt;number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable EIGRP Unequal Load Balancing In Named Configuration</div>
<div class="content">
<pre>(config-router-topology)# variance &lt;number&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_path_support">21.21. Add-Path Support</h3>
<div class="ulist">
<ul>
<li>
<p>Allow a Hub (dual-homed in DMVPN) to advertise multiple-equal cost routes to the same destination</p>
<div class="ulist">
<ul>
<li>
<p>must have the multiple equal-cost installed in its routing table</p>
</li>
<li>
<p>must disable Split Horizon on the tunnel towards the spokes</p>
</li>
<li>
<p>must have variance = 1, no unequal load balancing on the hub and the spokes</p>
</li>
<li>
<p>must desactived <strong>next-self-hop [no-ecmp-mode]</strong></p>
</li>
<li>
<p>must be configured in the af-interface section of the  named mode configuration</p>
</li>
<li>
<p>In certain scenarios, such as DMVPN deployments in
which multiple branch offices are dual homed, hub routers usually have
information about both routes to a particular dual-homed branch office, and can
perform equal-cost load balanc ing on their end. However, without an
additional mechanism, a hub is unable to advertise these equal-cost routes to
other spoke routers. As a result, the other spokes only see a single route to
the dual-homed branch office without an ability to perform load balancing over
multiple paths, and if the single route they know about fails, they need to go
over the usual reconvergence process in EIGRP to learn about the other route.</p>
</li>
<li>
<p>Spoke routers do not need to be specifically configured for the
Add-Path feature, apart from possible tuning of the maximum-paths command to
be allowed to insert multiple equal-cost paths into their routing tables.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_passive_interface">21.22. Passive Interface</h3>
<div class="ulist">
<ul>
<li>
<p>Suppresses EIGRP hello packets and routing updates on interfaces</p>
<div class="ulist">
<ul>
<li>
<p>Doesn&#8217;t form adjancencies</p>
</li>
<li>
<p>Includes the interface addresses in the topology database</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure EIGRP Passive Interfaces</div>
<div class="content">
<pre>(config-router)# passive-interface [default] [&lt;interface-type&gt;  &lt;interface-number&gt;]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eigrp_over_the_top">21.23. EIGRP Over the Top</h3>
<div class="ulist">
<ul>
<li>
<p>Enables a single end-to-end routing domain between two or more EIGRP sites
that are connected using a private or a public WAN connection.</p>
</li>
<li>
<p>Relies on LISP</p>
</li>
<li>
<p>Benefits:</p>
<div class="ulist">
<ul>
<li>
<p>no dependency on the type of WAN connection used.</p>
</li>
<li>
<p>no dependency on the service provider to transfer routes.</p>
</li>
<li>
<p>no security threat because the underlying WAN has no knowledge of enterprise routes.</p>
</li>
<li>
<p>simplifies dual carrier deployments and designs by eliminating the need to configure and manage EIGRP-BGP route distribution and route filtering between customer sites.</p>
</li>
<li>
<p>allows easy transition between different service providers.</p>
</li>
<li>
<p>supports both IPv4 and IPv6 environments.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_lisp">21.23.1. LISP</h4>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/lisp.png" alt="LISP" width="500" height="500"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Locator/Identifier Separation Protocol</p>
</li>
<li>
<p>Separate the identity and location into two independent entities, each of
them represented by a complete address, and provide a mapping service so that
the address representing the identity of a host can be resolved into the
address that represents its location.</p>
</li>
<li>
<p>Uses EID (EndPoints Identifiers) and RLOC (Routing Locator)</p>
</li>
<li>
<p>LISP hence has both a control and a data plane.</p>
<div class="ulist">
<ul>
<li>
<p>The control plane in LISP comprises the registration protocol and procedures by which the tunnel routers
R1 and R2 register the EIDs they are responsible for along with their RLOCs in
a LISP-mapping service, and using these registrations they map EIDs into RLOCs.</p>
</li>
<li>
<p>The data plane defines the actual tunnel encapsulation used between Routers R1
and R2 when two hosts from each LISP sites communicate.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In OTP, EIGRP serves as the replacement for LISP control plane protocols.
Instead of doing dynamic EID-to-RLOC mappings in native LISP-mapping
services, EIGRP routers running OTP over a service provider cloud create
targeted sessions, use the IP addresses provided by the service provider as
RLOCs, and exchange routes as EIDs.</p>
</li>
<li>
<p>OTP is based on creating targeted EIGRP sessions between customer edge
routers, and using the routing information carried by EIGRP to populate both
routing tables and LISP mapping tables. The edge routers do not exchange any
routing information with the service provider routers. Thus, this solution
is fully controlled by a customer and requires no cooperation with the
service provider, apart from providing full IP connectivity between customer routers</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_otp_ce">21.23.2. OTP CE</h4>
<div class="listingblock">
<div class="title">Task: Configure EIGRP OTP on CE</div>
<div class="content">
<pre>(config)# router eigrp test
(config-router)# address-family ipv4 unicast autonomous-system 100
(config-router-af)# neighbor 10.0.0.2 gigabitethernet 0/0/1 remote 3 lisp-encap 1
(config-router-af)# network 192.168.0.0
(config-router-af)# network 192.168.1.0</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_otp_route_reflectors">21.23.3. OTP Route Reflectors</h4>
<div class="listingblock">
<div class="title">Task: Configure EIGRP Route Reflectors</div>
<div class="content">
<pre>(config)# router eigrp test
(config-router)# address-family ipv4 unicast autonomous-system 100
(config-router-af)# af-interface gigabitethernet 0/0/1
(config-router-af-interface)# no next-hop-self
(config-router-af-interface)# no split-horizon
(config-router-af-interface)# exit
(config-router-af)# remote-neighbors source gigabitethernet 0/0/1 unicast-listen lisp-encap 1
(config-router-af)# network 192.168.0.0</pre>
</div>
</div>
<div class="paragraph">
<p>More
<a href="http://www.cisco.com/c/en/us/products/collateral/ios-nx-os-software/ip-routing/whitepaper_C11-730404.html">WAN virtualization with OTP</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_eigrp_logging_and_reporting">21.23.4. EIGRP Logging and Reporting</h4>
<div class="listingblock">
<div class="title">Task: Display the Contents Of the EIGRP Log</div>
<div class="content">
<pre># sh ei address-family {ipv4 | ipv6} events</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure EIGRP Logging</div>
<div class="content">
<pre>Router(config-router)# eigrp ?
event-log-size : Set max log size (default=500)
event-logging  : Log IP-EIGRP routing events (default)
log-neighbor-changes : enable IP-EIGRP neighbor logging (default)
log-neighbor-warnings :  Enable/Disable IP-EIGRP neighbor warnings (default=every 10seconds)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_soo">21.23.5. SoO</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ospf">22. OSPF</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">IP Routing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/iproute_ospf/configuration/15-mt/iro-15-mt-book/configuring_ospf.html">OSPF</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>link-state interior gateway protocol</p>
</li>
<li>
<p>RFC 2328</p>
</li>
<li>
<p>Dijkstra short path first algorithm</p>
</li>
<li>
<p>classless protocol</p>
</li>
<li>
<p>Transport via IP protocol 89</p>
<div class="ulist">
<ul>
<li>
<p>multicasts to 224.0.0.5 for AllSPF routers and to 224.0.0.6 for Designated Routers</p>
</li>
<li>
<p>unicasts</p>
</li>
</ul>
</div>
</li>
<li>
<p>equal-cost multipath</p>
</li>
<li>
<p>hierarchical design to reduce traffic</p>
</li>
<li>
<p>authentication updates</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_neighbors_4">22.1. Neighbors</h3>
<div class="paragraph">
<p>To form adjacency neighbors must agree on</p>
</div>
<div class="ulist">
<ul>
<li>
<p>unique router ID</p>
</li>
<li>
<p>unique interface IP address</p>
<div class="ulist">
<ul>
<li>
<p>primary IP address for OSPFv2</p>
</li>
<li>
<p>link-local address for OSPFv3</p>
</li>
</ul>
</div>
</li>
<li>
<p>common attributes</p>
<div class="ulist">
<ul>
<li>
<p>interface area-id</p>
</li>
<li>
<p>authentication</p>
</li>
<li>
<p>hello and dead timers</p>
</li>
<li>
<p>area type (normal, stub, NSSA, )</p>
</li>
<li>
<p>interface MTU</p>
</li>
<li>
<p>other optional capabilities</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_router_id_2">22.2. Router Id</h3>
<div class="paragraph">
<p>Determined by these rules in order of preference at boot or ospf process restart:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>manually configured router id</p>
</li>
<li>
<p>highest IP address of an up/up loopback not used by other OSPF process</p>
</li>
<li>
<p>highest IP address of an up/up non-loopack interfaces  not used by other OSPF process</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the Router-Id</div>
<div class="content">
<pre>(config-router)# router-id &lt;a.b.c.d&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dr_election">22.3. DR Election</h3>
<div class="ulist">
<ul>
<li>
<p>There is no pre-emption in OSPF</p>
<div class="ulist">
<ul>
<li>
<p>Router must wait for the failure of the current DR</p>
</li>
<li>
<p>Use the WAIT timer = DEAD timer</p>
</li>
</ul>
</div>
</li>
<li>
<p>on hub-and-spoke, best practice is to have hub as DR and spokes not eligible as DR with priority=0</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Priority</div>
<div class="content">
<pre>(config-if)# ip ospf priority &lt;0-255&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the WAIT Timer</div>
<div class="content">
<pre>(config-if)# ip ospf dead-timer &lt;seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ospf_cost">22.4. Ospf Cost</h3>
<div class="paragraph">
<p>\$"Cost" = 10^8 / "Bandwidth(bps)"\$</p>
</div>
<div class="listingblock">
<div class="title">Task: Description</div>
<div class="content">
<pre>(config-router)# auto-cost reference-bandwitch &lt;bps&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ospf_packet_format">22.5. OSPF Packet Format</h3>
<div class="sect3">
<h4 id="_common_ospf_packet_header">22.5.1. Common OSPF Packet Header</h4>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-header-format.png" alt="OSPF Header Format" width="896" height="312">
</div>
<div class="title">Figure 36. OSPF Header Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Type</dt>
<dd>
<p>Hello (1), database description (2), Link-State Request (3), Link-State Update (4), or Link-State Acknowledgment (5).</p>
</dd>
<dt class="hdlist1">Packet length</dt>
<dd>
<p>Length of the protocol packet in bytes including the OSPF header.</p>
</dd>
<dt class="hdlist1">Router ID</dt>
<dd>
<p>The ID of the router originating the packet.</p>
</dd>
<dt class="hdlist1">Area ID</dt>
<dd>
<p>The area that the packet is being sent into.</p>
</dd>
<dt class="hdlist1">Checksum</dt>
<dd>
<p>standard IP checksum of the entire contents of the packet, excluding the 64-bit authentication field.</p>
</dd>
<dt class="hdlist1">AuType</dt>
<dd>
<p>Identifies the authentication scheme to be used for the packet.</p>
<div class="ulist">
<ul>
<li>
<p>0: no authentication</p>
</li>
<li>
<p>1: plain-text authentication</p>
</li>
<li>
<p>2: cryptographic authentication</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Authentication</dt>
<dd>
<p>64-bit field for use by the authentication scheme.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hello_packet">22.5.2. Hello Packet</h4>
<div class="ulist">
<ul>
<li>
<p>Sent from the primary IP address ( not the secondary addresses )</p>
</li>
<li>
<p>Every 10 seconds (Ethernet), 30 seconds (Non-broadcast)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
OSPF neighbors will become fully adjacent if one or both of the neighbors are using
unnumbered interfaces for the connection between them.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-hello-packet-format.png" alt="OSPF Hello Packet Format" width="896" height="312">
</div>
<div class="title">Figure 37. OSPF Hello Packet Format</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure OSPF Hello Interval</div>
<div class="content">
<pre>(config-if)# ip ospf hello-interval &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the Interval During Which at Least One OSPF Hello Packet Must Be Received from a Neighbor Before the Router Declares That Neighbor Down</div>
<div class="content">
<pre>(config-if)# ip ospf dead-interval {&lt;seconds&gt; | minimal hello-multiplier &lt;number&gt;}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_database_description_packet">22.5.3. Database Description Packet</h4>
<div class="ulist">
<ul>
<li>
<p>Uses an OSPF-defined simple error-recovery process.</p>
<div class="ulist">
<ul>
<li>
<p>Each DD packet, which can contain several LSA headers, has a sequence number assigned.</p>
</li>
<li>
<p>The receiver acknowledges a received DD packet by sending a DD packet with the identical sequence number back to the sender.</p>
</li>
<li>
<p>The sender uses a window size of one packet and then waits for the acknowledgment before sending the next DD packet.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Only the master is allowed to send DD packets on its own accord as well as to set and increase their sequence numbers.</p>
</li>
<li>
<p>A slave is allowed to send a DD packet only as a response to a DD packet received from master router, and must use the
same sequence number. In effect, a slave is polled by the master and only responds to it.</p>
<div class="ulist">
<ul>
<li>
<p>If a slave has more DD than the master, he uses the M flag</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-database-description-message-format.png" alt="OSPF DD Packet Format" width="896" height="248">
</div>
<div class="title">Figure 38. OSPF DD Packet Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Interface MTU</dt>
<dd>
<p>Size of the largest IP message that can be sent on this router&#8217;s interface
without fragmentation</p>
</dd>
<dt class="hdlist1">Options</dt>
<dd>
<p>For optional OSPF capabilities</p>
</dd>
<dt class="hdlist1">I-bit</dt>
<dd>
<p>Initial for the first in a sequence of DD messages</p>
</dd>
<dt class="hdlist1">M-bit</dt>
<dd>
<p>More DD follow this one</p>
</dd>
<dt class="hdlist1">MS-bit</dt>
<dd>
<p>if this message is sent by the master in the communication</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_link_state_request">22.5.4. Link State Request</h4>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-link-state-request-message-format.png" alt="OSPF Link State Request Format" width="896" height="248">
</div>
<div class="title">Figure 39. OSPF Link State Request Format</div>
</div>
</div>
<div class="sect3">
<h4 id="_link_state_update">22.5.5. Link State Update</h4>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-link-state-update-message-format.png" alt="OSPF Link State Update Format" width="896" height="184">
</div>
<div class="title">Figure 40. OSPF Link State Update Format</div>
</div>
</div>
<div class="sect3">
<h4 id="_link_state_acknowledgment">22.5.6. Link State Acknowledgment</h4>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-link-state-ack-message-format.png" alt="OSPF Link State Acknowledgment Format" width="896" height="152">
</div>
<div class="title">Figure 41. OSPF Link State Acknowledgment Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">LSA headers</dt>
<dd>
<p>Contains LSA headers to identify the LSAs acknowledged.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_link_state_packets">22.5.7. Link-State Packets</h4>
<div class="ulist">
<ul>
<li>
<p>only a router that has originated a particular LSA is allowed to modify it or withdraw it.</p>
<div class="ulist">
<ul>
<li>
<p>Other routers must process and flood this LSA within its defined flooding scope if they recognize the LSA’s type and contents,
but they must not ever change its contents, block it, or drop it before its maximum lifetime has expired.</p>
</li>
</ul>
</div>
</li>
<li>
<p>has a unique LSID (Link State Identifier)</p>
</li>
</ul>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Type 1
</td>
<td class="hdlist2">
<p>Router LSA</p>
<div class="ulist">
<ul>
<li>
<p>one per router per area</p>
</li>
<li>
<p>lists the RouterID,  the IP Addresses and neighbors for each interface in that area</p>
</li>
<li>
<p>represents Stub networks (subnet on which a router has not formed any neighbor relationships )</p>
</li>
<li>
<p>flooded only within the same area</p>
</li>
<li>
<p>LSID = Router ID</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Type 2
</td>
<td class="hdlist2">
<p>Network LSA</p>
<div class="ulist">
<ul>
<li>
<p>one per transit network</p>
<div class="ulist">
<ul>
<li>
<p>network over which two or more OSPF routers have become neighors and elected a DR
so that traffic can transit between them</p>
</li>
<li>
<p>except for point-to-point connection treated as a combination of p2p link and a stub IP network
(to facilate unnumbered p2p links)</p>
</li>
</ul>
</div>
</li>
<li>
<p>generated by DR</p>
</li>
<li>
<p>describes the set of routers attached to a particular network</p>
</li>
<li>
<p>describes the subnet and the router interfaces connected to the subnet</p>
</li>
<li>
<p>flooded only within the area that contains the network</p>
</li>
<li>
<p>LSID = DR&#8217;s interface IP Address on that subnet</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Type 3
</td>
<td class="hdlist2">
<p>Summary inter-area LSA</p>
<div class="ulist">
<ul>
<li>
<p>Generated by ABR</p>
</li>
<li>
<p>describes inter-area routes to network</p>
<div class="ulist">
<ul>
<li>
<p>represents networks present in one area when being advertised into another area.</p>
</li>
<li>
<p>Defines the subnets in the origin area, and cost, but no topology data.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Flooded only within its area of origin; reoriginated on ABRs.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Type 4
</td>
<td class="hdlist2">
<p>Summary inter-area LSA</p>
<div class="ulist">
<ul>
<li>
<p>Generated by ABR</p>
</li>
<li>
<p>Flooded by ABR to all areas except the area containing the ASBR</p>
</li>
<li>
<p>describes routes to ASBR</p>
<div class="ulist">
<ul>
<li>
<p>tells other routers in the area how to get to the advertising router of an external route</p>
</li>
</ul>
</div>
</li>
<li>
<p>Flooded all areas except the area containing the ASBR</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Type 5
</td>
<td class="hdlist2">
<p>AS external LSA</p>
<div class="ulist">
<ul>
<li>
<p>originated by ASBR</p>
</li>
<li>
<p>describes routes to destinations external to the AS</p>
</li>
<li>
<p>flooded all over except stub areas</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Type 6
</td>
<td class="hdlist2">
<p>Group Membership LSA</p>
<div class="ulist">
<ul>
<li>
<p>defined for MOSPF</p>
</li>
<li>
<p>Not supported by Cisco</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Type 7
</td>
<td class="hdlist2">
<p>NSSA External LSA</p>
<div class="ulist">
<ul>
<li>
<p>Created by ASBRs inside an NSSA, instead of a type 5 LSA.</p>
</li>
<li>
<p>Flooded only within its area of origin;</p>
</li>
<li>
<p>converted to type 5 LSA on an ABR toward other areas.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Type 8
</td>
<td class="hdlist2">
<p>External Attributes LSA</p>
<div class="ulist">
<ul>
<li>
<p>Created by ASBRs during BGP-to-OSPF redistribution to preserve BGP attributes of redistributed networks.</p>
</li>
<li>
<p>Not implemented in Cisco routers</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Type 9-11
</td>
<td class="hdlist2">
<p>Opaque LSA</p>
<div class="ulist">
<ul>
<li>
<p>Used as generic LSAs to allow for easy future extension of OSPF;</p>
<div class="ulist">
<ul>
<li>
<p>for example, type 10 has been adapted for MPLS traffic engineering.</p>
</li>
</ul>
</div>
</li>
<li>
<p>have different flooding scope:</p>
<div class="ulist">
<ul>
<li>
<p>Type 9 has link-local flooding scope,</p>
</li>
<li>
<p>type 10 has area-local flooding scope,</p>
</li>
<li>
<p>type 11 has autonomous system flooding scope equivalent to the flooding scope of type 5 LSAs
(not flooded into stubby areas and NSSAs).</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>OSPF&#8217;S SPF Algorithm Links Different Pieces Of Information Together.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>For a router in Area 1 to reach the external route in Area 3,
it has to look at the Type-5 that represents the external route.
Then it has to look at the Type-4 representing the ABR on the area that the ASBR lives in.
Then we have to look at the Type-3 to get to that remote ABR.
Finally we look at the Type-1 and Type-2 LSAs in our area to determine how to get to our closest ABR.</p>
</div>
<div class="paragraph">
<p>Read more
<a href="https://supportforums.cisco.com/document/133976/reading-and-understanding-ospf-database#sthash.qdHPgN1P.dpuf">here</a>.</p>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the OSPF Database</div>
<div class="content">
<pre># sh ip ospf database</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_backbone">22.6. Backbone</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">ABR</dt>
<dd>
<p>Router actively connected to multiple areas <strong>including</strong> Area 0</p>
<div class="ulist">
<ul>
<li>
<p>has one LSDB for each area</p>
</li>
<li>
<p>runs the SPF for each LSDB then combines the result in a single routing table</p>
</li>
<li>
<p>can summarize and filter routes</p>
</li>
<li>
<p>ignores type 3 LSAs learned in a nonbackbone area during SPF calculation,
which prevents an ABR from choosing a route that goes into a nonbackbone area and then back into the backbone.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_stubby_areas">22.7. Stubby Areas</h3>
<div class="paragraph">
<p>All stubby area types
- block Type 4/5 LSA
- automatically inject default routes except NSSA</p>
</div>
<div class="sect3">
<h4 id="_stubby_area">22.7.1. Stubby Area</h4>
<div class="ulist">
<ul>
<li>
<p>Doesn&#8217;t have an ASBR</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Stubby Area</div>
<div class="content">
<pre>(config-router)# area &lt;id&gt; stub</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_totally_stubby">22.7.2. Totally Stubby</h4>
<div class="ulist">
<ul>
<li>
<p>Stubby areas where Type 3 are blocked</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Totally Stubby Areas on the ABR</div>
<div class="content">
<pre>(config-router)# area &lt;id&gt; stub no-summary</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nssa">22.7.3. NSSA</h4>
<div class="ulist">
<ul>
<li>
<p>Contains one or more ASBRs</p>
</li>
<li>
<p>Allows creation of Type 7</p>
</li>
<li>
<p>Doesn&#8217;t automatically inject default routes</p>
</li>
<li>
<p>The ABR with highest RID translates Type 7 to Type 5</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure NSSA</div>
<div class="content">
<pre>(config-router)# area &lt;id&gt; nssa</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Inject Default Routes In NSSA</div>
<div class="content">
<pre>(config)# area &lt;id&gt; nssa default-information-originate</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_totally_nssa">22.7.4. Totally NSSA</h4>
<div class="ulist">
<ul>
<li>
<p>NSSA  where Type 3 are blocked</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Totally NSSA</div>
<div class="content">
<pre>(config-router)# area &lt;id&gt; nssa no-summary</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ospf_path_selection">22.8. OSPF Path Selection</h3>
<div class="ulist">
<ul>
<li>
<p>Intra-Area &gt; Inter-Area &gt; External Routes (E1/N1 &gt; E2/N2)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_virtual_links">22.9. Virtual Links</h3>
<div class="ulist">
<ul>
<li>
<p>purposes:</p>
<div class="ulist">
<ul>
<li>
<p>Areas not physically connected to area 0</p>
</li>
<li>
<p>partitioning the backbone</p>
</li>
</ul>
</div>
</li>
<li>
<p>transit area can not be stub</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Router A</div>
<div class="content">
<pre>(config)# router ospf 10
(config-router)# area 2 virtual-link 2.2.2.2</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Router B</div>
<div class="content">
<pre>(config)# router ospf 10
(config-router)# area 2 virtual-link 1.1.1.1</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: TODO</div>
<div class="content">
<pre>(config-router)# no capability transit</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure Authentication on Virtual Links</div>
<div class="content">
<pre>! Null
(config-router)# area &lt;id&gt; virtual-link &lt;router-id&gt; authentication { null }

! Plaintext
(config-router)# area &lt;id&gt; virtual-link &lt;router-id&gt; authentication { authentication-key &lt;key-value&gt; }

! MD5
(config-router)# area &lt;id&gt; virtual-link &lt;router-id&gt; authentication { message-digest message-digest- key key-num md5 key-value}

! Cryptographic
(config-router)# area &lt;id&gt; virtual-link &lt;router-id&gt; key-chain &lt;key-chain-name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/en/US/tech/tk365/technologies_tech_note09186a0080094aaa.shtml">What are ospf areas and virtual links</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_network_types">22.10. Network Types</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">broadcast</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>multicast hellos every 10 seconds</p>
</li>
<li>
<p>automatic neighbor discovery</p>
</li>
<li>
<p>DR/BDR election</p>
</li>
<li>
<p>default for LAN ethernet, TR, FDDI</p>
</li>
<li>
<p>DR doesn&#8217;t change the next hop of advertised prefixes</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Point-to-point</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>only 2 routers</p>
</li>
<li>
<p>automatic neighbor relationships</p>
</li>
<li>
<p>no DR/BDR election</p>
</li>
<li>
<p>multicast hellos every 10 seconds</p>
</li>
<li>
<p>default for HDLC and PPP</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Non-broadcast</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unicast hellos every 30 seconds</p>
</li>
<li>
<p>manual configuration of neighbor</p>
</li>
<li>
<p>DR/BDR election</p>
</li>
<li>
<p>default on Frame Relay, X.25 and SMDS</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Point-to-multipoint</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>multi-access, broadcast</p>
</li>
<li>
<p>hellos every 30 seconds</p>
</li>
<li>
<p>automatic discovery of neighbor (MA)</p>
</li>
<li>
<p>DR/BDR election</p>
</li>
<li>
<p>one IP subnet</p>
</li>
<li>
<p>maintain connectivity during a VC failure ???</p>
</li>
<li>
<p>generates host routes (with mask /32 ) for each neighbor</p>
</li>
<li>
<p>default for ???</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Point-to-multipoint non-broadcast</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>manual configuration of neighbor</p>
</li>
<li>
<p>no DR/BDR election</p>
</li>
<li>
<p>network proprietary to Cisco</p>
</li>
<li>
<p>hellos every 30 seconds</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Loopback</dt>
</dl>
</div>
<div class="ulist TIP">
<ul class="TIP">
<li>
<p>if Multi-Access network type then DR/BDR election</p>
</li>
<li>
<p>if non-broadcast then manual configuration of neighbors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/support/docs/ip/open-shortest-path-first-ospf/7039-1.html#t27">OSPF design guide: selecting interface network types</a></p>
</div>
<div class="listingblock">
<div class="title">Task: Configure OSPF Network Type</div>
<div class="content">
<pre>(config-if)# ospf network {broadcast| point-to-point| point-to-multipoint [non-broadcast] | non-broadcast | loopback }</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_graceful_restart">22.11. Graceful Restart</h3>
<div class="ulist">
<ul>
<li>
<p>enables a router to continue to forward packets during a restart of the routing process</p>
</li>
<li>
<p>must be configured on all neighbor routers</p>
</li>
<li>
<p>can also work with EIGRP, BGP, IS-IS</p>
</li>
<li>
<p>default since IOS 12.4(6)T</p>
</li>
<li>
<p>2 versions: RFC 3623 and Cisco NSF</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/en/US/docs/ios-xml/ios/iproute_ospf/command/ospf-a1.html#wp258289">Cisco
NSF</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_spf_throttling">22.12. SPF Throttling</h3>

</div>
<div class="sect2">
<h3 id="_capability_vrf_lite">22.13. Capability Vrf-Lite</h3>
<div class="paragraph">
<p>Read OSG, chapter 19, VRF lite, pp. 872-876</p>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/en/US/docs/ios-xml/ios/iproute_ospf/command/ospf-a1.html#wp2582896905" class="bare">http://www.cisco.com/en/US/docs/ios-xml/ios/iproute_ospf/command/ospf-a1.html#wp2582896905</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_summarization_3">22.14. Summarization</h3>
<div class="paragraph">
<p>Why the null 0 interface is added ?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>do prevent routing loops</p>
<div class="ulist">
<ul>
<li>
<p>packets destined for the routes that have been summarized will a longer  match</p>
</li>
<li>
<p>packets destined to summary routes will be dropped</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>See good explanation</p>
</div>
</div>
<div class="sect2">
<h3 id="_ospf_states">22.15. OSPF States</h3>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-lsdb-exchange.png" alt="OSPF LSDB Exchange">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Down</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>No hellos have been received from neighbors</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Attempt</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Unicast hello packet has been sent to neighbor, but not yet received back</p>
</li>
<li>
<p>only used for manually configured NBMA neighbors</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Init</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>I have received a hello packet from a neighbor,
but they have not acknowledged a hello from me</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">2-way</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>I have received a hello packet from a neighbor
and he acknowledged a hello from me</p>
</li>
<li>
<p>I can see my Router Id in the neighbor&#8217;s hello packet</p>
</li>
<li>
<p>Stop here for DROthers</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Exstart</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Master &amp; slave relationship is formed where master has higher Router-id</p>
</li>
<li>
<p>Master chooses the starting sequence number of the DBD packets that are
used for actual LSA exchange.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Exchange</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Local link state database is sent through DBD packets</p>
</li>
<li>
<p>DBD sequence number is used for reliable acknowledgement/retransmission</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Loading</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>LSR packets are sent to ask for more info about a particular LSA</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Full</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Neighbors are fully adjacent and databases are synchronized.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Key Point</div>
<div class="paragraph">
<p>In the beginning of the exchange, each router places the other into the
ExStart state. Each of them considers itself to be the master, and sends an
empty DD packet to the other router, containing a randomly chosen sequence
number, and MS (Master), M (More), and I (Init) flags set to 1. After receiving
the neighbor’s DD packet, however, the router with the lower RID will change
its role to slave, and it will respond with a DD packet with MS and I flags
cleared and the sequence number set to the sequence number of master’s DD
packet. This accomplishes the master/slave selection, and both routers move to
the Exchange state. The master will then send a DD packet with the sequence
number incre- mented by 1, optionally containing one or more LSA headers, and
the slave will respond with a DD packet reusing the same sequence number from
the received packet, optionally advertising its own LSA headers. The exchange
continues in the same fashion, with the master incrementing the sequence number
of each subsequent DD packet, until both routers have advertised all known all
LSA headers (the master will stop sending DD pack- ets when it has advertised
all LSA headers itself and the last DD response from the slave has the M flag
cleared).</p>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/en/US/tech/tk365/technologies_white_paper09186a0080094e9e.shtml#appa1">ospf design guide: link-state advertisements</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_ospf_process">22.16. OSPF Process</h3>
<div class="listingblock">
<div class="title">Task: Enable OSPF Process (Legacy Command )</div>
<div class="content">
<pre>(config)# router ospf &lt;process-id&gt;
(config-router)# network &lt;a.b.c.d&gt; [&lt;w.i.l.d&gt;] area &lt;id&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>inject both the primary and secondary addresses</p>
</li>
<li>
<p>If an interface is IP unnumbered, and there is a <strong>network</strong> statement
that matches the IP address of the primary interface,
inject both the primary interface and the unnumbered interface</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Enable OSPF Process (Interface Level)</div>
<div class="content">
<pre>(config-if)# ip ospf &lt;process-id&gt; area &lt;id&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
- inject any and all secondary subnets
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Prevent OSPF to Advertize Secondary Prefixes</div>
<div class="content">
<pre>(config-if)# ip ospf &lt;process-id&gt; area &lt;id&gt; secondaries none</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ospf_authentication">22.17. OSPF Authentication</h3>
<div class="sect3">
<h4 id="_classic_ospf_authentication">22.17.1. Classic OSPF Authentication</h4>
<div class="ulist">
<ul>
<li>
<p>Null , default: type 0</p>
</li>
<li>
<p>Plain-text, simple password authentication</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# area &lt;id&gt; authentication
(config-if)# ip ospf authentication-key &lt;string&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Message digest authentication</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# area &lt;id&gt; authentication message-digest
(config-if)# ip ospf message-digest-key &lt;key-id&gt; md5 &lt;string&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Key Rollover Procedure with Multiple MD5 Keys</div>
<div class="paragraph">
<p>Multiple MD5 keys with different key IDs are allowed per interface.
This allows for graceful key migration where a new key can be added without disrupting the adjacencies.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To sign sent packets, it always uses the key that was added as the last one to the interface (regardless of the key number).</p>
</li>
<li>
<p>To authenticate the received packet, it uses the key ID that is indicated in the packet.</p>
</li>
<li>
<p>If a neighbor is detected on an interface that uses a different key number than this router,
OSPF enters a key migration phase in which it sends all packets as many times as how many keys are configured on the interface,
and each packet is signed with a different key.</p>
</li>
<li>
<p>The migration phase ends when all neighbors have migrated to the same key as the one used to sign sent packets by this router.</p>
</li>
<li>
<p>This procedure is also called the OSPF key rollover procedure.</p>
</li>
<li>
<p>Because plaintext passwords do not have key numbers, the key rollover is not available for plaintext authentication.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_extended_cryptographic_ospf_authentication">22.17.2. Extended Cryptographic OSPF Authentication</h4>
<div class="ulist">
<ul>
<li>
<p>Uses SHA-HMAC (Secure Hash Algorithm - Hash Message Authentication Code) as per RFC 5709</p>
</li>
<li>
<p>Uses key chains</p>
<div class="ulist">
<ul>
<li>
<p>Each key in the key chain must have a cryptographic algorithm
configured using a per-key <strong>cryptographic-algorithm</strong> command.
Failure to do so will result in OSPF not using that key.</p>
</li>
<li>
<p>Each key in a key chain can be configured with the <strong>send-life-time</strong> and
accept-life-time keywords to limit its usability to a particular timeframe.
If multiple keys in the key chain are eligible to sign egress packets, the
key with the highest key ID will be used. Be aware that this behavior
differs from RIPv2 and EIGRP that select the key with the lowest key ID.</p>
</li>
<li>
<p>The key rollover procedure as used by classic OSPF is not used with key
chains.  There is no key migration phase of sending multiple OSPF packets signed with different valid
keys.</p>
<div class="ulist">
<ul>
<li>
<p>To sign egress packets, use the valid key with the highest key ID in the key chain.</p>
</li>
<li>
<p>To authenticate ingress packets, try to use the key indicated in the received packet.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Cryptographic Algorithm for the Key Chain</div>
<div class="content">
<pre>(config)# key-chain &lt;name&gt;
(config-keychain)# key &lt;number&gt;
(config-keychain-key)# cryptographic-algorithm ?

  hmac-sha-1    HMAC-SHA-1 authentication algorithm
  hmac-sha-256  HMAC-SHA-256 authentication algorithm
  hmac-sha-384  HMAC-SHA-384 authentication algorithm
  hmac-sha-512  HMAC-SHA-512 authentication algorithm
  md5           MD5 authentication algorithm</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Extended Cryptographic OSPF Authentication</div>
<div class="content">
<pre>(config-if)# ip ospf authentication key-chain &lt;key-chain-name&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Configuring the extended cryptographic authentication using the area OSPF process level
   command is not supported.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ttl_security_check">22.18. TTL Security Check</h3>
<div class="ulist">
<ul>
<li>
<p>Drops packets with TTL &lt; 255 except on virtual links and sham links</p>
<div class="ulist">
<ul>
<li>
<p>If all OSPF routers sent their packets with TTL set to 255,
receiving an OSPF packet with its TTL less than 255 would be a clear indication that the packet originated
outside the network segment over which it was received.
Because OSPF com munication is, with the notable exception of virtual links and sham links,
always based on direct router-to-router communication, receiving an OSPF
packet outside a virtual link or a sham link with its TTL less than 255 is a
possible indication of a malicious activity.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Time-to-Live (TTL) Security Check Feature on a Specific Interface</div>
<div class="content">
<pre>(config-if)# ip ospf ttl-security [hops &lt;count&gt; |disable]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Time-to-Live (TTL) Security Check Feature on All Interfaces</div>
<div class="content">
<pre>(config-router)# ip ospf ttl-security all-interfaces</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure TTL Security on a Virtual Link</div>
<div class="content">
<pre>(config-router)# area virtual-link ttl-security &lt;hops&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure TTL Security on a Sham Link</div>
<div class="content">
<pre>(config-router)# area virtual-link ttl-security &lt;hops&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spf">22.19. SPF</h3>
<div class="sect3">
<h4 id="_spf_timers">22.19.1. Spf Timers</h4>
<div class="ulist">
<ul>
<li>
<p>spf-delay: between topology change notifications and recalculation of the shortest path</p>
</li>
<li>
<p>spf-holdtime : between spf calculations</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Spf Timers</div>
<div class="content">
<pre>(config-router)# timers spf seconds &lt;seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_spf_throttling_2">22.19.2. SPF Throttling</h4>
<div class="ulist">
<ul>
<li>
<p>Defines a variable-length wait interval between two consecutive SPF runs</p>
</li>
<li>
<p>Controls by 3 parameters:</p>
<div class="ulist">
<ul>
<li>
<p>spf-start: initial wait interval before an SPF computation, if the network has been stable for a prolonged period of time.</p>
</li>
<li>
<p>spf-hold: wait time between subsequent SPF runs, and its value doubles for each consecutive SPF run.</p>
</li>
<li>
<p>spf-max-wait:  maximum time between two SPF runs (that is, doubling the spf-hold value is capped at spf-max-wait), and also
defines a period during which the network must be stable for the wait interval to be set back to spf-start and the spf-hold to its preconfigured
value. If the network has been stable for the last spf-hold period but not for the entire spf-max-wait since the last SPF run, the wait interval returns
to the spf-start value but the subsequent wait will still be set to twice the
previous spfhold value.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Spf Throttling</div>
<div class="content">
<pre>(config-router)# timers throttle spf &lt;spf-start&gt; &lt;spf-hold&gt; &lt;spf-max-wait&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify SPF Throttling Configuration</div>
<div class="content">
<pre># sh ip ospf | i SPF

 Initial SPF schedule delay 10000 msecs
 Minimum hold time between two consecutive SPFs 15000 msecs
 Maximum wait time between two consecutive SPFs 100000 msecs</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lsa_throttling">22.19.3. LSA Throttling</h4>
<div class="listingblock">
<div class="title">Task: Configure LSA Throttling</div>
<div class="content">
<pre>(config-router)# timers throttle lsa all &lt;start-interval&gt; &lt;hold-interval&gt; &lt;max-interval&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify LSA Throttling Configuration</div>
<div class="content">
<pre># sh ip ospf | i LSA

 Initial LSA throttle delay 10000 msecs
 Minimum hold time for LSA throttle 15000 msecs
 Maximum wait time for LSA throttle 100000 msecs
 Minimum LSA arrival 1000 msecs
 LSA group pacing timer 240 secs</pre>
</div>
</div>
<div class="paragraph">
<p>TODO
Apart from throttling the LSA origination, a router can also be configured to
ignore the same LSA upon arrival if it appears to arrive too often. This
throttling of arriving LSAs is configured using the timers lsa arrival
milliseconds OSPF command. If two or more same LSAs arrive less than
milliseconds apart, only the first one is accepted and the remaining LSAs are
dropped. In effect, the same LSA is accepted only if it arrives more than
milliseconds after the previous accepted one. The default setting is 1000
millisec- onds and can be seen in the show ip ospf output in Example 9-16.
Obviously, the value of the minimum LSA arrival interval should be smaller than
the neighbors’ initial hold interval in LSA Throttling. Otherwise, a neighbor
would be allowed to send an updated LSA sooner than this router would be
willing to accept it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_incremental_spf">22.19.4. Incremental SPF</h4>
<div class="listingblock">
<div class="title">Task: Configure Incremental SPF</div>
<div class="content">
<pre>(config-router)# ispf</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify Incremental SPF Configuration</div>
<div class="content">
<pre># sh ip ospf | i Incremental

 Incremental-SPF enabled</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ospf_filtering">22.20. OSPF Filtering</h3>
<div class="sect3">
<h4 id="_routes_filtering_not_lsa_filtering">22.20.1. Routes Filtering Not LSA Filtering</h4>
<div class="ulist">
<ul>
<li>
<p>uses <strong>distribute-list</strong></p>
</li>
<li>
<p>The distribute list in the inbound direction applies to results of SPF—the
routes to be installed into the router’s routing table.</p>
</li>
<li>
<p>The distribute list in the outbound direction applies only to redistributed
routes and only on an ASBR; it selects which redistributed routes shall be
advertised.</p>
</li>
<li>
<p>The inbound logic does not filter inbound LSAs; it instead filters the
routes that SPF chooses to add to that one router’s routing table.</p>
</li>
<li>
<p>If the distribute list includes the incoming interface parameter, the
incoming interface is checked as if it were the outgoing interface of the
route.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_abr_type_3_lsa_filtering">22.20.2. ABR Type 3 LSA Filtering</h4>
<div class="ulist">
<ul>
<li>
<p>allows an ABR to filter type 3 LSAs at the point where the LSAs would normally
be created.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Filter Type 3 LSA on the ABR</div>
<div class="content">
<pre>(config-router)# area &lt;id&gt; filter-list prefix &lt;prefix-list-name&gt; { in | out }</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_area_range_no_advertise_option">22.20.3. Using the Area Range No-Advertise Option</h4>
<div class="listingblock">
<div class="title">Task: Summarize and Do Not Advertise Components</div>
<div class="content">
<pre>(config-router)# area &lt;id&gt; range &lt;prefix /length&gt; not-advertise [ cost cost ]</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ospfv2_prefix_suppression">22.21. OSPFv2 Prefix Suppression</h3>
<div class="ulist">
<ul>
<li>
<p>RFC 6860 defines a method of hiding, or suppressing, the transit link prefixes in OSPF
TODO Complete this</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Activate OSPFv2 Prefix Suppression for the Entire Router</div>
<div class="content">
<pre>(config-router)# prefix-suppression</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
suppress all prefixes on all its OSPF-enabled interfaces except
loopbacks, secondary IP addresses, and prefixes on passive interfaces. Such
prefixes are considered nontransit prefixes.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Activate OSPFv2 Prefix Suppression on a Specific Interface</div>
<div class="content">
<pre>(config-if)# ip ospf prefix-suppression [disable]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ospf_stub_router">22.22. OSPF Stub Router</h3>
<div class="ulist">
<ul>
<li>
<p>allows a router to either temporarily or permanently be prevented from becoming a transit router.</p>
<div class="ulist">
<ul>
<li>
<p>a transit router is simply one to which packets are forwarded, with the expectation that the transit router will forward the
packet to yet another router.</p>
</li>
<li>
<p>a nontransit routers only forward packets to and from locally attached subnets.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO Better explanation</p>
</div>
</div>
<div class="sect2">
<h3 id="_ospf_graceful_restart">22.23. OSPF Graceful Restart</h3>

</div>
<div class="sect2">
<h3 id="_ospf_graceful_shutdown">22.24. OSPF Graceful Shutdown</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_is_is">23. IS-IS</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>link-state protocol</p>
</li>
<li>
<p>doesn&#8217;t run over any other network protocol</p>
<div class="ulist">
<ul>
<li>
<p>encapsulates messages directly in data-link frames</p>
</li>
<li>
<p>sends to the layer 2 address called SNAP (sub-network point of attachment)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_nsap_address">23.1. NSAP Address</h3>
<div class="ulist">
<ul>
<li>
<p>variable length between 8 and 20 octets</p>
</li>
<li>
<p>assigned to the entire node</p>
<div class="dlist">
<dl>
<dt class="hdlist1">IDI</dt>
<dd>
<p>Initial Domain ID</p>
</dd>
<dt class="hdlist1">DSP</dt>
<dd>
<p>Domain Specific Part</p>
</dd>
<dt class="hdlist1">AFI</dt>
<dd>
<p>Authority and Format ID</p>
</dd>
<dt class="hdlist1">HO-DSP</dt>
<dd>
<p>high-order DSP</p>
</dd>
</dl>
</div>
</li>
<li>
<p>identifies the area</p>
</li>
<li>
<p>can be divided in sub-fields</p>
<div class="dlist">
<dl>
<dt class="hdlist1">System ID</dt>
</dl>
</div>
</li>
<li>
<p>generally 6 octets</p>
</li>
<li>
<p>between 1 and 8 octects
-</p>
<div class="dlist">
<dl>
<dt class="hdlist1">SEL</dt>
</dl>
</div>
</li>
<li>
<p>identifies particular services on the destination node</p>
</li>
<li>
<p>if SEL = 0,</p>
<div class="ulist">
<ul>
<li>
<p>identifies node NET (Network Entity Title)</p>
</li>
<li>
<p>mandatory for is-is configuration</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../images/nsap-addressing.png" alt="NSAP addressing"></span></p>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">AFI Meaning</th>
<th class="tableblock halign-left valign-top">IDI Length and Contents</th>
<th class="tableblock halign-left valign-top">HO-DSP Length and Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">39 Use of Data Country Code (ISO 3166)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 octets; numeric country code according to ISO 3166</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 octets; area number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">45 Use of international phone numbers (ITU-T E.164)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 octets; international phone number according to E.164</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets; area number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">47 Use of International Code Designator (ISO 6523)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 octets; international organization code according to ISO 6523</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 octets; area number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">49 Locally defined format (private addressing; free format)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formally not present</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between 0 and 12 octets; area number</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_levels_of_routing">23.2. Levels Of Routing</h3>
<div class="ulist">
<ul>
<li>
<p>Level 0 : ES-ES / ES-IS on the same link</p>
</li>
<li>
<p>Level 1 : IS-IS intra-area</p>
</li>
<li>
<p>Level 2 : IS-IS inter-area</p>
</li>
<li>
<p>Level 3 : IS-IS inter-domain (inter AS)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_adjancency">23.3. Adjancency</h3>
<div class="ulist">
<ul>
<li>
<p>Separate for L1 and L2</p>
<div class="ulist">
<ul>
<li>
<p>L1 with same area</p>
</li>
<li>
<p>L2</p>
</li>
</ul>
</div>
</li>
<li>
<p>possible adjacency states:</p>
<div class="ulist">
<ul>
<li>
<p>Down: The initial state. No IIHs have been received from the neighbor.</p>
</li>
<li>
<p>Initializing: IIHs have been received from the neighbor, but it is not certain that the neighbor is properly receiving this router’s IIHs.</p>
</li>
<li>
<p>Up: IIHs have been received from the neighbor, and it is certain that the neighbor is properly receiving this router’s IIHs.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_metrics">23.4. Metrics</h3>
<div class="ulist">
<ul>
<li>
<p>assigned to individual interfaces</p>
</li>
<li>
<p>default to 10</p>
<div class="ulist">
<ul>
<li>
<p>not automatically recalculated if bandwidth changes</p>
</li>
<li>
<p>manually set with <strong>isis metric &lt;number&gt;</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>types of metrics</p>
<div class="ulist">
<ul>
<li>
<p>Default: Required to be supported by all IS-IS implementations; usually relates to the bandwidth of the link (higher value represents a slower link)</p>
</li>
<li>
<p>Delay: Relates to the transit delay on the link</p>
</li>
<li>
<p>Expense: Relates to the monetary cost of carrying data through the link</p>
</li>
<li>
<p>Error: Relates to the residual bit error rate of the link</p>
</li>
</ul>
</div>
</li>
<li>
<p>narrow (original) metrics</p>
<div class="ulist">
<ul>
<li>
<p>6 bits for interface</p>
</li>
<li>
<p>10 bits for complete path</p>
</li>
</ul>
</div>
</li>
<li>
<p>wide metrics</p>
<div class="ulist">
<ul>
<li>
<p>24 bits for interface</p>
</li>
<li>
<p>32 bits for complete path</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use same type of metrics in one area
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_packets">23.5. Packets</h3>
<div class="ulist">
<ul>
<li>
<p>Hello</p>
</li>
<li>
<p>Link State PDU</p>
</li>
<li>
<p>Complete Sequence Numbers PDU</p>
</li>
<li>
<p>Partial Sequence Numbers PDU</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_hello">23.5.1. Hello</h4>
<div class="ulist">
<ul>
<li>
<p>also called IIH (IS-IS Hello)</p>
</li>
<li>
<p>separate L1 and L2 hellos in bcast network</p>
</li>
<li>
<p>single L1L2 hellos on point-to-point link</p>
</li>
<li>
<p>sent every 10 seconds per default</p>
</li>
<li>
<p>defined Hold time with <strong>isis hello-multiplier</strong></p>
</li>
<li>
<p>do not need to match (contrary to OSPF)</p>
</li>
<li>
<p>always the one-third of the configured values on DIS</p>
<div class="ulist">
<ul>
<li>
<p>to detect the outage more readily</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_link_state_pdu">23.5.2. Link State PDU</h4>
<div class="ulist">
<ul>
<li>
<p>one single LSP</p>
</li>
<li>
<p>may be fragmented by originator because of MTU</p>
</li>
<li>
<p>uniquely identified by LSPID</p>
<div class="ulist">
<ul>
<li>
<p>System Id</p>
</li>
<li>
<p>Pseudo Node:</p>
</li>
<li>
<p>Fragment Number</p>
</li>
</ul>
</div>
</li>
<li>
<p>uses Sequence Number for different version of the same LSP</p>
</li>
<li>
<p>has a Remaining Lifetime</p>
<div class="ulist">
<ul>
<li>
<p>default to 20 minutes</p>
</li>
<li>
<p>refreshes every 15 minutes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the LSP’s Remaining Lifetime decreases to 0, the router will delete the
LSP’s body from the link-state database, keep only its header, and advertise
the empty LSP with the Remaining Lifetime set to 0. Flooding an empty LSP with
the Remaining Lifetime set to 0 is called an LSP purge. Router purging an LSP
will not flush the LSP from its link-state database just yet, though. The
expired LSP can be purged from the link-state database after an additional time
called ZeroAgeLifetime set to 60 seconds. This is done to ensure that the LSP’s
header is retained until the purged LSP has been safely propagated to all
neighbors. Cisco routers, however, appear to hold the empty LSP header for
another 20 minutes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_complete_sequence_numbers_pdu">23.5.3. Complete Sequence Numbers PDU</h4>
<div class="ulist">
<ul>
<li>
<p>contains list of LSPID</p>
</li>
<li>
<p>doesn&#8217;t contain the LSP body(similar to OSPF&#8217;s DBD )</p>
</li>
<li>
<p>exchanged only during initialization on P2P links</p>
</li>
<li>
<p>sent periodically by DIS on bcast networks</p>
<div class="ulist">
<ul>
<li>
<p>Receivers of CSNP packets can compare their link-state database contents to
the list of LSPs in the CSNP and perform appropriate action—flood a newer or
missing LSP if they have one, or request an LSP if they find it missing in
their own database.</p>
</li>
<li>
<p>If the sender’s link-state database contains so many LSPs that listing them
all in a single CSNP packet would cause it to exceed the MTU, multiple CSNPs
are sent. For this purpose, the individual LSPIDs to be advertised are first
sorted as integer numbers in ascending order. Each CSNP contains information
about the Start LSPID and End LSPID that is described by this CSNP. The full
range of possible LSPIDs starts with the value of 0000.0000.0000.00-00 (the
bold part is the System ID, the following octet is the Pseudonode ID, and the
octet following the dash is the LSP Number ID), and ends with the value of
FFFF.FFFF.FFFF.FF-FF. If all LSPs can be listed in a single CSNP, the Start
and End LSPIDs will use these respective values. If it is necessary to send
more CSNPs, the first CSNP will have the 0000.0000.0000.00-00 as the Start
LSPID, and the End LSPID will be set to the LSPID of the last entry in this
CSNP. In the following CSNPs, the Start and End LSPIDs will be set to the
respective LSPIDs of the first and last entry, sorted in ascending order. The
last CSNP will have the value of FFFF.FFFF.FFFF.FF-FF as the End LSPID. This
sorting of LSPIDs into ascending number and CSNPs sequen- tially listing all
LSPIDs from the allowable range are the reasons for calling these PDUs
Sequence Numbers PDUs.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_partial_sequence_numbers_pdu">23.5.4. Partial Sequence Numbers PDU</h4>
<div class="ulist">
<ul>
<li>
<p>used to request an LSP or acknowledge its successful arrival.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_network_types_2">23.6. Network Types</h3>
<div class="ulist">
<ul>
<li>
<p>Broadcast (multi-access)</p>
</li>
<li>
<p>P2P</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_point_to_point_links">23.6.1. Point-to-Point Links</h4>
<div class="ulist">
<ul>
<li>
<p>On point-to-point interfaces, IS-IS expects to detect a single neighbor, bring up an adja- cency, and then synchronize link-state databases.</p>
</li>
<li>
<p>three-way handshake:</p>
<div class="ulist">
<ul>
<li>
<p>configured with <strong>isis three-way-handshake {cisco|ietf}</strong></p>
</li>
<li>
<p>introduces Extended Local Circuit ID (4 octets)</p>
</li>
<li>
<p>contains adjacency state TLV with</p>
<div class="ulist">
<ul>
<li>
<p>Adjacency Three Way State: This is the state of adjacency as seen by the sending router.</p>
</li>
<li>
<p>Extended Local Circuit ID: This is the ID of the sending router’s interface.</p>
</li>
<li>
<p>Neighbor System ID: This value is set to the ID of the neighboring router whose IIHs have been successfully received.</p>
</li>
<li>
<p>Neighbor Extended Local Circuit ID: This value is set to the Extended Local Circuit ID field value from the neighbor’s IIH packets.</p>
</li>
</ul>
</div>
</li>
<li>
<p>After the adjacency is declared as Up, routers will attempt to synchronize their link-state databases.</p>
<div class="ulist">
<ul>
<li>
<p>Both routers will mark all their LSPs for flooding over the point-to-point link; plus they send CSNP packets to each other.</p>
</li>
<li>
<p>Because the IS-IS standard assumes that the actual transmission of LSPs marked for flooding is driven by a periodically scheduled process,
it is possible that the CSNP packets are exchanged before the LSP transmission takes place.
If a router learns from the received CSNP that its neighbor already has an LSP that is scheduled to be sent,
the router will unmark the LSP, removing it from the set of LSPs to be flooded.
This way, only the LSPs missing from the neighbor’s database will be sent to it.
In addition, if a router learns from the received CSNP that the neighbor has LSPs that are newer or unknown,
it will request them using a PSNP packet. Note that neither of these is necessary,
as both routers nonetheless initially set up all their LSPs to be flooded across the link, without the aid of CSNP or PSNP packets.
The initial sending of CSNPs to com- pare the link-state databases and PSNPs to request missing or updated entries increases the resiliency of the synchronization process but is not strictly necessary: Without these packets,
routers will simply exchange the full link-state database.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_broadcast_networks">23.6.2. Broadcast Networks</h4>
<div class="ulist">
<ul>
<li>
<p>Routers must create adjacencies, synchronize their databases, and keep them synchronized</p>
</li>
<li>
<p>on Ethernet networks,</p>
<div class="ulist">
<ul>
<li>
<p>encapsulates IEEE 802.2 LLC frames to DSAP and SSAP set to 0xFE</p>
</li>
<li>
<p>sends L1 packets to mcast 0180.c200.0014</p>
</li>
<li>
<p>sends L2 packets to mcast 0180.c200.0015</p>
</li>
</ul>
</div>
</li>
<li>
<p>detects neighbors with IIH</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the IS-IS Priority</div>
<div class="content">
<pre>(config-if)# isis priority &lt;0-255&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Priority 0 doesn&#8217;t exclude the router from the election
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_dis">DIS</h5>
<div class="ulist">
<ul>
<li>
<p>helps routers on bcast segment to synchronize with periodic flooding of CSNPs</p>
</li>
<li>
<p>represents the bcast segment as the pseudo-node</p>
</li>
<li>
<p>doesn&#8217;t elect/need backup DIS</p>
</li>
<li>
<p>elected with each IIH based on Highest</p>
<div class="ulist">
<ul>
<li>
<p>Interface priority</p>
</li>
<li>
<p>SNPA</p>
</li>
<li>
<p>System ID: when SNPA are not comparable</p>
<div class="ulist">
<ul>
<li>
<p>Frame Relay DLCI vs ATM VPI/VCI</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_areas">23.7. Areas</h3>
<div class="ulist">
<ul>
<li>
<p>it is  possible to configure up to three different NSAP addresses on an IS-IS
router in a single IS-IS instance, provided that the System ID in all NSAP
addresses is identical and the NSAP addresses differ only in their Area ID.</p>
<div class="ulist">
<ul>
<li>
<p>A router with multiple NSAP addresses will nonetheless maintain only a single
link-state database, causing all configured areas to merge together. This
behavior is useful when splitting, joining, or renumbering areas.</p>
</li>
<li>
<p>For example, when you are renumbering an area, all routers are first added a second NSAP
address with the new Area ID and then the old NSAP address is removed—without
causing any adjacencies between routers to flap.</p>
</li>
<li>
<p>Similarly, when you are joining two areas, routers in an annexed area are given
the new NSAP with the same Area ID as the area into which they are being
joined, and afterward, the old NSAP is removed. Splitting an area again uses a
similar approach—first add the new NSAP address to all routers, and afterward,
remove the former NSAP address.</p>
</li>
</ul>
</div>
</li>
<li>
<p>L1 routers advertise directly connected networks</p>
</li>
<li>
<p>L2 routerts advertise directly connected networks, + all other L1 networks in its own area</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_authentication_2">23.8. Authentication</h3>
<div class="ulist">
<ul>
<li>
<p>authenticates IIH independently of LSP, CSNP and PSNP packets</p>
</li>
<li>
<p>L1 routers must have the same L1 area password</p>
</li>
<li>
<p>L2 routers must have the same L2 domain password</p>
</li>
<li>
<p>If security is a major concern, different passwords for L1 IIH, L2 IIH, L1
non-IIH, and L2 non-IIH packets can be configured.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure IIH Authentication</div>
<div class="content">
<pre>(config-if)# isis authentication mode {text | md5} [level-1|level-2]
(config-if)# isis auth key-chain name [level-1|level-2]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure LSP, CSNP and PSNP Authentication</div>
<div class="content">
<pre>(config-router)# authentication mode {text | md5} [level-1|level-2]
(config-router)# authentication key-chain name [level-1|level-2]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the previous commands , if the <strong>level-1</strong> or <strong>level-2</strong>
keyword is omitted from a command where it is currently indicated, the
corresponding authentication type will be activated for both levels.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ipv6_support">23.9. IPv6 Support</h3>
<div class="ulist">
<ul>
<li>
<p>Supports out-of-the box</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO:</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bgp">24. BGP</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration guides</span>&#160;&#9656; <span class="submenu">IP Routing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/iproute_bgp/configuration/15-mt/irg-15-mt-book/configuring_a_basic_bgp_network.html">BGP</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exterior gateway protocol</p>
</li>
<li>
<p>Creates loop-free inter-domain routing between AS.</p>
</li>
<li>
<p>Path vector algorithm = (distance vector + AS-path loop detection)</p>
</li>
<li>
<p>TCP 179</p>
</li>
<li>
<p>AD: external 20 , internal and local 200</p>
</li>
<li>
<p>RFC 1771</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_bgp_message_format">24.1. BGP Message Format</h3>
<div class="ulist">
<ul>
<li>
<p>Minimum size: 19 bytes</p>
</li>
<li>
<p>Maximum size: 4096 bytes</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_bgp_header">24.1.1. BGP Header</h4>
<div class="imageblock">
<div class="content">
<img src="../images/bgp-header-format.png" alt="BGP Header Format" width="896" height="280">
</div>
<div class="title">Figure 42. BGP Header Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Marker</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bytes</p>
</li>
<li>
<p>set to all 1s for OPEN message or if OPEN message without authentication</p>
</li>
<li>
<p>computed by the authentication process</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Length</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>2 bytes</p>
</li>
<li>
<p>Total length in bytes of the message including the header</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>1 byte</p>
</li>
<li>
<p>Indicates message type (1: Open, 2: Update, 3: Notification, 4: Keepalive)</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_open">24.1.2. OPEN</h4>
<div class="ulist">
<ul>
<li>
<p>Initiates the session</p>
</li>
<li>
<p>Contains BGP version , local AS number, BGP router Id</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/bgp-open.png" alt="bgp open" width="896" height="280">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Version</dt>
<dd>
<p>1 octet</p>
</dd>
<dt class="hdlist1">My autonomous system</dt>
<dt class="hdlist1">Hold time</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>maximum interval in seconds between successive Keepalive  or Update messages.</p>
</li>
<li>
<p>A receiver compares the value of the Hold Time and the value of its configured hold time
and accepts the smaller value or rejects the connection.</p>
</li>
<li>
<p>Can be set to zero to indicates that the connection is always up</p>
</li>
<li>
<p>if not set to zero, the minimum recommended hold time is 3 seconds</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">BGP identifier</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Router ID</p>
</li>
<li>
<p>determined by these rules in order of preference at boot or BGP process restart:</p>
<div class="ulist">
<ul>
<li>
<p>manually configured Router id</p>
</li>
<li>
<p>highest IP address of an up/up loopback</p>
</li>
<li>
<p>highest IP address of an up/up non-loopack</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Optional parameters length</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>total length in octects of the following Optional Parameters field</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Optional Parameters</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Variable length field containing a triplet &lt;Type: 1 octet,Length: 1 octet,Value&gt;</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Configure the BGP Router Id</div>
<div class="content">
<pre>(config-router)# bgp router-id &lt;ip-address&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_keepalive">24.1.3. KEEPALIVE</h4>
<div class="ulist">
<ul>
<li>
<p>Every 60 seconds</p>
</li>
<li>
<p>Hold-time: 180 seconds</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the BGP Network Timers</div>
<div class="content">
<pre>(config-router)# timers bgp &lt;keepalive-seconds&gt; &lt;holdtime-seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the BGP Network Timers for a Specific Neighbor</div>
<div class="content">
<pre>(config-router)# neighbor {&lt;ip-address&gt; | &lt;peer-group-name&gt;} timers &lt;keepalive-seconds&gt; &lt;holdtime-seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update">24.1.4. UPDATE</h4>
<div class="ulist">
<ul>
<li>
<p>Advertises a single feasible route to a peer and/or withdraws multiple unfeasible routes</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/bgp-update.png" alt="Header Format" width="896" height="312">
</div>
<div class="title">Figure 43. Header Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Unfeasible Routes Length</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>2-octet field</p>
</li>
<li>
<p>total length of the following Withdrawn Routes field, in octets.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Withdrawn Routes</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>variable-length</p>
</li>
<li>
<p>lists routes to be withdrawn from service.</p>
</li>
<li>
<p>Each route in the list is described with a (Length, Prefix) tuple in which the Length is
the length of the prefix and the Prefix is the IP address prefix of the withdrawn route.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Total Path Attribute Length</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>2-octet</p>
</li>
<li>
<p>total length of the following Path Attribute field, in octets.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Path Attributes</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>variable-length</p>
</li>
<li>
<p>lists the attributes associated with the NLRI in the following field.
Each path attribute is a variable-length triple of (Attribute Type, Attribute
Length, Attribute Value). The Attribute Type part of the triple is a 2-octet field consisting of
four flag bits, four unused bits, and an Attribute Type code (see <a href="#AttributeTypeCode">Attribute Type Code</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/bgp-attribute.png" alt="Attribute Type Part Of the Path Attributes Field" width="512" height="152">
</div>
<div class="title">Figure 44. Attribute Type Part Of the Path Attributes Field</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Flag bits (1/0)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>O: Optional / Well-known</p>
</li>
<li>
<p>T: Transitive / Non-transitive</p>
</li>
<li>
<p>P: Partial / Complete</p>
</li>
<li>
<p>E: Extended length / Regular length ( 2-bytes/ 1-bytes)</p>
</li>
<li>
<p>U: Unused</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<table id="AttributeTypeCode" class="tableblock frame-none grid-rows spread">
<caption class="title">Table 14. Attribute Type Code</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Category</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ORIGIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Well-known mandatory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AS_PATH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Well-known mandatory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEXT_HOP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Well-known mandatory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULTI_EXIT_DISC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional nontransitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCAL_REF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional transitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATOMIC_AGGREGATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Well-known discretionary</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AGGREGATOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional transitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COMMUNITY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional transitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ORIGINATOR_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional nontransitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLUSTER_LIST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional nontransitive</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
tasks for Internet, no-export, no-advertise, local-as
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_notification">24.1.5. NOTIFICATION</h4>
<div class="ulist">
<ul>
<li>
<p>go out in response to error, fatal condition</p>
</li>
<li>
<p>torn down or reset the BGP peer session</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_bgp_fsm_states">24.1.6. BGP FSM States</h4>
<div class="imageblock">
<div class="content">
<img src="../images/diag-149799025073e8fed30407bd1c11e23e.png" alt="BGP Neighbor Negotiation Finite State Machines" width="923" height="321">
</div>
<div class="title">Figure 45. BGP Neighbor Negotiation Finite State Machines</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Idle</dt>
<dd>
<p>initial BGP state after enabling BGP process or resetting device.</p>
</dd>
<dt class="hdlist1">Connect</dt>
<dd>
<p>waits for a TCP connection with the remote peer. If successful, sends OPEN message. If not, resets the ConnectRetry timer and transitions to Active state.</p>
</dd>
<dt class="hdlist1">Active</dt>
<dd>
<p>attempts to initiate a TCP connection with the remote
peer. If successful, sends OPEN message. If not, resets ConnectRetry timer and transitions back to Connect state</p>
</dd>
<dt class="hdlist1">OpenSent</dt>
<dd>
<p>TCP connection up and OPEN message sent,  transition to OpenReceive state and wait for initial
keepalive to move into OpenConfirm state.  If TCP session disconnect, terminate BGP session, reset ConnectRetry timer, move back to Active State.</p>
</dd>
<dt class="hdlist1">OpenConfirm</dt>
<dd>
<p>OPEN messages sent and received. Wait for KEEPALIVE</p>
</dd>
<dt class="hdlist1">Established</dt>
<dd>
<p>KEEPALIVE received, neighbor parameters match. the BGP peer session is fully established. UPDATE messages containing routing information will now be sent.</p>
<div class="ulist">
<ul>
<li>
<p>If peer stuck in <strong>Active</strong> state, potential problems can include:</p>
<div class="ulist">
<ul>
<li>
<p>no IP connectivity</p>
</li>
<li>
<p>incorrect <strong>neighbor</strong> statement</p>
</li>
<li>
<p>access-list filtering TCP port 179</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>TODO: To display transitions from idle to established with debug ip bgp</p>
</div>
<div class="listingblock">
<div class="content">
<pre>R1(config)# router bgp 123
R1(config-router)# no neigh 172.16.16.6 shutdown
*Mar 4 21:02:16.958: BGP: 172.16.16.6 went from
*Mar 4 21:02:16.958: BGP: 172.16.16.6 , delay 15571ms
*Mar 4 21:02:29.378: BGP: 172.16.16.6
*Mar 4 21:02:29.382: BGP: 172.16.16.6 rcv message type 1, length (excl. header) 26 *Mar 4 21:02:29.382: BGP: 172.16.16.6 rcv OPEN, version 4, holdtime 180 seconds *Mar 4 21:02:29.382: BGP: 172.16.16.6 went from
*Mar 4 21:02:29.382: BGP: 172.16.16.6   , version 4,   ,
holdtime 180 seconds
*Mar 4 21:02:29.382: BGP: 172.16.16.6     w/ OPTION parameter len: 16 BGP: 172.16.16.6
*Mar 4 21:02:29.382: BGP: 172.16.16.6 went from OpenSent to OpenConfirm
*Mar 4 21:02:29.382: BGP: 172.16.16.6 send message type 1, length (incl. header) 45
*Mar  4 21:02:29.394: BGP: 172.16.16.6 went from</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_autonomous_systems">24.2. Autonomous Systems</h3>
<div class="ulist">
<ul>
<li>
<p>AS: set of routers under a single technical administration</p>
</li>
<li>
<p>AS can be:</p>
<div class="ulist">
<ul>
<li>
<p>stub : only one exit</p>
</li>
<li>
<p>multihomed: multiple connections with the one or multiple providers</p>
<div class="ulist">
<ul>
<li>
<p>transit: allows traffic with origin and destination outside the AS</p>
</li>
<li>
<p>non-transit:</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_asn_format">24.2.1. ASN Format</h4>
<div class="ulist">
<ul>
<li>
<p>2-byte (RFC 4271)</p>
<div class="ulist">
<ul>
<li>
<p>0 - 65535</p>
</li>
<li>
<p>reserved: 0, 65535</p>
</li>
<li>
<p>public use: 1 - 64495</p>
</li>
<li>
<p>documentation: 64496-64511 (RFC 5398)</p>
</li>
<li>
<p>private use: 64512 - 65534</p>
</li>
</ul>
</div>
</li>
<li>
<p>4-byte (RFC 5396)</p>
<div class="ulist">
<ul>
<li>
<p>Asplain: decimal value notation for 2-byte and 4-byte ASNs</p>
</li>
<li>
<p>Asdot: decimal value notation for 2-byte and dot notation for 4-byte ASN</p>
</li>
<li>
<p>Documentation: 65536-65551 (RFC 5398)</p>
</li>
</ul>
</div>
</li>
<li>
<p>AS 23456: reserved for gradual transition from 2-byte to 4-byte (RFC 4893)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Modify the Default Output and Regex Match Format for 4-Byte ASN</div>
<div class="content">
<pre>(config-router)# bgp asnotation dot</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_peers">24.3. BGP Peers</h3>
<div class="ulist">
<ul>
<li>
<p>Manually configured and not automatically discovered</p>
</li>
<li>
<p>Formed over a TCP connection</p>
</li>
<li>
<p>Exchanges PA(Path Attributes) and NLRI (IP/prefix) with the same PA</p>
</li>
<li>
<p>Starts with full BGP routing table then incremental updates</p>
</li>
<li>
<p>Keeps table version number</p>
<div class="dlist">
<dl>
<dt class="hdlist1">iBPG peers </dt>
</dl>
</div>
</li>
<li>
<p>same AS</p>
</li>
<li>
<p>must be fully meshed within AS</p>
<div class="dlist">
<dl>
<dt class="hdlist1">eBGP peers </dt>
</dl>
</div>
</li>
<li>
<p>different AS</p>
</li>
<li>
<p>by default, one hop away but you can change that with <strong>ebgp-multihop</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Neighbor</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; remote-as &lt;asn&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable the Neighbor to Exchange Prefixes for the Ipv4 Unicast Address Family with the Local Device</div>
<div class="content">
<pre>(config-router)# address-family ipv4 [unicast | multicast | vrf &lt;name&gt;]
!TODO check the mode
(config-router)# neighbor &lt;ip-address&gt; activate</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Info About the TCP and BGP Connection to Neighbors</div>
<div class="content">
<pre># sh ip bgp neigbors &lt;ip-address&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_peer_groups">24.4. BGP Peer Groups</h3>
<div class="ulist">
<ul>
<li>
<p>Group of peers with the same update policies ( outbound route maps, distribute lists, filter lists, update source ,)</p>
</li>
<li>
<p>Benefits:</p>
<div class="ulist">
<ul>
<li>
<p>simplify configuration</p>
</li>
<li>
<p>make configuration updates more efficient</p>
</li>
</ul>
</div>
</li>
<li>
<p>Restrictions for eBGP peers:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Create a BGP Peer Group</div>
<div class="content">
<pre>(config-router)# neighbor &lt;peer-group-name&gt; peer-group</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Assign a Neighbor to a Peer Group</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; peer-group &lt;name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Add a Text Description with a Specified Peer Group</div>
<div class="content">
<pre>(config-router)# neighbor &lt;peer-group-name&gt; description &lt;text&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable a BGP Peer or Peer Group</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; shutdown</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_session_reset">24.5. BGP Session Reset</h3>
<div class="ulist">
<ul>
<li>
<p>Whenever the routing policy changes due to a configuration change</p>
</li>
<li>
<p>Can be hard reset, soft reset or dynamic inbound soft reset</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Clear and Reset BGP Neighbor Sessions</div>
<div class="content">
<pre># clear ip bgp *</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable Logging Of BGP Neighbor Resets</div>
<div class="content">
<pre>(config-router)# bgp log-neighbor-changes</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Clear BGP Update Group Membership and Recalculate BGP Update Groups</div>
<div class="content">
<pre># clear ip bgp update-group [ &lt;index-group&gt; | &lt;ip-address&gt; ]</pre>
</div>
</div>
<div class="sect3">
<h4 id="_hard_reset">24.5.1. Hard Reset</h4>
<div class="ulist">
<ul>
<li>
<p>Tears down the peering sessions including the TCP connections</p>
</li>
<li>
<p>Deletes prefixes learned from the peers.</p>
</li>
<li>
<p>Pros: no memory overhead</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_soft_reset">24.5.2. Soft Reset</h4>
<div class="ulist">
<ul>
<li>
<p>Stores prefix information</p>
</li>
<li>
<p>Do not tearn down existing peering sessions</p>
</li>
<li>
<p>Can be configured for inbound or outbound sessions</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task:Configure a BGP Speaker to Perform Inbound Soft Reconfiguration for Peers That Do Not Support the Route Refresh Capability.</div>
<div class="content">
<pre>(config-router)# bgp soft-reconfig-backup</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Start Storing Updates for Each Neighbor That Do Not Support Route Refresh</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address|peer-group-name&gt; soft-reconfiguration [inbound]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>All the updates received from this neighbor will be stored unmodified,
regardless of the inbound policy. When inbound soft reconfiguration is done
later, the stored information will be used to generate a new set of inbound
updates.</p>
</li>
<li>
<p>Memory requirements can increased.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dynamic_inbound_soft_reset">24.5.3. Dynamic Inbound Soft Reset</h4>
<div class="ulist">
<ul>
<li>
<p>Do not store update information locally</p>
</li>
<li>
<p>Relies on dynamic exchanges with supporting peers</p>
</li>
<li>
<p>The peers supports the capability if  <strong>show ip bgp neighbors</strong> displays
<em>Received route refresh capability from peer</em> .</p>
</li>
<li>
<p>Use <strong>bgp soft-reconfig-backup</strong> to store updates for peers who do not support the refresh route capability</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_routing_policy_change_management">24.5.4. Routing Policy Change Management</h4>
<div class="paragraph">
<p>TODO: add this part under bgp reset</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_route_aggregation">24.6. BGP Route Aggregation</h3>
<div class="ulist">
<ul>
<li>
<p>2 methods</p>
<div class="ulist">
<ul>
<li>
<p>basic route redistribution: creates an aggregate route, then redistributes the routes in BGP</p>
</li>
<li>
<p>conditional aggregation: creates an aggregate route , then advertises or not certain routes
based on route maps, AS-SET, or summary information</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>bgp suppress-inactive</strong> stops BGP to advertise inactive routes (not installed
into the RIB) to any peer.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_bgp_route_aggregation_generating_as_set_information">24.6.1. BGP Route Aggregation Generating AS_SET Information</h4>
<div class="paragraph">
<p>#TODO: improve this part</p>
</div>
<div class="paragraph">
<p>AS_SET information can be generated when BGP routes are aggregated using the
aggregate-address command. The path advertised for such a route is an AS_SET
consisting of all the elements, including the communities, contained in all the
paths that are being summarized. If the AS_PATHs to be aggregated are
identical, only the AS_PATH is advertised. The ATOMIC-AGGREGATE attribute, set
by default for the aggregate-address command, is not added to the AS_SET.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_backdoor_routes">24.7. BGP Backdoor Routes</h3>
<div class="ulist">
<ul>
<li>
<p>Use <strong>network backdoor</strong> to cause BGP to prefer EIGRP</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/bgp-backdoor-route-topology.png" alt="Backdoor routes" width="400" height="400">
</div>
</div>
<div class="listingblock">
<div class="title">Task: Indicate a Network Reachable Through a Backdoor Route</div>
<div class="content">
<pre>(config-router)# network &lt;ip-address&gt; backdoor</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_best_path_selection_algorithm">24.8. Best Path Selection Algorithm</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Reachable Next Hop (Well-Known Mandatory)</p>
</li>
<li>
<p>Highest Weight</p>
</li>
<li>
<p>Highest Local Pref</p>
</li>
<li>
<p>Locally Originated Paths (Network, Distribute, Aggregate-Summary) Over Externally Originated Paths</p>
</li>
<li>
<p>Shortest AS Path</p>
</li>
<li>
<p>Lowest Origin Type ( Internal Over External Over Incomplete)</p>
</li>
<li>
<p>Lowest MED</p>
</li>
<li>
<p>EBGP Paths Over IBGP Paths</p>
</li>
<li>
<p>Lowest IGP Cost</p>
</li>
<li>
<p>Oldest Path</p>
</li>
<li>
<p>Lowest BGP Router Id</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
“We Love Oranges AS Oranges Mean Pure Refreshment”.
W Weight (Highest) L Local_Pref (Highest) O Originate (local originate) AS
As_Path (shortest) O Origin Code (IGP &lt; EGP &lt; Incomplete) M MED (lowest) P
Paths (External Paths preferred Over Internal) R Router ID (lowest)
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
wise lip lovers apply oral medication every night
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_community_attributes">24.9. Community Attributes</h3>
<div class="ulist">
<ul>
<li>
<p>No-advertise: prevents advertisements to any BGP peer</p>
</li>
<li>
<p>No-export: prevents advertisements to any eBGP peer</p>
</li>
<li>
<p>local-as:  prevents advertisements outside the AS, or in confederation scenarios, outside the sub-AS</p>
</li>
<li>
<p>Internet:  advertises routes to any peer</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_routing_process">24.10. BGP Routing Process</h3>
<div class="listingblock">
<div class="title">Task: Configure a BGP Routing Process</div>
<div class="content">
<pre>(config)# router bgp &lt;asn&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify a Network As Local to the BGP Routing Table</div>
<div class="content">
<pre>(config-router)# network &lt;prefix&gt; [mask  &lt;a.b.c.d&gt;] [route-map &lt;name&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable the IPv4 Unicast Address Family for the BGP Routing Process</div>
<div class="content">
<pre>no bgp default ipv4-unicast</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Add a Text Description with a Specified Neighbor</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; description &lt;text&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Apply a route map to incoming or outgoing routes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address|peer-group-name&gt; route-map &lt;name&gt; [in | out]</pre>
</div>
</div>
<div class="sect3">
<h4 id="_aggregating_route_prefixes_using_bgp">24.10.1. Aggregating Route Prefixes Using BGP</h4>
<div class="listingblock">
<div class="title">Task: Redistribute Static Routes Into the BGP Routing Table</div>
<div class="content">
<pre>(config-router)# redistribute static</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task:Create an Aggregate Entry In a BGP Routing Table</div>
<div class="content">
<pre>(config-router)# aggregate-address &lt;prefix&gt; &lt;mask&gt; [as-set]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Create an Aggregate Route and Suppress Advertisements Of More-Specific Routes to All Peers</div>
<div class="content">
<pre>(config-router)# aggregate-address &lt;prefix&gt; &lt;mask&gt; [summary-only]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Create an Aggregate Route but Suppress Advertisement Of Specified Routes</div>
<div class="content">
<pre>(config-router)# aggregate-address &lt;prefix&gt; &lt;mask&gt; [suppress-map &lt;map-name&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Selectively Advertises Routes Previously Suppressed by the <strong>Aggregate-Address</strong> Command</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address | peer-group-name&gt; unsuppress-map &lt;map-name&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Conditionally advertise BGP routes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The routes or prefixes that will be conditionally advertised are defined in two
route maps: an advertise map and either an exist map or nonexist map. The route
map associated with the exist map or nonexist map specifies the prefix that the
BGP speaker will track. The route map associated with the advertise map
specifies the prefix that will be advertised to the specified neighbor when the
condition is met.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a prefix is found to be present in the exist map by the BGP speaker, the
prefix specified by the advertise map is advertised.</p>
</li>
<li>
<p>If a prefix is found not to be present in the nonexist map by the BGP
speaker, the prefix specified by the advertise map is advertised.</p>
</li>
<li>
<p>If the condition is not met, the route is withdrawn and conditional
advertisement does not occur. All routes that may be dynamically advertised
or not advertised must exist in the BGP routing table in order for
conditional advertisement to occur. These routes are referenced from an
access list or an IP prefix list.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Advertise Selectively Some BGP Routes to Neighbor</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; advertise-map &lt;name-1&gt; { exist-map &lt;name&gt; | non-exist-map &lt;name&gt;}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Inject More Specific Prefixes Into a BGP Routing Table Over Less Specific Prefixes</div>
<div class="content">
<pre>(config-router)# bgp inject-map &lt;name&gt; exist-map &lt;name&gt; [copy-attributes]</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_routes">24.11. BGP Routes</h3>
<div class="listingblock">
<div class="title">Task: Advertise a Default Route to BGP Peers</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; default-originate  [route-map &lt;name&gt;]</pre>
</div>
</div>
<div class="ulist">
<div class="title">Task: Suppress Inactive Route Advertisement Using BGP</div>
<ul>
<li>
<p>Suppress inactive route advertisement</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router-af)# bgp suppress-inactive</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_peer_session_template">24.12. Peer Session Template</h3>
<div class="listingblock">
<div class="title">Task: Create a Peer Session Template</div>
<div class="content">
<pre>(config-router)# template peer-session &lt;name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Inherit the Configuration Of Another Peer Session Template</div>
<div class="content">
<pre>(config-router-stmp)# inherit peer-session &lt;template-name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Send a Peer Session Template to a Neighbor So That the Neighbor Can Inherit the Configuration</div>
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; inherit peer-session &lt;template-name&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_peer_policy_template">24.13. Peer Policy Template</h3>
<div class="listingblock">
<div class="title">Task: Create a Peer Policy Template</div>
<div class="content">
<pre>(config-router)# template peer-policy &lt;name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Maximum Number Of Prefixes That a Neighbor Will Accept from This Peer</div>
<div class="content">
<pre>(config-router-ptmp)# maximum-prefix &lt;limit&gt; [&lt;threshold&gt;] [restart &lt;interval&gt; | warning-only]</pre>
</div>
</div>
<div class="ulist NOTE">
<ul class="NOTE">
<li>
<p>A peer policy template can directly or indirectly inherit up to 8 peer
policy templates.</p>
</li>
<li>
<p>A BGP neighbor cannot be configured to work with both peer groups and peer
templates. A BGP neighbor can be configured to belong only to a peer group or
to inherit policies only from peer templates.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_routing_table">24.14. BGP Routing Table</h3>
<div class="listingblock">
<div class="title">Task: Display the Entries In the BGP Routing Table</div>
<div class="content">
<pre># sh ip bgp [prefix] [mask]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify that the VRF instance has been created</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip vrf</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display information about all the BGP paths in the database</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip bgp paths</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display the status of all BGP connections</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip bgp summary</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display IPv4 multicast database-related information</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip bgp ipv4 multicast &lt;command&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display injected paths</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip bgp injected-paths

BGP table version is 11, local router ID is 10.0.0.1
Status codes:s suppressed, d damped, h history, * valid, &gt; best, i -
internal
Origin codes:i - IGP, e - EGP, ? - incomplete
   Network          Next Hop            Metric LocPrf Weight Path
*&gt; 172.16.0.0       10.0.0.2                               0 ?
*&gt; 172.17.0.0/16    10.0.0.2                               0 ?</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display update replication stats for BGP update groups</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip bgp replication [&lt;index-group&gt; | &lt;ip-address&gt;] [summary]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display BGP routes that are not installed in the RIB</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip bgp rib-failure

Network            Next Hop                      RIB-failure   RIB-NH Matches
10.1.15.0/24       10.1.35.5           Higher admin distance              n/a
10.1.16.0/24       10.1.15.1           Higher admin distance              n/a</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display locally configured peer session template</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip bgp template peer-session</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshoot_2">24.15. Troubleshoot</h3>
<div class="listingblock">
<div class="title">Task: Display Info About the Processing Of BGP Update Groups.</div>
<div class="content">
<pre># debug ip bgp groups</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_todos">24.16. Todos</h3>
<div class="ulist">
<ul>
<li>
<p>Concept: bgp route aggregation generating AS_SET information</p>
</li>
<li>
<p>Multiprotocol bgp concepts</p>
</li>
<li>
<p>Multiprotocol bgp extensions for IP multicast concepts</p>
</li>
<li>
<p>AFI bgp address family identifier model : ipv4, ipv6,clns, vpnv4</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_pic">24.17. BGP PIC</h3>
<div class="ulist">
<ul>
<li>
<p>BGP Prefix-Independent Convergence for IP and MPLS-VPN feature</p>
</li>
<li>
<p>creates and stores a backup/alternate path in the RIB,FIB, and CEF
so that when a failure is detected, the backup/alternate path can immediately take over,
thus enabling fast failover.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">How BGP Converges Under Normal Circumstances</div>
<div class="paragraph">
<p>Under normal circumstances, BGP can take several seconds to a few minutes to converge after a network change. At a high level, BGP goes through the following process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BGP learns of failures through either IGP or BFD events or interface events.</p>
</li>
<li>
<p>BGP withdraws the routes from the RIB, and the RIB withdraws the routes from the FIB and dFIB.  This process clears the data path for the affected prefixes.</p>
</li>
<li>
<p>BGP sends withdraw messages to its neighbors.</p>
</li>
<li>
<p>BGP calculates the next best path to the affected prefixes.</p>
</li>
<li>
<p>BGP inserts the next best path for affected prefixes into the RIB, and the RIB installs them in the FIB and dFIB.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This process takes a few seconds or a few minutes to complete, depending on the
latency of the network, the convergence time across the network, and the local
load on the devices. The data plane converges only after the control plane converges.</p>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When BGP PIC is enabled, CEF recursion is disabled
when next-hop is learned via /32 mask or next-hop is directly connected
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Read more
<a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/iproute_bgp/configuration/15-mt/irg-15-mt-book/irg-bgp-mp-pic.html#GUID-63551B0E-00FE-4952-AC34-E418ABF110CA">details</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_ttl_security_check">24.18. BGP TTL Security Check</h3>
<div class="paragraph">
<p>TTL Security Check is a security feature that protects BGP peers from multi-hop
attacks. This feature is based on the Generalized TTL Security Mechanism (GTSM,
RFC 3682), and is currently available for BGP. Work is currently in progress to
implement this feature for other routing protocols such as OSPF and EIGRP.</p>
</div>
<div class="paragraph">
<p>TTL Security Check allows the configuration of a minimum acceptable TTL value
for the packets exchanged between two eBGP peers. When enabled, both peering
routers transmit all their traffic to each other with a TTL of 255. In
addition, routers establish a peering session only if the other eBGP peer sends
packets with a TTL equal to or greater than the TTL value configured for the
peering session. All packets received with TTL values less than the predefined
value are silently discarded.</p>
</div>
<div class="listingblock">
<div class="title">Task: Enable TTL security check between BGP peers</div>
<div class="content">
<pre>(config-router)# neighbor &lt;a.b.c.d&gt; ttl-security hops &lt;count&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_redistribution">25. Redistribution</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Redistribution occurs from the routing table not the routing database</p>
</li>
<li>
<p>When redistributing protocol X into Y, take &#8230;&#8203;</p>
<div class="ulist">
<ul>
<li>
<p>routes in the RIB via protocol X</p>
</li>
<li>
<p>connected interfaces running protocol X</p>
</li>
</ul>
</div>
</li>
<li>
<p>choose</p>
<div class="ulist">
<ul>
<li>
<p>routes with lower AD</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_administrative_distance">25.1. Administrative Distance</h3>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Route source</th>
<th class="tableblock halign-left valign-top">Distance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connected route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">summary EIGRP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eBGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">internal EIGRP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGRP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OSPF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IS-IS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">115</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ODR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">External EIGRP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">170</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iBGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unknown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">255</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_spot_issues">25.2. Spot Issues</h3>
<div class="ulist">
<ul>
<li>
<p>Loops cannot occur with one single point of redistribution</p>
</li>
<li>
<p>Loops may occur with multiple points of redistribution</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_heuristics">25.3. Heuristics</h3>
<div class="ulist">
<ul>
<li>
<p>identify each domain and associate a tag</p>
</li>
<li>
<p>assign tags to each domain</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>  route-map ospf2eigrp permit
    set tag 123</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>deny tag on re-entry</p>
<div class="ulist">
<ul>
<li>
<p>always block routes to be re-enter the domain</p>
</li>
<li>
<p>optionaly: block routes as per scenario requirement</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>  ! block own routes
  route-map ospf2eigrp deny 10
    match tag 456
  ! block some routes if requested
  route-map deny 20
    match tag 78</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>all tags to pass through transit domains without re-tagging them</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>! identify the transit tags without tagging
route-map ospf2eigrp permit 60
  match tag 234</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use BGP community instead of tags for BGP</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>route-map ospf2bgp permit 70
  set community 110</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>ip community-list 1 permit 10
  match community 1
  set tag 110</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connected_routes">25.4. Connected Routes</h3>
<div class="listingblock">
<div class="title">Task: Redistribute Connected Routes</div>
<div class="content">
<pre>redistribute connected</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Override the implicit redistribution of interfaces running the protocol X</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_static_routes_2">25.5. Static Routes</h3>
<div class="listingblock">
<div class="title">Task: Redistribute Static Route</div>
<div class="content">
<pre>(config-router)# redistribute static route-map &lt;name&gt; metric &lt;value&gt;
(config-router)# default-metric &lt;hops&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rip_2">25.6. RIP</h3>
<div class="ulist">
<ul>
<li>
<p>doesn&#8217;t differentiate between internal and external routes</p>
</li>
<li>
<p>no default seed metric</p>
<div class="ulist">
<ul>
<li>
<p>recommendation: use  1 as default-metric</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Prevent Loss Of Packet When BGP Routes Are Redistributed In RIP</div>
<div class="content">
<pre>(config)# router rip
(config-router)# input-queue 1024</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eigrp_2">25.7. EIGRP</h3>
<div class="listingblock">
<div class="content">
<pre>redistribute &lt;protocol&gt; metric &lt;bandwidth&gt; &lt;delay&gt; &lt;load&gt; &lt;reliability&gt; &lt;MTU&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>internal routes AD &lt; external routes</p>
</li>
<li>
<p>uses router-id for loop prevention</p>
</li>
<li>
<p>no default seed metric unless EIGRP to EIGRP</p>
<div class="ulist">
<ul>
<li>
<p>default-metric &lt;bandwidth&gt; &lt;delay&gt; &lt;load&gt; &lt;reliability&gt; &lt;MTU&gt;</p>
</li>
<li>
<p>default-metric 10000 100 1 255 1500</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Duplicate router-ids will prevent EIGRP to install routes
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ospf_redistribution">25.8. OSPF Redistribution</h3>
<div class="ulist">
<ul>
<li>
<p>differentiates between internal and external routes but same AD= 110</p>
</li>
<li>
<p>Router-id for flooding loop prevention</p>
</li>
<li>
<p>Use <strong>subnets</strong> keyword</p>
</li>
<li>
<p>default metric is 1 for BGP and 20 for other IGP</p>
</li>
<li>
<p>default metric-type E2/N2</p>
</li>
<li>
<p>OSPF path selection
TODO: improve this part</p>
<div class="ulist">
<ul>
<li>
<p>E1 &gt; E2 &gt; N1 &gt; N2</p>
</li>
<li>
<p>E1 &amp; N1 vs E2 &amp; N2 metrics</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>router ospf 1
  redistribute rip
  redistribute eigrp
  default-metric 10</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Assign Different AD to Internal and External</div>
<div class="content">
<pre></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_redistribution">25.9. BGP Redistribution</h3>
<div class="sect3">
<h4 id="_igp_to_bgp">25.9.1. IGP to BGP</h4>
<div class="ulist">
<ul>
<li>
<p>denies OSPF external routes by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Redistribute OSPF Into BGP</div>
<div class="content">
<pre>redistribute ospf &lt;pid&gt; match internal external</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bgp_to_igp">25.9.2. BGP to IGP</h4>
<div class="ulist">
<ul>
<li>
<p>iBGP routes denied by default, eBGP routes win</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<h1 id="_part_iii_vpn_technologies" class="sect0">Part III : VPN Technologies</h1>
<div class="sect1">
<h2 id="_vrf">26. VRF</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Virtual Routing and Forwarding</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create multiple virtual, isolated networks,
where each technically has its own separate RIB  and FIB .</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">steps</div>
<div class="content">
<pre>conf t
ip routing
ip vrf &lt;case-sensitive-name&gt;
  rd &lt;route-distinguisher&gt;
  route-target {export|import|both} &lt;rt-ext-community&gt;
  import map &lt;route-map&gt;
  export map &lt;route-map&gt;
interface &lt;type slot/subslot/port&gt;
  ip vrf forwarding &lt;vrf-name&gt;</pre>
</div>
</div>
<div class="sect2">
<h3 id="_vrf_definition">26.1. VRF definition</h3>
<div class="ulist">
<ul>
<li>
<p>old command for ipv4 only <strong>ip vrf &lt;name&gt;</strong></p>
</li>
<li>
<p>new command for ipv4 and ipv6 address family</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Create a VRF</div>
<div class="content">
<pre>(config)# vrf definition &lt;name&gt;
(config-vrf)# description &lt;same useful information&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_route_distinguisher">26.2. Route Distinguisher</h3>
<div class="ulist">
<ul>
<li>
<p>64-bit prepended to every route in the respective VRF routing table</p>
</li>
<li>
<p>create unique VPNv4 prefix in case two VPNs contain the same prefixes</p>
</li>
<li>
<p>the first 2 bytes represent the RD type</p>
</li>
<li>
<p>the last 6 bytes can be</p>
<div class="ulist">
<ul>
<li>
<p>Common format: ASN(2bytes):Site(4bytes) or ASN(4bytes):Site(2bytes)</p>
</li>
<li>
<p>Alternative format: a.b.c.d:NN</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_route_target">26.3. Route Target</h3>
<div class="ulist">
<ul>
<li>
<p>RT is Path attribute of the NLRI</p>
</li>
<li>
<p>1 or + for each RD/prefix</p>
</li>
<li>
<p>useful in overlapping VPNs or central service VPN offered by SP</p>
</li>
<li>
<p>Allows for granular control of traffic</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">task: import or export route target communities for the specified VRF</div>
<div class="content">
<pre>(config)# route-target {import|export|both} &lt;ext-community&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_vrf_interface">26.4. VRF Interface</h3>
<div class="ulist">
<ul>
<li>
<p>can be physical (ethernet) or logical (SVI)</p>
</li>
<li>
<p>belongs to only one VRF</p>
</li>
<li>
<p>packets received are routed and forwarded using the associated VRF table</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Assign an interface to a VRF</div>
<div class="content">
<pre>(config-if)# ip vrf forwarding &lt;vrf-name&gt;</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
this command will erase all existing IP addresses configured on the
interface to avoid potential address duplication in the new routing table.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_vrf_static_route">26.5. VRF Static Route</h3>
<div class="listingblock">
<div class="title">Task: Create a VRF-bound static route</div>
<div class="content">
<pre>(config)# ip route vrf &lt;name&gt; &lt;prefix&gt; &lt;mask&gt; [&lt;interface] [next-hop]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
with multi-access interfaces, specify the next-hop
associated with the interface subnet because Cisco IOS will install a CEF entry
in the source VRF using the information provided and will not attempt to
resolve the next-hop recursively. Remember that this trick only works with the
non-recursive static routes that use directly connected interfaces.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_vrf_lite">26.6. VRF lite</h3>
<div class="ulist">
<ul>
<li>
<p>extend VRFs beyond a single router by properly mapping the VRFs to the
links connecting two routers.</p>
</li>
<li>
<p>simplest way of creating non-overlapping VPNs</p>
</li>
<li>
<p>poor scalability because each VPN needs a dedicated inter-router links</p>
<div class="ulist">
<ul>
<li>
<p>Example: for two routers and 100 VPNs, you must provision 100 connections between the two routers, one
for every VPN.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The connection could be either a separate interface or some Layer 2 virtualization technique, such as Frame-Relay PVC or Ethernet VLAN.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_multi_vrf">26.7. Multi-VRF</h3>
<div class="paragraph">
<p>TODO Maybe this belongs to the mpls l3vpns section</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mpls">27. MPLS</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Protocol number: 137 ???</p>
</li>
<li>
<p>packet-forwarding technology which uses labels in order to make data
forwarding decisions</p>
</li>
<li>
<p>LSP Label Switching Path</p>
</li>
<li>
<p>FEC forwarding equivalence class: a group of IP packets which are forwarded
in the same manner (e.g., over the same path, with the same forwarding
treatment)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_mpls_label_stack">27.1. MPLS Label Stack</h3>
<div class="imageblock">
<div class="content">
<img src="../images/mpls-label-stack.png" alt="mpls label stack" width="538" height="60">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/mpls-header-format.png" alt="MPLS Header Format" width="896" height="152">
</div>
<div class="title">Figure 46. MPLS Header Format</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Label
</td>
<td class="hdlist2">
<p>Locally significant to the router</p>
<div class="ulist">
<ul>
<li>
<p>0 : IPv4 Explicit NULL Label. indicates that the label stack must be
popped, and the packet forwarding must be based on the IPv4 header.</p>
</li>
<li>
<p>1 : Router Alert Label. When a received packet contains this label value
at the top of the label stack, it is delivered to a local software module for
processing. The actual packet forwarding is determined by the label beneath
it in the stack. However, if the packet is forwarded further, the Router
Alert Label should be pushed back onto the label stack before forwarding. The
use of this label is analogous to the use of the Router Alert Option in IP
packets (for example, ping with record route option)</p>
</li>
<li>
<p>2 : IPv6 Explicit NULL Label. indicates that the label stack must be
popped, and the packet forwarding must be based on the IPv6 header</p>
</li>
<li>
<p>3 : Implicit NULL Label. never actually appears in the
encapsulation.indicates that the LSR pops the top label from the stack and
forwards the rest of the packet (labeled or unlabeled) through the outgoing
interface (as per the entry in Lfib). Although this value might never appear
in the encapsulation, it needs to be specified in the Label Distribution
Protocol, so a value is reserved</p>
</li>
<li>
<p>4-15: Reseerved</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
EXP
</td>
<td class="hdlist2">
<p>Experimental, class of service</p>
</td>
</tr>
<tr>
<td class="hdlist1">
S
</td>
<td class="hdlist2">
<p>Bottom-of-Stack flag</p>
</td>
</tr>
<tr>
<td class="hdlist1">
TTL
</td>
<td class="hdlist2">
<p>Time to live</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_label_distribution">27.2. Label Distribution</h3>
<div class="ulist">
<ul>
<li>
<p>protocol : LDP (default RFC 3036) or TDP (cisco)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_mpls_ping_and_tracetroute">27.3. MPLS ping and tracetroute</h3>
<div class="paragraph">
<p>MPLS LSP ping uses MPLS echo request and reply packets to validate an LSP. You can use
MPLS LSP ping to validate IPv4 LDP, AToM, and IPv4 RSVP FECs by using appropriate
keywords and arguments with the ping mpls command. The MPLS echo request packet is sent
to a target router through the use of the appropriate label stack associated with the LSP to be
validated. Use of the label stack causes the packet to be forwarded over the LSP itself.
The destination IP address of the MPLS echo request packet is different from the address used
to select the label stack. The destination IP address is defined as a 127.x.y.z/8 address. The
127.x.y.z/8 address prevents the IP packet from being IP switched to its destination if the LSP is
broken.</p>
</div>
<div class="paragraph">
<p>An MPLS echo reply is sent in response to an MPLS echo request. The reply is sent as an IP
packet and it is forwarded using IP, MPLS, or a combination of both types of switching. The
source address of the MPLS echo reply packet is an address obtained from the router
generating the echo reply. The destination address is the source address of the router that
originated the MPLS echo request packet. The MPLS echo reply destination port is set to the
echo request source port.</p>
</div>
<div class="paragraph">
<p>MPLS LSP traceroute uses MPLS echo request and reply packets to validate an LSP. You can
use MPLS LSP traceroute to validate IPv4 LDP and IPv4 RSVP FECs by using appropriate
keywords and arguments with the trace mpls command.
The MPLS LSP Traceroute feature uses TTL settings to force expiration of the TTL along an
LSP. MPLS LSP Traceroute incrementally increases the TTL value in its MPLS echo requests
(TTL = 1, 2, 3, 4) to discover the downstream mapping of each successive hop. The success of
the LSP traceroute depends on the transit router processing the MPLS echo request when it
receives a labeled packet with a TTL = 1. On Cisco routers, when the TTL expires, the packet is
sent to the Route Processor (RP) for processing. The transit router returns an MPLS echo reply
containing information about the transit hop in response to the TTL-expired MPLS packet. The
MPLS echo reply destination port is set to the echo request source port.</p>
</div>
<div class="listingblock">
<div class="title">Task: Select an LDP IPv4 prefix FEC for validation</div>
<div class="content">
<pre># ping mpls ipv4 &lt;destination-address/destination-mask-length&gt; [repeat &lt;count&gt;] [exp &lt;bits&gt; ] [verbose]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Select an LDP IPv4 prefix FEC for validation</div>
<div class="content">
<pre># trace mpls ipv4 &lt;destination-address/destination-mask-length&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/V1Z2kN" class="bare">http://goo.gl/V1Z2kN</a>
<a href="https://partners.intelsecurity.com/uk/reseller/index.aspx">Good explanation on INE blog</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_l3vpns">27.4. L3VPNs</h3>
<div class="ulist">
<ul>
<li>
<p>mpls vpn</p>
<div class="ulist">
<ul>
<li>
<p>CE : no mpls-aware</p>
</li>
<li>
<p>PE : mpls and vpn aware</p>
</li>
<li>
<p>P : no vpn aware</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO Place this section at an appropriate place</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Establish an LSP between PEs: IGP + LDP , free BGP core</p>
</li>
<li>
<p>Exchange routes with customer: PE-CE IGP or BGP</p>
</li>
<li>
<p>Exchange customer routes between PEs: iBGP + MPLS VPN label</p>
</li>
<li>
<p>Label switch between PEs: Data follows the IGP + LDP transport label</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Read <a href="http://goo.gl/FXrVOO">Route leaking</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre>show mpls forwarding-table</pre>
</div>
</div>
<div class="paragraph">
<p>check <a href="http://www.cisco.com/en/US/docs/ios-xml/ios/mpls/command/mp-s2.html#wp4232274342" class="bare">http://www.cisco.com/en/US/docs/ios-xml/ios/mpls/command/mp-s2.html#wp4232274342</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_ipv6_over_mpls_6pe_and_6vpe">27.5. IPv6 over MPLS: 6PE and 6VPE</h3>
<div class="ulist">
<ul>
<li>
<p>enables the service providers running an MPLS/IPv4 infrastructure
to offer IPv6 services without any major changesin the infrastructure</p>
</li>
<li>
<p>benefits</p>
<div class="ulist">
<ul>
<li>
<p>Minimal operational cost and risk : No impact on existing IPv4 and MPLS services.</p>
</li>
<li>
<p>Only PE routers upgrade : A 6PE and 6VPE router can be an existing PE router or
a new one dedicated to IPv6 traffic.</p>
</li>
<li>
<p>No impact on IPv6 CE routers : The ISP can connect to any CE router running Static,
IGP or EGP.</p>
</li>
<li>
<p>Production services ready : An ISP can delegate IPv6 prefixes.</p>
</li>
<li>
<p>IPv6 introduction into an existing MPLS service : 6PE and 6VPE routers can be added at any time.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/6vpe-protocols.png" alt="Protocols leveragaged with  6VPE">
</div>
<div class="title">Figure 47. protocols leveraged with 6vpe</div>
</div>
<div class="paragraph">
<p>More at
<a href="https://gixtools.net/wp-content/uploads/2011/05/Cisco-IPv6-Provider-Edge-Router-over-MPLS-Cisco-6PE.pdf" class="bare">https://gixtools.net/wp-content/uploads/2011/05/Cisco-IPv6-Provider-Edge-Router-over-MPLS-Cisco-6PE.pdf</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ldp">28. LDP</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">MPLS</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/mp_ldp/configuration/15-mt/mp-ldp-15-mt-book.html">Label Distribution Protocol</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://tools.ietf.org/html/rfc5036">RFC 5036</a></p>
</li>
<li>
<p>enables peer label switch routers (LSRs) to exchange label binding information for supporting hop-by-hop forwarding in an MPLS network.</p>
</li>
<li>
<p>UDP 646 (TCP 711 for TDP)</p>
</li>
<li>
<p>Hellos multicast to 224.0.0.2</p>
</li>
<li>
<p>Updates unicast TCP to LDP ID</p>
</li>
<li>
<p>supercedes Cisco TDP</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_ldp_process">28.1. LDP process</h3>
<div class="listingblock">
<div class="title">Task: Enable LDP at Interface Level</div>
<div class="content">
<pre>(config-if)# mpls ip</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the label protocol</div>
<div class="content">
<pre>(config)# mpls label protocol {ldp|tdp}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable Ldp at IGP Process</div>
<div class="content">
<pre>(config-router)#mpls ldp autoconfig</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify Ldp Is Enabled</div>
<div class="content">
<pre># sh mpls interfaces</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_discovery_of_adjacent_ldp_peers">28.2. Discovery Of Adjacent LDP Peers</h3>
<div class="ulist">
<ul>
<li>
<p>neigbhbor discovery UDP port 646</p>
<div class="ulist">
<ul>
<li>
<p>basic neighbor discovery: multicast hellos to directly connected neighbors</p>
</li>
<li>
<p>extended neighbor discovery: unicast hellos to non-directly connected neighbors</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Verify that the interface is up and is sending Discovery Hello messages.</div>
<div class="content">
<pre># sh mpls ldp discovery [all| vrf &lt;vpn-name&gt;] [detail]

  Local LDP Identifier:
       172.16.12.1:0
       Discovery Sources:
       Interfaces:
           Ethernet3/0 (ldp): xmit</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>timers: hello interval (5 seconds) and holdtime (15 seconds)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# mpls ldp discovery hello interval &lt;sec&gt;
(config)# mpls ldp discovery hello holdtime &lt;sec&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>TODO: test this command</p>
</div>
<div class="listingblock">
<div class="title">Task: Establish LDP session between devices that are not directed connected</div>
<div class="content">
<pre>(config)# mpls ldp neighbor targeted</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This command can be used if you want to create LDP session that persists
even when the direct link goes down and there is alternative paths.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Respond to request for LDP targeted hellos</div>
<div class="content">
<pre>(config)# mpls ldp neighbor targeted accept</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldp_sessions">28.3. LDP Sessions</h3>
<div class="paragraph">
<p>in 2 steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transport connection: if the 2 peers have never established a tcp session,
create a new session
with a client (active device, highest ip address) using a random port
and the server (lowest ip addr) listening on the TCP 646 port.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>R1#show tcp brief (state)
TCB        Local_Address   Foreign_Address
498D80D8   192.1.1.1.646   192.1.5.5.21288   ESTAB</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Session establishment:</p>
<div class="ulist">
<ul>
<li>
<p>negotiates ldp protocol version, label exchange method, timers</p>
</li>
<li>
<p>if incompatibility, sends error negotiation messages and restart the negotiation
with initial backoff value (15 seconds) and maximum backoff value (120 seconds)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>R1#show mpls ldp parameters

  Protocol version: 1
  Session hold time: 180 sec; keep alive interval: 60 sec
  Discovery hello: holdtime: 15 sec; interval: 5 sec
  Discovery targeted hello: holdtime: 90 sec; interval: 10 sec
  Downstream on Demand max hop count: 255
  Downstream on Demand Path Vector Limit: 255
  LDP for targeted sessions
  LDP initial/maximum backoff: 15/120 sec
  LDP loop detection: off</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>the label exchange methods:</p>
<div class="ulist">
<ul>
<li>
<p>Unsolicited downstream distribution mode</p>
</li>
<li>
<p>solicited downstream distribution mode</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display the status of LDP session</div>
<div class="content">
<pre>R1#sh mpls ldp neighbor

  Peer LDP Ident: 192.1.5.5:0; Local LDP Ident 192.1.1.1:0
    TCP connection: 192.1.5.5.21288 - 192.1.1.1.646
    State: Oper; Msgs sent/rcvd: 10/11; Downstream
    Up time: 00:04:24
    LDP discovery sources:
      FastEthernet0/0, Src IP addr: 172.16.15.5
    Addresses bound to peer LDP Ident:
    172.16.15.5 192.1.5.5</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>with keepalives (60 seconds)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# mpls ldp holdtime &lt;sec&gt;
%Previously established sessions may not use the new holdtime.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Keepalive timer is reset every time LDP packets or keepalives are received</p>
</li>
<li>
<p>Keepalives are automatically adjusted to 1/3 of the configured holdtime</p>
</li>
<li>
<p>Reset the tcp session for new timers to take effect</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ldp_label_binding_label_spaces_and_identifiers">28.4. LDP label binding, label spaces and identifiers</h3>
<div class="ulist">
<ul>
<li>
<p>LDP label binding: association between a destination prefix and a label</p>
</li>
<li>
<p>LDP supports two types of label spaces:</p>
<div class="ulist">
<ul>
<li>
<p>Interface-specific: An interface-specific label space uses interface resources for labels.</p>
<div class="ulist">
<ul>
<li>
<p>For example, label-controlled ATM (LC-ATM) interfaces use virtual path identifiers/virtual circuit identifiers (VPIs/VCIs) for labels.</p>
</li>
<li>
<p>Depending on its configuration, an LDP platform may support zero, one, or more interface-specific label spaces.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Platform-wide: An LDP platform supports a single platform-wide label space for use by interfaces that can share the same labels.</p>
<div class="ulist">
<ul>
<li>
<p>For Cisco platforms, all interface types, except LC-ATM, use the platform-wide label space.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>LDP uses a 6-byte quantity called an LDP Identifier (or LDP ID) to name label spaces.
The LDP ID is made up of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first four bytes, called the LPD router ID, identify the LSR that owns the label space.</p>
</li>
<li>
<p>The last two bytes, called the local label space ID, identify the label space within the LSR.
For the platform-wide label space, the last two bytes of the LDP ID are always both 0.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The LDP ID takes the following form: &lt;LDP router ID&gt; : &lt;local label space ID&gt;
The following are examples of LPD IDs: 172.16.0.0:0 , 192.168.0.0:3</p>
</div>
<div class="paragraph">
<p>The router determines the LDP router ID as follows, if the <strong>mpls ldp router-id</strong> command is not executed,</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The router examines the IP addresses of all operational interfaces.</p>
</li>
<li>
<p>If these IP addresses include loopback interface addresses, the router selects the largest loopback address as the LDP router ID.</p>
</li>
<li>
<p>Otherwise, the router selects the largest IP address pertaining to an operational interface as the LDP router ID.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The normal (default) method for determining the LDP router ID may result in a router ID that is not usable in certain situations. For example, the router might select an IP address as the LDP router ID that the routing protocol cannot advertise to a neighboring router.
The <strong>mpls ldp router-id</strong> command allows you to specify the IP address of an interface as the LDP router ID. Make sure the specified interface is operational so that its IP address can be used as the LDP router ID.
When you issue the mpls ldp router-id command without the force keyword, the router select selects the IP address of the specified interface (provided that the interface is operational) the next time it is necessary to select an LDP router ID, which is typically the next time the interface is shut down or the address is configured.
When you issue the mpls ldp router-id command with the force keyword, the effect of the mpls ldp router-id command depends on the current state of the specified interface:</p>
</div>
<div class="listingblock">
<div class="title">Task:  Define Router-Id (Recommended)</div>
<div class="content">
<pre>(config)# mpls ldp router-id &lt;interface-type number&gt; [force]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>If the interface is up (operational) and if its IP address is not currently the LDP router ID,
the LDP router ID changes to the IP address of the interface.
This forced change in the LDP router ID tears down any existing LDP sessions,
releases label bindings learned via the LDP sessions,
and interrupts MPLS forwarding activity associated with the bindings.</p>
</li>
<li>
<p>If the interface is down (not operational) when the <strong>mpls ldp router-id</strong> force command is issued,
when the interface transitions to up,
the LDP router ID changes to the IP address of the interface.
This forced change in the LDP router ID tears down any existing LDP sessions,
releases label bindings learned via the LDP sessions,
and interrupts MPLS forwarding activity associated with the bindings.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Verify LDP Sessions</div>
<div class="content">
<pre># sh mpls ldp neighbor</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Troubleshoot LDP Adjacencies</div>
<div class="content">
<pre># debug mpls ldp transport events</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Establish a TCP connection using the physical interface IP address</div>
<div class="content">
<pre>(config-if)# mpls ldp discovery transport-address interface.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldp_session_protection">28.5. LDP Session protection</h3>
<div class="ulist">
<ul>
<li>
<p>provides faster LDP convergence when a link recovers following an outage.</p>
</li>
<li>
<p>protects an LDP session between directly connected neighbors or an LDP session established
for a traffic engineering (TE) tunnel.</p>
</li>
<li>
<p>uses LDP Targeted Hellos to protect LDP sessions</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enables MPLS LDP session protection</div>
<div class="content">
<pre>(config)# mpls ldp session protection [vrf &lt;vpn-name&gt;] [for &lt;acl&gt;] [duration {infinite | &lt;seconds&gt;}]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldp_authentication">28.6. LDP Authentication</h3>
<div class="ulist">
<ul>
<li>
<p>MD5 with same password</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify authentication between two LDP peers</div>
<div class="content">
<pre>(config)# mpls ldp neighbor [vrf &lt;vpn-name&gt;] ip-address [password [0-7] &lt;password-string&gt; ]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Make the use of passwords mandatory between LDP peers</div>
<div class="content">
<pre>(config)# mpls ldp password required</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldp_md5_global_configuration">28.7. LDP MD5 Global Configuration</h3>
<div class="ulist">
<ul>
<li>
<p>enables LDP MD5 globally instead of on a per-peer basis.</p>
</li>
<li>
<p>can set up password requirements for a set of LDP neighbors
to prevent unauthorized peers from establishing LDP sessions and to block spoofed TCP messages.</p>
</li>
<li>
<p>enhancements</p>
<div class="ulist">
<ul>
<li>
<p>You can specify peers for which MD5 protection is required.
This can prevent the establishment of LDP sessions with unexpected peers.</p>
</li>
<li>
<p>You can configure passwords for groups of peers. This increases the scalability
of LDP password configuration management.</p>
</li>
<li>
<p>The established LDP session with a peer is not automatically torn down when the
password for that peer is changed. The new password is used the next time an
LDP session is established with the peer.</p>
</li>
<li>
<p>You can control when the new password is used. You can configure the new
password on the peer before forcing the use of the new password.</p>
</li>
<li>
<p>If the neighboring nodes support graceful restart, then LDP sessions are
gracefully restarted. The LDP MD5 password configuration is checkpointed to the
standby Route Processors (RPs). The LDP MD5 password is used by the device when
the new active RP attempts to establish LDP sessions with neighbors after the
switchover.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO more</p>
</div>
</div>
<div class="sect2">
<h3 id="_ldp_auto_configuration">28.8. LDP Auto-configuration</h3>
<div class="ulist">
<ul>
<li>
<p>enables you to globally enable LDP on every interface associated with an IGP instance.</p>
</li>
<li>
<p>supported on OSPF and IS-IS</p>
</li>
<li>
<p>provides a means to block LDP from being enabled on interfaces</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable the MPLS LDP Autoconfiguration feature on OSPF interfaces</div>
<div class="content">
<pre>(config-router)# mpls ldp autoconfig [area &lt;area-id&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no area is specified, the command applies to all interfaces associated with
the OSPF process.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Enables the MPLS LDP Autoconfiguration feature on IS-IS interfaces</div>
<div class="content">
<pre>(config-router)# mpls ldp autoconfig [level 1 | level 2]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable LDP autoconfiguration on a specified interface</div>
<div class="content">
<pre>(config-if)# no mpls ldp igp  autoconfiguration</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldp_outbound_label_filtering">28.9. LDP outbound label filtering</h3>
<div class="ulist">
<ul>
<li>
<p>By default, LDP will generate and advertise labels for every prefix found in
the local routing table.</p>
</li>
<li>
<p>Use a standard access-list to select the prefixes eligible for label generation.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Stop the generation of labels for every prefix found in the local routing table</div>
<div class="content">
<pre>(config)# no mpls ldp advertise-labels</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Select prefixes for LDP label generation</div>
<div class="content">
<pre>(config)# mpls ldp advertise-labels for &lt;acl&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldp_inbound_label_binding_filtering">28.10. LDP Inbound Label Binding Filtering</h3>
<div class="listingblock">
<div class="title">Task: control the label bindings a label switch router accepts from its peer LSRs.</div>
<div class="content">
<pre>(config)# mpls ldp neighbor [vrf &lt;vpn-name&gt;] &lt;ip-address&gt; labels accept &lt;acl&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify that MPLS LDP Inbound Label Bindings are Filtered</div>
<div class="content">
<pre># show mpls ldp neighbor [vrf &lt;vpn-name&gt;] [ &lt;address&gt; | interface] [detail]
# show ip access-list [ &lt;acl&gt;]
# show mpls ldp bindings</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldp_graceful_restart">28.11. LDP Graceful restart</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gre">29. GRE</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Generic Routing Encapsulation</p>
</li>
<li>
<p>Tunnelling protocol developed by Cisco</p>
</li>
<li>
<p>IP protocol 47</p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc2784">RFC 2784</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc2345">RFC 2345</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc1234">RFC 1234</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_tunneling">29.1. Tunneling</h3>
<div class="ulist">
<ul>
<li>
<p>Tunneling uses encapsulates data packets with from one protocol inside a different protocol at the same OSI layer
and transports the data packets unchanged across a foreign network (which  may not support the passenger protocol).</p>
</li>
<li>
<p>Unlike encapsulation, tunneling allows a lower-layer protocol, or same-layer protocol,
to be carried through the tunnel.</p>
</li>
<li>
<p><strong>Passenger protocol</strong> : The protocol that you are encapsulating. Examples: AppleTalk, IP, IPX.</p>
</li>
<li>
<p><strong>Carrier protocol</strong> : The protocol that does the encapsulating. Examples: GRE, IP-in-IP, L2TP,MPLS, STUN,DLSw+.</p>
</li>
<li>
<p><strong>Transport protocol</strong> : The protocol used to carry the encapsulated protocol. The main transport protocol is IP.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ip-tunneling-concepts.png" alt="ip tunneling concepts">
</div>
<div class="title">Figure 48. IP Tunneling Terminology and Concepts</div>
</div>
</div>
<div class="sect2">
<h3 id="_gre_header">29.2. GRE Header</h3>
<div class="imageblock">
<div class="content">
<img src="../images/gre-header-format.png.png" alt="gre header format.png" width="896" height="248">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Checksum present</p>
</li>
<li>
<p>Set to 1 if the checksum and the Reserved1 field are present</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">K</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Key bit</p>
</li>
<li>
<p>Set to 1 if</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Reserved0</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>if any of bits 1-5 are non-zero, a receiver must discard the packet
unless receiver implements RFC1701</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Protocol Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Ether protocol type (e.g. IPv4 &#8594; 0x800)</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
GRE adds at least 24 bytes to the original IP ( 20 bytes for new IP header + 4 bytes for GRE header )
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_gre_keepalive">29.3. GRE Keepalive</h3>
<div class="paragraph">
<p>The GRE tunnel keepalive mechanism gives the ability for one side to originate
and receive keepalive packets to and from a remote router even if the remote
router does not support GRE keepalives. For GRE keepalives, the sender
pre-builds the keepalive response packet inside the original keepalive request
packet so that the remote end only needs to do standard GRE decapsulation of
the outer GRE IP header and then forward the inner IP GRE packet. GRE tunnel
keepalives timers on each side are independent and do not have to match. The
problem with the configuration of keepalives only on one side of the tunnel is
that only the router that has keepalives configured marks its tunnel interface
as down if the keepalive timer expires. The GRE tunnel interface on the other
side, where keepalives are not configured, remains up even if the other side of
the tunnel is down. The tunnel can become a black-hole for packets directed
into the tunnel from the side that did not have keepalives configured.</p>
</div>
<div class="paragraph">
<p>Specifies the number of times that the device will continue to send keepalive
packets without response before bringing the tunnel interface protocol down.</p>
</div>
<div class="paragraph">
<p>GRE keepalive packets may be configured either on only one side of the tunnel or on both.
If GRE keepalive is configured on both sides of the tunnel, the period and retries arguments can be different at each side of the link.</p>
</div>
<div class="paragraph">
<p>This command is supported only on GRE point-to-point tunnels.</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure GRE Keepalives</div>
<div class="content">
<pre>(config-if)# keepalive [ period [retries]]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gre_tunnel">29.4. GRE Tunnel</h3>
<div class="paragraph">
<p>To build a tunnel, a tunnel interface must be defined on each of two routers
and the tunnel interfaces must reference each other.
At each router, the tunnel interface must be configured with a L3 address.
The tunnel endpoints, tunnel source, and tunnel destination must be defined,
and the type of tunnel must be selected.</p>
</div>
<div class="paragraph">
<p>Optional steps can be performed to customize the tunnel.</p>
</div>
<div class="paragraph">
<p>Remember to configure the router at each end of the tunnel.
If only one side of a tunnel is configured,
the tunnel interface may still come up and stay up (unless
keepalive is configured), but packets going into the tunnel will be dropped.</p>
</div>
<div class="listingblock">
<div class="title">Task: Summary Steps</div>
<div class="content">
<pre>interface tunnel &lt;number&gt;
  bandwidth &lt;kbps&gt;
  keepalive [&lt;period&gt; [&lt;retries&gt;]]
  tunnel source {&lt;ip-address&gt; | &lt;interface-type interface-number&gt;}
  tunnel destination { &lt;hostname&gt; | &lt;ip-address&gt;}
  tunnel key &lt;key-number&gt;
  tunnel mode [gre {ip | multipoint} | dvmrp | ipip | mpls | nos]
  ip mtu &lt;bytes&gt;
  ip tcp mss &lt;mss-value&gt;
  tunnel path-mtu-discovery [age-timer {&lt;aging-mins&gt;| infinite}]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The router should have a route to the destination address,
but not through the tunnel interface.</p>
</li>
<li>
<p>Tunnel Key ID must match on both side of the tunnel.
It is used as a weak form of authentication</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configuration_example">29.4.1. Configuration Example</h4>
<div class="paragraph">
<p>Note that Ethernet interface 0/1 is the tunnel source for Router A and the tunnel destination for Router B.
Fast Ethernet interface 0/1 is the tunnel source for Router B and the tunnel destination for Router A.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Router A</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre>interface Tunnel0
 ip address 10.1.1.2 255.255.255.0
 tunnel source Ethernet0/1
 tunnel destination 192.168.3.2
 tunnel mode gre ip
!
interface Ethernet0/1
 ip address 192.168.4.2 255.255.255.0</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Router B</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre>interface Tunnel0
 ip address 10.1.1.1 255.255.255.0
 tunnel source FastEthernet0/1
 tunnel destination 192.168.4.2
 tunnel mode gre ip
!
interface FastEthernet0/1
 ip address 192.168.3.2 255.255.255.0</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gre_backup_interface">29.5. GRE backup interface</h3>
<div class="literalblock">
<div class="content">
<pre>In this example, R4 and R5 use the backup interface feature along with duplicate routing information to perform both traffic engineering and redundancy. With the backup interface configured on R4’s and R5's point-to-point GRE Tunnel100 interface, R4 and R5 wait for the line protocol of Tunnel100 interface to go DOWN before GRE interface Tunnel45 is activated. The following rules and restrictions apply when implementing the backup interface functionality:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>The primary/active interface being backed up must be a point-to-point interface type, because its state can be better determined.
The secondary/standby interface acting as backup can be any interface except sub-interface, because the state of the main interface determines the state of sub-interfaces in general</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# backup interface &lt;intf-id&gt;
(config-if)# backup delay &lt;after-down&gt; &lt;before-up&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre># sh backup</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_4">29.6. Troubleshooting</h3>
<div class="paragraph">
<p>Three reasons for a GRE tunnel to shut down:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is no route to the tunnel destination address.</p>
</li>
<li>
<p>The interface that anchors the tunnel source is down.</p>
</li>
<li>
<p>The route to the tunnel destination address is through the tunnel itself. “%TUN-5-RECURDOWN:Tunnel0“</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the above three reasons for tunnel shut down are problems local to the
router at the tunnel endpoints and do not cover problems in the intervening
network.</p>
</div>
<div class="paragraph">
<p>Also if the two routers tunnel modes do not match, the tunnel interface can
still stay in an up/ip state but the routers cannot forward packets because of
the mismatch encapsulation.</p>
</div>
<div class="sect3">
<h4 id="__tun_5_recurdown_error_message_and_flapping_eigrp_ospf_bgp_neighbors_over_a_gre_tunnel">29.6.1. "%TUN-5-RECURDOWN" Error Message and Flapping EIGRP/OSPF/BGP Neighbors Over a GRE Tunnel</h4>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/support/docs/ip/enhanced-interior-gateway-routing-protocol-eigrp/22327-gre-flap.html" class="bare">http://www.cisco.com/c/en/us/support/docs/ip/enhanced-interior-gateway-routing-protocol-eigrp/22327-gre-flap.html</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_questions">29.7. Questions</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>What is the minimum amount of additional header that GRE adds to a packet?</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>16 bytes</p>
</li>
<li>
<p>20 bytes</p>
</li>
<li>
<p>24 bytes</p>
</li>
<li>
<p>36 bytes</p>
</li>
<li>
<p>48 bytes</p>
</li>
</ol>
</div>
</li>
<li>
<p>Which of the following are valid options in a GRE header (select all that apply)?</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>GRE Header Length</p>
</li>
<li>
<p>Checksum Present</p>
</li>
<li>
<p>Key Present</p>
</li>
<li>
<p>External Encryption</p>
</li>
<li>
<p>Protocol</p>
</li>
</ol>
</div>
</li>
<li>
<p>What is the purpose of a GRE tunnel interface?</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>It is always the tunnel source interface.</p>
</li>
<li>
<p>It is always the tunnel destination interface.</p>
</li>
<li>
<p>It is where the protocol that travels through the tunnel is configured.</p>
</li>
<li>
<p>It is the interface that maps to the physical tunnel port.</p>
</li>
<li>
<p>It is not used today</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="http://ptgmedia.pearsoncmg.com/9781587201509/samplechapter/158720150X_CH14.pdf" class="bare">http://ptgmedia.pearsoncmg.com/9781587201509/samplechapter/158720150X_CH14.pdf</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dmvpn">30. DMVPN</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>dynamic creation of spoke-to-spoke</p>
</li>
<li>
<p>DMVPN = mGRE + NHRP + IPSec</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Start with mGRE configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre>interface tunnel 0
  ip address 141.11.10.1 255.255.255.0
  tunnel source e0
  tunnel mode gre multipoint</pre>
</div>
</div>
<div class="sect2">
<h3 id="_phases">30.1. Phases</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Phase 1</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Hub and spoke functionality</p>
</li>
<li>
<p>for simplified and smaller configuration</p>
</li>
<li>
<p>zero touch provisioning for adding spokes to the VPN</p>
</li>
<li>
<p>supports dynamically addressed CPEs</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Phase 2</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Spoke-to-spoke functionality (by changing the routing protocol behavior self-hop ?)</p>
</li>
<li>
<p>on demand spoke-to-spoke tunnels avoids dual encrypts/decrypts</p>
</li>
<li>
<p>Smaller spoke CPE can participate in the virtual mesh</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Phase 3</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Architecture and scaling</p>
</li>
<li>
<p>uses ip nhrp redirect on the hub</p>
</li>
<li>
<p>uses ip nhrp shortcut on the spokes to accept and install the shortcut route</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Verify NHRP Configuration</div>
<div class="content">
<pre># sh ip nhrp

141.11.10.2/32 via 141.11.10.2
   Tunnel1234 created 00:02:21, expire 00:57:38
   Type: dynamic, Flags: unique registered
   NBMA address: 10.11.10.2
141.11.10.3/32 via 141.11.10.3
   Tunnel1234 created 00:02:09, expire 00:57:50
   Type: dynamic, Flags: unique registered
   NBMA address: 10.11.10.3</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dmvpn_with_ipsec_using_pre_shared_key">30.2. DMVPN with IPsec using pre-shared key</h3>
<div class="paragraph">
<p>The feature works according to the following rules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each spoke has a permanent IPSec tunnel to the hub, not to the other spokes
within the network. Each spoke registers as clients of the NHRP server.</p>
</li>
<li>
<p>When a spoke needs to send a packet to a destination (private) subnet on
another spoke, it queries the NHRP server for the real (outside) address of
the destination (target) spoke.</p>
</li>
<li>
<p>After the originating spoke learns the peer address of the target spoke, it
can initiate a dynamic IPSec tunnel to the target spoke.</p>
</li>
<li>
<p>The spoke-to-spoke tunnel is built over the multipoint GRE (mGRE) interface.</p>
</li>
<li>
<p>The spoke-to-spoke links are established on demand whenever there is traffic
between the spokes. Thereafter, packets are able to bypass the hub and use
the spoke-to-spoke tunnel.</p>
</li>
<li>
<p>If an IP multicast stream originates from a spoke location, a rendezvous
point (RP) must be deployed at the hub site in order for other spoke site
clients to receive the stream</p>
</li>
<li>
<p>mGRE Tunnel Interface allows a single GRE interface to support multiple IPSec
tunnels and simplifies the size and complexity of the configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO: Work this long configuration sample.
TODO: Understand the purpose of the individual commands</p>
</div>
<div class="listingblock">
<div class="title">Hub Router</div>
<div class="content">
<pre>crypto isakmp policy 100
hash md5
authentication pre-share

!--- Add dynamic pre-shared keys for all the remote VPN
!--- routers.
crypto isakmp key cciein8weeks address 0.0.0.0 0.0.0.0
!--- Create the Phase 2 policy for actual data encryption.
crypto ipsec transform-set strong esp-3des esp-md5-hmac
!
!--- Create an IPSec profile to be applied dynamically to the
!--- GRE over IPSec tunnels.

crypto ipsec profile cciein8weeks
set security-association lifetime seconds 120
set transform-set strong

!--- Create a GRE tunnel template which will be applied to
!--- all the dynamically created GRE tunnels.

interface Tunnel0
ip address 192.168.1.1 255.255.255.0
no ip redirects
ip mtu 1440
ip nhrp authentication cciein8weeks
ip nhrp map multicast dynamic
ip nhrp network-id 1
no ip split-horizon eigrp 90
no ip next-hop-self eigrp 90
tunnel source FastEthernet0/0
tunnel mode gre multipoint






tunnel key 0
tunnel protection ipsec profile cciein8weeks

!--- This is the outbound interface.

interface FastEthernet0/0
ip address 209.168.202.225 255.255.255.0
duplex auto
speed auto

!--- This is the inbound interface.

interface FastEthernet0/1
ip address 1.1.1.1 255.255.255.0
duplex auto
speed auto
!
!--- Enable a routing protocol to send and receive
!--- dynamic updates about the private networks.

router eigrp 10
network 1.1.1.0 0.0.0.255
network 192.168.1.0
no auto-summary</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Spoke 1 (DMVPN Phase II)</div>
<div class="content">
<pre>crypto isakmp policy 10
hash md5
authentication pre-share

!--- Add dynamic pre-shared keys for all the remote VPN
!--- routers and the hub router.

crypto isakmp key cciein8weeks address 0.0.0.0 0.0.0.0
!
!--- Create the Phase 2 policy for actual data encryption.
crypto ipsec transform-set strong esp-3des esp-md5-hmac

!--- Create an IPSec profile to be applied dynamically to
!--- the GRE over IPSec tunnels.

crypto ipsec profile cciein8weeks
set security-association lifetime seconds 120
set transform-set strong

!--- Create a GRE tunnel template to be applied to
!--- all the dynamically created GRE tunnels.

interface Tunnel0
ip address 192.168.1.2 255.255.255.0
no ip redirects
ip mtu 1440
ip nhrp authentication cciein8weeks
ip nhrp map multicast dynamic
ip nhrp map 192.168.1.1 209.168.202.225
ip nhrp map multicast 209.168.202.225
ip nhrp network-id 1
ip nhrp nhs 192.168.1.1
tunnel source FastEthernet0/0
tunnel mode gre multipoint &lt;- facilitates spoke to spoke communication
tunnel key 0
tunnel protection ipsec profile cciein8weeks
!
!--- This is the outbound interface.
interface FastEthernet0/0
ip address 209.168.202.131 255.255.255.0
duplex auto
speed auto
!
!--- This is the inbound interface.
interface FastEthernet0/1
ip address 2.2.2.2 255.255.255.0
duplex auto
speed auto

!--- Enable a routing protocol to send and receive
!--- dynamic updates about the private networks.

router eigrp 10
network 2.2.2.0 0.0.0.255
network 192.168.1.0
no auto-summary</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Spoke 2</div>
<div class="content">
<pre>crypto isakmp policy 10
hash md5
authentication pre-share

!--- Add dynamic pre-shared keys for all the remote VPN
!--- routers and the hub router.

crypto isakmp key cciein8weeks address 0.0.0.0 0.0.0.0
!--- Create the Phase 2 policy for actual data encryption.
crypto ipsec transform-set strong esp-3des esp-md5-hmac

!--- Create an IPSec profile to be applied dynamically to
!--- the GRE over IPSec tunnels.

crypto ipsec profile cciein8weeks
set security-association lifetime seconds 120
set transform-set strong
!--- Create a GRE tunnel template to be applied to
!--- all the dynamically created GRE tunnels.

interface Tunnel0
ip address 192.168.1.3 255.255.255.0
no ip redirects
ip mtu 1440
ip nhrp authentication cciein8weeks
ip nhrp map multicast dynamic
ip nhrp map 192.168.1.1 209.168.202.225
ip nhrp map multicast 209.168.202.225
ip nhrp network-id 1
ip nhrp nhs 192.168.1.1
tunnel source FastEthernet0/0
tunnel mode gre multipoint
tunnel key 0
tunnel protection ipsec profile cciein8weeks
!

!--- This is the outbound interface.
interface FastEthernet0/0
ip address 209.168.202.130 255.255.255.0
duplex auto
speed auto
!
!--- This is the inbound interface.
interface FastEthernet0/1
ip address 3.3.3.3 255.255.255.0
duplex auto
speed auto
!
!--- Enable a routing protocol to send and receive
!--- dynamic updates about the private networks.

router eigrp 10
network 3.3.3.0 0.0.0.255
network 192.168.1.0
no auto-summary</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_qos_profile">30.3. QoS profile</h3>
<div class="paragraph">
<p>The Per-Tunnel QoS for DMVPN feature introduces per-tunnel quality of service (QoS) support
for Dynamic Multipoint VPN (DMVPN) and increases per-tunnel QoS performance for Internet
Protocol Security (IPsec) tunnel interfaces. This feature allows you to apply a QoS policy on a
DMVPN hub on a tunnel instance (per-endpoint or per-spoke basis) in the egress direction for
DMVPN hub-to-spoke tunnels. The QoS policy on a DMVPN hub on a tunnel instance allows
you to shape the tunnel traffic to individual spokes (parent policy) and to differentiate individual
data flows going through the tunnel for policing (child policy).</p>
</div>
<div class="paragraph">
<p>The QoS policy that is used by the hub for a particular endpoint or spoke is selected by the Next
Hop Resolution Protocol (NHRP) group in which the spoke is configured. Even though many
spokes may be configured in the same NHRP group, the tunnel traffic of each spoke is
measured individually for shaping and policing.</p>
</div>
<div class="paragraph">
<p>The following example shows how to map NHRP groups to a QoS policy on the hub.
The example shows a hierarchical QoS policy (parent: group1_parent/group2_parent; child:
group1/group2) that will be used for configuring per-tunnel QoS for DMVPN feature.
The example also shows how to map the NHRP group spoke_group1 to the QoS policy
group1_parent and map the NHRP group spoke_group2 to the QoS policy group2_parent on
the hub:</p>
</div>
<div class="listingblock">
<div class="title">DMVPN Hub and QoS Configuration</div>
<div class="content">
<pre>class-map match-all group1_Routing
match ip precedence 6
class-map match-all group2_Routing
match ip precedence 6
class-map match-all group2_voice
match access-group 100
class-map match-all group1_voice
match access-group 100

policy-map group1
class group1_voice
        priority 1000
class group1_Routing
        bandwidth percent 20
policy-map group1_parent
class class-default
        shape average 3000000
 service-policy group1
policy-map group2
class group2_voice
        priority percent 20
class group2_Routing
        bandwidth percent 10
policy-map group2_parent
class class-default
        shape average 2000000
 service-policy group2

interface tunnel 1
ip address 209.165.200.225 255.255.255.224
no ip redirects
ip mtu 1400
ip nhrp authentication testing
ip nhrp map multicast dynamic
ip nhrp map group spoke_group1 service-policy output group1_parent
ip nhrp map group spoke_group2 service-policy output group2_parent
ip nhrp network-id 172176366
ip nhrp holdtime 300
ip nhrp registration no-unique
tunnel source fastethernet 2/1/1
tunnel mode gre multipoint
tunnel protection ipsec profile DMVPN

interface fastethernet 2/1/1
ip address 209.165.200.226 255.255.255.224</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_qos_pre_classify">30.4. QoS Pre-classify</h3>
<div class="paragraph">
<p>Configure qos pre-classify in VPN designs where both QoS and IPsec occur on the
same system and QoS needs to match on parameters in the cleartext packet other
than the DSCP/ToS byte.</p>
</div>
<div class="paragraph">
<p><a href="http://goo.gl/cb0HLi">Further Reading</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ipsec">31. IPSEC</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ipsec_with_pre_shared_key">31.1. IPSec with pre-shared key</h3>
<div class="sect3">
<h4 id="_ipv4_site_to_ipv4_site">31.1.1. IPv4 site to IPv4 site</h4>
<div class="ulist">
<ul>
<li>
<p>IPSec between two sites such as branch and a headquarter is known as site to site or LAN to
LAN tunnel.</p>
</li>
<li>
<p>can be configured with or without GRE.</p>
</li>
<li>
<p>IKE has two modes of operation, aggressive or main mode.
Main mode hides IKE/IPSec peer identities.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Router B</div>
<div class="content">
<pre>crypto isakmp policy 2
authentication pre-share

crypto isakmp key cciein8weeks address 172.16.1.1
!
!
!--- Configuration for IPsec policies.
!--- Enables the crypto transform configuration mode,
!--- where you can specify the transform sets that are used
!--- during an IPsec negotiation.

crypto ipsec transform-set Router-IPSEC esp-des esp-sha-hmac
!
!--- Indicates that IKE is used to establish
!--- the IPsec Security Association for protecting the
!--- traffic specified by this crypto map entry.

crypto map cciein8weeks 1 ipsec-isakmp
description Tunnel to172.16.1.1

!--- Sets the IP address of the remote end.

set peer 172.16.1.1

!--- Configures IPsec to use the transform-set
!--- "Router-IPSEC" defined earlier in this configuration.
set transform-set Router-IPSEC

!--- Specifies the interesting traffic to be encrypted.

match address 100
!
!--- Configures the interface to use the
!--- crypto map " cciein8weeks" for IPsec.


interface FastEthernet0
ip address 172.17.1.1 255.255.255.0
duplex auto
speed auto
crypto map cciein8weeks</pre>
</div>
</div>
<div class="paragraph">
<p>IPSec(validate_transform_proposal): proxy identities not supported
ISAKMP: IPSec policy invalidated proposal
ISAKMP (0:2): SA not acceptable!</p>
</div>
<div class="paragraph">
<p>Above messages are indicative of the fact that access lists (as referenced in match address
command inside a crypto map) for IPsec interesting traffic do not match between peers.</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/PmO6l4" class="bare">http://goo.gl/PmO6l4</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_ipv6_in_ipv4_tunnels">31.1.2. IPv6 in IPv4 tunnels</h4>
<div class="paragraph">
<p>Generic routing encapsulation (GRE) tunnels sometimes are combined with IPSec, because
IPSec does not support IPv6 multicast packets. This function prevents dynamic routing
protocols from running successfully over an IPSec VPN network. Because GRE tunnels do
support IPv6 multicast , a dynamic routing protocol can be run over a GRE tunnel. Once a
dynamic routing protocol is configured over a GRE tunnel, you can encrypt the GRE IPv6
multicast packets using IPSec.</p>
</div>
<div class="paragraph">
<p>IPSec can encrypt GRE packets using a crypto map or tunnel protection. Both methods specify
that IPSec encryption is performed after GRE encapsulation is configured. When a crypto map
is used, encryption is applied to the outbound physical interfaces for the GRE tunnel packets.
When tunnel protection is used, encryption is configured on the GRE tunnel interface.</p>
</div>
<div class="paragraph">
<p>“%CRPTO-4-IKMP_BAD_MESSAGE: IKE” message from 150.150.150.1 failed its sanity check
or is malformed appears if the pre-shared keys on the peers do not match. In order to fix this
issue, check the pre-shared keys on both sides.</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/pqy0E8" class="bare">http://goo.gl/pqy0E8</a>
<a href="http://goo.gl/RhXJDZ" class="bare">http://goo.gl/RhXJDZ</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_vti">31.1.3. VTI</h4>
<div class="paragraph">
<p>Virtual Tunneling Interface</p>
</div>
<div class="paragraph">
<p>The use of IPsec VTIs both greatly simplifies the configuration process when you need to
provide protection for remote access and provides a simpler alternative to using generic routing
encapsulation (GRE) or Layer 2 Tunneling Protocol (L2TP) tunnels for encapsulation and crypto
maps with IPsec. A major benefit associated with IPsec VTIs is that the configuration does not
require a static mapping of IPsec sessions to a physical interface. The IPsec tunnel endpoint is
associated with an actual (virtual) interface. Because there is a routable interface at the tunnel
endpoint, many common interface capabilities can be applied to the IPsec tunnel.
The IPsec VTI allows for the flexibility of sending and receiving both IP unicast and multicast
encrypted traffic on any physical interface, such as in the case of multiple paths. Traffic is
encrypted or decrypted when it is forwarded from or to the tunnel interface and is managed by
the IP routing table. Using IP routing to forward the traffic to the tunnel interface simplifies the
IPsec VPN configuration compared to the more complex process of using access control lists
(ACLs) with the crypto map in native IPsec configurations. DVTIs function like any other real
interface so that you can apply quality of service (QoS), firewall, and other security services as
soon as the tunnel is active.</p>
</div>
<div class="paragraph">
<p>IPsec VTIs allow you to configure a virtual interface to which you can apply features. Features
for clear-text packets are configured on the VTI. Features for encrypted packets are applied on
the physical outside interface. When IPsec VTIs are used, you can separate the application of
features such as NAT, ACLs, and QoS and apply them to clear-text or encrypted text, or both.
When crypto maps are used, there is no simple way to apply encryption features to the IPsec
tunnel.</p>
</div>
<div class="paragraph">
<p>There are two types of VTI interfaces:
- Static VTIs (SVTIs)
- Dynamic VTIs (DVTIs)</p>
</div>
<div class="paragraph">
<p>SVTI configurations can be used for site-to-site connectivity in which a tunnel provides always-
on access between two sites. The advantage of using SVTIs as opposed to crypto map
configurations is that users can enable dynamic routing protocols on the tunnel interface without
the extra 4 bytes required for GRE headers, thus reducing the bandwidth for sending encrypted
data. Additionally, multiple Cisco IOS software features can be configured directly on the tunnel
interface and on the physical egress interface of the tunnel interface. This direct configuration
allows users to have solid control on the application of the features in the pre- or post-encryption
path.</p>
</div>
<div class="paragraph">
<p>DVTIs can provide highly secure and scalable connectivity for remote-access VPNs. The DVTI
technology replaces dynamic crypto maps and the dynamic hub-and-spoke method for
establishing tunnels. Dynamic VTIs can be used for both the server and remote configuration.
The tunnels provide an on-demand separate virtual access interface for each VPN session. The
configuration of the virtual access interfaces is cloned from a virtual template configuration,
which includes the IPsec configuration and any Cisco IOS software feature configured on the
virtual template interface, such as QoS, NetFlow, or ACLs.
Dynamic VTIs function like any other real interface so that you can apply QoS, firewall, other
security services as soon as the tunnel is active. QoS features can be used to improve the
performance of various applications across the network. Any combination of QoS features
offered in Cisco IOS software can be used to support voice, video, or data applications.</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/0yHAkK" class="bare">http://goo.gl/0yHAkK</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_vpn">31.2. GET VPN</h3>
<div class="paragraph">
<p>Group Encrypted Transport</p>
</div>
<div class="paragraph">
<p>The IOS GETVPN is a tunnel-less (i.e. no overlay) VPN technology that provides end-to-end
security for network traffic in a native mode and maintaining the fully meshed topology. It uses
the core network&#8217;s ability to route and replicate the packets between various sites within the
enterprise. Cisco IOS GETVPN preserves the original source and destination IP addresses
information in the header of the encrypted packet for optimal routing. Hence, it is largely suited
for an enterprise running over a private Multiprotocol Label Switching (MPLS)/IP-based core
network. It is also better suited to encrypt multicast traffic. Cisco IOS GET VPN uses Group
Domain of Interpretation (GDOI) as the keying protocol and IPSec for encryption.
A GETVPN deployment has primarily three components, Key Server (KS), Group Member
(GM), and Group Domain of Interpretation (GDOI) protocol. GMs do encrypt/decrypt the traffic
and KS distribute the encryption key to all the group members. The KS decides on one single
data encryption key for a given lifetime. Since all GMs use the same key, any GM can decrypt
the traffic encrypted by any other GM. GDOI protocol is used between the GM and KS for group
key and group SA management. Minimum one KS is required for a GETVPN deployment.
Unlike traditional IPSec encryption solutions, GET VPN uses the concept of group SA. All
members in the GETVPN group can communicate with each other using a common encryption
policy and a shared SA and therefore no need to negotiate IPSec between GMs on a peer to
peer basis; thereby reducing the resource load on the GM routers.</p>
</div>
<div class="sect3">
<h4 id="_group_member">31.2.1. Group Member</h4>
<div class="paragraph">
<p>The group member registers with the key server to get the IPSec SA that is necessary to
encrypt data traffic within the group. The group member provides the group ID to the key server
to get the respective policy and keys for this group. These keys are refreshed periodically by
KS, and before the current IPSec SAs expire, so that there is no loss of traffic.</p>
</div>
</div>
<div class="sect3">
<h4 id="_key_server">31.2.2. Key Server</h4>
<div class="paragraph">
<p>Key server is responsible for maintaining security policies, authenticating the GMs and providing
the session key for encrypting traffic. KS authenticates the individual GMs at the time of
registration. Only after successful registration the GMs can participate in group SA.
A group member can register at any time and receive the most current policy and keys. When a
GM registers with the key server, the key server verifies the group id number of the GM. If this id
number is a valid and the GM has provided valid Internet Key Exchange (IKE) credentials, the
key server sends the SA policy and the Keys to the group member.</p>
</div>
<div class="paragraph">
<p>There are two types of keys that the GM will receive from the KS:
- Key Encryption Key (KEK), for securing control plane
- Traffic Encryption Key (TEK), for securing data plane
The TEK becomes part of the IPSec SA with which the group members within the same group
encrypt the data. KEK is used to secure rekey messages (i.e. control plane) between the key
server and the group members.</p>
</div>
<div class="paragraph">
<p>The Key Server sends out rekey messages either because of an impending IPSec SA expiration
or because the security policy has changed on the key server. Keys can be distributed during
rekey using either multicast or unicast transport. Multicast method is more scalable as keys
need not be transmitted to each group member individually. Unlike in unicast, KS will not
receive acknowledgement from GM about the success of the rekey reception in multicast rekey
method. In unicast rekey method, KS will delete a GM from its database if three consecutive
rekeys are not acknowledged by that particular GM.</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/mxG401" class="bare">http://goo.gl/mxG401</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_l2_vpn">32. L2 VPN</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>simplest solution where a client wants to manage his own routing
protocols, IP management, and QoS mechanisms; this means that the service
provider only focuses on providing high-throughput Layer 2 connections.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_pseudo_wire">32.1. Pseudo-Wire</h3>
<div class="ulist">
<ul>
<li>
<p>Ethernet Pseudo-Wire</p>
</li>
<li>
<p>allows Ethernet frames to traverse an operational MPLS cloud.</p>
<div class="ulist">
<ul>
<li>
<p>This implies that spanning tree will run on the links, and devices connected through these connections will use the same subnet.</p>
</li>
<li>
<p>This service has its own field name, Emulated Service, and operates over pseudowire.</p>
</li>
<li>
<p>In addition to this, it is necessary to have an operational packet label switched network (MPLS network).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Two modes: raw mode and tagged mode.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">tagged mode</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>uses the same 802.1Q tag at each end of the link.</p>
</li>
<li>
<p>uses pseudowire type 0x0004.</p>
</li>
<li>
<p>uses service-delimiting VLAN tag</p>
<div class="ulist">
<ul>
<li>
<p>Every frame sent on the PW must have a different VLAN for each customer.</p>
</li>
<li>
<p>If a frame as received by a PE from the attachment circuit is missing a service-delimiting VLAN tag,
the PE must prepend the frame with a dummy VLAN tag before sending the frame on the PW.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Raw Mode</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>the service-delimiting tag might or might not be added in the frame and has no significance to the end points.</p>
</li>
<li>
<p>pseudowire type 0x0005.</p>
</li>
<li>
<p>service-delimiting tags are never through the attachment circuit by the PE;
it is mandatory that they are stripped from the frame before the frame is transmitted.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_l2tpv3">32.2. L2TPv3</h3>
<div class="ulist">
<ul>
<li>
<p>provides several enhancements to L2TP to tunnel any Layer 2 payload over L2TP,
by defining how the L2TP protocol tunnels Layer 2 payloads over an IP core
network by using Layer 2 VPNs.</p>
</li>
<li>
<p>RFC 3931, 4719</p>
</li>
<li>
<p>uses protocol ID 115</p>
</li>
<li>
<p>A L2TPv3 tunnel is a control connection between two PE routers.</p>
</li>
<li>
<p>One L2TPv3 tunnel can have multiple data connections,
and each data connection is termed as an L2TPv3 session.</p>
</li>
<li>
<p>The control connection is used to establish, maintain, and release sessions.</p>
</li>
<li>
<p>Each session is identified by a session ID which is unique across the entire router.</p>
</li>
<li>
<p>L2TPv3 carries frames inside IP packets.</p>
</li>
<li>
<p>Pre-requisites on Cisco routers</p>
<div class="ulist">
<ul>
<li>
<p>cef or dcef</p>
</li>
<li>
<p>loopback address reachable from the remote PE device at the other end of the L2TPv3 control channel</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/V9egil" class="bare">http://goo.gl/V9egil</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_atom">32.3. ATOM</h3>
<div class="ulist">
<ul>
<li>
<p>Any Transport over MPLS (AToM) transports Layer 2 packets over a MPLS backbone.</p>
</li>
<li>
<p>AToM uses a directed LDP session between edge routers for setting up and maintaining connections. Forwarding occurs through
the use of two levels of labels, switching between the edge routers.</p>
</li>
<li>
<p>The external label (tunnel label) routes the packet over the MPLS backbone to the egress Provider Edge (PE) at the
ingress PE. The VC label is a de-multiplexing label that determines the connection at the tunnel
endpoint (the particular egress interface on the egress PE as well as the virtual path identifier
[VPI]/virtual channel identifier [VCI] value for an ATM Adaptation Layer 5 [AAL5] protocol data
unit [PDU], the data-link connection identifier [DLCI] value for a Frame Relay PDU, or the virtual
LAN [VLAN] identifier for an Ethernet frame). EoMPLS carries frames inside MPLS packets.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because the control word is included by default, so it may be necessary to explicitly disable this
command in static pseudowire configurations. You can use <strong>mpls control-word</strong> command is used
in static pseudowire configurations, the command must be configured the same way on both
ends of the connection to work correctly. Otherwise, the provider edge routers cannot exchange
control messages to negotiate inclusion or exclusion of the control word.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>!First we will create the xconnect configuration on routers.
R2(config)# int f0/0
R2(config-if)# xconnect 4.4.4.4 204 encapsulation mpls
R2(config-if-xconn)# end

!Now we do the matching configuration on the other device.
R4(config)# int f0/0
R4(config-if)# xconnect 2.2.2.2 204 encapsulation mpls
R4(config-if-xconn)# end</pre>
</div>
</div>
<div class="paragraph">
<p>The xconnect command used on the F0/0 interface on both routers is used to
create a bridged connection with the destination specified. The command is
broken down with an xconnect keyword followed by the peering router address and
the unique virtual circuit ID (VCID). The VCID must match on both ends of the
connection. The encapsulation can be L2TPv2, L2TPv3, or MPLS. Never lose sight
of the fact that there must be a unique address per router for each xconnect.</p>
</div>
<div class="listingblock">
<div class="title">Task: Verify the status of a pseudo-wire</div>
<div class="content">
<pre>R2# show xconnect all

   Legend: XC ST=Xconnect State, S1=Segment1 State, S2=Segment2 State
   UP=Up, DN=Down, AD=Admin Down, IA=Inactive, NH=No Hardware
   XC ST Segment 1 S1 Segment 2 S2
   ------+---------------------------------+--+---------------------------------+--
   DN ac Fa0/0(Ethernet) AD mpls 4.4.4.4:204 DN</pre>
</div>
</div>
<div class="paragraph">
<p>An MPLS Layer 2 pseudowire has two segments. Segment 1 (S1) is for the customer-facing port. Segment 2 (S2) relates to the core configuration.</p>
</div>
<div class="paragraph">
<p>To specify the path that traffic uses a MPLS Traffic engineering (TE) tunnel or destination IP address and Domain Name Server (DNS) name),
use the preferred-path command in pseudowire configuration mode.</p>
</div>
<div class="paragraph">
<p>To disable tunnel selection, use the no form of this command.</p>
</div>
<div class="paragraph">
<p>preferred-path {interface tunnel tunnel-number | peer {ip-address | host-name}} [disable-fallback]
no preferred-path {interface tunnel tunnel-number | peer {ip-address | host-name}} [disable-
fallback]</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/6RsX89" class="bare">http://goo.gl/6RsX89</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_vpls_2">32.4. VPLS</h3>
<div class="paragraph">
<p>TODO clean the notes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Virtual Private LAN Service</p>
</li>
<li>
<p>offers Layer 2 Ethernet services.</p>
</li>
<li>
<p>enables geographically separate LAN segments to be interconnected as a single bridged domain over an MPLS network.</p>
<div class="ulist">
<ul>
<li>
<p>VPLS over GRE enables VPLS across an IP network.</p>
</li>
<li>
<p>The provider edge (PE) routers for VPLS over GRE must support VPLS and additional GRE encapsulation and decapsulation.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>An instance of VPLS must be configured on each PE router.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provides multipoint Ethernet service as compared to Ethernet over MPLS (EoMPLS) that is point to point.</p>
</li>
<li>
<p>emulates a virtual IEEE Ethernet bridge network.</p>
</li>
<li>
<p>uses flooding to communicate MAC address reachability information.</p>
</li>
<li>
<p>VPLS can carry single VLAN within each instance.</p>
</li>
<li>
<p>supports MAC address aging and replicates broadcast and multicast traffic.</p>
</li>
<li>
<p>A point to point Ethernet Virtual Circuit (EVC) connecting a pair of physical UNIs is also
known as Ethernet Wire Service (EWS) or Ethernet Private Line (EPL).</p>
<div class="ulist">
<ul>
<li>
<p>EPL provides VLAN transparency and control protocol tunneling are supplied by the implementation of 802.1Q-in-Q
tag-stacking technology.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ethernet Virtual Private Line (EVPL) and EPL are also considered E-Line services.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike Layer 3 VPN, there is no routing interaction between customer and service provider
networks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multipoint-to-multipoint configuration</p>
</li>
<li>
<p>Forwarding of frames based on learned MAC addresses</p>
</li>
<li>
<p>Uses virtual forwarding instance (VFI, like VLAN) for customer separation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>VPLS Components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User-facing PE (U-PE): The U-PE is the device to which the functions needed
to take forwarding or switching decisions at the ingress of the provider
network.</p>
</li>
<li>
<p>Network PE (N-PE): The N-PE is the device to which the signaling and control
functions are allocated when a VPLS-PE is distributed across more than one
box.</p>
</li>
<li>
<p>Virtual switching instance (VSI): Virtual switching instance that serves one
single VPLS A VSI performs standard LAN (that is, Ethernet) bridging
functions, including forwarding done by a VSI based on MAC addresses and VLAN
tags.</p>
</li>
<li>
<p>Pseudowire (PW): PWE3 is a mechanism that emulates the essential attributes
of a telecommunications service (such as a T1 leased line or Frame Relay)
over a PSN.</p>
</li>
<li>
<p>Attachment circuit (AC): The physical or virtual circuit attaching (AC) a CE
to a PE. An attachment circuit may be, for example, a Frame Relay DLCI, an
ATM VPI/VCI, an Ethernet port, a VLAN, or an MPLS LSP. One or multiple ACs
can belong to same VFI.</p>
</li>
<li>
<p>VC (virtual circuit): Martini-based data encapsulation, tunnel label is used
to reach remote PE, VC label is used to identify VFI. One or multiple VCs can
belong to same VFI Virtual Forwarding Instance (VFI):</p>
</li>
<li>
<p>VFI creates L2 multipoint bridging among all ACs and VCs. It’s an L2
broadcast domain such as VLAN.</p>
</li>
<li>
<p>Multiple VFIs can exist on the same PE box to separate user traffic such as
VLANs.</p>
</li>
<li>
<p>Signaling</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Signaling uses LDP to establish and tear down PWs. Using LDP as the signaling VPLS control
plane does not have inherent support of auto-discovery. Therefore, LDP-VPLS relies on manual
configuration to identify all PE routers. MPLS in the core, normal LDP sessions per hop to
exchange tunnel label or IGP label. Targeted or directed LDP session between PEs to
exchange VC label. Tunnel label is used to forward packet from PE to PE VC label and is used
to identify L2VPN circuit.</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/KwPVFS" class="bare">http://goo.gl/KwPVFS</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_otv">32.5. OTV</h3>
<div class="ulist">
<ul>
<li>
<p>Overlay Transport Virtualization</p>
</li>
<li>
<p>OTV is a “MAC address in or over IP” technique for supporting Layer 2 VPNs to extend LANs over any transport.
The transport can be Layer 2 based, Layer 3 based, IP switched, label switched,
or anything else as long as it can carry IP packets.  By using the principles
of MAC routing, OTV provides an overlay that enables Layer 2 connectivity
between separate Layer 2 domains while keeping these domains independent and
preserving the fault-isolation, resiliency, and load-balancing benefits of an
IP-based interconnection.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The core principles on which OTV operates are the use of a control protocol to advertise MAC
address reachability information (instead of using data plane learning) and packet switching of
IP encapsulated Layer 2 traffic (instead of using circuit switching) for data forwarding. These
features are a significant departure from the core mechanics of traditional Layer 2 VPNs. In
traditional Layer 2 VPNs, a static mesh of circuits is maintained among all devices in the VPN to
enable flooding of traffic and source-based learning of MAC addresses. This full mesh of circuits
is an unrestricted flood domain on which all traffic is forwarded. Maintaining this full mesh of
circuits severely limits the scalability of existing Layer 2 VPN approaches. At the same time, the
lack of a control plane limits the extensibility of current Layer 2 VPN solutions to properly
address the requirements for extending LANs across data centers.</p>
</div>
<div class="paragraph">
<p>OTV uses a control protocol to map MAC address destinations to IP next hops that are
reachable through the network core. OTV can be thought of as MAC routing in which the
destination is a MAC address, the next hop is an IP address, and traffic is encapsulated in IP so
it can simply be carried to its MAC routing next hop over the core IP network. Thus a flow
between source and destination host MAC addresses is translated in the overlay into an IP flow
between the source and destination IP addresses of the relevant edge devices. This process is
called encapsulation rather than tunneling as the encapsulation is imposed dynamically and
tunnels are not maintained. Since traffic is IP forwarded, OTV is as efficient as the core IP
network and will deliver optimal traffic load balancing, multicast traffic replication, and fast
failover just like the core would. OTV also supports detection of multi-homing.</p>
</div>
<div class="paragraph">
<p>A technology typically deployed at the customer edge (CE), unlike VPLS, OTV is
configured on each CE router or switch. OTV provides Layer 2 LAN extension over
Layer 3-, Layer 2-, or MPLS-based networks.
One of the significant benefits or advantages of OTV is the
fault-domain isolation feature; thus spanning-tree root does not change. With
each CE having its own root, there is no intervention or planning required by
the provider. OTV supports automatic detection of multihoming and ARP
optimization.</p>
</div>
<div class="paragraph">
<p>OTV entities/roles and their description</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">edge device</dt>
<dd>
<p>This is a device which performs all OTV functions.
The OTV Edge device is connected to Layer 2 segments and IP transport network.</p>
</dd>
<dt class="hdlist1">join interfaces</dt>
<dd>
<p>These are Layer 3 interfaces on the OTV Edge device which connects to the IP
transport network</p>
</dd>
<dt class="hdlist1">internal  interface</dt>
<dd>
<p>These are Layer 2 interfaces on the OTV Edge device.
These can be "trunk" or "access" ports.</p>
</dd>
<dt class="hdlist1">overlay   interface</dt>
<dd>
<p>This is a multicast-enabled multi-access network over which all OTV
encapsulated Layer 2 frames are carried.</p>
</dd>
<dt class="hdlist1">site VLAN</dt>
<dd>
<p>OTV Edge devices need to elect an Authoritative Edge Device (AED) per
VLAN so that only one device forwards traffic for that VLAN. For this election,
the OTV Edge devices use Site VLAN for communication on the local site.</p>
</dd>
<dt class="hdlist1">authoritative edge device</dt>
<dd>
<p>The authoritative edge device is responsible for all MAC address reachability
updates for a VLAN.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/XioB96" class="bare">http://goo.gl/XioB96</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<h1 id="_part_iv_infrastructure_security" class="sect0">Part IV : Infrastructure Security</h1>
<div class="sect1">
<h2 id="_aaa">33. AAA</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_local_aaa_server">33.1. Local AAA Server</h3>
<div class="paragraph">
<p>The Local AAA Server feature allows you to configure your router so that user authentication
and authorization attributes currently available on AAA servers are available locally on the
router. The attributes can be added to existing framework, such as the local user database or
subscriber profile. The local AAA server provides access to the complete dictionary of Cisco
IOS supported attributes.</p>
</div>
<div class="paragraph">
<p>You can configure your router so that AAA authentication and authorization attributes currently
available on AAA servers are made available on existing Cisco IOS devices. The attributes can
be added to existing framework, such as the local user database or subscriber profile. For
example, an attribute list can now be added to an existing username, providing the ability for the
local user database to act as a local AAA server. For situations in which the local username list
is relatively small, this flexibility allows you to provide complete user authentication or
authorization locally within the Cisco IOS software without having a AAA server. This ability can
allow you to maintain your user database locally or provide a failover local mechanism without
having to sacrifice policy options when defining local users.
A subscriber profile allows domain-based clients to have policy applied at the end-user service
level. This flexibility allows common policy to be set for all users under a domain in one place
and applied there whether or not user authorization is done locally.</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/aaTqf5" class="bare">http://goo.gl/aaTqf5</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_ppp_security">33.2. PPP Security</h3>
<div class="paragraph">
<p>TODO</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implement device access control</p>
<div class="ulist">
<ul>
<li>
<p>lines</p>
</li>
<li>
<p>password encryption</p>
</li>
<li>
<p>management plane protection</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_copp">34. CoPP</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_cpp">35. CPP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Control Plane Protection
- security feature that extends the policing functionality provided by the
  software-based Control Plane Policing (CoPP) feature. The CoPP feature
  controls the rate in which control plane traffic is sent to he Route
  Processor in Cisco IOS software-based devices. Control Plane Protection
  extends this policing functionality by dividing the Control Plane into three
  control plane sub-interfaces and allowing the enforcement of separate
  rate-limiting policies. In addition, CPP incorporates port-filtering and
  queue-thresholding. Port-filtering is a mechanism for the early dropping of
  packets that are directed to closed or non-listened IOS TCP/UDP ports.
  Queue-thresholding is a mechanism that limits the number of packets per
  protocol hold in the control-plane input queue, preventing the input queue
  from being overwhelmed by any single protocol traffic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The three control plane sub-interfaces implemented by Control Plane Protection are:</p>
<div class="ulist">
<ul>
<li>
<p>Control-plane host subinterface—This interface handles all control-plane IP packets that are destined to any of the IP addresses configured on the router interfaces. Examples of traffic falling in this category include tunnel termination traffic, management traffic or routing protocols such as SSH, SNMP, BGP, OSPF, and EIGRP. All host traffic terminates on and is processed by the router.</p>
</li>
<li>
<p>Control-plane transit subinterface—This subinterface receives all IP packets that are software switched by the route processor. This means packets that are not directly destined to the router itself but rather traffic traversing through the router and that require process switching.</p>
</li>
<li>
<p>Control-plane CEF-exception subinterface—This control-plane subinterface receives all IP packets that are either redirected as a result of a configured input feature in the CEF packet forwarding path for process switching or directly enqueued in the control plane input queue by the interface driver (i.e. ARP, L2 Keepalives and all non-IP host traffic).</p>
</li>
</ul>
</div>
</li>
<li>
<p>In addition, CPP enhances the protection of the control-plane host subinterface by implementing Port-filtering and Queue-thresholding. Port-filtering is a feature that can only be applied to the control-plane host subinterface and that automatically drops packets directed toward closed or non-listened UDP/TCP ports on the router. Queue-thresholding is another feature that can only be applied to the control-plane host subinterface and that limits the number of unprocessed packets per protocol, preventing the input queue from being overwhelmed by any single protocol traffic.</p>
</li>
<li>
<p>At a very high level the sequence of events with Control Plane Protection is as follows:</p>
</li>
<li>
<p>step 1 A packet enters the router configured with CoPP on an ingress interface.</p>
</li>
<li>
<p>step 2 The interface performs the basic input port and QoS services.</p>
</li>
<li>
<p>step 3 The packet gets forwarded to the router processor.</p>
</li>
<li>
<p>step 4 The router processor makes a routing decision, determining whether or not the packet is destined to the control plane.</p>
</li>
<li>
<p>step 5 Packets destined for the control plane are processed by Aggregate CoPP, and are dropped or forward to the Control Plane Path according to the polices for each traffic class. Packets that have other destinations are forwarded normally.</p>
</li>
<li>
<p>step 6 Packets sent to the Control Plane Path are intercepted by the Control Plane Protection traffic classifier, which classifies the packets into the corresponding control-plane subinterfaces.</p>
</li>
<li>
<p>step 7 Packets received by each control-plane subinterface are dropped or forward to the Control Plane global input queue according to the configured policies.</p>
</li>
<li>
<p>step 8 In addition, packets sent to the control-plane host subinterface can be dropped or forwarded according to the Port-filter and Queue-thresholding policies before they are sent to the global input queue.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similar to CoPP, CPP helps protect the RP of Cisco IOS software-based routers by filtering unwanted traffic and by rate-limiting the traffic expected by the control plane. This shields the control plane from traffic that might be part of DoS or other attacks, helping maintain network stability even during attack conditions.</p>
</div>
<div class="paragraph">
<p>CPP ability to divide the control plane traffic and rate-limit each traffic type individually, gives you greater traffic control for attack mitigation. Port-filtering and Queue-thresholding also provide for a more advanced attack protection. On one hand, Port-filtering shields the RP from packets directed to closed or non-listened TCP/UDP ports, mitigating attacks attempting to spoof legitimate traffic permitted by CoPP. On the other hand, Queue-thresholding limits protocol queue usage mitigating attacks designed to overwhelm the input queue with the flooding of a single protocol.</p>
</div>
<div class="paragraph">
<p>CPP is recommended on all software-based IOS platforms,
where hardware-based CoPP is not available. CPP is particularly useful on routers facing the Internet or other external networks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_management_plane_protection">36. Management Plane Protection</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>restrict the interfaces on which network management packets are allowed to enter a device.</p>
</li>
<li>
<p>disabled by default</p>
</li>
<li>
<p>After MPP is enabled, no interfaces except designated management interfaces
will accept network management traffic destined to the device.</p>
</li>
<li>
<p>Restricting management packets to designated interfaces provides greater
control over management of a device, providing more security for that device.
Other benefits include improved performance for data packets on nonmanagement
interfaces, support for network scalability, need for fewer access control
lists (ACLs) to restrict access to a device, and management packet floods on
switching and routing interfaces are prevented from reaching the CPU.</p>
</li>
<li>
<p>management protocols: beep, (t)ftp, http(s), ssh v1 and v2, telnet, snmp v1,v2 and v3</p>
</li>
<li>
<p>pre-requisites: cef</p>
</li>
<li>
<p>interfaces not supported:</p>
<div class="ulist">
<ul>
<li>
<p>Out-of-band management interfaces (also called dedicated management interfaces)</p>
</li>
<li>
<p>Loopback and virtual interfaces not associated to physical interfaces</p>
</li>
<li>
<p>Fallback and standby management interfaces</p>
</li>
<li>
<p>Hardware-switched and distributed platforms</p>
</li>
</ul>
</div>
</li>
<li>
<p>restrictions</p>
<div class="ulist">
<ul>
<li>
<p>Secure Copy (SCP) is supported under the Secure Shell (SSH) Protocol and not directly configurable in the command-line interface (CLI).</p>
</li>
<li>
<p>Uninformed management stations lose access to the router through nondesignated management interfaces when the Management Plane Protection feature is enabled.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task:</div>
<div class="content">
<pre>conf t
control-plane
 management-interface &lt;type slot/port&gt; allows &lt;protocols&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Displays information about the management interface such as type of interface, protocols enabled on the interface, and number of packets dropped and processed.</div>
<div class="content">
<pre># show management-interface [&lt;interface&gt; | protocol &lt;protocol-name&gt;]</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_access_control_list">37. Access Control List</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_references">37.1. References</h3>
<div class="paragraph">
<p>sec-data-acl</p>
</div>
</div>
<div class="sect2">
<h3 id="_reflexive_acl">37.2. Reflexive ACL</h3>
<div class="ulist">
<ul>
<li>
<p>source control</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ip_source_guard">38. IP Source Guard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO Improve</p>
</div>
<div class="paragraph">
<p>IP Source Guard will inspect traffic from hosts to be certain they&#8217;re not
spoofing their IP address or, optionally, MAC address.  As mentioned, it knows
the MAC and IP information from the DHCP snooping database.  Enabling the
feature is simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SW1(config-if)#ip verify source ! check IP addresses
SW1(config-if)#ip verify source port-security ! check IPs &amp; MACs</pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to rely strictly on the DHCP snooping database, you can make
manual entries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SW1(config)#ip source binding mac-address vlan vlan ip-address interface interface</pre>
</div>
</div>
<div class="paragraph">
<p>Of important note, source guard can be used in a non-DHCP environment using the
above command to populate the reference table, however, you must still enable
dhcp snooping globally and on the specific VLAN in order for source guard to
function!</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
GNS3 doesn&#8217;t support this feature
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dynamic_arp_inspection">39. Dynamic ARP Inspection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dynamic ARP inspection blocks "a variety of ARP-based attacks", according to the documentation.
Drop ARPs that shouldn&#8217;t be coming based on the information seen in the DHCP snooping table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SW1(config-if)#ip arp inspection trust  ! need to trust other switches
SW1(config)#ip arp inspection vlan 100  ! turn the feature on globally for the VLAN</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>port-security</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_router_security">39.1. Router Security</h3>
<div class="ulist">
<ul>
<li>
<p>ipv4 access list</p>
</li>
<li>
<p>ipv6 traffic filter</p>
</li>
<li>
<p>unicast reverse path forwarding</p>
</li>
<li>
<p>ipv6 first hop security</p>
<div class="ulist">
<ul>
<li>
<p>ra guard</p>
</li>
<li>
<p>dhcp guard</p>
</li>
<li>
<p>binding table</p>
</li>
<li>
<p>device tracking</p>
</li>
<li>
<p>ND inspection/snooping</p>
</li>
<li>
<p>source guard</p>
</li>
<li>
<p>PACL</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ieee_802_1x">40. IEEE 802.1X</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_definition">40.1. Definition</h3>
<div class="ulist">
<ul>
<li>
<p>Port-based authentication</p>
</li>
<li>
<p>until the client is authenticated,
allows only EAPoL (Extensible Authentication Protocol over LAN), CDP and STP traffic</p>
</li>
<li>
<p>supplicant: client workstation running 802.1x compliant software</p>
</li>
<li>
<p>authenticator: edge switch or wireless access point</p>
</li>
<li>
<p>authentication server: performs the actual authentication (Radius with EAP)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_port_security_2">40.2. Port Security</h3>
<div class="paragraph">
<p>TODO Redo this part</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DOT1X-SP-5-SECURITY_VIOLATION: Security violation on interface GigabitEthernet4/8,
New MAC address 0080.ad00.c2e4 is seen on the interface in Single host mode
%PM-SP-4-ERR_DISABLE: security-violation error detected on Gi4/8, putting Gi4/8 in
err-disable state</pre>
</div>
</div>
<div class="paragraph">
<p>This message indicates that the port on the specified interface is configured in single-host mode.
Any new host that is detected on the interface is treated as a security violation.
The port has been error disabled.
Ensure that only one host is connected to the port.
If you need to connect to an IP phone and a host behind it, configure Multidomain Authentication Mode on that switchport.</p>
</div>
<div class="paragraph">
<p>The Multidomain authentication (MDA) mode allows an IP phone and a single host behind the IP phone to authenticate independently,
with 802.1X, MAC authentication bypass (MAB), or (for the host only) web-based authentication.
In this application, Multidomain refers to two domains — data and voice — and only two MAC addresses are allowed per port.
The switch can place the host in the data VLAN and the IP phone in the voice VLAN, though they appear to be on the same switch port.
The data VLAN assignment can be obtained from the vendor-specific attributes (VSAs) received from the AAA server within authentication.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<h1 id="_part_v_infrastructure_services" class="sect0">Part V : Infrastructure Services</h1>
<div class="sect1">
<h2 id="_system_management">41. System Management</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_telnet">41.1. Telnet</h3>
<div class="ulist">
<ul>
<li>
<p>allows a user at one site to establish a TCP connection to a login
server at another site, then passes the keystrokes from one system to the
other.</p>
</li>
<li>
<p>offers 3 main services:</p>
<div class="ulist">
<ul>
<li>
<p>Network virtual terminal connection</p>
</li>
<li>
<p>Option negotiation</p>
</li>
<li>
<p>Symmetric connection</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cisco implementation of Telnet supports the following Telnet options:</p>
<div class="ulist">
<ul>
<li>
<p>Remote echo</p>
</li>
<li>
<p>Binary transmission</p>
</li>
<li>
<p>Suppress go ahead</p>
</li>
<li>
<p>Timing mark</p>
</li>
<li>
<p>Terminal type</p>
</li>
<li>
<p>Send location</p>
</li>
<li>
<p>Terminal speed</p>
</li>
<li>
<p>Remote flow control</p>
</li>
<li>
<p>X display location</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify the IP Address Of an Interface As the Source Address for Telnet Connections</div>
<div class="content">
<pre>(config)# ip telnet source-interface &lt;interface&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>If the specified interface is not up, IOS selects
the address of the interface closest to the destination as the source address.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Set the TCP Window to Zero When the Telnet Connection Is Idle</div>
<div class="content">
<pre>(config)# service telnet-zeroidle</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Normally, data sent to noncurrent Telnet connections is accepted and discarded.
When <strong>service telnet-zero-idle</strong> is enabled, if a session is
suspended (that is, some other connection is made active or the EXEC is
sitting in command mode), the TCP window is set to zero. This action prevents
the remote host from sending any more data until the connection is resumed.</p>
</li>
<li>
<p>Use this command when it is important that all messages sent by the host be
seen by the users and the users are likely to use multiple sessions.</p>
</li>
<li>
<p>Do not use this command if your host will eventually time out and log out a
TCP user whose window is zero.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Hide Host Address While Attempting to Establish a Telnet Session</div>
<div class="content">
<pre>(config)# ip telnet hidden addresses</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Mark Outgoing Traffic with IP Precedence</div>
<div class="content">
<pre>(config)# ip telnet tos &lt;0-7&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task:</div>
<div class="content">
<pre>(config)# ip telnet quiet</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Error Message When Telnet Connection Fails to a Specific Host</div>
<div class="content">
<pre>(config)# busy-message &lt;hostname&gt; d message d</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Sets Line to Send a RETURN (CR) As a CR Followed by a NULL Instead Of a CR Followed by a LINE FEED (LF).</div>
<div class="content">
<pre>(config)# ip telnet transparent</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ssh">41.2. SSH</h3>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>!--- Step 1: Configure a hostname and domain name
(config)# hostname router
(config)# ip domain-name nyc.cisco.com

!--- Step 2: Generate an RSA key pair, automatically enabling SSH.
(config)# cry key generate rsa

!--- Step 3: Configure time-out and number of authentication retries.
(config)# ip ssh time-out 60
(config)# ip ssh authentication-retries 2

!--- Step 4: Configure VTYs to only accept SSH.
(config)# line vty 0 4
(config-line)# transport input ssh

!--- Step 5: Allow SSH connections only originated from the management network.
(config)# access-list 111 remark ACL for SSH
(config)# access-list 111 permit tcp 172.26.0.0 0.0.255.255 any eq 22
(config)# access-list 111 deny ip any any log-input
(config)# line vty 0 4
(config-line)# access-class 111 in</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scp">41.3. SCP</h3>

</div>
<div class="sect2">
<h3 id="__t_ftp">41.4. [T]FTP</h3>
<div class="ulist">
<ul>
<li>
<p>UDP 69</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ftp_client">41.4.1. FTP Client</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="_ftp_server">41.4.2. FTP Server</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_snmp">41.5. SNMP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration guides</span>&#160;&#9656; <span class="submenu">Network Management</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/snmp/configuration/15-mt/snmp-15-mt-book/nm-snmp-cfg-snmp-support.html">configuring SNMP support</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application-layer protocol between SNMP managers and agents</p>
<div class="ulist">
<ul>
<li>
<p>SNMP manager running NMS software: UDP port 162 open for traps/informs messages</p>
</li>
<li>
<p>SNMP managed devices running SNMP agent: UDP 161 open for GET/SET messages</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_version_3">41.5.1. Version</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
v1
</td>
<td class="hdlist2">
<p>original specs, weak authentication with community string, Uses SMIv1, uses MIB-I originally.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
v2
</td>
<td class="hdlist2">
<p>Uses SMIv2, removed requirement for communities, added GetBulk and Inform messages, began with MIB-II originally.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
v2c
</td>
<td class="hdlist2">
<p>64-bit counters, getBulkRequest, informsRequest,Pseudo-release (RFC 1905) that allowed SNMPv1-style communities with SNMPv2;</p>
</td>
</tr>
<tr>
<td class="hdlist1">
v3
</td>
<td class="hdlist2">
<p>authentication, encryption, Mostly identical to SNMPv2, but adds significantly better security, although it supports communities for backward compatibility. Uses MIB-II.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_mib">41.5.2. MIB</h4>
<div class="paragraph">
<p>MIB: dictionaries of OID</p>
</div>
<div class="paragraph">
<p>OID: hierarchical identifiers in numerical format that represent MIB variables.
( e.g. 1.3.6.1.2.1 "Interfaces"
1.3.6.1.4.1.9 "Enterprises - Cisco"
)</p>
</div>
</div>
<div class="sect3">
<h4 id="_packet_format_2">41.5.3. Packet Format</h4>
<div class="imageblock">
<div class="content">
<img src="../images/snmp-header.png" alt="SNMP Header Format" width="896" height="376">
</div>
<div class="title">Figure 49. SNMP Header Format</div>
</div>
<div class="sect4">
<h5 id="_snmp_pdu_types">SNMP PDU Types</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>SetRequest</p>
</li>
<li>
<p>GetRequest</p>
</li>
<li>
<p>GetNextRequest</p>
</li>
<li>
<p>GetBulkRequest</p>
</li>
<li>
<p>Trap</p>
</li>
<li>
<p>InformsRequest</p>
</li>
<li>
<p>Response</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_basic_system_information">41.5.4. Basic System Information</h4>
<div class="listingblock">
<div class="title">Task: Configure the Location Information</div>
<div class="content">
<pre>(config)# snmp-server location &lt;homesweethome&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Contact Information</div>
<div class="content">
<pre>(config)# snmp-server contact &lt;no-where-to-be-found&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the System Serial Number</div>
<div class="content">
<pre>(config)# snmp-server chassis-id &lt;system-serial-number&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_views">41.5.5. Views</h4>
<div class="listingblock">
<div class="title">Task: Create a View</div>
<div class="content">
<pre>(config)# snmp-server view &lt;name&gt; &lt;oid-tree&gt; {included | excluded}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_communities">41.5.6. Communities</h4>
<div class="listingblock">
<div class="title">Task: Configure a Community String</div>
<div class="content">
<pre>(config)# snmp-server community &lt;string&gt; [view &lt;name&gt;] [ro|rw] [&lt;acl]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Community String</div>
<div class="content">
<pre># sh snmp community</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_traps">41.5.7. Traps</h4>
<div class="listingblock">
<div class="title">Task: Send Traps to NMS</div>
<div class="content">
<pre>(config)# snmp-server host &lt;ip-address&gt;
                      [traps | informs]
                      [version {1| 2c | 3 [auth | noauth | priv]}]
                      community-string [udp-port port-number] [notification-type]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_snmp_v3">41.5.8. SNMP V3</h4>
<div class="listingblock">
<div class="title">Task: Configure SNMP V3 Group</div>
<div class="content">
<pre>(config)# snmp-server group [&lt;groupname&gt; {v1 | v2c | v3 [auth | noauth | priv]}]
            [read &lt;readview&gt;]
            [write &lt;writeview&gt;]
            [notify &lt;notifyview&gt;]
            [access &lt;acl]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display SNMP V3 Group Settings</div>
<div class="content">
<pre># sh snmp group</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure  SNMP V3 User</div>
<div class="content">
<pre>(config)# snmp-server engineID {local &lt;engine-id&gt; | remote &lt;ip-address&gt; [udp-port &lt;number&gt; ] [vrf &lt;vrf-name&gt; ] &lt;engine-id-string&gt; }
(config)# snmp-server user &lt;username&gt; &lt;groupname&gt; [remote &lt;ip-address&gt; [udp-port &lt;number&gt; ]] {v1 | v2c | v3 [encrypted] [auth {md5 | sha} &lt;auth-password&gt; ]} [access &lt;acl&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display SNMP User Information</div>
<div class="content">
<pre># sh snmp user &lt;user&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display SNMP EngineID</div>
<div class="content">
<pre># sh snmp engineID</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_snmp_manager">41.5.9. SNMP Manager</h4>
<div class="ulist">
<ul>
<li>
<p>control and monitor the activities of network hosts using SNMP.</p>
</li>
<li>
<p>Network Management System (NMS)</p>
<div class="ulist">
<ul>
<li>
<p>can be dedicated device used for network management, or the applications used on such a device.</p>
</li>
<li>
<p>can be CLI or GUI (CiscoWorks2000)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the SNMP Manager Process</div>
<div class="content">
<pre>(config)# snmp-server manager</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the SNMP Manager Session Time-Out</div>
<div class="content">
<pre>(config)# snmp-server manager session-timeout &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the Status Of the SNMP Sessions</div>
<div class="content">
<pre># sh snmp sessions brief</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the Current Set Of Pending SNMP Requests</div>
<div class="content">
<pre># sh snmp pending</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_snmp_shutdown_mechanism">41.5.10. SNMP Shutdown Mechanism</h4>
<div class="listingblock">
<div class="title">Task: Enable the SNMP Shutdown Mechanism</div>
<div class="content">
<pre>(config)# snmp-server system-shutdown</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Define the Maximum SNMP Agent Packet Size</div>
<div class="content">
<pre>(config)# snmp-server packetsize &lt;bytes&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the TFTP Servers Used for Saving and Loading Configuration Files</div>
<div class="content">
<pre>(config)# snmp-server tftp-server-list &lt;acl&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable SNMP Agent</div>
<div class="content">
<pre>(config)# no snmp-server</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rmon">41.6. RMON</h3>
<div class="paragraph">
<p>TODO clean this section</p>
</div>
<div class="paragraph">
<p>Remote Monitoring, or RMON, is an event-notification extension of the SNMP
capabil- ity on a Cisco router or switch. RMON enables you to configure
thresholds for alerting based on SNMP objects, so that you can monitor device
performance and take appropri- ate action to any deviations from the normal
range of performance indications.  RMON is divided into two classes: alarms and
events. An event is a numbered, user- configured threshold for a particular
SNMP object. You configure events to track, for example, CPU utilization or
errors on a particular interface, or anything else you can
do with an SNMP object.</p>
</div>
<div class="paragraph">
<p>You set the rising and falling thresholds for these events, and then tell RMON
which RMON alarm to trigger when those rising or falling thresholds are
crossed. For example, you might want to have the router watch CPU utilization
and trigger an SNMP trap or log an event when the CPU utilization rises faster
than, say, 20 percent per minute. Or you might configure it to trigger an alarm
when the CPU utiliza- tion rises to some absolute level, such as 80 percent.
Both types of thresholds (relative, or
delta,” and absolute) are supported. Then, you can configure a different alarm
notifica- tion as the CPU utilization falls, again at some delta or to an
absolute level you specify.</p>
</div>
<div class="paragraph">
<p>The alarm that corresponds to each event is also configurable in terms of what
it does (logs the event or sends a trap). If you configure an RMON alarm to
send a trap, you also need to supply the SNMP community string for the SNMP
server.</p>
</div>
<div class="paragraph">
<p>Event and alarm numbering are locally significant. Alarm numbering provides a
pointer to the corresponding event. That is, the configured events each point
to specific alarm num- bers, which you must also define.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>rmon event 1 log trap public description Fa0.0RisingErrors owner config
rmon event 2 log trap public description Fa0.0FallingErrors owner config
rmon event 3 log trap public description Se0.0RisingErrors owner config
rmon event 4 log trap public description Se0.0FallingErrors owner config
rmon alarm 11 ifInErrors.1 60 delta rising-threshold 10 1 falling-threshold 5 2 owner config
rmon alarm 20 ifInErrors.2 60 absolute rising-threshold 20 3 falling-threshold 10 4 owner   config</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Monitor RMon Activity</div>
<div class="content">
<pre># sh rmon activity
# sh rmon event</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syslog">41.7. Syslog</h3>
<div class="ulist">
<ul>
<li>
<p>RFC 5424</p>
</li>
<li>
<p>Clear-text protocol that provides event notifications without requiring difficult, time-intensive configuration or opening attack vectors.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Steps</div>
<ul>
<li>
<p>Install a Syslog server on a workstation with a fixed IP address.</p>
</li>
<li>
<p>Configure the logging process to send events to the Syslog server’s IP address using the <strong>logging host</strong> command.</p>
</li>
<li>
<p>Configure any options, such as which severity levels (0–7) you want to send to the Syslog server using the logging trap command.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ntp">41.8. NTP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration guides</span>&#160;&#9656; <span class="submenu">Network Management</span>&#160;&#9656; <span class="submenu">Basic System Management</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/bsm/configuration/15-mt/bsm-15-mt-book/bsm-time-calendar-set.html">Setting Time and Calendar Services</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Version 3 <a href="https://tools.ietf.org/html/rfc1305">RFC 1305</a></p>
</li>
<li>
<p>UDP port 123</p>
</li>
<li>
<p>IOS does not support stratum 1 service, cannot be linked to stratum 0 atomic clock</p>
</li>
<li>
<p>Accuracy &lt; milliseconds with 1 NTP packet per minute</p>
</li>
<li>
<p>Stratum</p>
<div class="ulist">
<ul>
<li>
<p>0 : atomic clock</p>
</li>
<li>
<p>8 : default value</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ntp_associations">41.8.1. NTP Associations</h4>
<div class="ulist">
<ul>
<li>
<p>Polled-based    : better accuracy and reliability</p>
<div class="ulist">
<ul>
<li>
<p>Client mode           : <strong>ntp server</strong></p>
</li>
<li>
<p>Symmetric active mode : <strong>ntp peer</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Broadcast-based : less manual configuration on LAN</p>
<div class="ulist">
<ul>
<li>
<p>Server                : <strong>ntp broadcast</strong></p>
</li>
<li>
<p>Client                : <strong>ntp broadcast client</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Verify NTP Status</div>
<div class="content">
<pre># show ntp status</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify NTP Associations</div>
<div class="content">
<pre># show ntp associations</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Troubleshoot NTP Associations</div>
<div class="content">
<pre># debug ntp refclock</pre>
</div>
</div>
<div class="sect4">
<h5 id="_polled_based_associations">Polled-Based Associations</h5>
<div class="listingblock">
<div class="content">
<pre>(config)# ntp server &lt;ip-address&gt; [normal-sync] [version &lt;number&gt;] [key &lt;id&gt;] [prefer]
(config)# ntp peer &lt;ip-address&gt; [normal-sync] [version &lt;number&gt;] [key &lt;id&gt;] [prefer]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_broadcast_based_associations">Broadcast-Based Associations</h5>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ntp broadcast version &lt;number&gt;
(config-if)# ntp broadcast client
(config-if)# ntp broadcastdelay &lt;microseconds&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ntp_access_groups">41.8.2. NTP Access Groups</h4>
<div class="listingblock">
<div class="title">Task: Grant/Deny Access Privileges with Ipv4 or Ipv6 Access-Lists</div>
<div class="content">
<pre>(config)# ntp access-group [ipv4 | ipv6] &lt;options&gt;  &lt;access-list-id&gt; [kod]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><em>options</em> per increasing order of restrictions are:</p>
<div class="ulist">
<ul>
<li>
<p><strong>peer</strong>: synchronize itself to systems whose address passes access list criteria</p>
</li>
<li>
<p><strong>serve</strong>: allows time requests and NTP control queries but no synchronization</p>
</li>
<li>
<p><strong>serve-only</strong>: allows only time requests</p>
</li>
<li>
<p><strong>query-only</strong>: allows only NTP control queries</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>kod</strong> sends the kiss-of-death packet to any host that tries to send a packet
that is not compliant with the access-group policy.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ntp_authentication">41.8.3. NTP Authentication</h4>
<div class="ulist">
<ul>
<li>
<p>Use cryptographic checksum keys</p>
</li>
<li>
<p>Encryption/decryption are CPU-intensive and may degrade accuracy</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ntp authenticate
(config)# ntp authentication-key &lt;number&gt; md5 &lt;key&gt;
(config)# ntp trusted-key &lt;key-number&gt; [-&lt;end-key-number]
(config)# ntp server &lt;ip-address&gt; key &lt;id&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_source_ip_address">41.8.4. Source IP Address</h4>
<div class="ulist">
<ul>
<li>
<p>Default to NTP packet outgoing interface</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Change the Source IP Address for All Destinations</div>
<div class="content">
<pre>(config)# ntp source interface</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Change the Source for a Specific Association</div>
<div class="content">
<pre>(config)# ntp {server|peer} source</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoritative_server">41.8.5. Authoritative Server</h4>
<div class="listingblock">
<div class="title">Task:</div>
<div class="content">
<pre>(config)# ntp master</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_panic_treshold">41.8.6. Panic Treshold</h4>
<div class="listingblock">
<div class="title">Task: Reject Time Updates Greater Than the Panic Threshold Of 1000 Seconds</div>
<div class="content">
<pre>(config)# ntp panic update</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_orphan_mode">41.8.7. Orphan Mode</h4>
<div class="ulist">
<ul>
<li>
<p>When a subnet lost communications with clock servers</p>
</li>
<li>
<p>Orphan parent simulate a UTC source for orphan children</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ntp server &lt;a.b.c.d&gt;
(config)# ntp peer &lt;e.f.g.h&gt;
(config)# ntp orphan &lt;stratum&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_external_reference_clock">41.8.8. External Reference Clock</h4>
<div class="listingblock">
<div class="content">
<pre># line aux &lt;number&gt;
# ntp refclock trimble pps none stratum &lt;number&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_software_clock">41.8.9. Software Clock</h4>
<div class="listingblock">
<div class="content">
<pre>(config)# clock timezone &lt;zone&gt; &lt;hours-offset&gt; [&lt;minutes-offset&gt;]
(config)# summer-time &lt;zone&gt; recurring [&lt;week day month hh:mm&gt; [&lt;offset&gt;]]
(config)# summer-time &lt;zone&gt; date [&lt;date month year hh:mm&gt; [&lt;offset&gt;]]
# clock set &lt;hh:mm:ss date month year&gt;
# show clock</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hardware_clock">41.8.10. Hardware-Clock</h4>
<div class="ulist">
<ul>
<li>
<p>different from software-clock</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># calendar set &lt;hh:mm:ss date month year&gt;
(config)# clock calendar-valid
# clock read-calendar
# clock update-calendar
# show calendar
# show clock [detail]
# show ntp associations [details]
# show ntp status</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_time_ranges">41.8.11. Time Ranges</h4>
<div class="listingblock">
<div class="title">Task: Configure Time Ranges</div>
<div class="content">
<pre>(config)# time-range &lt;name&gt;
(config-time-range)# absolute [start &lt;hh:mm date month year&gt;] [end &lt;hh:mm date month year&gt;]
(config-time-range)# periodic &lt;day-of-week&gt; &lt;hh:mm&gt; to [&lt;day-of-the-week&gt;] &lt;hh:mm&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify Time Range</div>
<div class="content">
<pre># show time-range</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vulnerability">41.8.12. Vulnerability</h4>
<div class="ulist">
<ul>
<li>
<p>DoS for version &#8656; 4.2.4p7</p>
</li>
<li>
<p>No workaround, disable NTP on the device</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_example">41.8.13. Example</h4>
<div class="ulist">
<ul>
<li>
<p>Step 1 Enable timestamp information for debug messages.</p>
</li>
<li>
<p>Step 2 Enable timestamp information for log messages.</p>
</li>
<li>
<p>Step 3 Define the network-wide time zone.</p>
</li>
<li>
<p>Step 4 Enable summertime adjustments.</p>
</li>
<li>
<p>Step 5 Restrict which devices can communicate with this device as an NTP server.</p>
</li>
<li>
<p>Step 6 Restrict which devices can communicate with this device as an NTP peer.</p>
</li>
<li>
<p>Step 7 Define the source IP address to be used for NTP packets.</p>
</li>
<li>
<p>Step 8 Enable NTP authentication.</p>
</li>
<li>
<p>Step 9 Define the NTP servers.</p>
</li>
<li>
<p>Step 10 Define the NTP peers.</p>
</li>
<li>
<p>Step 11 Enable NTP to update the device hardware clock</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http">41.9. HTTP</h3>
<div class="paragraph">
<p>Cisco IOS routers and switches support web access for administration, through
both HTTP and HTTPS. Enabling HTTP access requires the <strong>ip http server</strong> global
configuration command. HTTP access defaults to TCP port 80. You can change
the port used for HTTP by configuring the ip http port command. You can
restrict HTTP access to a router using the ip http access-class command,
which applies an extended access list to connection requests. You can also
specify a unique username and password for HTTP access using the ip http client
username and ip http client password commands. If you choose, you can also
configure HTTP access to use a variety of other access-control methods,
including AAA, using <strong>ip http authentication [aaa | local | enable | tacacs]</strong>.</p>
</div>
<div class="paragraph">
<p>You can also configure a Cisco IOS router or switch for Secure Sockets Layer
(SSL) access. By default, HTTPS uses TCP port 443, and the port is configurable
in much the same way as it is with HTTP access. Enabling HTTPS access requires
the <strong>ip http secure-server</strong> command. When you configure HTTPS access in most IOS
Release 12.4 versions, the router or switch automatically disables HTTP
access, if it has been configured. However, you should disable it manually if
the router does not do it for you.</p>
</div>
<div class="paragraph">
<p>HTTPS router access also gives you the option of specifying the cipher suite of
your choice. This is the combination of encryption methods that the router will
enable for HTTPS access. By default, all methods are enabled</p>
</div>
<div class="listingblock">
<div class="title">Task: Display HTTP Secure Server Status</div>
<div class="content">
<pre># sh ip http server secure status

HTTP secure server status                 : Enabled
HTTP secure server port                   : 443
HTTP secure server ciphersuite            : 3des-ede-cbc-sha des-cbc-sha rc4-128-md5 rc4-128-sha
HTTP secure server client authentication  : Disabled
HTTP secure server trustpoint             :
HTTP secure server active session modules : ALL</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rtp_rtcp">41.10. RTP/RTCP</h3>
<div class="paragraph">
<p>Real-time Transport Control Protocol (RTCP)
- sister protocol of RTP
- provides out-of-band control information for an RTP flow
  * It is used periodically to transmit control packets to
participants in a streaming multimedia session.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>gathers statistics on a media connection and information such as bytes
sent, packets sent, lost packets, jitter, feedback and round trip delay. An
application may use this information to increase the quality of service,
perhaps by limiting flow or using a different codec.</p>
</li>
<li>
<p>type of RTCP packets: Sender report packet, Receiver report
packet, Source Description RTCP Packet, Goodbye RTCP Packet and Application
Specific RTCP packets.</p>
</li>
<li>
<p>RTCP itself does not provide any flow encryption or authentication means. SRTCP
protocol can be used for that purpose.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO question 1</p>
</div>
<div class="paragraph">
<p><a href="http://ccm.net/contents/288-rtp-rtcp-protocols" class="bare">http://ccm.net/contents/288-rtp-rtcp-protocols</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qos">42. QoS</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="title">Blueprint Topics</div>
<div class="content">
<pre>6.2.a Implement and troubleshoot end-to-end QoS
6.2.a [i] CoS and DSCP mapping
6.2.b Implement, optimize and troubleshoot QoS using MQC
6.2.b [i] Classification
6.2.b [ii] Network based application recognition [NBAR]
6.2.b [iii] Marking using IP precedence, DSCP, CoS, ECN
6.2.b [iv] Policing, shaping
6.2.b [v] Congestion management [queuing]
6.2.b [vi] HQoS, sub-rate ethernet link
6.2.b [vii] Congestion avoidance [WRED]
6.2.c Describe layer 2 QoS
6.2.c [i] Queuing, scheduling
6.2.c [ii] Classification, marking</pre>
</div>
</div>
<div class="sect2">
<h3 id="_classification_and_marking">42.1. Classification and Marking</h3>
<div class="sect3">
<h4 id="_fields_that_can_be_marked_for_qos_purposes">42.1.1. Fields That Can Be Marked for QoS Purposes</h4>
<div class="ulist">
<ul>
<li>
<p>Layer 3:  IPP, IP DSCP, DS field, ToS byte</p>
</li>
<li>
<p>Layer 2:  Ethernet CoS,Frame Relay  DE, ATM CLP, MPLS EXP</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_ipp">IPP</h5>
<div class="imageblock">
<div class="content">
<img src="../images/ipp-vs-dscp.png" alt="ipp vs dscp">
</div>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 15. IPP and Class Selector DSCP Values</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">DSCP CS name</th>
<th class="tableblock halign-left valign-top">IPP names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS0/Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">routine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">priority</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">immediate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flash</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flash override</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">critical</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">internetwork control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">network control</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dscp">DSCP</h5>
<div class="ulist">
<ul>
<li>
<p>PHB: Per-Hop Behavior</p>
</li>
<li>
<p>Expedited Forwarding (EF):</p>
<div class="ulist">
<ul>
<li>
<p>Queue EF packets so that they get scheduled quickly, to give them low latency.</p>
</li>
<li>
<p>Police the EF packets so that they do not consume all bandwidth on the link or starve other queues.</p>
</li>
<li>
<p>Binary value: 101110 Decimal value: 46</p>
</li>
<li>
<p>packets given queue priority</p>
</li>
</ul>
</div>
</li>
<li>
<p>Assured Forwarding (AF)</p>
<div class="ulist">
<ul>
<li>
<p>defines 4 queues with 3 drop priorities</p>
</li>
<li>
<p>\$AFx_1y_1 &gt; AFx_2y_2 if x_1 &gt; x_2 or (x_1 = x_2 and y_1 &lt; y_2)\$</p>
</li>
<li>
<p>AFxy &#8594; 8x + 2y = decimal value</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_ethernet_lan_class_of_service">Ethernet LAN Class Of Service</h5>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-cos.png" alt="Ethernet CoS">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wan_2">WAN</h5>
<div class="ulist">
<ul>
<li>
<p>Frame Relay DE (Discard Eligibility), 1-bit</p>
</li>
<li>
<p>ATM CLP (Cell Loss Priority ), 1-bit</p>
</li>
<li>
<p>MPLS EXP (Exprimental), 3-bit</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nbar">42.1.2. NBAR</h4>
<div class="ulist">
<ul>
<li>
<p>Network-Based Application Recognition</p>
</li>
<li>
<p>Deep-packet classification  from Layer 4 through Layer 7:</p>
<div class="ulist">
<ul>
<li>
<p>Statically assigned TCP and UDP port numbers.</p>
</li>
<li>
<p>Non-TCP and non-UDP IP protocols.</p>
</li>
<li>
<p>Dynamically assigned TCP and UDP port numbers.</p>
<div class="ulist">
<ul>
<li>
<p>requires stateful inspection: inspect a protocol across multiple packets during packet classification.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Subport classification or classification based on deep-packet inspection.</p>
<div class="ulist">
<ul>
<li>
<p>URL, Hostname, or MIME type</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>uses MQC match protocol</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 16. NBAR Match Protocol</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the match criteria for a class map on the basis of the specified protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol citrix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures NBAR to match Citrix traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol fasttrack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures NBAR to match FastTrack peer-to-peer traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol gnutella</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures NBAR to match Gnutella peer-to-peer traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol http</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures NBAR to match HTTP traffic by URL, host,MIME type, or fields in HTTP packet headers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol rtp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures NBAR to match Real-Time Transport Protocol (RTP) traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match qos-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies a specific QoS group value as a match criterion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match source-address mac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses the source MAC address as a match criterion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the match criteria for a class map on the basis of the datagram header (Layer 2) or the network header (Layer 3).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies tag type as a match criterion.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Restrictions</div>
<ul>
<li>
<p>NBAR cannot classify ipx</p>
</li>
<li>
<p>NBAR cannot classify multicast traffic</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure DSCP-Based Layer 3 Custom Applications</div>
<div class="content">
<pre>(config)# ip nbar custom &lt;name&gt; transport {tcp| udp } id &lt;id&gt;
(config-custom)# dscp {ef | af }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the Current Protocol-to-Port Mappings In Use by NBAR.</div>
<div class="content">
<pre># sh ip nbar port-mapping [&lt;protocol-name&gt;]

port-map bgp      udp 179
port-map bgp      tcp 179
port-map cuseeme  udp 7648 7649
port-map cuseeme  tcp 7648 7649
port-map dhcp     udp 67 68
port-map dhcp     tcp 67 68</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cb_marking">42.1.3. CB Marking</h4>
<div class="ulist">
<ul>
<li>
<p>requires CEF</p>
</li>
<li>
<p>Mark as close to the ingress edge of the network as possible, but not so close
to the edge that the marking is made by an untrusted device.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For any class inside the policy map for which there is no set command, packets in that class are not marked.</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 17. Recommended Values for Traffic Marking</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Traffic Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP Precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP DSCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class of Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Voice payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Video payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Voice and video signaling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF31 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High priority data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF21 AF22 AF23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medium priority data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF11 AF12 AF13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All other traffic</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Set the DSCP Value In the ToS Byte</div>
<div class="content">
<pre>(config-pmap-c)#set ip dscp {&lt;0-63&gt; | AF&lt;xy&gt; | CS&lt;x&gt; | EF | default}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_qos_pre_classification">42.1.4. QoS Pre-Classification</h4>
<div class="ulist">
<ul>
<li>
<p>enabled on VPN endpoint routers permit the router to make egress QoS decisions based on the original traffic,
before encapsulation, rather than just the encapsulating tunnel header.</p>
</li>
<li>
<p>works by keeping the original, unencrypted traffic in memory until the egress QoS actions are taken.</p>
</li>
<li>
<p>enables in tunnel interface configuration mode, virtual-template configuration mode, or crypto map configuration mode</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable QoS Pre-Classification</div>
<div class="content">
<pre>(config-if)# qos pre-classification</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_autoqos">42.1.5. AutoQoS</h4>
<div class="ulist">
<ul>
<li>
<p>macro that helps automate class-based QoS configuration.</p>
</li>
<li>
<p>creates and applies QoS configurations based on Cisco best-practice recommendations.</p>
</li>
<li>
<p>provides the following benefits:</p>
<div class="ulist">
<ul>
<li>
<p>Simpler QoS deployment.</p>
</li>
<li>
<p>Less operator error, because most steps are automated.</p>
</li>
<li>
<p>Cheaper QoS deployment because less staff time is involved in analyzing network traffic and determining QoS configuration.</p>
</li>
<li>
<p>Faster QoS deployment because there are dramatically fewer commands to issue.</p>
</li>
<li>
<p>Companies can implement QoS without needing an in-depth knowledge of QoS concepts</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display the Interface AutoQoS Configuration</div>
<div class="content">
<pre>&gt; sh auto qos</pre>
</div>
</div>
<div class="sect4">
<h5 id="_autoqos_for_voip">AutoQoS for VOIP</h5>
<div class="ulist">
<ul>
<li>
<p>for voice and video applications</p>
</li>
<li>
<p>enables on individual interfaces, but creates both interface and global configuration</p>
</li>
<li>
<p>uses CDP on access ports to detect presence or absence of softphone</p>
</li>
<li>
<p>trusts COS or DSCP values on trunk or uplink ports</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_autoqos_on_switches">AutoQoS on Switches</h6>
<div class="ulist">
<ul>
<li>
<p>no need to enable QoS globally.</p>
<div class="ulist">
<ul>
<li>
<p>After it is enabled for any interface, the command starts a macro that:</p>
</li>
</ul>
</div>
</li>
<li>
<p>Globally enables QoS.</p>
</li>
<li>
<p>Creates COS-to-DCSP mappings and DSCP-to-COS mappings.</p>
<div class="ulist">
<ul>
<li>
<p>As the traffic enters the switch, the frame header containing the COS value is removed.</p>
</li>
<li>
<p>The switch uses the COS value in the frame header to assign a DSCP value to the packet.</p>
</li>
<li>
<p>If the packet exits a trunk port, the internal DSCP value is mapped back to a COS value.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enables priority or expedite ingress and egress queues.</p>
</li>
<li>
<p>Creates mappings of COS values to ingress and egress queues and thresholds.</p>
</li>
<li>
<p>Creates mappings of DSCP values to ingress and egress queues and thresholds.</p>
</li>
<li>
<p>Creates class maps and policy maps to identify, prioritize, and police voice traffic.</p>
</li>
<li>
<p>Applies those policy maps to the interface.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For best results, enable AutoQoS before configuring any other QoS on the
switch. You can then go back and modify the default configuration if needed to
fit your specific requirements.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Enable AutoQoS on an Access Port</div>
<div class="content">
<pre>(config-if)# auto qos voip {cisco- phone | cisco-softphone}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable AutoQoS on Uplink Port</div>
<div class="content">
<pre>(config-if)# auto qos voip trust</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_autoqos_on_routers">AutoQoS on Routers</h6>
<div class="listingblock">
<div class="title">Task: Enable AutoQoS on Router Port</div>
<div class="content">
<pre>(config-if)# auto qos voip [trust]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Make sure that the interface bandwidth is configured before giving this
command.</p>
<div class="ulist">
<ul>
<li>
<p>If you change it later, the QoS configuration will not change.  When you issue the <strong>auto qos voip</strong> command on an individual data circuit, the
configuration it creates differs depending on the bandwidth of the circuit
itself.</p>
</li>
<li>
<p>Compression and fragmentation are enabled on links of 768 kbps
bandwidth and lower. They are not enabled on links faster than 768 kbps.</p>
</li>
<li>
<p>The router additionally configures traffic shaping and applies an AutoQoS service
policy regardless of the bandwidth.</p>
</li>
</ul>
</div>
</li>
<li>
<p>When you issue the command on a serial interface with a bandwidth of 768 kbps
or less, the router changes the interface encapsulation to PPP. It creates a
PPP Multilink interface and enables Link Fragmentation and Interleave (LFI) on
the interface. Serial interfaces with a configured bandwidth greater than 768
kbps keep their configured encapsulation, and the router merely applies an
AutoQoS service policy to the interface.</p>
</li>
<li>
<p>If you use the <strong>trust</strong> keyword in the command, the router creates class maps that
group traffic based on its DSCP values. It associates those class maps with a
created policy map and assigns it to the interface. You would use this keyword
when QoS markings are assigned by a trusted device.</p>
</li>
<li>
<p>If you do not use the <strong>trust</strong> keyword, the router creates access lists that match
voice and video data and call control ports. It associates those access lists
with class maps with a created policy map that marks the traffic appropriately.
Any traffic not matching those access lists is marked with DSCP 0. You would
use this command if the traffic either arrives at the router unmarked or
arrives marked by an untrusted device.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_autoqos_for_enterprise">AutoQoS for Enterprise</h5>
<div class="ulist">
<ul>
<li>
<p>supported on Cisco routers.</p>
</li>
<li>
<p>The main difference between it and AutoQoS VoIP is that it automates the QoS configuration for VoIP
plus other network applications, and is meant to be used for WAN links.</p>
</li>
<li>
<p>can be used for Frame Relay and ATM subinterfaces only if they are point-to-point links.</p>
</li>
<li>
<p>detects the types and amounts of network traffic with NBAR and then creates
policies based on that.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable Traffic Discovery</div>
<div class="content">
<pre>(config-if)# auto discovery qos [trust]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Make sure that CEF is enabled, that the interface
bandwidth is configured, and that no QoS configuration is on the interface
before giving the command.</p>
</li>
<li>
<p>Use the <strong>trust</strong> keyword if the traffic arrives at the
router already marked, and if you trust those markings, because the AutoQoS
policies will use those markings during the configuration stage.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Generate the AutoQoS Configuration for Enterprise</div>
<div class="content">
<pre>(config-if)# auto qos</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Show Auto Discovery Qos</div>
<div class="content">
<pre># sh auto discovery qos</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/autoqos-for-enterprise.png" alt="AutoQoS for Enterprise Classes and DSCP Values">
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_congestion_management_and_avoidance">42.2. Congestion Management and Avoidance</h3>
<div class="paragraph">
<p>congestion when hardware queue is full</p>
</div>
<div class="sect3">
<h4 id="_queues">42.2.1. Queues</h4>
<div class="paragraph">
<p>hardware queues</p>
</div>
<div class="paragraph">
<p>software queues</p>
</div>
</div>
<div class="sect3">
<h4 id="_cbwfq">42.2.2. CBWFQ</h4>

</div>
<div class="sect3">
<h4 id="_llq">42.2.3. LLQ</h4>

</div>
</div>
<div class="sect2">
<h3 id="_shaping_policing_and_link_fragmentation">42.3. Shaping, Policing and Link Fragmentation</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_mqc">42.4. MQC</h3>
<div class="ulist">
<ul>
<li>
<p>Define a traffic class with <strong>class map</strong></p>
</li>
<li>
<p>Define PHB actions(marking, queuing, )  with <strong>policy map</strong></p>
</li>
<li>
<p>Attach the traffic policy to an interface with <strong>service-policy</strong></p>
</li>
<li>
<p>restrictions: maximum of 256 classes in a single policy map</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_traffic_class_2">42.4.1. Traffic Class</h4>
<div class="paragraph">
<p>A traffic class contains 3 major elts: a name, a series of <strong>match</strong> commands followed by <strong>match-all</strong> (default) or <strong>match-any</strong></p>
</div>
<div class="ulist">
<div class="title">Match Commands That Can Be Used with MQC</div>
<ul>
<li>
<p>match access-group</p>
</li>
<li>
<p>match any</p>
</li>
<li>
<p>match class-map</p>
</li>
<li>
<p>match cos</p>
</li>
<li>
<p>match destination-address mac</p>
</li>
<li>
<p>match discard-class</p>
</li>
<li>
<p>match [ip] dscp</p>
</li>
<li>
<p>match field</p>
</li>
<li>
<p>match fr-dlci</p>
</li>
<li>
<p>match input-interface</p>
</li>
<li>
<p>match ip rtp</p>
</li>
<li>
<p>match mpls experimental</p>
</li>
<li>
<p>match mpls experimental topmost</p>
</li>
<li>
<p>match not  // add a note here</p>
</li>
<li>
<p>match packet length
-</p>
</li>
<li>
<p>etc</p>
</li>
<li>
<p>Packets that do not explicitly match a defined class are considered to have matched a special class called <strong>class-default</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display All Class Maps and Their Matching Criteria</div>
<div class="content">
<pre>&gt; sh class-map</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_elements_of_a_traffic_policy">42.4.2. Elements Of a Traffic Policy</h4>
<div class="ulist">
<ul>
<li>
<p>contains 3 elts: name, traffic class, command to enable the QoS feature</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purpose</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random-detect discard-class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the WRED parameters for a discard- class value for a class in a policy map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random-detect discard-class-based</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures  WRED on the basis of the discard class value of a packet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random-detect ecn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables explicit congestion notification (ECN).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random-detect exponential-weighting-constant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the exponential weight factor for the average queue size calculation for the queue reserved for a class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random-detect precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure the WRED parameters for a particular IP Precedence for a class policy in a policy map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set atm-clp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the cell loss priority (CLP) bit when a policy map is configured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set cos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the  Layer 2 class of service (CoS) value of an outgoing packet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set discard-class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marks a packet with a discard-class value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set [ip] dscp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marks a packet by setting the differentiated services code point (DSCP) value in the type of service (ToS) byte.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set fr-de</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes the discard eligible (DE) bit setting in the address field of a Frame Relay frame to 1 for all traffic leaving an interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set mpls experimental</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates the value to which the  MPLS bits are set if the packets match the specified policy map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the precedence value in the packet header.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set qos-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets a  QoS group identifier (ID) that can be used later to classify packets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shape</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shapes traffic to the indicated bit rate according to the algorithm specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shape adaptive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures a Frame  Relay interface or a point-to- point subinterface to estimate the available bandwidth by backward explicit congestion notification (BECN) integration while trafficommand</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shape fecn-adaptative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configures a Frame Relay interface to reflect FECN bits as BECN bits in Q.922 test response messages.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Display the Configuration for the Specified Class Of the Specified Policy Map</div>
<div class="content">
<pre>&gt; show policy-map &lt;policy-name&gt; class &lt;class-name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the Configuration Of All Classes for All Existing Policy Maps</div>
<div class="content">
<pre>&gt; show policy-map interface &lt;name number&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_policy">42.4.3. Service Policy</h4>
<div class="listingblock">
<div class="title">Task: Enable a Traffic Policy on an Interface</div>
<div class="content">
<pre>(config-if)# service-policy {input | output } policy-map-name</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rsvp">42.5. RSVP</h3>
<div class="sect3">
<h4 id="_configuration_tasks">42.5.1. Configuration Tasks</h4>
<div class="listingblock">
<div class="content">
<pre>ip rsvp bandwidth [interface-kbps [single-flow-kbps] ]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>default 75 % can be allocated by to RSVP and up to 75% of the total bandwidth
is available for a single flow</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_first_host_redundancy_protocols">43. First Host Redundancy Protocols</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_hsrp">43.1. HSRP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">First Hop Redundancy Protocols</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipapp_fhrp/configuration/15-mt/fhp-15-mt-book/fhp-hsrp-v2.html">HSRP Version 2</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.ietf.org/rfc/rfc2281.txt">RFC 2281</a></p>
</li>
<li>
<p>Set of routers sharing one virtual IP address and one virtual MAC address</p>
</li>
<li>
<p>Elect one active router with the highest (priority, IP address)</p>
</li>
<li>
<p>Standy router takes over if Active router fails</p>
</li>
<li>
<p>Elect new standby router if standby router fails or becomes the active router.</p>
</li>
<li>
<p>To minimize network traffic, only the active and standby router send periodic HSRP messages.</p>
</li>
<li>
<p>A router may participate in multiple groups with seperate state and timers for each group</p>
</li>
<li>
<p>Unique group id per vlan</p>
</li>
<li>
<p>Multicast address = 0000.0c07.AC<em>xy</em> (where xy is the HSRP group number in Hex)</p>
</li>
<li>
<p>Send to multicast 224.0.0.2 for v1 and 224.0.0.102 for v2</p>
</li>
<li>
<p>UDP port 1985</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_hsrp_packet">43.1.1. HSRP Packet</h4>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-with-hsrp-payload.png" alt="ethernet with hsrp payload" width="536" height="41">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/hsrp-packet.png" alt="HSRP Packet" width="896" height="248">
</div>
<div class="title">Figure 50. HSRP Packet</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_version">43.1.2. HSRP Version</h4>
<div class="ulist">
<ul>
<li>
<p>Version 1 by default</p>
</li>
<li>
<p>Version 2 doesn&#8217;t interoperate with HSRPv1 on the same interface.</p>
<div class="ulist">
<ul>
<li>
<p>v1 and v2 can run on different physical interfaces of the same router</p>
</li>
<li>
<p>v1 cannot advertise and learn millisecond timers</p>
</li>
<li>
<p>v1 uses multicast 224.0.0.2 and v2 224.0.0.102</p>
</li>
<li>
<p>v2 uses jitter timers (negative for hellotimes and positive for holdtimes)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Group number: 0..255 for v1 and 0..4095 for v2</p>
</li>
<li>
<p>Different virtual MAC address</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Change HSRP Version</div>
<div class="content">
<pre>(config-if)# standby version {1 | 2}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_opcode">43.1.3. HSRP OpCode</h4>
<div class="ulist">
<ul>
<li>
<p>Uses the Opcode field for preemption</p>
<div class="ulist">
<ul>
<li>
<p>0: <strong>Hello</strong>: The router is running and is capable of becoming the active or standby router</p>
</li>
<li>
<p>1: <strong>Coup</strong>: The router wishes to become the active router</p>
</li>
<li>
<p>2: <strong>Resign</strong>: The router no longer wishes to be active router</p>
</li>
</ul>
</div>
</li>
<li>
<p>No preemption by default</p>
</li>
<li>
<p>Preemption: the router with the highest priority becomes immediately the active router by sending a <strong>coup</strong> message,
The previous active router changes to the <strong>speak</strong> state and sends a <strong>resign</strong> message.</p>
</li>
<li>
<p>Can specify a delay before take over to allow the router to populate its routing table</p>
<div class="ulist">
<ul>
<li>
<p><strong>minimum</strong> seconds after the last restart:</p>
</li>
<li>
<p><strong>reload</strong> seconds after the first interface-up event after the device has reloaded, if such an event occurs within 360 seconds from reload. ???</p>
</li>
<li>
<p><strong>sync</strong> seconds: for IP redundancy clients only ???</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure HSRP Preemption</div>
<div class="content">
<pre>(config-if)# standby [ &lt;group-number&gt; ] preempt [ delay{ [ minimum &lt;seconds&gt; ] [ reload &lt;seconds&gt; ] [ sync &lt;seconds&gt; ] } ]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_state">43.1.4. HSRP State</h4>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 5%;">
<col style="width: 15%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the starting state and indicates that HSRP is not running. This state is entered via a configuration change or when an interface first comes up.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Learn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The router has not determined the virtual IP address, and not yet seen an authenticated Hello message from the active router. In this state the router is still waiting to hear from the active router.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The router knows the virtual IP address, but is neither the active router nor the standby router. It listens for Hello messages from those routers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Speak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The router sends periodic Hello messages and is actively participating in the election of the active and/or standby router. A router cannot enter Speak state unless it has the virtual IP address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The router is a candidate to become the next active router and sends periodic Hello messages. Excluding transient conditions, there MUST be at most one router in the group in Standby state.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The router is currently forwarding packets that are sent to the group&#8217;s virtual MAC address. The router sends periodic Hello messages. Excluding transient conditions, there MUST be at most one router in Active state in the group.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_priority_2">43.1.5. Priority</h4>
<div class="ulist">
<ul>
<li>
<p>Default value: 100</p>
</li>
<li>
<p>The higher (priority || IP address) wins</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure HSRP Priority</div>
<div class="content">
<pre>(config-if)# standby [group-number] priority &lt;number&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_timers">43.1.6. HSRP Timers</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Hellotime</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>3 seconds by default</p>
</li>
<li>
<p>Only meaningful in Hello messages</p>
</li>
<li>
<p>Configured on the router or learned from authenticated Hello message from the active router</p>
<div class="ulist">
<ul>
<li>
<p>not learned if HSRP hellos &lt; 1 second</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Holdtime</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>10 seconds by default</p>
</li>
<li>
<p>&gt;= 3 * hellotime</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Configure HSRP Timers</div>
<div class="content">
<pre>(config-if)# standby [group-number] timers[msec] &lt;hellotime&gt; [msec] &lt;holdtime&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_authentication">43.1.7. HSRP Authentication</h4>
<div class="ulist">
<ul>
<li>
<p>Clear-text or MD5 encryption</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure HSRP Clear-Text Authentication</div>
<div class="content">
<pre>(config-if)# standby [group-number] authentication text &lt;string&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure HSRP MD5 Authentication</div>
<div class="content">
<pre>(config-if)# standby [group-number] authentication  md5 { key-string [ 0 | 7 ] key [ timeout seconds ] | key-chain &lt;name-of-chain&gt; }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Debug HSRP Authentication</div>
<div class="content">
<pre># debug standby errors</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_and_object_tracking">43.1.8. HSRP and Object Tracking</h4>
<div class="ulist">
<ul>
<li>
<p>Reduce HSRP priority if the monitored interface goes down, allowing another HSRP router to become active if it has preemption enabled.</p>
</li>
<li>
<p>Cumulative reduction if multiple tracked interfaces are down</p>
</li>
<li>
<p>Configurable decrement value (default = 10)</p>
</li>
<li>
<p>Can shutdown/change the HSRP group to the Init state on the basis of the  tracked object&#8217;s state</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Interface Tracking</div>
<div class="content">
<pre>(config-if)# standby track { &lt;object-number&gt; [&lt;priority-decrement&gt;] | interface-type &lt;interface-number&gt; [ decrement &lt;priority-decrement&gt; ] } [shutdown]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_support_for_icmp_redirects">43.1.9. HSRP Support for ICMP Redirects</h4>
<div class="ulist">
<ul>
<li>
<p>Enabled by default with advertisement every 60 seconds and holddown of 180 seconds</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Why?</div>
<p>When HSRP is running, preventing hosts from discovering the interface (or
real) IP addresses of devices in the HSRP group is important. If a host is
redirected by ICMP to the real IP address of a device, and that device later
fails, then packets from the host will be lost.</p>
</div>
<div class="ulist">
<div class="title">How?</div>
<ul>
<li>
<p>looks up the next hop IP address in its table of real IP addresses vs virtual IP address</p>
</li>
<li>
<p>if match found, replaces the real IP address by the virtual IP addresses in the gateway field of the redirect packet</p>
</li>
<li>
<p>if no match (unknown), send the redirect packet to go out unchanged</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Restrictions</div>
<ul>
<li>
<p>Do not redirect to passive HSRP devices</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable ICMP Redirects on an Interface</div>
<div class="content">
<pre>(config-if)# standby redirect [timers &lt;advertisement&gt; &lt;holddown&gt;] [unknown]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable ICMP Redirects on an Interface</div>
<div class="content">
<pre>(config-if)# standby redirect [timers &lt;advertisement&gt; &lt;holddown&gt;] [unknown]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure ICMP Redirect Messages with HSRP Virtual IP Address As the Gateway IP Address</div>
<div class="content">
<pre>(config)# standby redirects [enable | disable]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Debug HSRP Support for ICMP Redirects</div>
<div class="content">
<pre># debug standby events icmp

10:43:08: HSRP: ICMP redirect not sent to 10.0.0.4 for dest 10.0.1.2
10:43:08: HSRP: could not uniquely determine IP address for mac 00d0.bbd3.bc22</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_virtual_ip_address_and_group">43.1.10. HSRP Virtual IP Address and Group</h4>
<div class="ulist">
<ul>
<li>
<p>Can have a name (no longer than 25 chars)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Virtual IP Address</div>
<div class="content">
<pre>(config-if)# standby [&lt;group-number&gt;] ip [ &lt;a.b.c.d&gt;  [secondary]]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, send one gratuitous ARP when a group becomes active and then another two and four seconds later.</p>
</li>
<li>
<p>When HSRP is on the Active state on an interface,
Proxy ARP requests are answered with the MAC address of the HSRP group.
otherwise, they are ignored.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Number Of Gratuitous ARP Packets Sent by HSRP Group When It Transitions to the Active State, and How Often the ARP Packets Are Sent</div>
<div class="content">
<pre>(config-if)# standby arp gratuitous [count &lt;number=&gt; interval &lt;seconds&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Name Of the Standby Group</div>
<div class="content">
<pre>(config-if)# standby name &lt;group-name&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_hsrp">43.1.11. Multiple HSRP</h4>
<div class="ulist">
<ul>
<li>
<p>Provides load sharing in an HSRP configuration</p>
<div class="ulist">
<ul>
<li>
<p>Because HSRP uses only one Active router at a time, any other HSRP routers are idle.</p>
</li>
<li>
<p>two or more HSRP groups are configured on each HSRP LAN interface,
where the configured priority determines which router will be active for each HSRP group.</p>
</li>
</ul>
</div>
</li>
<li>
<p>requires that each DHCP client and statically configured host are issued a default gateway corresponding to one of the HSRP groups</p>
</li>
<li>
<p>requires that they’re distributed appropriately.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_glbp">43.2. GLBP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">First Hop Redundancy Protocols</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipapp_fhrp/configuration/15-mt/fhp-15-mt-book/Configuring-GLBP.html">Gateway Load Balancing Protocol</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>One AVG (active virtual gateway) per group</p>
</li>
<li>
<p>Up to 4 primary AVFs (active virtual forwarder)</p>
</li>
<li>
<p>Up to 1024 GLBP groups per physical interface</p>
</li>
<li>
<p>AVG responds to all ARP requests with MAC from all particapating AVF</p>
<div class="ulist">
<ul>
<li>
<p>Not with own MAC address like HSRP</p>
</li>
</ul>
</div>
</li>
<li>
<p>Load-balancing</p>
<div class="ulist">
<ul>
<li>
<p>Round-robin (default)</p>
</li>
<li>
<p>Host-dependent</p>
</li>
<li>
<p>Weigthed</p>
</li>
</ul>
</div>
</li>
<li>
<p>Multicast, 224.0.0.102, UDP port 3222</p>
</li>
<li>
<p>Virtual MAC address 0007.B400.<em>xxyy</em>, where xx the group and yy in (00-03)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_glbp_packet_type">43.2.1. GLBP Packet Type</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Hello
</td>
<td class="hdlist2">
<p>advertise protocol info, multicast, sent by any AVG or AVF in [Speak, Standby, Active] State</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Request
</td>
<td class="hdlist2">
<p>request virtual MAC, unicast sent to AVG</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Reply
</td>
<td class="hdlist2">
<p>get virtual MAC, unicast sent from AVG</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_active_virtual_gateway">43.2.2. Active Virtual Gateway</h4>
<div class="ulist">
<ul>
<li>
<p>Elected for each group max( priority, IP address )</p>
</li>
<li>
<p>Assigns up to 4 virtual MAC address to AVFs</p>
</li>
<li>
<p>Reponds to ARP request for the virtual IP address of the group</p>
</li>
<li>
<p>If failed, new AVG election from AVG in listen State</p>
</li>
<li>
<p>By default, no AVG preemption</p>
</li>
<li>
<p>Load balancing methods</p>
<div class="ulist">
<ul>
<li>
<p>Round-robin: by default, each AVF in turn is used for ARP</p>
</li>
<li>
<p>Host-dependent: use same AVF based on the host MAC</p>
</li>
<li>
<p>Weighted: use the weight value advertised by the gateway</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure GLBP Virtual Ip Address</div>
<div class="content">
<pre>(config-if)# glbp &lt;group:0..1023 &gt; ip [&lt;virtual-ip-address&gt; [secondary]]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When the glbp ip command is enabled on an interface,
the handling of proxy ARP requests is changed
(unless proxy ARP was disabled).
the AVG intercepts the ARP requests and replies to the ARP on behalf of the connected nodes.
If a forwarder in the GLBP group is active, proxy ARP requests are answered using the MAC address of the first active
forwarder in the group.
If no forwarder is active, proxy ARP responses are suppressed.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Configure GLBP Priority</div>
<div class="content">
<pre>(config-if)# glbp [&lt;group&gt;] priority &lt;level=100&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure GLBP Preemption</div>
<div class="content">
<pre>(config-if)# glbp [&lt;group&gt;] preempt [delay minimum &lt;seconds&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure GLBP Load Balancing</div>
<div class="content">
<pre>(config-if)# glbp &lt;group&gt; load-balancing [ &lt;host-dependent&gt; | &lt;round-robin&gt; | &lt;weighted&gt; ]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Time During Which the AVG Continues to Redirect Clients to a Secondary AVF</div>
<div class="content">
<pre>(config-if)# glbp &lt;group&gt; timers redirect &lt;redirect-seconds=60&gt; &lt;timeout-seconds=1440&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The redirect timer sets the time delay between a forwarder failing on the
network and the AVG assuming that the forwarder will not return. The virtual
MAC address to which the forwarder was responsible for replying is still
given out in Address Resolution Protocol (ARP) replies, but the forwarding
task is handled by another router in the GLBP group.</p>
</li>
<li>
<p>The timeout interval is the time delay between a forwarder failing on the
network and the MAC address for which the forwarder was responsible becoming
inactive on all of the routers in the GLBP group. After the timeout
interval, packets sent to this virtual MAC address will be lost. The timeout
interval must be long enough to allow all hosts to refresh their ARP cache
entry that contained the virtual MAC address.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Display Glbp Status</div>
<div class="content">
<pre># sh glbp

FastEthernet0/0.40 - Group 1
  State is Standby
    1 state change, last state change 00:02:02
  Virtual IP address is 172.16.26.100
  Hello time 3 sec, hold time 10 sec
    Next hello sent in 2.720 secs
  Redirect time 600 sec, forwarder time-out 14400 sec
  Preemption disabled
  Active is 172.16.26.6, priority 100 (expires in 11.360 sec)
  Standby is local
  Priority 100 (default)
  Weighting 100 (default 100), thresholds: lower 1, upper 100
  Load balancing: round-robin
  Group members:
    ca02.6150.0000 (172.16.26.2) local
    ca06.618c.0000 (172.16.26.6)
  There are 2 forwarders (1 active)
  Forwarder 1
    State is Listen
    MAC address is 0007.b400.0101 (learnt)
    Owner ID is ca06.618c.0000
    Time to live: 14399.840 sec (maximum 14400 sec)
    Preemption enabled, min delay 30 sec
    Active is 172.16.26.6 (primary), weighting 100 (expires in 10.944 sec)
  Forwarder 2
    State is Active
      1 state change, last state change 00:02:08
    MAC address is 0007.b400.0102 (default)
    Owner ID is ca02.6150.0000
    Preemption enabled, min delay 30 sec
    Active is local, weighting 100</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_active_virtual_forwarder">43.2.3. Active Virtual Forwarder</h4>
<div class="ulist">
<ul>
<li>
<p>Primary AVF gets virtual MACs from AVG</p>
</li>
<li>
<p>Secondary AVF learns virtual MACs from hellos</p>
</li>
<li>
<p>Virtual forwarder preemptive is enabled by default with 30 seconds delay</p>
</li>
<li>
<p>Uses weighting and object tracking to determine the forwarding capacity of each device in the GLBP group</p>
<div class="ulist">
<ul>
<li>
<p>Decrement or increments the weight when the interface goes down or up</p>
</li>
<li>
<p>Stops being AVF if value below lower threshold</p>
</li>
<li>
<p>Resumes being AVF if value greater then upper threshold</p>
</li>
<li>
<p>When multiple tracked interfaces are down, the configured weighting decrements are cumulative.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify GLBP Initial Weighting Value</div>
<div class="content">
<pre>(config-if)# glbp &lt;group-number&gt; weighting &lt;maximum&gt; [lower &lt;low-value&gt; ] [upper &lt;up-value&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify a Tracking Object Where GLBP Weighting Changes Based on the Availability Of the Object Being Tracked</div>
<div class="content">
<pre>(config-if)# glbp &lt;group&gt; weighting track &lt;object-number&gt; [decrement &lt;value&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Router to Take Over As (AVF) Group If the Current AVF Falls Below Its Low Weighting Threshold</div>
<div class="content">
<pre>(config-if)# glbp &lt;group&gt; preempt forwarder [delay minimum &lt;seconds&gt;]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authentication_3">43.2.4. Authentication</h4>
<div class="ulist">
<ul>
<li>
<p>Supports no authentication, plain-text, or MD5 authentication</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Glbp Authentication</div>
<div class="content">
<pre>(config-if)# glbp authentication { text &lt;string&gt; | key-chain &lt;name&gt; }</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_vrrp">43.3. VRRP</h3>
<div class="ulist">
<ul>
<li>
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">First Hop Redundancy Protocols</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipapp_fhrp/configuration/15-mt/fhp-15-mt-book/fhp-vrrp.html">VRRP</span></span> </a></p>
</li>
<li>
<p><a href="https://wwwietf.org/rfc/rfc3768.txt">RFC 3768</a></p>
</li>
<li>
<p>Similar to HSRP</p>
</li>
<li>
<p>Multicast virtual MAC address (0000.5E00.01xx, where xx is the hex VRRP group number).</p>
</li>
<li>
<p>Uses the IOS object tracking feature, rather than its own internal tracking mechanism, to track interface states for failover purposes.</p>
</li>
<li>
<p>Preemption by default</p>
</li>
<li>
<p>The group IP address is the interface IP address of one of the VRRP routers.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable VRRP</div>
<div class="content">
<pre>(config-if)# vrrp &lt;group&gt; []</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify VRRP Configuration</div>
<div class="content">
<pre># sh vrrp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Customize VRRP</div>
<div class="content">
<pre>conf t
interface &lt;type number&gt;
  ip address ip-address mask
  vrrp &lt;group&gt; description text
  vrrp &lt;group&gt; priority level
  vrrp &lt;group&gt; preempt [delay minimum seconds]
  vrrp &lt;group&gt; timers learn</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_idrp">43.4. IDRP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">First Hop Redundancy Protocols</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipapp_fhrp/configuration/15-mt/fhp-15-mt-book/fhp-vrrp.html">IRDP</span></span> </a>
- <a href="http://www.ietf.org/rfc/rfc1256.txt">RFC 1256</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>ICMP Router Discovery Protocol allows hosts to locate routers
that can be used as gateway to reach IP-based devices on other networks.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_message_format_2">43.4.1. Message Format</h4>
<div class="sect4">
<h5 id="_icmp_router_advertisement_message">ICMP Router Advertisement Message</h5>
<div class="imageblock">
<div class="content">
<img src="../images/icmp-router-advertisement.png" alt="icmp router advertisement" width="896" height="248">
</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Checksum
</td>
<td class="hdlist2">
<p>The 16-bit one&#8217;s complement of the one&#8217;s complement sum of the ICMP message,
starting with the ICMP Type.
For computing the checksum, the Checksum field is set to 0.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Num Addrs
</td>
<td class="hdlist2">
<p>Number of router addreses advertised in this message</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Addr Entry Size
</td>
<td class="hdlist2">
<p>Number of 32-bit words of information per router address (=2 for IPv4)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Lifetime
</td>
<td class="hdlist2">
<p>Maximum number of seconds that the router adresses may be considered valid.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Router Address[i]
</td>
<td class="hdlist2">
<p>Sending router&#8217;s addresses on the interface from which this message is sent.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Preference Level[i]
</td>
<td class="hdlist2">
<p>Preferability of each Router Address[i] as a default router,
relative to other router addresses on the same subnet. Higher values more preferable.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_icmp_router_solicitation_message">ICMP Router Solicitation Message</h5>
<div class="imageblock">
<div class="content">
<img src="../images/icmp-router-sollicitation.png" alt="icmp router sollicitation" width="896" height="184">
</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Checksum
</td>
<td class="hdlist2">
<p>The 16-bit one&#8217;s complement of the one&#8217;s complement sum of the ICMP message,
starting with the ICMP Type.
For computing the checksum, the Checksum field is set to 0.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Reserved
</td>
<td class="hdlist2">
<p>Sent as 0; ignored on reception.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">43.4.2. Configuration</h4>
<div class="listingblock">
<div class="title">Task: Configure a Host to Discover Routers That Transmit IRDP Router Updates After Disabling IP Routing</div>
<div class="content">
<pre>(config)# no ip routing
(config-if)# ip gdp irdp [multicast]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable IRDP on an Interface</div>
<div class="content">
<pre>(config-if)# ip irdp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Send IRDP Advertisement to the All-Systems Multicast Addresses</div>
<div class="content">
<pre>(config-if)# ip irdp multicast</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the IRDP Period for Which Advertisements Are Valid.</div>
<div class="content">
<pre>(config-if)# ip irdp holdtime &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Sets the IRDP Maximum Interval Between Advertisements.</div>
<div class="content">
<pre>ip irdp maxadvertinterval &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the IRDP Minimum Interval Between Advertisements.</div>
<div class="content">
<pre>ip irdp minadvertinterval &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the IRDP Preference Level Of the Device</div>
<div class="content">
<pre>(config-if)# ip irdp preference &lt;number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify an IRDP Address and Preference to Proxy-Advertise</div>
<div class="content">
<pre>(config-if)# ip irdp address &lt;a.b.c.d&gt; &lt;preference-level&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ipv6_ra_rs">43.5. IPv6 RA/RS</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_multicast_2">44. Multicast</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ip_multicast">44.1. IP Multicast</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">IP multicasting</dt>
<dd>
<p>Sending a message from a single source to selected multiple destinations across a
Layer 3 network in one data stream.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_multicast_ip_addressing">44.1.1. Multicast IP Addressing</h4>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 18. Multicast Address Ranges and Their Use</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Range</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.0 to 239.255.255.255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPv4 class D reserved for multicast applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.0 to 224.0.0.255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">permanent groups; Assigned by IANA for network protocols on a local segment. Routers do not forward packets with destination addresses used from this range.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.1.0 to 224.0.1.255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">permanent groups; Assigned by IANA for the network protocols that are forwarded in the entire network. Routers forward packets with destination addresses used from this range.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">232.0.0.0 to 232.255.255.255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for SSM applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">233.0.0.0 to 233.255.255.255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GLOP addressing. It is used for automatically allocating 256 multicast addresses to any enterprise that owns a registered ASN.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">239.0.0.0 to 239.255.255.255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administratively scoped addresses; for private multicast domains</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remaining ranges of addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transient groups; Any enterprise can allocate a multicast address from the transient groups for a global multicast application and should release it when the application is no longer in use.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 19. Well-Known Multicast Addresses</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All multicast hosts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All multicast routers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DVMRP routers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All OSPF routers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2224.0.0.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RIPv2 routers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIGRP routers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIM routers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMPv3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RGMP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.1.39</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cisco-RP-Announce</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.1.40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cisco-RP-Discovery</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_mapping_ip_multicast_address_to_mac_addresses">44.1.2. Mapping IP Multicast Address to MAC Addresses</h4>
<div class="paragraph">
<p>ip &#8594; mac address = (0x01005E) + 0 bit + last 23 bits of the IP address</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/mcast-ip-to-mac.png" alt="IP -&gt; MAC">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_igmp">44.2. IGMP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration guides</span>&#160;&#9656; <span class="submenu">Multicast</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipmulti_igmp/configuration/15-mt/imc-igmp-15-mt-book.htm">IGMP</span></span> </a></p>
</div>
<div class="paragraph">
<p>Check also
<a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swigmp.html#pgfId-1027678">Catalyst configuration guides</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Group membership protocol used by hosts to inform routers and multilayer switches
of the existence of members on their directly connected networks and
to allow them to send and receive multicast datagrams.</p>
</li>
<li>
<p>IP protocol number: 2</p>
</li>
<li>
<p>TTL: 1</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_igmp_packet_format">44.2.1. IGMP Packet Format</h4>
<div class="imageblock">
<div class="content">
<img src="../images/igmp-packet-format.png" alt="IGMP Version 2 Format" width="896" height="184">
</div>
<div class="title">Figure 51. IGMP Version 2 Format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Membership Query (Type code = 0x11):</p>
<div class="ulist">
<ul>
<li>
<p>Used by multicast routers to discover the presence of group members on a subnet.</p>
</li>
<li>
<p>A General Membership Query message sets the Group Address field to 0.0.0.0.</p>
</li>
<li>
<p>A Group-Specific Query sets the Group Address field to the address of the group being queried.</p>
</li>
<li>
<p>It is sent by a router after it receives the IGMPv2 Leave Group message from a host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Version 1 Membership Report (Type code = 0x12):</p>
</li>
<li>
<p>Used by IGMPv2 hosts for backward compatibility with IGMPv1.</p>
</li>
<li>
<p>Version 2 Membership Report (Type Code = 0x16):</p>
<div class="ulist">
<ul>
<li>
<p>Sent by a group member to inform the router that at least one group member is present on the subnet.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Leave Group (Type code = 0x17):</p>
<div class="ulist">
<ul>
<li>
<p>Sent by a group member if it was the last member to send a Membership Report to inform the router that it is leaving
the group.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Maximum Response Time</dt>
<dd>
<p>Specifies the time limit for the corresponding report.</p>
<div class="ulist">
<ul>
<li>
<p>The field has a resolution of 100 milliseconds, the value is taken directly.</p>
</li>
<li>
<p>only in Membership Query (0x11); in other messages it is set to 0 and ignored by the receiver.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Checksum</dt>
<dd>
<p>Carries the 16-bit checksum computed by the source.</p>
<div class="ulist">
<ul>
<li>
<p>computed over the entire IP payload, not just over the first 8 octets,
even though IGMPv2 messages are only 8 bytes in length.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Group Address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Set to 0.0.0.0 in General Query messages and to the group address in Group- Specific messages.</p>
</li>
<li>
<p>Membership Report messages carry the address of the group being reported in this field</p>
</li>
<li>
<p>Leave Group messages carry the address of the group being left in this field.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_messages">44.2.2. Messages</h4>
<div class="ulist">
<ul>
<li>
<p>membership queries:</p>
<div class="ulist">
<ul>
<li>
<p>general:  sent to 224.0.0.1 (all systems on a subnet)</p>
</li>
<li>
<p>group-specific: sent to the group</p>
</li>
</ul>
</div>
</li>
<li>
<p>membership reports</p>
<div class="ulist">
<ul>
<li>
<p>sollicited: sent to the group in v2, sent to 224.0.0.22 in v3</p>
</li>
<li>
<p>unsollicited</p>
</li>
</ul>
</div>
</li>
<li>
<p>Leave Group messages</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_default_igmp_configuration">44.2.3. Default IGMP Configuration</h4>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 54.5454%;">
<col style="width: 45.4546%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Default Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version 2 on all interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP query timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60 seconds on all interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP maximum query response time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 seconds on all interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multilayer switch as a member of a multicast group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No group memberships are defined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to multicast groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All groups are allowed on an interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP host-query message interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60 seconds on all interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multilayer switch as a statically connected member</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Display Multicast-Related Information About an Interface.</div>
<div class="content">
<pre># show ip igmp interface [interface-id]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_igmp_version">44.2.4. IGMP Version</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">v1</dt>
<dd>
<p>RFC 1112</p>
<div class="ulist">
<ul>
<li>
<p>general membership queries</p>
</li>
<li>
<p>join</p>
</li>
<li>
<p>implicit leave</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">v2</dt>
<dd>
<p>RFC 2236</p>
<div class="ulist">
<ul>
<li>
<p>group-specific queries</p>
</li>
<li>
<p>explicit leave group process</p>
</li>
<li>
<p>explicit max response time field</p>
</li>
<li>
<p>querier election</p>
</li>
<li>
<p>Backward compatible with v1</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">v3</dt>
<dd>
<p>RFC 3376</p>
<div class="ulist">
<ul>
<li>
<p>source filtering SSM</p>
</li>
<li>
<p>uses 224.0.0.22 for membership reports</p>
</li>
<li>
<p>Backward compatible with v1 and v2</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Specify the IGMP Version</div>
<div class="content">
<pre>(config-if)# ip igmp version {1 | 2 | 3}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Return to the Default Version</div>
<div class="content">
<pre>(config-if)# no ip igmp version</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you change to version 1,
you cannot configure the <strong>ip igmp query-interval</strong>
or the <strong>ip igmp query-max-response-time</strong> interface configuration commands.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_querier_election">44.2.5. Querier Election</h4>
<div class="ulist">
<ul>
<li>
<p>Selects preferred router to send Query messages when multiple routers are connected on the same subnet</p>
</li>
<li>
<p>Each IGMPv2 router sends general query message to 224.0.0.1 with its interface source address.</p>
</li>
<li>
<p>The router stops upon receiption of query messages with lowest IP address
&#8594; The router with the lowest IP address wins</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_igmpv2_query_timeout">44.2.6. IGMPv2 Query Timeout</h4>
<div class="ulist">
<ul>
<li>
<p>period of time before the router takes over as the querier for the interface.</p>
</li>
<li>
<p>By default, the router waits twice the query interval.  After that time, if
the router has received no queries, it becomes the querier.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ip igmp querier-timeout &lt;60-300-seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maximum_response_time_field">44.2.7. Maximum Response Time Field</h4>
<div class="ulist">
<ul>
<li>
<p>v1, fixed at 10 seconds</p>
</li>
<li>
<p>v2, can be changed to control the burstiness of the response process especially with large number of active routers.</p>
</li>
<li>
<p>Increasing the maximum response timer value also increases the leave latency;
the query router must now wait longer to make sure there are no more hosts for the group on the subnet.</p>
</li>
<li>
<p>Default:10 seconds, range: 1..25.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Change the Maximum Response Time Field</div>
<div class="content">
<pre>(config-if)# ip igmp query-max-response-time &lt;seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_join_the_club">44.2.8. Join the Club</h4>
<div class="listingblock">
<div class="title">Task: Join a Specified Group</div>
<div class="content">
<pre>(config-if)# ip igmp join-group &lt;address&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Join a Specified (S,G) Channel</div>
<div class="content">
<pre>(config-if)# ip igmp join-group &lt;address&gt; source &lt;a.b.c.d&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the Multicast Groups That Are Directly Connected to the Multilayer Switch and That Were Learned Through IGMP.</div>
<div class="content">
<pre># sh ip igmp groups [group-name | group-address | type number]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Forward Multicast Packet Without Accepting Them</div>
<div class="content">
<pre>(config-if)# ip igmp static-group</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This method allows fast switching.
The outgoing interface appears in the IGMP cache,
but the switch itself is not a member,
as evidenced by lack of an L (local) flag in the multicast route entry.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ip igmp static-group</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_leave_process">44.2.9. Leave Process</h4>
<div class="ulist">
<ul>
<li>
<p>in v1, implicit exit</p>
</li>
<li>
<p>in v2,</p>
<div class="ulist">
<ul>
<li>
<p>host send leave group message to group address,</p>
</li>
<li>
<p>querier send <strong>igmp-last-member-query-count</strong> group-specific queries at <strong>igmp-last-member-interval</strong> milliseconds</p>
</li>
<li>
<p>querier stops forwarding for the group if no reply within timeout period</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Last Member Query Interval</div>
<div class="content">
<pre>(config-if)# ip igmp last-member-query-interval &lt;milliseconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Last Member Query Count</div>
<div class="content">
<pre>(config-if)# ip igmp last-member-query-count &lt;1-7&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Minimize the Leave Latency When Only One IGMPv2 Receiver Is Connected to the Interface</div>
<div class="content">
<pre>(config-if)# ip igmp immediate-leave group-list &lt;acl&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Can also be in global mode but not combined with the interface mode
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_igmp_message_restriction">44.2.10. IGMP Message Restriction</h4>
<div class="listingblock">
<div class="title">Task: Restrict Receivers on a Subnet to Join Only Certain Multicast Groups</div>
<div class="content">
<pre>(config-if)# ip igmp access-group &lt;standard-acl&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Restrict Receivers on a Subnet to Join  Multicast Groups from Specific Sources</div>
<div class="content">
<pre>(config-if)# ip igmp access-group &lt;extended-acl&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_igmp_proxy">44.2.11. IGMP Proxy</h4>
<div class="ulist">
<ul>
<li>
<p>enables hosts in a unidirectional link routing (UDLR) environment that are not
directly connected to a downstream router to join a multicast group sourced
from an upstream network.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/igmp-udlr.png" alt="UDL scenario">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Before you can see how this optimization improves multicast performance, you
need to explore what a UDL routing scenario actually is. UDL creates a
scenario that would normally be an issue for standard multicast and unicast
routing protocols because of the fact that these routing protocols forward
data on interfaces from which they have received routing control information.
This model works only on bidirectional links for most existing routing
protocols like those that we have discussed thus far; however, some networks
use broadcast satellite links, which are by their very nature unidirectional.
For networks that use broadcast satellite links, accomplishing two-way
communication over broadcast satellite links presents a problem in terms of
discovering and sharing knowledge of a network topology through traditional
protocols like OSPF or Enhanced Interior Gateway Routing Protocol (EIGRP).
This impacts Protocol Independent Multicast (PIM) operation because of PIM
reliance on these protocols.</p>
</li>
<li>
<p>Specifically, in unicast routing, when a router receives an update message on
an interface for a prefix, it forwards data for destinations that match that
prefix out that same interface. This is the case in distance vector routing
protocols like EIGRP. Similarly, in multicast routing, when a router receives
a Join message for a multicast group on an interface, it forwards copies of
data destined for that group out that same interface. Based on these
principles, existing unicast and multicast routing protocols cannot be
supported over UDLs. UDLR was designed to enable the operation of routing
protocols over UDLs without changing the routing protocols themselves.</p>
</li>
<li>
<p>Read more at  “Configuring Unidirectional Link Routing” documentation at Cisco.com or visit the following URL: <a href="http://tinyurl.com/CiscoUDLR" class="bare">http://tinyurl.com/CiscoUDLR</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_cgmp">44.2.12. CGMP</h4>
<div class="paragraph">
<p>TODO: Create a seperate files for CGMP and IGMP snooping ?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cisco proprietary</p>
</li>
<li>
<p>Layer 2 protocol, well-known MAC 0X0100.0CDD.DDDD</p>
</li>
<li>
<p>configured on both the cisco router and switch.</p>
</li>
<li>
<p>permits routers to communicate L2 info it has learned from IGMP to switches</p>
</li>
<li>
<p>Only routers send CGMP messages while switches only listens to CGMP messages</p>
</li>
<li>
<p>helps switches send group traffic to only those hosts that want it &#8594; no wasted bandwidth</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_message_format_3">Message Format</h5>
<div class="ulist">
<ul>
<li>
<p>GDA: Group Destination Address</p>
</li>
<li>
<p>USA: Unicast Source Address</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">CGMP Messages</div>
<p>,==
Type  , GDA       , USA        , Description</p>
</div>
<div class="paragraph">
<p>Join  , Group MAC , Host MAC   , Add USA port to group
Leave , Group MAC , Host MAC   , Delete USA port from group
Join  , Zero      , Router MAC , Learn which port connects to the CGMO router
Leave , Zero      , Router MAC , Release CGMP router port
Leave , Group MAC , Zero       , Delete the group from the CAM
Leave , Zero      , Zero       , Delete all groups from the CAM</p>
</div>
<div class="paragraph">
<p>,==</p>
</div>
<div class="listingblock">
<div class="title">Task: Clear All the CGMP Entries on the Switches</div>
<div class="content">
<pre># clear ip cgmp</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_process">Process</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When a CGMP-capable router gets connected to the switch, it sends a CGMP Join
message with the GDA set to 0 and the USA set to its own MAC address.
The CGMP-capable switch now knows that a multicast router is connected to the port
on which it received the router’s CGMP message. The router repeats the message
every 60 seconds. A router can also tell the switch that it no longer
participates in CGMP by sending a CGMP Leave message with the GDA set to 0 and
the USA set to its own MAC address.</p>
</li>
<li>
<p>When a host joins a group, it sends an IGMP Join message. Normally, a
multicast router examines only Layer 3 information in the IGMP Join message,
and the router does not have to process any Layer 2 information. However, when
CGMP is configured on a router, the router also examines the Layer 2
destination and source MAC addresses of the IGMP Join message. The source
address is the unicast MAC address of the host that sent the IGMP Join message.
The router then generates a CGMP Join message that includes the multicast MAC
address associated with the multicast IP address (to the GDA field of the CGMP
join) and the unicast MAC address of the host (to the USA field of the CGMP
message). The router sends the CGMP Join message using the well-known CGMP
multicast MAC address 0x0100.0cdd.dddd as the destination address.</p>
</li>
<li>
<p>When switches receive a CGMP Join message, they search in their CAM tables
for the port number associated with the host MAC address listed in the USA
field. Switches create a new CAM table entry (or use an existing entry if it
was already created before) for the multicast MAC address listed in the GDA
field of the CGMP Join message, add the port number associated with the host
MAC address listed in the USA field to the entry, and forward the group traffic
on the port.</p>
</li>
<li>
<p>When a host leaves a group, it sends an IGMP Leave message. The router
learns the host’s unicast MAC address (USA) and the IP multicast group it has
just left. Because the Leave messages are sent to the All Multicast Routers MAC
address 0x0100.5e00.0002 and not to the multicast group address the host has
just left, the router calculates the multicast MAC address (GDA) from the IP
multicast group the host has just left. The router then generates a CGMP Leave
message, copies the multicast MAC address it has just calculated in the GDA
field and unicast MAC address in the USA field of the CGMP Leave message, and
sends it to the well- known CGMP multicast MAC address.</p>
</li>
<li>
<p>When switches receive a CGMP Leave message, they again search for the port
number associated with the host MAC address listed in the USA field. Switches
remove this port from the CAM table entry for the multicast MAC address listed
in the GDA field of the CGMP Leave message and stop forwarding the group
traffic on the port.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rgmp">44.2.13. RGMP</h4>
<div class="ulist">
<ul>
<li>
<p>Router-Port Group Management Protocol</p>
</li>
<li>
<p>Proprietary with informational RFC 3488</p>
</li>
<li>
<p>Layer 2</p>
</li>
<li>
<p>doesn&#8217;t work with CGMP</p>
</li>
<li>
<p>works well with ICMP snooping</p>
<div class="ulist">
<ul>
<li>
<p>IGMP snooping helps switches control distribution of multicast traffic on
ports where multicast hosts are connected, but it does not help switches
control distribution of multicast traffic on ports where multicast routers
are connected.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_operations_2">Operations</h5>
<div class="ulist">
<ul>
<li>
<p>When RGMP is enabled on a router, the router sends RGMP Hello messages by
default every 30 seconds. When the switch receives an RGMP Hello message, it
stops forwarding all multicast traffic on the port on which it received the
Hello message.</p>
</li>
<li>
<p>When the router wants to receive traffic for a specific multicast group, the
router sends an RGMP Join G message, where G is the multicast group address,
to the switch. When the switch receives an RGMP Join message, it starts
forwarding the requested group traffic on the port on which it received the
Hello message.</p>
</li>
<li>
<p>When the router does not want to receive traffic for a formerly RGMP-joined
specific multicast group, the router sends an RGMP Leave G message, where G
is the multicast group address, to the switch. When the switch receives an
RGMP Leave message, it stops forwarding the group traffic on the port on
which it received the Hello message.</p>
</li>
<li>
<p>When RGMP is disabled on the router, the router sends an RGMP Bye message to
the switch. When the switch receives an RGMP Bye message, it starts
forwarding all IP multicast traffic on the port on which it received the
Hello message.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable RGMP</div>
<div class="content">
<pre>(config-if)# ip rgmp</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_igmp_filtering_and_throttling">44.2.14. IGMP Filtering and Throttling</h4>
<div class="ulist">
<ul>
<li>
<p>configures and apply IGMP profiles on a SVI, a per-port, or a per-port per-VLAN basis</p>
</li>
<li>
<p>works only with IGMP snooping active globally or on the port</p>
</li>
<li>
<p>When an IGMP packet is received, IGMP filtering uses the filters configured
by the user to determine whether the IGMP packet should be discarded or
allowed to be processed by the existing IGMP snooping code.</p>
<div class="ulist">
<ul>
<li>
<p>With IGMP v1/v2, the entire packet is discarded.</p>
</li>
<li>
<p>With IGMPv3 , the packet is rewritten to remove message elements that were denied by the filters.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display IGMP Filtering and Throttling Configuration</div>
<div class="content">
<pre># sh ip igmp profile [&lt;number&gt;]</pre>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_profiles">IGMP Profiles</h5>
<div class="listingblock">
<div class="title">Task: Configure IGMP Profile</div>
<div class="content">
<pre>(config)# ip igmp profile &lt;number&gt;
(config-profile)# {permit | deny}
(config-profile)# range &lt;low-mcast-ip-address&gt; [&lt;high-mcast-ip-address&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Apply IGMP Profile</div>
<div class="content">
<pre>(config-if)# ip igmp filter &lt;profile-number&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>applicable only to Layer 2 access ports (no routed ports, SVIs, or physical port belonging to EtherChannel  );</p>
</li>
<li>
<p>only one profile per interface</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_maximum_number_of_igmp_groups">Maximum Number Of IGMP Groups</h5>
<div class="listingblock">
<div class="title">Task: Set the Maximum Number Of IGMP Groups</div>
<div class="content">
<pre>(config-if)# ip igmp max-groups &lt;number&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_throttling_action">IGMP Throttling Action</h5>
<div class="ulist">
<ul>
<li>
<p>When an interface receives an IGMP report and the maximum number of entries is in the forwarding table,
specify the action that the interface takes:</p>
<div class="ulist">
<ul>
<li>
<p>deny : Drop the report.</p>
</li>
<li>
<p>replace : Replace the existing group with the new group for which the IGMP report was received.</p>
</li>
</ul>
</div>
</li>
<li>
<p>works only if the maximum number of IGMP groups have been configured</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>– If the throttling action is <strong>deny</strong>,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the entries that were previously in the forwarding table are aged out.</p>
</li>
<li>
<p>After these entries are aged out and the maximum number of entries is in the
forwarding table, the switch drops the next IGMP report received on the
interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>– If the throttling action is <strong>replace</strong>,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the entries that were previously in the forwarding table are removed.</p>
</li>
<li>
<p>When the maximum number of entries is in the forwarding table,
the switch replaces a randomly selected entry with the received IGMP report.</p>
<div class="ulist">
<ul>
<li>
<p>To prevent the switch from removing the forwarding-table entries,
configure the IGMP throttling action before an interface adds entries to the
forwarding table.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure IGMP Throttling Action</div>
<div class="content">
<pre>(config-if)# ip igmp max-groups action {deny | replace}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_igmp_snooping">44.2.15. IGMP Snooping</h4>
<div class="ulist">
<ul>
<li>
<p>Problem: L2 switch forwards multicast packets to all interfaces &#8594; wasted traffic</p>
</li>
<li>
<p>Solution: Tracks IGMP messages (Join/Leave) to only forward invites to interested parties.</p>
<div class="ulist">
<ul>
<li>
<p>Add ports when receiving Join message</p>
</li>
<li>
<p>Delete ports when Leave messages or no membership reports from clients</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 20. Default IGMP Snooping Configuration</caption>
<colgroup>
<col style="width: 54.5454%;">
<col style="width: 45.4546%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Default Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP snooping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled globally and per VLAN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None configured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast router learning method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIM-DVMRP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP snooping Immediate Leave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None configured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCN flood query count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCN query solicitation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP snooping querier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP report suppression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Display IGMP Snooping Information</div>
<div class="content">
<pre># sh ip igmp snooping</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable IGMP Snooping Globally</div>
<div class="content">
<pre>(config)# no ip igmp snooping</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable VLAN Snooping</div>
<div class="content">
<pre>(config)# ip igmp snooping vlan &lt;1-1001,1006-4094&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Change the Snooping Method</div>
<div class="content">
<pre>(config)# ip igmp snooping vlan &lt;vlan-id&gt; mrouter learn {cgmp | pim-dvmrp}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multicast_router_port">44.2.16. Multicast Router Port</h4>
<div class="listingblock">
<div class="title">Task: Add a Multicast Router Port</div>
<div class="content">
<pre>(config)# ip igmp snooping vlan &lt;id&gt; mrouter interface &lt;type-number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify That IGMP Snooping Is Enabled on the VLAN Interface</div>
<div class="content">
<pre>(config)# sh ip igmp snooping mrouter vlan &lt;id&gt;</pre>
</div>
</div>
<div class="sect4">
<h5 id="_statically_join_a_group">Statically Join a Group</h5>
<div class="listingblock">
<div class="title">Task: Add a L2 Port to Join a Group</div>
<div class="content">
<pre>ip igmp snooping vlan &lt;vlan-id&gt; static &lt;ip-address&gt; interface &lt;type number&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hosts or L2 ports normally join multicast groups dynamically
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Verify the Member Port and the IP Address</div>
<div class="content">
<pre># sh ip igmp snooping groups</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_immediate_leave">IGMP Immediate Leave</h5>
<div class="listingblock">
<div class="title">Task: Remove a Port Immediately When It Detects an IGMPv2 Leave Message</div>
<div class="content">
<pre>(config)# ip igmp snooping vlan &lt;id&gt; immediate-leave</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_leave_timer">IGMP Leave Timer</h5>
<div class="listingblock">
<div class="title">Task: Configure the IGMP Leave Timer Globally</div>
<div class="content">
<pre>ip igmp snooping last-member-query-interval &lt;milliseconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the IGMP Leave Timer on the VLAN Interface</div>
<div class="content">
<pre>ip igmp snooping vlan &lt;id&gt; last-member-query-interval &lt;milliseconds&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_tcn_events">TCN Events</h5>
<div class="ulist">
<ul>
<li>
<p>when the client changed its loaction and the receiver is on same port that was blocked but is now forwarding,</p>
</li>
<li>
<p>when a port went down without sending a leave message.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Control the Multicast Flooding Time After a TCN Event</div>
<div class="content">
<pre>(config)# ip igmp snooping tcn flood query count &lt;1-2-10&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Speed the Process Of Recovering from the Flood Mode Caused by a TCN Event.</div>
<div class="content">
<pre>(config)# ip igmp snooping tcn query solicit</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>When a topology change occurs, the spanning-tree root sends a IGMP global leave with group 0.0.0.0.</p>
</li>
<li>
<p>however, after <strong>ip igmp snooping tcn query solicit</strong> command,
the switch sneds the global leave message whether or not it is the spanning-tree root.</p>
</li>
<li>
<p>When the router receives this special leave, it immediately sends general queries,
which expedite the process of recovering from the flood mode during the TCN event.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Disable the Flooding Of Multicast Traffic During a TCN Event</div>
<div class="content">
<pre>(config-if)# no ip igmp snooping tcn flood</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>When the swith receives a TCN, multicast traffic is flooded to all the ports until 2 general queries are received.</p>
</li>
<li>
<p>If the switch has many ports with attached hosts subscribed to many groups,
this flooding might exceed the capacity of the link and cause packet loss.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_snooping_querier">IGMP Snooping Querier</h5>
<div class="listingblock">
<div class="title">Task: Enable IGMP Snooping Querier</div>
<div class="content">
<pre>(config)# ip igmp snooping querier
(config)# ip igmp snooping querier address &lt;ip.ad.re.ss&gt;
(config)# ip igmp snooping querier query-interval &lt;seconds&gt;
(config)# ip igmp snooping querier tcn query [count &lt;n&gt; | interval &lt;seconds&gt;]
(config)# ip igmp snooping querier timer expiry &lt;seconds&gt;
(config)# ip igmp snooping querier version {1 | 2}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Information About the IP Address and Receiving Port for the Most-Recently Received IGMP Query In the VLAN</div>
<div class="content">
<pre># sh ip igmp snooping querier [vlan &lt;id&gt;] [detail]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_report_suppression">IGMP Report Suppression</h5>
<div class="listingblock">
<div class="title">Task: Disable IGMP Report Suppression</div>
<div class="content">
<pre>(config)# no ip igmp snooping report-suppression</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mvr">44.2.17. MVR</h4>
<div class="ulist">
<ul>
<li>
<p>Multicast VLAN Registration</p>
</li>
<li>
<p>Problem: How to scale multicast traffic accross an Ethernet ring-based SP network</p>
</li>
<li>
<p>Solution : one multicast VLAN shared with subscribers in seperate VLANs</p>
</li>
<li>
<p>Use case: broadcast of multiple TV channels over a service-provider network</p>
</li>
<li>
<p>works with or without IGMP snooping</p>
<div class="ulist">
<ul>
<li>
<p>If both enabled, MVR reacts only to join and leave messages from MVR groups.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 21. Default MVR Configuration</caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Default Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled globally and per interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None configured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query response time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5 second</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast VLAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VLAN 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compatible</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface (per port) default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Neither a receiver nor a source port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immediate Leave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled on all ports</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_mvr_global_parameters">MVR Global Parameters</h5>
<div class="listingblock">
<div class="title">Task: Enable MVR on the Switch</div>
<div class="content">
<pre>(config)# mvr</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Range Of IP Multicast Address on the Switch</div>
<div class="content">
<pre>(config)# mvr group &lt;ip-address&gt; [count]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <strong>count</strong> parameter configure a contiguous series of MVR group addresses. Default= 1 in 1..256</p>
</li>
<li>
<p>Any multicast data sent to the ip address  corresponding to one TV channel
is sent to all source ports on the switch and all interested receiver ports.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Define the Maximum Time to Wait for IGMP Report Memberships on a Receiver Port</div>
<div class="content">
<pre>(config)# mvr querytime &lt;tenths-of-seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the VLAN In Which Multicast Data Is Received</div>
<div class="content">
<pre>(config)# mvr vlan &lt;vlan-id&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>All source ports must belong to this VLAN</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Specify the MVR Mode Of Operation</div>
<div class="content">
<pre>(config)# mvr mode { dynamic | compatible }</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><strong>dynamic</strong>: allows dynamic MVR memberships on source ports.</p>
</li>
<li>
<p><strong>compatible</strong> is the default and does not support ICMP dynamic joins on source ports.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Verify the MVR Global Configuration</div>
<div class="content">
<pre>(config)# sh mvr
(config)# sh mvr members</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mvr_interfaces">MVR Interfaces</h5>
<div class="listingblock">
<div class="title">Task: Configure an MVR Port As Source</div>
<div class="content">
<pre>(config-if)# mvr type source</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Configure uplinks ports that receive and send multicast data as source ports</p>
</li>
<li>
<p>Subscribers cannot be directly connected to source ports</p>
</li>
<li>
<p>All source ports on a switc belong to the single multicast VLAN.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Configure an MVR Port As Receiver</div>
<div class="content">
<pre>(config-if)# mvr type receiver</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Configure a port as a receiver port if it is a subscriber port and should only recieve multicast data.</p>
</li>
<li>
<p>Receiver ports do not receive data unless it becomes a member of the multicast group.</p>
</li>
<li>
<p>Receiver ports cannot belongs to the multicast VLAN.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Statically Configure a Port to Receive Multicast Traffic</div>
<div class="content">
<pre>(config)# mvr vlan &lt;id&gt; group &lt;ip-address&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable the Immediate-Leave Feature Of MVR on the Receiver Port</div>
<div class="content">
<pre>(config)# mvr immediate</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the MVR Interface Configuration</div>
<div class="content">
<pre># sh mvr interface</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display All Receiver and Source Ports That Are Members Of a Multicast Group</div>
<div class="content">
<pre># sh mvr members [group-ip-address]</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_igmp_filtering_and_throttling_2">44.2.18. IGMP Filtering and Throttling</h4>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 22. Default IGMP Filtering Configuration</caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Default Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none applied</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none defined</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profile action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deny the range addresses</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_igmp_profiles_2">IGMP Profiles</h5>
<div class="listingblock">
<div class="title">Task: Configure an IGMP Profile</div>
<div class="content">
<pre>(config)# ip igmp profile &lt;number&gt;
(config-igmp-profile)# permit | deny
(config-igmp-profile)# range &lt;low-ip-address&gt; [&lt;high-ip-address&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Apply IGMP Profile to an Interface</div>
<div class="content">
<pre>(config)# ip igmp filter &lt;profile-number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the Profile Configuration</div>
<div class="content">
<pre># sh ip igmp profile &lt;number&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_throttling">IGMP Throttling</h5>
<div class="listingblock">
<div class="title">Task: Set the Maximum Number Of IGMP Groups That the Interface Can Join</div>
<div class="content">
<pre>(config-if)# ip igmp max-groups &lt;count&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Action That the Interface Takes When It Reaches the Maximum Number Of Entries and Receives a New IGMP Report</div>
<div class="content">
<pre>(config-if)# ip igmp max-groups action {deny | replace }</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pim">44.3. PIM</h3>
<div class="ulist">
<ul>
<li>
<p>Protocol-independent</p>
<div class="ulist">
<ul>
<li>
<p>relies on unicast routing table to perform RPF check</p>
</li>
<li>
<p>needs  <strong>ip multicast-routing</strong> command</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_versions">44.3.1. Versions</h4>
<div class="ulist">
<ul>
<li>
<p>Default= v2 since IOS 11.3</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the PIM Version on the Interface.</div>
<div class="content">
<pre>(config)# ip multicast-routing
(config-if)# ip pim version [1|2]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display Information About Interfaces Configured for PIM.</div>
<div class="content">
<pre>show ip pim interface [type number] [count]</pre>
</div>
</div>
<div class="sect4">
<h5 id="_pimv1">PIMv1</h5>
<div class="ulist">
<ul>
<li>
<p>Supports Auto-RP : eliminates the need to manually configure the rendezvous point in every router.</p>
<div class="ulist">
<ul>
<li>
<p>multiple active RPs for the same group</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_pimv2">PIMv2</h5>
<div class="ulist">
<ul>
<li>
<p>Supports BSR (boot strap router) capability.</p>
</li>
<li>
<p>single, active RP per multicast group, with multiple backup RPs.</p>
</li>
<li>
<p>Sparse mode and dense mode are properties of a group, as opposed to an interface.</p>
</li>
<li>
<p>PIM join and prune messages have more flexible encoding for multiple address families.</p>
</li>
<li>
<p>A more flexible hello packet format replaces the query packet to encode current and future capability options.</p>
</li>
<li>
<p>Register messages to an RP specify whether they are sent by a border router or a designated router.</p>
</li>
<li>
<p>PIM packets are no longer inside IGMP packets; they are standalone packets.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_pimv1_and_pimv2_interoperability">PIMv1 and PIMv2 Interoperability</h5>
<div class="ulist">
<ul>
<li>
<p>You can upgrade to PIMv2 incrementally. PIM Versions 1 and 2 can be configured
on different routers within one network. Internally,
all routers  on a shared media network must run the same
PIM version. Therefore, if a PIMv2 device detects a PIMv1 device, the Version 2
device downgrades itself to Version 1 until all Version 1 devices have been
shut down or upgraded.</p>
</li>
<li>
<p>PIMv2 uses the BSR to discover and announce RP-set information for each group
prefix to all the routers  in a PIM domain.
PIMv1, together with the Auto-RP feature, can perform the same tasks as the PIMv2 BSR.</p>
<div class="ulist">
<ul>
<li>
<p>When PIMv2 devices interoperate with PIMv1 devices, Auto-RP should have already
been deployed. A PIMv2 BSR that is also an Auto-RP mapping agent automatically
advertises the RP elected by Auto-RP. That is, Auto-RP sets its single RP on
every router  in the group. Not all routers and switches in
the domain use the PIMv2 hash function to select multiple RPs.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dense-mode groups in a mixed PIMv1 and PIMv2 region need no special
configuration; they automatically interoperate.</p>
</li>
<li>
<p>Sparse-mode groups in a mixed PIMv1 and PIMv2 region are possible because the
Auto-RP feature in PIMv1 interoperates with the PIMv2 RP feature. Although all
PIMv2 devices can also use PIMv1, we recommend that the RPs be upgraded to
PIMv2 (or at least upgraded to PIMv1 in the Cisco IOS Release 11.3 software).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ease the transition to PIMv2, we have these recommendations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use Auto-RP throughout the region.</p>
</li>
<li>
<p>Configure sparse-dense mode throughout the region.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_modes_3">44.3.2. Modes</h4>
<div class="ulist">
<ul>
<li>
<p>dense mode (DM)</p>
</li>
<li>
<p>sparse mode (SM)</p>
</li>
<li>
<p>sparse-dense mode (PIM DM-SM) : recommended</p>
</li>
<li>
<p>By default, no mode is configured.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable a PIM Mode on the Interface.</div>
<div class="content">
<pre>(config-if)# pim {dense-mode | sparse-mode | sparse-dense-mode }</pre>
</div>
</div>
<div class="sect4">
<h5 id="_pim_dm">PIM DM</h5>
<div class="ulist">
<ul>
<li>
<p>employs only SPTs to deliver (S,G) multicast traffic by using a implicit flood and explicit prune method.</p>
<div class="ulist">
<ul>
<li>
<p>A separate SPT exists for every individual source sending to each group.</p>
</li>
<li>
<p>(S,G) identifies an SPT where S is the IP address of the source and G is the multicast group address.</p>
</li>
</ul>
</div>
</li>
<li>
<p>sends prune message to upstream when there are no directly connected members or PIM neighbors present</p>
<div class="ulist">
<ul>
<li>
<p>Prunes have a timeout value associated with them,
after which the PIM DM device puts the interface into the
forwarding state and floods multicast traffic out the interface.</p>
</li>
<li>
<p>sends graft message when a new receiver on a previously pruned branch joins a multicast group</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_pim_sm">PIM SM</h5>
<div class="ulist">
<ul>
<li>
<p>uses shared trees and SPTs to distribute multicast traffic to multicast receivers in the network.</p>
</li>
<li>
<p>needs explicit join towards the RP (Rendez-vous Point)</p>
<div class="ulist">
<ul>
<li>
<p>When a host joins a multicast group using IGMP,
its directly connected PIM SM device sends PIM join messages toward
the RP.</p>
</li>
<li>
<p>This join message travels router-by-router toward the root,
constructing a branch of the shared tree as it goes.</p>
</li>
<li>
<p>The RP keeps track of multicast receivers; it also registers sources through register
messages received from the source&#8217;s first-hop router (designated router DR)
to complete the shared tree path from the source to the receiver. The branches
of the shared tree are maintained by periodic join refresh messages that the
PIM SM devices send along the branch.</p>
</li>
<li>
<p>When using a shared tree, sources must send their traffic to the RP so that the
traffic reaches all receivers. The special notation \*,G, (pronounced star comma
G) is used to represent the tree, where * means all sources and G represents
the multicast group.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In addition to using the shared distribution tree, PIM SM can also use
SPTs. By joining an SPT, multicast traffic is routed directly to the receivers
without having to go through the RP, thereby reducing network latency and
possible congestion at the RP. The disadvantage is that PIM SM devices must
create and maintain (S,G) state entries in their routing tables along with the
(S,G) SPT. This action consumes router resources.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Prune messages are sent up the distribution tree to prune multicast group
traffic. This action permits branches of the shared tree or SPT that were
created with explicit join messages to be torn down when they are no longer
needed. For example, if a leaf router (a router without any downstream
connections) detects that it no longer has any directly connected hosts (or
downstream multicast routers) for a particular multicast group, it sends a
prune message up the distribution tree to stop the flow of unwanted multicast
traffic.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_shared_tree_vs_source_tree">Shared Tree Vs Source Tree</h5>
<div class="paragraph">
<p>By default, members of a group receive data from senders to the group across a
single data-distribution tree rooted at the RP. Figure <a href="#pim_tree">PIM Trees</a> shows this type of
shared-distribution tree. Data from senders is delivered to the RP for
distribution to group members joined to the shared tree.</p>
</div>
<div id="pim_tree" class="imageblock">
<div class="content">
<img src="../images/pim-trees.png" alt="pim trees">
</div>
<div class="title">Figure 52. PIM Trees</div>
</div>
<div class="paragraph">
<p>If the data rate warrants, leaf routers (routers without any downstream
connections) on the shared tree can use the data distribution tree rooted at
the source. This type of distribution tree is called a shortest-path tree or
source tree. By default, the IOS software switches to a source tree upon
receiving the first data packet from a source.</p>
</div>
<div class="paragraph">
<p>This process describes the move from a shared tree to a source tree:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a Receiver Joins a Group; Leaf Router C Sends a Join Message Toward the RP.</p>
</li>
<li>
<p>the RP Puts a Link to Router C In Its Outgoing Interface List.</p>
</li>
<li>
<p>a Source Sends Data; Router a Encapsulates the Data In a Register Message
and sends it to the RP.</p>
</li>
<li>
<p>the RP Forwards the Data Down the Shared Tree to Router C and Sends a Join
message toward the source. At this point, data might arrive twice at Router C,
once encapsulated and once natively.</p>
</li>
<li>
<p>When Data Arrives Natively (Unencapsulated) at the RP, It Sends A
register-stop message to Router A.</p>
</li>
<li>
<p>by Default, Reception Of the First Data Packet Prompts Router C to Send A
join message toward the source.</p>
</li>
<li>
<p>When Router C Receives Data on (S,G), It Sends a Prune Message for The
source up the shared tree.</p>
</li>
<li>
<p>the RP Deletes the Link to Router C from the Outgoing Interface Of (S,G).
The RP triggers a prune message toward the source.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Join and prune messages are sent for sources and RPs. They are sent hop-by-hop
and are processed by each PIM device along the path to the source or RP.
Register and register-stop messages are not sent hop-by-hop. They are sent by
the designated router that is directly connected to a source and are received
by the RP for the group.</p>
</div>
<div class="paragraph">
<p>Multiple sources sending to groups use the shared tree.</p>
</div>
<div class="paragraph">
<p>You can configure the PIM device to stay on the shared tree.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sparse_dense_mode">Sparse-Dense Mode</h5>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pim_designated_routers">44.3.3. PIM Designated Routers</h4>
<div class="ulist">
<ul>
<li>
<p>Senders of multicast traffic announce their existence through register messages
received from the source&#8217;s first-hop router (designated router) and forwarded
to the RP.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PIM routers  send PIM router-query messages to determine
which device will be the DR for each LAN segment (subnet). The DR is
responsible for sending IGMP host-query messages to all hosts on the directly
connected LAN.</p>
</div>
<div class="paragraph">
<p>With PIM DM operation, the DR has meaning only if IGMPv1 is in use. IGMPv1 does
not have an IGMP querier election process, so the elected DR functions as the
IGMP querier. With PIM SM operation, the DR is the device that is directly
connected to the multicast source. It sends PIM register messages to notify the
RP that multicast traffic from a source needs to be forwarded down the shared
tree. In this case, the DR is the device with the highest IP address.</p>
</div>
<div class="paragraph">
<p>The default is 30 seconds. The range is 1 to 65535.</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure the PIM Query Interval</div>
<div class="content">
<pre>ip pim query-interval &lt;seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rendez_vous_points">44.3.4. Rendez-Vous Points</h4>
<div class="ulist">
<ul>
<li>
<p>Receivers of multicast packets use RPs to join a multicast group by using explicit join messages.</p>
</li>
<li>
<p>RPs are not members of the multicast group; rather, they serve as a meeting place for multicast sources and group members.</p>
</li>
<li>
<p>By default, no PIM RP address is configured.</p>
<div class="ulist">
<ul>
<li>
<p>You must configure the IP address of RPs on all routers  (including the RP).</p>
</li>
<li>
<p>If there is no RP configured for a group, the multilayer switch treats the group as dense,
using the dense-mode PIM techniques.</p>
</li>
<li>
<p>A PIM device can use multiple RPs, but only one per group.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Static RP Address</div>
<div class="content">
<pre>ip pim rp-address &lt;RP-IP-address&gt; [&lt;standard-access-list-number&gt;] [override]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>For <strong>access-list-number</strong>, enter an IP standard access list number
from 1 to 99. If no access list is configured, the RP is used for all groups.</p>
</li>
<li>
<p>The <strong>override</strong> keyword means that if there is a conflict between the
RP configured with this command and one learned by Auto-RP or BSR, the RP configured with this command prevails.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Display the RP That Was Selected for the Specified Group.</div>
<div class="content">
<pre># sh ip pim rp-hash group</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display How the Router Learns Of the RP (Through the BSR or the Auto-RP Mechanism).</div>
<div class="content">
<pre># sh ip pim rp [ &lt;group-name&gt; | &lt;group-address&gt; | &lt;mapping&gt; ]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the RP Routers Associated with a Sparse-Mode Multicast Group.</div>
<div class="content">
<pre># sh ip pim rp [ &lt;group-name&gt; | &lt;group-address&gt;]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_auto_rp">44.3.5. Auto-RP</h4>
<div class="ulist">
<ul>
<li>
<p>Cisco proprietary feature</p>
</li>
<li>
<p>eliminates the need to manually configure the rendezvous point (RP) information in every router and multilayer switch in the
network.</p>
</li>
<li>
<p>uses IP multicast to automate the distribution of group-to-RP mappings to all Cisco routers  in a PIM network.</p>
</li>
<li>
<p>Benefits</p>
<div class="ulist">
<ul>
<li>
<p>multiple RPs within a network to serve different group ranges.</p>
</li>
<li>
<p>Multiple RPs serve different group ranges or serve as hot backups of each other.</p>
</li>
<li>
<p>load splitting among different RPs and arrangement of RPs according
to the location of group participants.</p>
</li>
<li>
<p>no inconsistent and  manual RP configurations on every router and multilayer switch</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_candidate_rp">Candidate RP</h5>
<div class="ulist">
<ul>
<li>
<p>Send multicast RP-announce messages to 224.0.1.39 every 60 seconds (default) with holdtime of 180 seconds (defauld)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Another PIM Device to Be the Candidate RP for Local Groups.</div>
<div class="content">
<pre>ip pim send-rp-announce &lt;interface-id&gt; scope &lt;ttl&gt; group-list &lt;access-list-number&gt; interval &lt;seconds&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>For <strong>interface-id</strong>, enter the interface type and number that identifies the RP
address. Valid interfaces include physical ports, port channels, and VLANs.</p>
</li>
<li>
<p>For scope <strong>ttl</strong>, specify the time-to-live value in hops. Enter a hop count that
is high enough so that the RP-announce messages reach all mapping agents in the
network. There is no default setting. The range is 1 to 255.</p>
</li>
<li>
<p>For group-list <strong>access-list-number</strong>, enter an IP standard access list number
from 1 to 99. If no access list is configured, the RP is used for all groups.</p>
</li>
<li>
<p>For interval <strong>seconds</strong>, specify how often the announcement messages must be
sent. The default is 60 seconds. The range is 1 to 16383.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_mapping_agents">Mapping Agents</h5>
<div class="ulist">
<ul>
<li>
<p>listen to RP-announce messages</p>
</li>
<li>
<p>create Group-to-RP mapping cache</p>
</li>
<li>
<p>select highest IP candidate as active RP</p>
</li>
<li>
<p>send Group-to-RP mapping cache in RP-discovery messages to 224.0.1.40 every 60 seconds with 180 seconds holdtime</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure RP Mapping Agent</div>
<div class="content">
<pre>(config)# ip pim send-rp-discovery scope &lt;1..255&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure PIM-SM Interfaces to Use Dense Mode to Flood Auto-RP Traffic to 224.0.1.39 and 224.0.1.40.</div>
<div class="content">
<pre>(config)# ip pim autorp listener</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Prevent Candidate RP Spoofing</div>
<div class="content">
<pre>ip pim rp-announce-filter rp-list &lt;access-list-number&gt; group-list &lt;access-list-number&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Enter this command on each mapping agent in the network.</p>
</li>
<li>
<p>Without this command, all incoming RP-announce messages are accepted by default.</p>
</li>
<li>
<p>For <strong>rp-list</strong> access-list-number, configure an access list of candidate RP
addresses that, if permitted, is accepted for the group ranges supplied in the
group-list access-list-number variable. If this variable is omitted, the filter
applies to all multicast groups.</p>
</li>
<li>
<p>If more than one mapping agent is used, the filters must be consistent across
all mapping agents to ensure that no conflicts occur in the Group-to-RP mapping
information.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Prevent Join Messages to False RPs</div>
<div class="content">
<pre>Switch(config)# ip pim accept-rp 172.10.20.1 1
Switch(config)# access-list 1 permit 224.0.1.39
Switch(config)# access-list 1 permit 224.0.1.40</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Determine whether the <strong>ip pim accept-rp</strong> command was previously configured
throughout the network by using the show running-config privileged EXEC
command. If the <strong>ip pim accept-rp</strong> command is not configured on any device, this
problem can be addressed later. In those routers es already
configured with the <strong>ip pim accept-rp</strong> command, you must enter the command again
to accept the newly advertised RP.</p>
</div>
<div class="paragraph">
<p>To accept all RPs advertised with Auto-RP and reject all other RPs by default,
use the <strong>ip pim accept-rp auto-rp</strong> global configuration command.</p>
</div>
<div class="paragraph">
<p>If all interfaces are in sparse mode, use a default-configured RP to support
the two well-known groups 224.0.1.39 and 224.0.1.40. Auto-RP uses these two
well-known groups to collect and distribute RP-mapping information. When this
is the case and the <strong>ip pim accept-rp auto-rp</strong> command is configured, another <strong>ip
pim accept-rp</strong> command accepting the RP must be configured as follows:</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_pim_routers">PIM Routers</h5>
<div class="ulist">
<ul>
<li>
<p>listen to RP-discovery messages</p>
</li>
<li>
<p>knows with RP to use for groups they support</p>
</li>
<li>
<p>if Group-to-RP expires, select statically configured RP or switch to dense-mode operation</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bootstrap_router">44.3.6. Bootstrap Router</h4>
<div class="ulist">
<ul>
<li>
<p>A BSR provides a fault-tolerant, automated RP discovery and distribution
mechanism that enables routers  to dynamically learn the group-to-RP mappings.</p>
</li>
<li>
<p>eliminates the need to manually configure RP information in every router and switch in the network.</p>
</li>
<li>
<p>uses hop-by-hop flooding of BSR messages to distribute the mapping information</p>
<div class="ulist">
<ul>
<li>
<p>Each router multicasts BSR messages with TTL=1 to all PIM interfaces except the on on which it was received.</p>
</li>
<li>
<p>BSR contains the IP address of the current BSR</p>
</li>
</ul>
</div>
</li>
<li>
<p>elected BSR based on highest (priority, IP address)</p>
</li>
<li>
<p>Candidate RPs send candidate RP advertisements showing the group range for
which they are responsible directly to the BSR, which stores this information
in its local candidate-RP cache. The BSR periodically advertises the contents
of this cache in BSR messages to all other PIM devices in the domain. These
messages travel hop-by-hop through the network to all routers and switches,
which store the RP information in the BSR message in their local RP cache. The
routers and switches select the same RP for a given group because they all use
a common RP hashing algorithm.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display the Elected BSR</div>
<div class="content">
<pre># sh ip pim bsr</pre>
</div>
</div>
<div class="sect4">
<h5 id="_candidate_bsrs">Candidate BSRs</h5>
<div class="paragraph">
<p>You can configure one or more candidate BSRs. The devices serving as candidate
BSRs should have good connectivity to other devices and be in the backbone
portion of the network.</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure Your Multilayer Switch to Be a Candidate BSR.</div>
<div class="content">
<pre>(config)# ip pim bsr-candidate &lt;interface-id&gt; &lt;hash-mask-length&gt; [priority]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>For <strong>interface-id</strong>, enter the interface type and number on this switch from
which the BSR address is derived to make it a candidate. This interface must
be enabled with PIM. Valid interfaces include physical ports, port channels,
and VLANs.</p>
</li>
<li>
<p>For <strong>hash-mask-length</strong>, specify the mask length (32 bits maximum) that is to be
ANDed with the group address before the hash function is called. All groups
with the same seed hash correspond to the same RP. For example, if this value
is 24, only the first 24 bits of the group addresses matter.</p>
</li>
<li>
<p>For <strong>priority</strong>, enter a number from 0 to 255. The BSR with the larger
priority is preferred. If the priority values are the same, the device with
the highest IP address is selected as the BSR. The default is 0.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_multicast_forwarding_and_reverse_path_check">Multicast Forwarding and Reverse Path Check</h5>
<div class="paragraph">
<p>With multicasting, the source is sending traffic to an arbitrary group of hosts
represented by a multicast group address in the destination address field of
the IP packet. To determine whether to forward or drop an incoming multicast
packet, the router  uses a <strong>reverse path forwarding</strong> (RPF)
check on the packet as follows and shown in Figure <a href="#rpf">RPF Check</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the Router  Examines the Source Address Of the Arriving
multicast packet to determine whether the packet arrived on an interface that
is on the reverse path back to the source.</p>
</li>
<li>
<p>If the Packet Arrives on the Interface Leading Back to the Source, the RPF
check is successful and the packet is forwarded to all interfaces in the
outgoing interface list (which might not be all interfaces on the router).</p>
</li>
<li>
<p>If the RPF Check Fails, the Packet Is Discarded.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Some multicast routing protocols, such as DVMRP, maintain a separate multicast
routing table and use it for the RPF check. However, PIM uses the unicast routing table to perform the RPF check.</p>
</div>
<div class="paragraph">
<p>Figure <a href="#rpf">RPF Check</a> shows Gigabit Ethernet interface 0/2 receiving a multicast packet from source 151.10.3.21. A check of the routing table shows that the interface on the reverse path to the source is Gigabit Ethernet interface 0/1, not interface 0/2. Because the RPF check fails, the multilayer switch discards the packet. Another multicast packet from source 151.10.3.21 is received on interface 0/1, and the routing table shows this interface is on the reverse path to the source. Because the RPF check passes, the switch forwards the packet to all interfaces in the outgoing interface list.</p>
</div>
<div id="rpf" class="imageblock">
<div class="content">
<img src="../images/pim-rpf-check.png" alt="pim rpf check">
</div>
<div class="title">Figure 53. RPF Check</div>
</div>
<div class="paragraph">
<p>PIM uses both source trees and RP-rooted shared trees to forward datagrams ;
the RPF check is performed differently for each:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a PIM router  has a source-tree state ( an (S,G) entry is present in the multicast routing table),
it performs the RPF check against the IP address of the source of the multicast packet.</p>
</li>
<li>
<p>If a PIM router  has a shared-tree state (and no explicit source-tree state),
it performs the RPF check on the rendezvous point (RP) address (which is
known when members join the group).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sparse-mode PIM uses the RPF lookup function to determine where it needs to send joins and prunes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(S,G) joins (which are source-tree states) are sent toward the source.</p>
</li>
<li>
<p>(*,G) joins (which are shared-tree states) are sent toward the RP.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DVMRP and dense-mode PIM use only source trees and use RPF as previously described.</p>
</div>
<div class="listingblock">
<div class="title">Task: Display How the Multilayer Switch Is Doing Reverse-Path Forwarding</div>
<div class="content">
<pre># sh ip rpf { &lt;source-address&gt; | &lt;name&gt;}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_neighbor_discovery_2">44.3.7. Neighbor Discovery</h4>
<div class="ulist">
<ul>
<li>
<p>To establish adjacencies, a PIM router  sends PIM hello
messages to the all-PIM-routers multicast group (224.0.0.13) on each of its
multicast-enabled interfaces.</p>
<div class="ulist">
<ul>
<li>
<p>The hello message contains a holdtime, which
tells the receiver when the neighbor adjacency associated with the sender
expires if no more PIM hello messages are received.</p>
</li>
<li>
<p>Keeping track of adjacencies is important for PIM DM operation for building the source
distribution tree.</p>
</li>
</ul>
</div>
</li>
<li>
<p>PIM hello messages are also used to elect the DR (highest IP address) for multi-access networks</p>
<div class="ulist">
<ul>
<li>
<p>With PIM DM operation, the DR has meaning only if IGMPv1 is
in use; IGMPv1 does not have an IGMP querier election process, so the elected
DR functions as the IGMP querier.</p>
</li>
<li>
<p>In PIM SM operation, the DR is the router or switch that is directly connected to the multicast source.
It sends PIM register messages to notify the RP that multicast traffic from a source needs
to be forwarded down the shared tree.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: List the PIM Neighbors</div>
<div class="content">
<pre># sh ip pim neighbor [type number]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Query a Multicast Router  About Which Neighboring Multicast Devices Are Peering with It.</div>
<div class="content">
<pre># mrinfo [ &lt;hostname&gt; | &lt;address&gt;] [ &lt;source-address&gt; | &lt;interface&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display IP Multicast Packet Rate and Loss Information.</div>
<div class="content">
<pre># mstat source [&lt;destination&gt;] [&lt;group&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Trace the Path from a Source to a Destination Branch for a Multicast Distribution Tree for a Given Group.</div>
<div class="content">
<pre># mtrace source [&lt;destination&gt;] [&lt;group&gt;]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_auto_rp_and_bsr_configuration_guidelines">44.3.8. Auto-RP and BSR Configuration Guidelines</h4>
<div class="paragraph">
<p>There are two approaches to using PIMv2. You can use Version 2 exclusively in
your network or migrate to Version 2 by employing a mixed PIM version
environment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If your network is all Cisco routers , you can use either Auto-RP or BSR.</p>
</li>
<li>
<p>If you have non-Cisco routers in your network, you must use BSR.</p>
</li>
<li>
<p>If you have Cisco PIMv1 and PIMv2 routers  and non-Cisco routers, you must use both Auto-RP and BSR.</p>
</li>
<li>
<p>Because bootstrap messages are sent hop-by-hop, a PIMv1 device prevents these
messages from reaching all routers  in your network.
Therefore, if your network has a PIMv1 device in it and only Cisco routers and
multilayer switches, it is best to use Auto-RP.</p>
</li>
<li>
<p>If you have a network that includes non-Cisco routers, configure the Auto-RP
mapping agent and the BSR on a Cisco PIMv2 router . Ensure
that no PIMv1 device is on the path between the BSR and a non-Cisco PIMv2
router.</p>
</li>
<li>
<p>If you have non-Cisco PIMv2 routers that need to interoperate with Cisco PIMv1
routers , both Auto-RP and a BSR are required. We
recommend that a Cisco PIMv2 device be both the Auto-RP mapping agent and the
BSR.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_pim_domain_border">44.3.9. PIM Domain Border</h4>
<div class="paragraph">
<p>As IP multicast becomes more widespread, the chances of one PIMv2 domain
bordering another PIMv2 domain is increasing. Because these two domains
probably do not share the same set of RPs, BSR, candidate RPs, and candidate
BSRs, you need to constrain PIMv2 BSR messages from flowing into or out of the
domain. Allowing these messages to leak across the domain borders could
adversely affect the normal BSR election mechanism and elect a single BSR
across all bordering domains and co-mingle candidate RP advertisements,
resulting in the election of RPs in the wrong domain.</p>
</div>
<div class="listingblock">
<div class="title">Task: Define a PIM Bootstrap Message Boundary for the PIM Domain.</div>
<div class="content">
<pre>(config-if)# ip pim bsr-border</pre>
</div>
</div>
<div class="sect4">
<h5 id="_administratively_scoped_boundary">Administratively-Scoped Boundary</h5>
<div class="ulist">
<ul>
<li>
<p>uses range 239.0.0.0 to 239.255.255.255</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure an Administratively Scope Boundary</div>
<div class="content">
<pre>(config-if)# ip multicast boundary &lt;access-list-number&gt; [filter-autorp]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ttl_scoping">TTL Scoping</h5>
<div class="ulist">
<ul>
<li>
<p>The default TTL value is 0 hops, which means that all multicast packets are
forwarded out the interface. The range is 0 to 255.</p>
</li>
<li>
<p>Only multicast packets with a TTL value greater than the threshold are
forwarded out the interface.</p>
</li>
<li>
<p>You should configure the TTL threshold only on routed interfaces at the
perimeter of the network.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure TTL Scoping</div>
<div class="content">
<pre>(config-if)# ip multicast ttl-threshold &lt;value&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delay_the_use_of_pim_shortest_path_tree">44.3.10. Delay the Use Of PIM Shortest-Path Tree</h4>
<div class="paragraph">
<p>The change from shared to source tree happens when the first data packet
arrives at the last-hop router. This change occurs
because the <strong>ip pim spt-threshold</strong> interface configuration command controls that
timing; its default setting is 0 kbps.</p>
</div>
<div class="paragraph">
<p>The shortest-path tree requires more memory than the shared tree but reduces
delay. You might want to postpone its use. Instead of allowing the leaf router
to immediately move to the shortest-path tree, you can specify that the traffic
must first reach a threshold.</p>
</div>
<div class="paragraph">
<p>You can configure when a PIM leaf router should join the shortest-path tree for
a specified group. If a source sends at a rate greater than or equal to the
specified kbps rate, the multilayer switch triggers a PIM join message toward
the source to construct a source tree (shortest-path tree). If the traffic rate
from the source drops below the threshold value, the leaf router switches back
to the shared tree and sends a prune message toward the source.</p>
</div>
<div class="paragraph">
<p>You can specify to which groups the shortest-path tree threshold applies by
using a group list (a standard access list). If a value of 0 is specified or if
the group list is not used, the threshold applies to all groups.</p>
</div>
<div class="listingblock">
<div class="title">Task: Specify the Threshold That Must Be Reached Before Moving to Shortest-Path Tree</div>
<div class="content">
<pre>ip pim spt-threshold {kbps | infinity} [group-list access-list-number]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>For <strong>kbps</strong>, specify the traffic rate in kilobits per second. The default is 0
kbps. The range is 0 to 4294967.</p>
</li>
<li>
<p>Specify <strong>infinity</strong> if you want all sources for the specified group to use the
shared tree, never switching to the source tree.</p>
</li>
<li>
<p>For group-list <strong>access-list-number</strong>, specify the access list created
in Step 2. If the value is 0 or if the group-list is not used, the threshold
applies to all groups.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshoot_3">44.3.11. Troubleshoot</h4>
<div class="paragraph">
<p>When debugging interoperability problems between PIMv1 and PIMv2, check these
in the order shown:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify RP Mapping with <strong>Sh Ip Pim Rp-Hash</strong> Making Sure That All Systems Agree on the Same RP for the Same Group.</p>
</li>
<li>
<p>Verify Interoperability Between Different Versions Of DRs and RPs. Make Sure
the RPs are interacting with the DRs properly (by responding with
register-stops and forwarding decapsulated data packets from registers).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/ios/12&lt;4t/ip&gt;mcast/configuration/guide/mctlsplt.html#wp1061381">Load splitting IP multicast traffic over ECMP</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_misc">44.3.12. Misc</h4>
<div class="paragraph">
<p>TODO To be added in the text</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 23. PIM Type Code</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hello</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register Stop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Join/Prune</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootstrap</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assert</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Graft</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Graft-Ack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Candidate RP Advertisement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State Refresh</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DF Election</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11-14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unassigned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for extension of type space</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_ssm">SSM</h5>
<div class="listingblock">
<div class="title">Task: Define the Ssm Range Of IP Multicast Addresses</div>
<div class="content">
<pre>(config)# ip pim [vrf &lt;name&gt;] ssm { default | range a&lt;ccess-list-number&gt; }</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>default</strong> defines the ssm range access list to 232/8
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pim_snooping">44.3.13. PIM snooping</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="_pim_stub_routing">44.3.14. PIM stub routing</h4>
<div class="paragraph">
<p>TODO
In a network using PIM stub routing, the only allowable route for IP traffic to the user is through
a switch that is configured with PIM stub routing. PIM passive interfaces are connected to Layer
2 access domains, such as VLANs, or to interfaces that are connected to other Layer 2 devices.
Only directly connected multicast (IGMP) receivers and sources are allowed in the Layer 2
access domains. The PIM passive interfaces do not send or process any received PIM control
packets</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/UDQbL2" class="bare">http://goo.gl/UDQbL2</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mld">44.4. MLD</h3>
<div class="paragraph">
<p>TODO</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IP protocol: 58</p>
</li>
<li>
<p>ipv6</p>
</li>
<li>
<p>hop limit= 1</p>
</li>
<li>
<p>mldv1 &#8592; igmpv2, mldv2 &#8592; igmpv3</p>
</li>
<li>
<p>enabled globally when</p>
<div class="ulist">
<ul>
<li>
<p>pimv6 enabled</p>
</li>
<li>
<p>statically bind a local mcast group</p>
</li>
<li>
<p>link-local group report enabled</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_mld_snooping">44.4.1. MLD Snooping</h4>
<div class="listingblock">
<div class="title">Task: Enable pimv6 snooping</div>
<div class="content">
<pre># sh ipv6 snooping</pre>
</div>
</div>
<div class="paragraph">
<p>TODO</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ND Inspection</p>
</li>
<li>
<p>RA Guard</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_network_optimization">45. Network Optimization</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ip_sla">45.1. IP SLA</h3>
<div class="ulist">
<ul>
<li>
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">Network Mgt</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipsla/configuration/15-mt/sla-15-mt-book.html">IP SLA</span></span> </a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To implement IP SLAs network performance measurement,</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the IP SLAs Responder</p>
</li>
<li>
<p>Configure the Required IP SLAs Operation Type</p>
</li>
<li>
<p>Configure Any Options Available</p>
</li>
<li>
<p>Configure Threshold Conditions</p>
</li>
<li>
<p>Schedule the Operation</p>
</li>
<li>
<p>Run the Operation for a Period Of Time to Gather Statistics</p>
</li>
<li>
<p>Display and Interpret the Results with Cisco CLI or NMS with SNMP</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_ip_slas_operation_types">45.1.1. IP SLAs Operation Types</h4>
<div class="ulist">
<ul>
<li>
<p>ICMP echo, jitter, path echo , path jitter</p>
</li>
<li>
<p>TCP connect</p>
</li>
<li>
<p>UDP echo, jitter</p>
</li>
<li>
<p>VoIP RTP, UDP jitter, gatekeeper registration delay, post-dial delay</p>
</li>
<li>
<p>HTTP, FTP, DNS, DHCP</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Basic IP SLAs ICMP Echo Operation on the Source Device</div>
<div class="content">
<pre>(config)# ip sla &lt;operation-number&gt;
(config-ip-sla)# icmp-echo {&lt;destination-ip-address&gt;| &lt;destination-hostname&gt;}
                    [source-ip {&lt;src-ip&gt; | src-hostname} | source-interface &lt;interface-name&gt;]
(config-ip-sla-echo)# frequency &lt;seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ip_slas_responder">45.1.2. IP SLAs Responder</h4>
<div class="ulist">
<ul>
<li>
<p>for Cisco device only</p>
</li>
<li>
<p>listens on specific port for control protol messages send by IP SLA operation</p>
</li>
<li>
<p>on receipt of the control, open specified TCP or UDP port for specified duration</p>
</li>
<li>
<p>disables the port after reponding to the IP SLA packet or specified timeout</p>
</li>
<li>
<p>may use MD5 authentication for control message</p>
</li>
<li>
<p>takes two timestamps at the target devices to eliminate processing time</p>
</li>
<li>
<p>can track one-way delay, jitter, and directional packet loss</p>
</li>
<li>
<p>requires NTP synchronization except for one-way jitter measurement</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ip-sla-responder-timestamps.png" alt="IP SLA Responder Time Stamping">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ip_slas_operation_scheduling">45.1.3. IP SLAs Operation Scheduling</h4>
<div class="listingblock">
<div class="title">Task: Schedule IP SLA Operation</div>
<div class="content">
<pre>(config)# ip sla schedule &lt;operation-number&gt;
                          [ life {forever} | &lt;seconds&gt; ]
                          [start-time {now | pending | after &lt;hh:mm:ss&gt; | [&lt;hh:mm:ss&gt;]}] [month day | day month } ]
                          [ageout &lt;seconds&gt;]
                          [recurring]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify IP SLA Configuration</div>
<div class="content">
<pre># sh ip sla configuration</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can create a multioperation group</p>
<div class="ulist">
<ul>
<li>
<p>The frequency of all operations scheduled must be the same</p>
</li>
<li>
<p>The list of operation ID numbers must be limited to a max of 125 chars including commas</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Schedule a Group Of IP SLA Operations</div>
<div class="content">
<pre>(config)# ip sla group schedule &lt;group-operation-number&gt; &lt;operation-id-numbers&gt;
                          { schedule-period &lt;schedule-period-range | schedule-together }
                          [ frequency &lt;group-operation-frequency&gt; ]
                          [ life {forever} | &lt;seconds&gt; ]
                          [start-time {now | pending| after &lt;hh:mm:ss&gt; | [&lt;hh:mm:ss&gt;]}] [month day | day month } ]
                          [ageout &lt;seconds&gt;]
                          [recurring]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify IP SLA Multioperation Configuration</div>
<div class="content">
<pre># sh ip sla group schedule</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ip_slas_operation_threshold_monitoring">45.1.4. IP SLAs Operation Threshold Monitoring</h4>
<div class="ulist">
<ul>
<li>
<p>can send SNMP traps that are triggered by connection loss, timeout, round-trip time threshold,
average jitter threshold, one-way packet loss, one-way jitter, one-way mean opinion score, one-way latency</p>
</li>
<li>
<p>can trigger another IP SLA operation</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mpls_vpn_awareness">45.1.5. MPLS VPN Awareness</h4>
<div class="ulist">
<ul>
<li>
<p>IP SLA operations can be configured for a specific VPN</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_history_statistics">45.1.6. History Statistics</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Aggregated statistics
</td>
<td class="hdlist2">
<p>By default, two hours of aggregated
statistics for each operation. Value from each operation cycle is aggregated
with the previously available data within a given hour.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Operation snapshot history
</td>
<td class="hdlist2">
<p>snapshot of data for each
operation instance that matches a configurable filter, such as all, over
threshold, or failures. The entire dataset is available and no aggregation
takes place.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Distribution statistics
</td>
<td class="hdlist2">
<p>frequency distribution over
configurable intervals. Each time IP SLAs starts an operation, a new history
bucket is created until the number of history buckets matches the specified
size or the lifetime of the operation expires. By default, the history for an
IP SLAs operation is not collected. If history is collected, each bucket
contains one or more history entries from the operation. History buckets do not
wrap.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting_tips">45.1.7. Troubleshooting Tips</h4>
<div class="ulist">
<ul>
<li>
<p>If IP SLAs operation is not running and not generating stats,
add the <strong>verify-data</strong> command in ip sla configuration mode</p>
</li>
<li>
<p>Use <strong>debug ip sla trace</strong> and <strong>debug ip sla error</strong> commands</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enhanced_object_tracking">45.2. Enhanced Object Tracking</h3>
<div class="ulist">
<ul>
<li>
<p>separates definition of tracked object vs action to be taken when tracked object change</p>
</li>
<li>
<p>tracked object can be: interface, ip route or ip sla operation or list of objects</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_interface_tracking">45.2.1. Interface Tracking</h4>
<div class="ulist">
<ul>
<li>
<p>can be line protocol or ip route</p>
</li>
<li>
<p>may consider the carrier delay timer</p>
</li>
<li>
<p>may have a delay between the changes and the notification</p>
</li>
<li>
<p>may change the polling frequency</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_interface_line_protocol_tracking">Interface Line Protocol Tracking</h5>
<div class="listingblock">
<div class="title">Task: Track the Line Protocol State Of an Interface</div>
<div class="content">
<pre>(config)# track &lt;object-number&gt; interface &lt;type number&gt; line protocol</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_interface_ip_routing_tracking">Interface IP Routing Tracking</h5>
<div class="ulist">
<ul>
<li>
<p>The IP routing State is up if</p>
<div class="ulist">
<ul>
<li>
<p>ip routing is enable and active on the interface</p>
</li>
<li>
<p>known  ip address ( static, dhcp , ppp/ipcp, unnumbered )</p>
</li>
<li>
<p>interface line protocol up</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Track the IP Routing State Of an Interface</div>
<div class="content">
<pre>(config)# track &lt;object-number&gt; interface &lt;type number&gt; ip routing</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_eot_support_for_carrier_delay">EOT Support for Carrier Delay</h5>
<div class="ulist">
<ul>
<li>
<p>If a link fails, by default there is a two-second timer that must expire
before an interface and the associated routes are declared as being down. If
a link goes down and comes back up before the carrier delay timer expires,
the down state is effectively filtered, and the rest of the software on the
switch is not aware that a link-down event occurred. You can extend the
timer up to 60 seconds.</p>
</li>
<li>
<p>When EOT is configured on an interface, the tracking may detect the interface
is down before a configured carrier-delay timer has expired. This is because
EOT looks at the interface state and does not consider the carrier delay
timer.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: (Optional) Enables EOT to Consider the Carrier-Delay Timer When Tracking the Status Of an Interface.</div>
<div class="content">
<pre>(config-track)# carrier-delay</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: (Optional) Specifies a Period Of Time (In Seconds) to Delay Communicating State Changes Of a Tracked Object.</div>
<div class="content">
<pre>(config-track)# delay {up &lt;seconds&gt; [down &lt;seconds&gt;] | down &lt;seconds [up &lt;seconds&gt;]}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ip_route_tracking">45.2.2. IP Route Tracking</h4>
<div class="ulist">
<ul>
<li>
<p>Up if the route exists in the RIB and the route is accessible</p>
</li>
<li>
<p>polls the ip route state every 15 seconds</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Track an IP Route</div>
<div class="content">
<pre>(config)# track &lt;object-number&gt; ip route &lt;a.b.c.d/prefix&gt; reachability</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task:(Optional) Specifies the Interval In Which the Tracking Process Polls the Tracked Object.</div>
<div class="content">
<pre>(config)# track timer ip route { &lt;seconds&gt; | msec &lt;milliseconds&gt; }</pre>
</div>
</div>
<div class="paragraph">
<p>TODO: scaled metrics</p>
</div>
</div>
<div class="sect3">
<h4 id="_ip_sla_operation_tracking">45.2.3. IP SLA Operation Tracking</h4>
<div class="ulist">
<ul>
<li>
<p>tracks the state or the reachability of IP SLA operations
-</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Track the Reachability Of an IP SLA Host</div>
<div class="content">
<pre>(config)# track &lt;object-number&gt; ip sla &lt;operation-number&gt; reachability</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre># show track 3
Device# show track 3

Track 3
   IP SLA 1 reachability
   Reachability is Up
     1 change, last change 00:00:47
   Latest operation return code: over threshold
   Latest RTT (millisecs) 4
   Tracked by:
     HSRP Ethernet0/1 3</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tracked_list">45.2.4. Tracked List</h4>
<div class="ulist">
<ul>
<li>
<p>can be constructed with</p>
<div class="ulist">
<ul>
<li>
<p>boolean expression</p>
</li>
<li>
<p>treshold and weight</p>
</li>
<li>
<p>treshold and percentage</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure Tracked List Object with a Boolean Expression</div>
<div class="content">
<pre>(config)# track &lt;list-object-number&gt; list boolean {and | or}
(config-track)# object &lt;object-number&gt; [not]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure Tracked List Object with Threshold and Weight</div>
<div class="content">
<pre>(config)# track &lt;list-object-number&gt; list treshold weight
(config-track)# object &lt;object-number&gt; [weight &lt;number]
(config-track)# object &lt;object-number&gt; [weight &lt;number]
(config-track)# treshold weight {up &lt;number&gt; | down &lt;number&gt;| up &lt;number&gt; down &lt;number&gt;  }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure Tracked List Object with Threshold and Percentage</div>
<div class="content">
<pre>(config)# track &lt;list-object-number&gt; list treshold percentage
(config-track)# object &lt;object-number&gt;
(config-track)# object &lt;object-number&gt;
(config-track)# treshold percentage {up &lt;number&gt; | down &lt;number&gt;| up &lt;number&gt; down &lt;number&gt;  }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure Tracked List Default</div>
<div class="content">
<pre>(config-track)# default { delay | object &lt;object-number&gt; | treshold percentage }</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_netflow">45.3. NetFlow</h3>
<div class="ulist">
<ul>
<li>
<p>Cisco IOS application</p>
</li>
<li>
<p>provides statistics on packets flowing through the routing</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_netflow_flows">45.3.1. NetFlow Flows</h4>
<div class="ulist">
<ul>
<li>
<p>unidirectional stream of packets between a given source and destination</p>
</li>
<li>
<p>combination of 7 fields: source/destination IP address/Port number, layer 3 protocol type, ToS, input logical interface</p>
</li>
<li>
<p>can include accounting fields (such as AS number in v5)</p>
</li>
<li>
<p>stored/captured in <strong>netflow cache</strong></p>
</li>
<li>
<p>exported to the flow collector (NetFlow Collection Engine)</p>
</li>
<li>
<p>prerequisites</p>
<div class="ulist">
<ul>
<li>
<p>ip routing</p>
</li>
<li>
<p>cef, dcef or fast switching</p>
</li>
<li>
<p>enough CPU and memory</p>
</li>
</ul>
</div>
</li>
<li>
<p>data capture</p>
<div class="ulist">
<ul>
<li>
<p>from ingress: ip-to-ip, ip-to-mpls, FR and ATM terminated packets</p>
</li>
<li>
<p>for egress: ip-to-ip(with Netflow Accounting), mpls-to-ip (NetFlow MPLS Egress)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable NetFlow Capture</div>
<div class="content">
<pre>(config-if)# ip flow { ingress | egress }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify That NetFlow Is Operational</div>
<div class="content">
<pre># sh ip cache [verbose] flow</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_netflow_version">45.3.2. NetFlow Version</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
v5
</td>
<td class="hdlist2">
<p>-
-</p>
</td>
</tr>
<tr>
<td class="hdlist1">
v9
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>flexible and extensible</p>
</li>
<li>
<p>template based</p>
</li>
<li>
<p>uses 2 flow record type: template flowset, and data flowset</p>
</li>
<li>
<p>v5 and v9 use the same packet structure</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/netflow-packet.png" alt="netflow packet" width="754" height="41">
</div>
</div>
<div class="sect4">
<h5 id="_version_5">Version 5</h5>
<div class="imageblock">
<div class="content">
<img src="../images/netflow-header-v5.png" alt="NetFlow Header Format" width="896" height="344">
</div>
<div class="title">Figure 54. NetFlow Header Format</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/flow-record-v5.png" alt="Flow Record Format" width="896" height="408">
</div>
<div class="title">Figure 55. Flow Record Format</div>
</div>
</div>
<div class="sect4">
<h5 id="_version_9">Version 9</h5>
<div class="imageblock">
<div class="content">
<img src="../images/netflow-header-v9.png" alt="NetFlow Header Format" width="896" height="312">
</div>
<div class="title">Figure 56. NetFlow Header Format</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_netflow_cache">45.3.3. NetFlow Cache</h4>
<div class="ulist">
<ul>
<li>
<p>contains flow record for all active flows.</p>
</li>
<li>
<p>up to 64K flow entries, each cache entry requires 64 bytes</p>
</li>
<li>
<p>removes flows if</p>
<div class="ulist">
<ul>
<li>
<p>flow transport is completed (TCP  FIN or RST )</p>
</li>
<li>
<p>flow cache full</p>
</li>
<li>
<p>flow becomes inactive after 15 seconds</p>
</li>
<li>
<p>flow active for more than 30 minutes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Size Of the NetFlow Cache</div>
<div class="content">
<pre>(config)# ip flow-cache entries &lt;size=64000&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Flow Cache Timeout for Inactive Flow</div>
<div class="content">
<pre>(config)# ip flow-cache timeout inactive &lt;seconds=15&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Flow Cache Timeout for Active Flows</div>
<div class="content">
<pre>(config)# ip flow-cache timeout active &lt;minutes=30&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_netflow_data_export">45.3.4. NetFlow Data Export</h4>
<div class="ulist">
<ul>
<li>
<p>Send NetFlow cache entries to workstation running NetFlow Collection Engine</p>
</li>
<li>
<p>supports only two export destinations</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Export NetFlow Information to a Workstation</div>
<div class="content">
<pre>(config)# ip flow-export destination {&lt;ip-address | hostname} &lt;udp-port&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: (Optional) Use Version 5 Export Format</div>
<div class="content">
<pre>(config)# ip flow-export version 5</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: (Optional) Use Version 9 Export Format</div>
<div class="content">
<pre>(config)# ip flow-export version 9</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify That NetFlow Data Export Is Operational</div>
<div class="content">
<pre># sh ip flow export</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_embedded_event_manager">45.4. Embedded Event Manager</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">Embedded Management</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/eem/configuration/15-mt/eem-15-mt-book/eem-overview.html">Embedded Event Manager Overview</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>in-box, event tracking management</p>
</li>
<li>
<p>EEM Components:</p>
<div class="ulist">
<ul>
<li>
<p>EEM server – an internal process that handles the interaction between the
publishers and subscribers.</p>
</li>
<li>
<p>EEM publisher (detector) – software that screens events, publishes if there is
a policy match. Some of the different detectors are CLI, NetFlow, SNMP, syslog,
timers and counters.</p>
</li>
<li>
<p>EEM subscriber (policy) – defines an event and actions to be taken. There are
two policy types, applets with IOS CLI and scripts written using TCL.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The creation of an EEM policy involves:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Selecting the event for which the policy is run.</p>
</li>
<li>
<p>Defining the event detector options associated with logging and responding to the event.</p>
</li>
<li>
<p>Defining the environment variables, if required.</p>
</li>
<li>
<p>Choosing the actions to be performed when the event occurs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_embedded_packet_capture">45.5. Embedded Packet Capture</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">Embedded Management</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/epc/configuration/15-mt/epc-15-mt-book.html">Embedded Packet Capture</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>onboard packet capture facility</p>
</li>
<li>
<p>captures packets flowing to, through, and from the device</p>
</li>
<li>
<p>to analyze them locally or save and export them for offline analysis by using a tool such as Wireshark.</p>
</li>
<li>
<p>restrictions:</p>
<div class="ulist">
<ul>
<li>
<p>only captures multicast packets on ingress and does not capture the replicated packets on egress.</p>
</li>
<li>
<p>Currently, the capture file can only be exported off the device; for example, TFTP or FTP servers and local disk.</p>
</li>
</ul>
</div>
</li>
<li>
<p>benefits:</p>
<div class="ulist">
<ul>
<li>
<p>Ability to capture IPv4 and IPv6 packets in the CEF path.</p>
</li>
<li>
<p>A flexible method for specifying the capture buffer parameters.</p>
</li>
<li>
<p>Filter captured packets.</p>
</li>
<li>
<p>Methods to decode data packets captured with varying degree of detail.</p>
</li>
<li>
<p>Facility to export the packet capture in PCAP format suitable for analysis using an external tool.</p>
</li>
<li>
<p>Extensible infrastructure for enabling packet capture points.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The network administrator may define the capture buffer size and type
(circular, or linear) and the maximum number of bytes of each packet to
capture. The packet capture rate can be throttled using further
administrative controls. For example, options allow for filtering the packets
to be captured using an Access Control List and, optionally, further defined
by specifying a maximum packet capture rate or by specifying a sampling
interval.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_capture_buffer">45.5.1. Capture Buffer</h4>
<div class="ulist">
<ul>
<li>
<p>area in memory for holding the packet data. You can specify unique names, size and type of the buffer, and configure the buffer to handle incoming data as required.</p>
</li>
<li>
<p>can stored the following types of data are stored in a capture buffer: Packet data, Metadata</p>
<div class="ulist">
<ul>
<li>
<p>The packet data starts from datagramstart and copies a minimum of the per-packet-capture size or datagramsize to the capture buffer.</p>
</li>
<li>
<p>The metadata contains descriptive information about a set of packet data. It contains:</p>
<div class="ulist">
<ul>
<li>
<p>A timestamp of when it is added to a buffer.</p>
</li>
<li>
<p>The direction in which the packet data is transmitted&#8212;&#8203;egress or ingress.</p>
</li>
<li>
<p>The switch path captured.</p>
</li>
<li>
<p>Encapsulation type corresponding to input or output interface to allow the decoding of L2 decoders.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The following actions can be performed on capture buffers:</p>
<div class="ulist">
<ul>
<li>
<p>Define a capture buffer and associate it with a capture point.</p>
</li>
<li>
<p>Clear capture buffers.</p>
</li>
<li>
<p>Export capture buffers for offline analysis. Export writes off the file using one of the supported file transfer options: FTP, HTTP, HTTPS, PRAM, RCP, SCP, and TFTP.</p>
</li>
<li>
<p>Display content of the capture buffers.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Defines a capture buffer</div>
<div class="content">
<pre>(config)# monitor capture buffer &lt;buffer-name&gt;
  [clear
  | export &lt;location&gt;
  | filter access-list {&lt;acl&gt;}
  | limit {allow-nth-pak &lt;nth-packet&gt; | duration &lt;seconds&gt; | packet-count &lt;total-packets&gt; | packets-per-sec &lt;packets&gt;}
  | [max-size &lt;element-size&gt; ] [size &lt;buffer-size]&gt; [circular| linear]
  ]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Export EPC data for analysis</div>
<div class="content">
<pre>(config)# monitor capture buffer &lt;name&gt; export &lt;location&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display EPC data</div>
<div class="content">
<pre># show monitor capture {buffer { &lt;capture-buffer-name&gt; [parameters] | all parameters | merged &lt;capture-buffer-name1&gt; &lt;capture-buffer-name2&gt;}
                        [dump] [filter filter-parameters]
                       }
                       | point {all | capture-point-name}
                       }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre># sh monitor capture buffer PKTRACE  dump

11:13:00.593 EDT Mar 21 2007 : IPv4 Turbo      : Fa2/1 Fa0/1
65B6F500: 080020A2 44D90009 E94F8406 08004500  .. "DY..iO....E.
65B6F510: 00400F00 0000FE01 92AF5801 13025801  .@....~../X...X.
65B6F520: 58090800 4D1A1169 00000000 0005326C  X...M..i......2l
65B6F530: 01CCABCD ABCDABCD ABCDABCD ABCDABCD  .L+M+M+M+M+M+M+M
65B6F540: ABCDABCD ABCDABCD ABCDABCD ABCD00    +M+M+M+M+M+M+M.
11:13:20.593 EDT Mar 21 2007 : IPv4 Turbo      : Fa2/1 Fa0/1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_capture_point">45.5.2. Capture Point</h4>
<div class="ulist">
<ul>
<li>
<p>traffic transit point where a packet is captured and associated with a buffer.</p>
</li>
<li>
<p>must be associate to one and only one capture buffer</p>
</li>
<li>
<p>The following capture points are available:</p>
<div class="ulist">
<ul>
<li>
<p>IPv4 CEF/interrupt switching path with interface input and output</p>
</li>
<li>
<p>IPv6 CEF/interrupt switching path with interface input and output</p>
</li>
</ul>
</div>
</li>
<li>
<p>possible actions on the capture point:</p>
<div class="ulist">
<ul>
<li>
<p>Associate or disassociate capture points with capture buffers.</p>
</li>
<li>
<p>Destroy capture points.</p>
</li>
<li>
<p>Activate packet capture points on a given interface. Multiple packet capture points can be made active on a given interface. For example, Border Gateway Protocol (BGP) packets can be captured into one capture buffer and Open Shortest Path First (OSPF) packets can captured into another capture buffer.</p>
</li>
<li>
<p>Access Control Lists (ACLs) can be applied to capture points.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Define a capture point</div>
<div class="content">
<pre>(config)# monitor capture point {ip| ipv6}
             {cef &lt;capture-point-name&gt; interface-name &lt;interface-type&gt; { both | in | out} | process-switched &lt;capture-point-name&gt; {both| from-us| in | out}}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Associate the capture point with the capture buffer specified.</div>
<div class="content">
<pre>(config)# monitor capture point associate &lt;capture-point-name&gt; &lt;capture-buffer-name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: start  packet data capture</div>
<div class="content">
<pre>(config)# monitor capture point start {&lt;capture-point-name&gt; | all}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Stop packet data capture</div>
<div class="content">
<pre>(config)# monitor capture point stop {&lt;capture-point-name&gt; | all}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable packet capture infra debugs</div>
<div class="content">
<pre># debug packet-capture</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_wireshark_trace_analyzer">45.5.3. Using Wireshark trace analyzer</h4>
<div class="paragraph">
<p>Beginning with Cisco IOS Release XE 3.3.0SG, the Catalyst 4500 series switch supports
Wireshark, a packet analyzer program, also known as Ethereal, which supports multiple
protocols and presents information in a text-based user interface.
The key concepts around IOS XE based wireshark are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Capture points (a capture point is the central policy definition of the Wireshark feature)</p>
</li>
<li>
<p>Attachment points (it refers to Interfaces and traffic directions)</p>
</li>
<li>
<p>Filters (filters are attributes of a capture point that identify and limit the subset of traffic
traveling through the attachment point of a capture point, which is copied and passed to
Wireshark)</p>
</li>
<li>
<p>Actions</p>
</li>
<li>
<p>Storing captured packets to memory buffers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/n67lEF" class="bare">http://goo.gl/n67lEF</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_performance_monitor">45.6. Performance Monitor</h3>
<div class="paragraph">
<p>TODO</p>
</div>
<div class="paragraph">
<p>Cisco performance monitor enables you to monitor the flow of packets in your
network and become aware of any issues that might impact the flow before it
starts to significantly impact the performance of the application in question.
Performance monitoring is especially important for video traffic because high
quality interactive video traffic is highly sensitive to network conditions
(such as packet drops). Even minor issues that may not affect other
applications can have dramatic effects on video quality.</p>
</div>
<div class="paragraph">
<p>Further Reading
<a href="http://goo.gl/UReuBR" class="bare">http://goo.gl/UReuBR</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<h1 id="_part_vi_evolving_technologies" class="sect0">Part VI : Evolving Technologies</h1>
<div class="sect1">
<h2 id="_cloud">46. Cloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IT resources and sces that are abstracted from the underlying infrastructure
and provided <strong>on-demand</strong> and <strong>at scale</strong> in a <strong>multitenant</strong> environment.</p>
</div>
<div class="ulist">
<div class="title">Characteristics</div>
<ul>
<li>
<p>on-demand self-services</p>
</li>
<li>
<p>broad network access</p>
</li>
<li>
<p>resource pooling</p>
</li>
<li>
<p>rapid elasticity</p>
</li>
<li>
<p>measured services</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_compare_and_contrast_cloud_deployment_models">46.1. Compare and Contrast Cloud Deployment Models</h3>
<div class="ulist">
<ul>
<li>
<p>Public</p>
</li>
<li>
<p>Private</p>
</li>
<li>
<p>virtual Private</p>
</li>
<li>
<p>inter-cloud</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_infrastructure_platform_and_software_services_xaas">46.1.1. Infrastructure, Platform, and Software Services [XaaS]</h4>
<div class="ulist">
<ul>
<li>
<p>SaaS : Application sces</p>
</li>
<li>
<p>PaaS: run-time environment and software development frameworks and components  presented as API</p>
</li>
<li>
<p>IaaS: compute, network and storage</p>
</li>
<li>
<p>IT foundation: basic building blocks, core technologies</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_performance_and_reliability">46.1.2. Performance and Reliability</h4>
<div class="paragraph">
<p>add comparisons table here</p>
</div>
</div>
<div class="sect3">
<h4 id="_security_and_privacy">46.1.3. Security and Privacy</h4>
<div class="paragraph">
<p>add comparison table here</p>
</div>
</div>
<div class="sect3">
<h4 id="_scalability_and_interoperability">46.1.4. Scalability and Interoperability</h4>
<div class="paragraph">
<p>add comparison table here</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_describe_cloud_implementations_and_operations">46.2. Describe Cloud Implementations and Operations</h3>
<div class="paragraph">
<p>How to connect to the cloud</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Private WAN (like MPLS L3VPN)</p>
</li>
<li>
<p>Internet Exchange Point (IXP)</p>
</li>
<li>
<p>Internet VPN</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_automation_and_orchestration">46.2.1. Automation and Orchestration</h4>
<div class="ulist">
<ul>
<li>
<p>Automation: single task</p>
</li>
<li>
<p>Orchestration: process/workflow ordered set of tasks glued together with conditions</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_workload_mobility">46.2.2. Workload Mobility</h4>
<div class="ulist">
<ul>
<li>
<p>share workloads accross a collection of resources</p>
</li>
<li>
<p>different from VM mobility</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting_and_management">46.2.3. Troubleshooting and Management</h4>
<div class="ulist">
<ul>
<li>
<p>Scripting languages: Python, Ruby,</p>
</li>
<li>
<p>NETCONF</p>
<div class="ulist">
<ul>
<li>
<p>transport protocol by which configurations are installed and changed</p>
</li>
<li>
<p>RFC 6241</p>
</li>
</ul>
</div>
</li>
<li>
<p>YANG</p>
<div class="ulist">
<ul>
<li>
<p>modeling language used represent device configuration and state (~ XML)</p>
</li>
<li>
<p>RFC 6020</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_openstack_components">46.2.4. OpenStack Components</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Compute (Nova)</dt>
<dd>
<p>Fabric controller (the main part of an IaaS system). Manages pools of computer resources. A compute resource could be a VM, container, or bare metal server. Side note: Containers are similar to VMs except they share a kernel. They are otherwise independent, like VMs, and are considered a lighter-weight yet secure alternative to VMs.</p>
</dd>
<dt class="hdlist1">Networking (Neutron)</dt>
<dd>
<p>Manages networks and IP addresses. Ensures the network is not a bottleneck or otherwise limiting factor in a production environment. This is technology-agnostic network abstraction which allows the user to create custom virtual networks, topologies, subnets, gateway addresses, DNS, etc.</p>
</dd>
<dt class="hdlist1">Block Storage (Cinder)</dt>
<dd>
<p>Manages creation, attaching, and detaching of block storage devices to servers. This is not an implementation of storage itself, but provides as API to access that storage. Many storage appliance vendors often have a Cinder plug-in for OpenStack integration; this ultimately abstracts the vendor-specific user interfaces from the management process. Storage volumes can be detached and moved between instances (an interesting form of file transfer, file example) to share information and migrate data between projects.</p>
</dd>
<dt class="hdlist1">Identity (Keystone)</dt>
<dd>
<p>Directory service contains users mapped to services they can access. Somewhat similar to group policies applied in corporate deployments. Tenants are stored here which allows them to access resources/services within OpenStack; commonly this is access to the OpenStack Dashboard (Horizon) to manage an OpenStack environment.</p>
</dd>
<dt class="hdlist1">Image (Glance)</dt>
<dd>
<p>Provides discovery, registration, and delivery services. These images are like ordinary images to template new virtual services.</p>
</dd>
<dt class="hdlist1">Object Storage (Swift)</dt>
<dd>
<p>Storage system with built-in data replication and integrity. Objects and files are written to disk using this interface which manages the I/O details. Scalable and resilient storage for all objects like files, photos, etc. This means the customer doesn’t have to deploy a block-storage solution themselves, then manage the storage protocols (iSCSI, NFS, etc).</p>
</dd>
<dt class="hdlist1">Dashboard (Horizon)</dt>
<dd>
<p>The GUI for administrators and users to access, provision, and automate resources. The dashboard is based on Python Django framework and is layered on top of service APIs. Logging in relies on Keystone for identity management which secures access to the GUI. The dashboard supports different tenants (business units, groups/teams, customers, etc) with separate permissions and credentials; this is effectively role-based access control. The GUI provides the most basic/common functionality for users without needing CLI access, which is supported for advanced functions. “Security group” abstractions to enforce access control (often need to configure this before being able to access the new instances).</p>
</dd>
<dt class="hdlist1">Orchestration (Heat)</dt>
<dd>
<p>Service to orchestrate multiple cloud applications via templates using a variety of APIs.</p>
</dd>
<dt class="hdlist1">Workflow (Mistral)</dt>
<dd>
<p>Manages user-created workflows which can be triggered manually or by some event.</p>
</dd>
<dt class="hdlist1">Telemetry (Ceilometer)</dt>
<dd>
<p>Provides a Single Point of Contact for billing systems used within the cloud environment.</p>
</dd>
<dt class="hdlist1">Database (Trove)</dt>
<dd>
<p>This is a Database-as-a-service provisioning engine.</p>
</dd>
<dt class="hdlist1">Elastic Map Reduce (Sahara)</dt>
<dd>
<p>Automated way to provision Hadoop clusters, like a wizard.</p>
</dd>
<dt class="hdlist1">Bare Metal (Ironic)</dt>
<dd>
<p>Provisions bare metal machines rather than virtual machines.</p>
</dd>
<dt class="hdlist1">Messaging (Zaqar)</dt>
<dd>
<p>Cloud messaging service for Web Developments (full RESTful API) used to communicate between SaaS and mobile applications.</p>
</dd>
<dt class="hdlist1">Shared File System (Manila)</dt>
<dd>
<p>Provides an API to manage shares in a vendor agnostic fashion (create, delete, grant/deny access, etc).</p>
</dd>
<dt class="hdlist1">DNS (Designate)</dt>
<dd>
<p>Multi-tenant REST API for managing DNS (DNS-as-a-service).</p>
</dd>
<dt class="hdlist1">Search (Searchlight)</dt>
<dd>
<p>Provides search capabilities across various cloud services and is being integrated into the Dashboard.</p>
</dd>
<dt class="hdlist1">Key Manager (Barbican)</dt>
<dd>
<p>Provides secure storage, provisioning, and management of secrets (passwords).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_resources_and_references">46.2.5. Resources and References</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.cisco.com/c/dam/en_us/solutions/industries/docs/gov/CiscoCloudComputing_WP.pdf" class="bare">http://www.cisco.com/c/dam/en_us/solutions/industries/docs/gov/CiscoCloudComputing_WP.pdf</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/OpenStack#Components">Open Stack Components</a></p>
</li>
<li>
<p><a href="http://www.cisco.com/c/en/us/solutions/cloud/overview.html">Cloud Overview</a></p>
</li>
<li>
<p><a href="http://www.unleashingit.com/" class="bare">http://www.unleashingit.com/</a></p>
</li>
<li>
<p><a href="http://www.cisco.com/go/cloud" class="bare">http://www.cisco.com/go/cloud</a></p>
</li>
<li>
<p><a href="https://www.openstack.org/software/" class="bare">https://www.openstack.org/software/</a></p>
</li>
<li>
<p><a href="http://getcloudify.org/2014/07/18/openstack-wiki-open-cloud.html">Designing Networks and Services for the Cloud</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sdn">47. SDN</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SDN: Software-Defined Network</p>
</div>
<div class="ulist">
<ul>
<li>
<p>approach to computer networking that allows network administrators to
programmatically initialize, control, change, and manage network behavior
dynamically via open interfaces and abstraction of lower-level functionality.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_models">47.1. Models</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Distributed</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>control-plane distributed across all devices.</p>
</li>
<li>
<p>the statu quo,  not “SDN” model at all.</p>
</li>
<li>
<p>each network devices have their own control-plane components which rely on distributed routing protocols (such as OSPF, BGP, etc).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Augmented</dt>
<dd>
<p><span class="image" style="float: right"><img src="../images/sdn-augmented.png" alt="Augmented model" width="450" height="450"></span></p>
<div class="ulist">
<ul>
<li>
<p>fully distributed control-plane by adding a centralized controller that can apply policy to parts of the network at will. Such a
controller could inject shorter-match IP prefixes, policy-based routing (PBR),
security features (ACL), or other policy objects.</p>
</li>
<li>
<p>good compromise between distributing intelligence between nodes to prevent singles
points of failure (which a controller introduces) by using a known-good
distributed control-plane underneath. The policy injection only happens when it
“needs to”, such as offloading an overloaded link in a DC fabric or from a
long-haul fiber link between two points of presence (POPs) in an SP core.</p>
</li>
<li>
<p>Examples:</p>
<div class="ulist">
<ul>
<li>
<p>Cisco’s Performance Routing (PfR)</p>
</li>
<li>
<p>offline path computation element (PCE) servers for automated MPLS TE tunnel creation.</p>
</li>
</ul>
</div>
</li>
<li>
<p>lower impact on the existing network because the
wholesale failure of the controller simply returns the network to the
distributed model, which is known to work “well enough” in many cases.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Hybrid</dt>
<dd>
<p><span class="image" style="float: right"><img src="../images/sdn-hybrid.png" alt="Hybrid model" width="450" height="450"></span></p>
<div class="ulist">
<ul>
<li>
<p>like the augmented model except that controller-originated policy can be imposed anywhere in the network.</p>
</li>
<li>
<p>additional granularity to network administrators;</p>
</li>
<li>
<p>the main benefit over the augmented model is that the hybrid model is always topology-independent.</p>
<div class="ulist">
<ul>
<li>
<p>The controller can overwrite the forward table of any device which means that
topological restrictions are removed.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Example: Cisco’s Application Centric Infrastructure (ACI)  separates reachability from policy,
which is critical from both survivability and scalability perspectives.</p>
</li>
<li>
<p>The failure of the centralized control in these models has an identical effect to that of a controller in the augment model;
the network falls back to a distributed control-plane model. The impact of a
failed controller is a little more significant since more devices are affected
by the controller’s policy.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Centralized</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>single controller, which hosts the entire control-plane.</p>
<div class="ulist">
<ul>
<li>
<p>commands all of the devices in the forwarding-plane.</p>
</li>
<li>
<p>writes their forwarding tables with the proper information
(which doesn’t necessarily have to be an IP-based table, it could be anything)
as specified by the administrators.</p>
</li>
</ul>
</div>
</li>
<li>
<p>offers very granular control, in many cases, of individual flows in the network.</p>
</li>
<li>
<p>can use inexpensive hardware forwarders commoditized into white boxes (or branded white boxes, sometimes called brite
boxes)</p>
</li>
<li>
<p>offers more flexibility to the business because  network "device" can be almost anything: router, switch,
firewall, load-balancer, etc. Emulating software functions on generic hardware</p>
</li>
<li>
<p>single point of failure</p>
<div class="ulist">
<ul>
<li>
<p>Some SDN scaling architectures suggest simply
adding additional controllers for fault tolerance or to create a hierarchy of
controllers for larger networks. While this is a valid technique, it somewhat
invalidates the “centralized” model because with multiple controllers, the
distributed control-plane is reborn. The controllers still must synchronize
their routing information using some network-based protocol and the possibility
of inconsistencies between the controllers is real. When using this
multi-controller architecture, the network designer must understand that there
is, in fact, a distributed control-plane in the network; it has just been
moved around. The failure of all controllers means the entire failure domain
supported by those controllers will be inoperable. The failure of the
communication paths between controllers could likewise cause
inconsistent/intermittent problems with forward, just like a fully distributed
control-plane.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Example: OpenFlow</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_describe_functional_elements_of_network_programmability_and_how_they_interact">47.2. Describe Functional Elements Of Network Programmability  and How They Interact</h3>
<div class="sect3">
<h4 id="_controllers">47.2.1. Controllers</h4>
<div class="ulist">
<ul>
<li>
<p>responsible for programming forwarding tables of data-plane devices</p>
</li>
<li>
<p>can be physical routers, like Cisco’s PfR operating as a master controller (MC),
  or they could be software-only appliances, as seen with OpenFlow networks or Cisco’s Application Policy
Infrastructure Controller (APIC) used with ACI.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_apis">47.2.2. APIs</h4>
<div class="ulist">
<ul>
<li>
<p>standard way of interfacing with a software application or operating system.</p>
</li>
<li>
<p>typically use REST (Representational State Transfer)</p>
<div class="ulist">
<ul>
<li>
<p>represents an “architectural style” of transferring information between clients and servers.</p>
</li>
<li>
<p>used with stateless HTTP by combining traditional HTTP methods (GET, POST, PUT, DELETE, etc) and Universal Resource Identifiers (URI).</p>
</li>
<li>
<p>The end result is that API requests look like URIs and are used to fetch/write specific
pieces of data to a target machine.</p>
</li>
<li>
<p>promotes automation, especially for web-based applications or services.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_scripting">47.2.3. Scripting</h4>
<div class="ulist">
<ul>
<li>
<p>Ruby, Python</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TODO ACI Application Centric Infrastructure</p>
</div>
</div>
<div class="sect3">
<h4 id="_agents">47.2.4. Agents</h4>
<div class="ulist">
<ul>
<li>
<p>typically on-box software components that allow an
infrastructure device to report traffic conditions back to the controller.</p>
<div class="ulist">
<ul>
<li>
<p>Given this information, the controller can sense congestion, route
around failures, and perform all manner of fancy traffic-engineering as
required by the business applications.</p>
</li>
</ul>
</div>
</li>
<li>
<p>perform the same general function as SNMP yet offer increased flexibility and granularity as
they are programmable.</p>
</li>
<li>
<p>can be used for non-management purposes, at least from a general view.</p>
</li>
<li>
<p>Interface to the Routing System (I2RS) is an SDN
technique where a specific control-plane agent is required on every data-plane
forwarder.</p>
<div class="ulist">
<ul>
<li>
<p>This agent is effectively the control-plane client that communicates
upstream towards the controller. This is the channel by which the controller
consults its RIB and populates the FIB of the forwarding devices. The same is
true for OpenFlow (OF) which is a fully centralized SDN model. The agent can be
considered an interface to a data-plane forwarder for a control-plane SDN
controller.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A simple categorization method is to quantify management strategies
as “agent based” or “agent-less based”.</p>
<div class="ulist">
<ul>
<li>
<p>Agent is pull-based, which means the agent connects with master. Changes made on master are pulled down when agent
is “ready”. This can be significant since if a network device is currently
tolerating a microburst, the management agent can wait until the contention
abates before passing telemetry data to the master.</p>
</li>
<li>
<p>Agent-less is push-based like SNMP traps, where the triggering of an event on a network device creates a
message for the controller in unsolicited fashion. The other direction also
true; a master can use SSH to access a device for programming whenever the
master is “ready”.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Examples</p>
<div class="ulist">
<ul>
<li>
<p>Puppet: by Puppet labs,  agent-based (requiring software installed on the
client) and pushes complex data structures to managed nodes from the master
server. Puppet manifests are used as data structures to track node state and
display this state to the network operators. Uses Ruby.</p>
</li>
<li>
<p>Chef (by Chef Software): very similar to Puppet in that it requires agents and manages devices using
complex data structures. The concepts of cookbooks and recipes are specific to
Chef (hence the name) which contribute to a hierarchical data structure
management system. A Chef cookbook is loosely equivalent to a Puppet manifest.</p>
</li>
<li>
<p>Ansible (by Redhat): lighter-weight than Puppet or Chef given that management is agent-less. No
custom software needs to be installed on any device provided that it supports
SSH. This can be a drawback since individual device CLIs must be exposed to
network operators (or, at best, the Ansible automation engine) instead of using
a more abstract API design.</p>
</li>
<li>
<p>SaltStack: CLI-based, master-client or non-centralized environments</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_northbound_vs_southbound_protocols">47.2.5. Northbound Vs. Southbound Protocols</h4>
<div class="imageblock">
<div class="content">
<img src="../images/northbound-vs-southbound.png" alt="northbound vs southbound" width="393" height="288">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Northbound interfaces</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>APIs interfaces to existing business applications.</p>
</li>
<li>
<p>used so that applications can make requests of the network,
  which could include specific performance requirements
  (bandwidth, latency, etc). Because the controller “knows” this information by
communicating with the infrastructure devices via management agents, it can
determine the best paths through the network to satisfy these constraints.</p>
</li>
<li>
<p>loosely analogous to the original intent of the Integrated Services QoS
model using Resource Reservation Protocol (RSVP) where applications would
reserve bandwidth on a per-flow basis.</p>
</li>
<li>
<p>It is also similar to MPLS TE constrained SPF (CSPF) where a single device can source-route traffic through
the network given a set of requirements.</p>
</li>
<li>
<p>The logic is being extended to applications with a controller “shim” in between, ultimately providing a full
network view for optimal routing.</p>
</li>
<li>
<p>Typically REST API</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Southbound interfaces</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>include the control-plane protocol between the centralized controller and the
network forwarding hardware. These are the less intelligent network devices
used for forwarding only (assuming a centralized model).</p>
</li>
<li>
<p>Example:OpenFlow</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_describe_aspects_of_virtualization_and_automation_in_network_environments">47.3. Describe Aspects Of Virtualization and Automation In Network Environments</h3>
<div class="ulist">
<ul>
<li>
<p>Creation of virtual topologies using a variety of technologies to achieve a
given business goal. Sometimes these virtual topologies are overlays, sometimes
they are forms of multiplexing, and sometimes they are a combination of the two:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Ethernet VLANs</strong> using 802.1q encapsulation. Often used to create virtual
networks at layer 2 for security segmentation, traffic hair pinning through a
service chain, etc. This is a form of data multiplexing over Ethernet links. It
isn’t a tunnel/overlay since the layer 2 reachability information (MAC address)
remains exposed and used for forwarding decisions.</p>
</li>
<li>
<p><strong>VRF tables or other layer-3 virtualization techniques</strong>.
Similar uses as VLANs except virtualizes an entire routing
instance, and is often used to solve a similar set of problems. Can be combined
with VLANs to provide a complete virtual network between layers 2 and 3. Can be
coupled with GRE for longer-range virtualization solutions over a core network
that may or may not have any kind of virtualization. This is a multiplexing
technique as well but is control-plane only since there is no change to the
packets on the wire, nor is there any inherent encapsulation (not an overlay).</p>
</li>
<li>
<p><strong>Frame Relay DLCI encapsulation</strong>.
Like a VLAN, creates segmentation at layer 2
which might be useful for last-mile access circuits between PE and CE for
service multiplexing. The same is true for Ethernet VLANs when using EV
services such as EV-LINE, EV-LAN, and EV-TREE. This is a data- plane
multiplexing technique specific to frame relay.</p>
</li>
<li>
<p><strong>MPLS VPNs</strong>. Different VPN customers, whether at layer 2 or layer 3, are kept
completely isolated by being placed in a different virtual overlay across a
common core that has no/little native virtualization. This is an example of an
overlay type of virtual network.</p>
</li>
<li>
<p><strong>VXLAN</strong>. Just like MPLS VPNs; creates virtual overlays atop a potentially
non-virtualized core. Doesn’t provide a native control-plane, but that doesn’t
matter; it’s still a virtualization technique. Could be paired with BGP EVPN if
MAC routing is desired. This is another example of an overlay type of virtual
network.</p>
</li>
<li>
<p><strong>OTV</strong>. Just like MPLS VPNs; creates virtual overlays atop a potentially
non-virtualized core, except provides a control-plane for MAC routing. IP
multicast traffic is also routed intelligently using GRE encapsulation with
multicast destination addresses. This is another example of an overlay type of
virtual network.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_devops_methodologies_tools_and_workflows">47.3.1. DevOps Methodologies, Tools and Workflows</h4>
<div class="ulist">
<ul>
<li>
<p>Culture: People over Process over Tools</p>
</li>
<li>
<p>CI/CD: continuous Integration / Continous Deployment</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Everyone can see the changes: Dev, Ops, Quality Assurance (QA), management, etc</p>
</li>
<li>
<p>Verification is an exact clone of the production environment, not simply a smoke-test on a
developer’s test bed</p>
</li>
<li>
<p>The build and deployment/upgrade process is automated</p>
</li>
<li>
<p>Provide SW in short timeframes and ensure releases are always available in increments</p>
</li>
<li>
<p>Reduce friction, increase velocity</p>
</li>
<li>
<p>Reduce silos, increase collaboration</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_network_application_function_virtualization_nfv_afv">47.3.2. Network/Application Function Virtualization [NFV, AFV]</h4>
<div class="paragraph">
<p>NFV and AFV refer to taking specific network functions, virtualizing them, and
assembling them in a sequence to meet a specific business need. NFV and AFV by
themselves, in isolation, are generally synonymous with creating virtual
instances of things which were once physical. Many vendors offer virtual
routers (Cisco CSR1000v, Cisco IOS-XR9000v, etc), security appliances (Cisco
ASAv, Cisco NGIPSv, etc), telephony and collaboration components (Cisco UCM,
CUC, IM&amp;P, UCCX, etc) and many other things that were once physical appliances.
Separating these things into virtual functions allows a wide variety of
organizations, from cloud providers to small enterprises, to select only the
components they require. The following chapter describes a commonly used and
powerful NFV/AFV use case.</p>
</div>
</div>
<div class="sect3">
<h4 id="_service_function_chaining">47.3.3. Service Function Chaining</h4>
<div class="ulist">
<ul>
<li>
<p>service chaining is taking NFV/AFV components and sequencing them to create
some customized “chain of events” to solve a business problem. NFV/AFV by
itself isn’t terribly useful if specific services cannot be easily linked in
a meaningful way. Service chaining, especially in cloud environments, can be
achieved in a variety of technical ways. For example, one organization may
require routing and firewall, while another may require routing and intrusion
prevention. The per- customer granularity is a powerful offering of service
chaining in general. The main takeaway is that all of these solutions are
network virtualization solutions of sorts.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>MPLS and Segment Routing. Some headend LSR needs to impose different MPLS labels for each service in the chain that must be visited to provide a given service. MPLS is a natural choice here given the label stacking capabilities and theoretically-unlimited label stack depth.</p>
</li>
<li>
<p>Networking Services Header (NSH). Similar to the MPLS option except is purpose-built for service chaining. Being purpose-built, NSH can be extended or modified in the future to better support new service chaining requirements, where doing so with MPLS shim header formats is less likely. MPLS would need additional headers or other ways to carry “more” information.</p>
</li>
<li>
<p>Out of band centralized forwarding. Although it seems unmanageable, a centralized controller could simply instruct the data-plane devices to forward certain traffic through the proper services without any in-band encapsulation being added to the flow. This would result in an explosion of core state which could limit scalability, similar to policy-based routing at each hop.</p>
</li>
<li>
<p>Cisco vPath: This is a Cisco innovation that is included with the Cisco Nexus 1000v series switch for use as a distributed virtual switch (DVS) in virtualized server environments. Each service is known as a virtual service node (VSN) and the administrator can select the sequence in which each node should be transited in the forwarding path. Traffic transiting the Nexus 1000v switch is subject to redirection using some kind of overlay/encapsulation technology. Specifically, MAC- in-MAC encapsulation is used for layer-2 tunnels while MAC-in-UDP is used for layer-4 t</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_performance_availability_and_scaling_considerations">47.3.4. Performance, Availability, and Scaling Considerations</h4>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Model</th>
<th class="tableblock halign-left valign-top">Distributed</th>
<th class="tableblock halign-left valign-top">Augmented</th>
<th class="tableblock halign-left valign-top">Hybrid</th>
<th class="tableblock halign-left valign-top">Centralized</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Availability:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dependent on the protocol convergence times and redundancy in the network</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dependent on the protocol convergence times and redundancy in the network. Doesn’t matter how bad the SDN controller is &#8230;&#8203; its failure is tolerable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dependent on the protocol convergence times and redundancy in the network. Doesn’t matter how bad the SDN controller is &#8230;&#8203; its failure is tolerable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heavily reliant on a single SDN controller, unless one adds controllers to split failure domains or to create resilience within a single failure domain (which introduces a distributed control- plane in both cases)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Granularity / control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generally low for IGPs but better for BGP.
All devices generally need a common view of the network to prevent loops independently.
MPLS TE helps somewhat.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Better than distributed
since policy injection can happen at the network edge, or a small set of nodes.
Can be combined with MPLS TE for more granular selection.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moderately granular
since SDN policy decisions are extended to all nodes.
Can influence decisions based on any arbitrary information with a datagram</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Very highly granular;
complete control over all routing decisions based on any arbitrary information with a datagram</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalability (assume flow- based policy and state retention)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Very high in a properly designed network
(failure domain isolation, topology summarization, reachability aggregation, etc)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High, but gets worse with more policy injection.
Policies are generally limited to key nodes (such as border routers)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moderate, but gets worse with more policy injection.
Policy is proliferated across the network to all nodes (though the exact quantity may vary per node)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends;
all devices retain state for all transiting flows.
Hardware- dependent on TCAM and whether SDN can use other tables
such as L4 information, IPv6 flow labels, etc</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ONOS
- Open Network Operating Systems by the Linux Foundation</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internet_of_things">48. Internet Of Things</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>sometimes called Internet of Everything (IoE),</p>
</li>
<li>
<p>concept that many non-person entities (NPEs) or formerly non-networked devices in the world
would suddenly be networked.</p>
<div class="ulist">
<ul>
<li>
<p>typically includes things like window blinds, light bulbs, water treatment plant sensors, home heating/cooling
units, street lights, and anything else that could be remotely controlled or monitored.</p>
</li>
</ul>
</div>
</li>
<li>
<p>substantial business drivers for IoT:</p>
<div class="ulist">
<ul>
<li>
<p>electrical devices (like lights and heaters) could consume less energy by being smartly adjusted
based on changing conditions,</p>
</li>
<li>
<p>window blinds can open and close based on the luminosity of a room,</p>
</li>
<li>
<p>chemical levels can be adjusted in a water treatment plant by networked sensors.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Low-power and Lossy Networks (LLN) describes the vast majority of IoT networks
with the following basic characteristics (incomplete list):</p>
<div class="ulist">
<ul>
<li>
<p>Bandwidth constraints</p>
</li>
<li>
<p>Highly unreliable</p>
</li>
<li>
<p>Limited resources (power, CPU, and memory)</p>
</li>
<li>
<p>Extremely high scale (hundreds of millions and possibly more)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_describe_architectural_framework_and_deployment_considerations_for_iot">48.1. Describe Architectural Framework and Deployment Considerations for IoT</h3>
<div class="imageblock" style="float: right">
<div class="content">
<img src="../images/iot-architecture.png" alt="4 IoT layers" width="500" height="500">
</div>
</div>
<div class="sect3">
<h4 id="_data_center_dc_cloud">48.1.1. Data center (DC) Cloud</h4>
<div class="ulist">
<ul>
<li>
<p>Although not a strict requirement, the understanding that a public cloud
infrastructure exists to support IoT is a common one.</p>
</li>
<li>
<p>A light bulb manufacturer could partner with a networking vendor to develop
network-addressable light bulbs which are managed from a custom application
running in the public cloud. This might be better than a private cloud solution
since, if the application is distributed, regionalized instances could be
deployed in geographically dispersed areas using an “anycast” design for
scalability and performance improvements.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_core_networking_and_services">48.1.2. Core Networking and Services</h4>
<div class="ulist">
<ul>
<li>
<p>transports to connect the public cloud to the sensors</p>
</li>
<li>
<p>can be private WAN, IXP or Internet VPN</p>
</li>
<li>
<p>use a common set of technologies/services:  seen within this layer include IP, MPLS, mobile packet
core, QoS, multicast, security, network services, hosted cloud applications,
big data, and centralized device management (such as a network operations
facility).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_multi_service_edge_access_network">48.1.3. Multi-service Edge (access network)</h4>
<div class="ulist">
<ul>
<li>
<p>Like most SP networks, the access technologies tend to vary greatly based on
geography, cost, and other factors. Access networks can be optically-based to
provide Ethernet handoffs to IoT devices; this would make sense for relatively
large devices that would have Ethernet ports and would be generally immobile.
Mobile devices, or those that are small or remote, might use cellular
technologies such as 2G, 3G, or 4G/LTE for wireless backhaul to the closest
POP. A combination of the two could be used by extending Ethernet to a site and
using 802.11 WIFI to connect the sensors to the WLAN. The edge network may
require use of “gateways” as a short-term solution for bridging (potentially
non-IP) IoT networks into traditional IP networks. The gateways come with an
associated high CAPEX and OPEX since they are custom devices to solve a very
specific use-case. Specifically, gateways are designed to perform some subset
of the following functions, according to Cisco:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Map semantics between two heterogeneous domains: The word semantics in this
context refers to the way in which two separate networks operate and how each
network interprets things. If the embedded systems network is a transparent
radio mesh using a non-standard set of protocols while the multi-service edge
uses IP over cellular, the gateway is responsible for “presenting” common
interfaces to both networks. This allows devices in both networks to
communicate using a “language” that is common to each.</p>
</li>
<li>
<p>Perform translation in terms of routing, QoS security, management, etc: These
items are some concrete examples of semantics. An appropriate analogy for IP
networkers is stateless NAT64; an inside-local IPv4 host must send traffic to
some outside-local IPv4 address which represents an outside-global IPv6
address. The source of that packet becomes an IPv6 inside-global address so
that the IPv6 destination can properly reply.</p>
</li>
<li>
<p>Do more than just protocol changes: The gateways serve as interworking
devices between architectures at an architectural level. The gateways might
have a mechanism for presenting network status/health between layers, and more
importantly, be able to fulfill their architectural role in ensuring end-to-end
connectivity across disparate network types.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_embedded_systems_smart_things_network">48.1.4. Embedded Systems (Smart Things Network)</h4>
<div class="paragraph">
<p>This layer represents the host devices themselves. They can be wired or
wireless, smart or less smart, or any other classification that is useful to
categorize an IoT component. Often times, such devices support zero-touch
provisioning (ZTP) which helps with the initial deployment of massive-scale IoT
deployments. For static components, these components are literally embedded in
the infrastructure and should be introduced during the construction of a
building, factory, hospital, etc. These networks are rather stochastic (meaning
that behavior can be unpredictable). The author classifies wireless devices
into three general categories which help explain what kind of RF-level
transmission methods are most sensible:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Long range: Some devices may be placed very far from their RF base
stations/access points and could potentially be highly mobile. Smart
automobiles are a good example of this; such devices are often equipped with
cellular radios, such as 4G/LTE. Such an option is not optimal for supporting
LLNs given the cost of radios and power required to run them. To operate a
private cellular network, the RF bands must be licensed (in the USA, at least),
which creates an expensive and difficult barrier for entry.</p>
</li>
<li>
<p>Short range with “better” performance: Devices that are within a local area,
such as a building, floor of a large building, or courtyard area, could
potentially use unlicensed frequency bands while transmitting at low power.
These devices could be CCTV sensors, user devices (phones, tablets, laptops,
etc), and other general-purpose things whereby maximum battery life and cost
savings are eclipsed by the need for superior performance. IEEE 802.11 WIFI is
commonly used in such environments. IEEE 802.16 WIMAX specifications could also
be used, but in the author’s experience, it is rare.</p>
</li>
<li>
<p>Short range with “worse” performance: Many IoT devices fall into this final
category whereby the device itself has a very small set of tasks it must
perform, such as sending a small burst of data when an event occurs (i.e., some
nondescript sensor). Devices are expected to be installed one time, rarely
maintained, procured/operated at low cost, and be value-engineered to do very
few things. These devices are less commonly deployed in home environments since
many homes have WIFI; they are more commonly seen spread across cities.
Examples might include street lights, sprinklers, and parking/ticketing meters.
IEEE has defined 802.15.4 to support low-rate wireless personal area networks
(LR-PANS) which is used for many such IoT devices. Note that 802.15.4 is the
foundation for upper-layer protocols such as ZigBee and WirelessHART. ZigBee,
for example, is becoming popular in homes to network some IoT devices, such as
thermostats, which may not support WIFI in their hardware.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>IEEE 802.15.4 is worth a brief discussion by itself. Unlike WIFI, all nodes are
“full-function” and can act as both hosts and routers; this is typical for mesh
technologies. A device called a PAN coordinator is analogous to a WIFI access
point (WAP) which connects the PAN to the wired infrastructure; this
technically qualities the PAN coordinator as a “gateway” discussed earlier.</p>
</div>
<div class="paragraph">
<p>As a general comment, one IoT strategy is to “mesh under” and “route over”.
This loosely follows the 7- layer OSI model by attempting to constrain layers
1-2 to the IoT network, to include RF networking and link-layer communications,
then using some kind of IP overlay of sorts for network reachability.</p>
</div>
</div>
<div class="sect3">
<h4 id="_performance_reliability_and_scalability">48.1.5. Performance, Reliability and Scalability</h4>
<div class="paragraph">
<p>The performance of IoT devices is going to be a result of the desired security
and the access type. Many IoT devices will be equipped with relatively
inexpensive and weak hardware; this is sensible from a business perspective as
the device only needs to perform a few basic functions. This could be seen a
compromise of security since strong ciphers typically require more
computational power for encryption/decryption functionality. In addition, some
IoT devices may be expected to last for decades while it is highly unlikely
that the same is true about cryptographic ciphers. In short, more expensive
hardware is going to be more secure and resilient.</p>
</div>
<div class="paragraph">
<p>The access type is mostly significant when performance is discussed. Although
4G LTE is very popular and widespread in the United States and other countries,
it is not available everywhere. Some parts of the world are still heavily
reliant on 2G/3G cellular service which is less capable and slower. A widely
distributed IoT network may have a combination of these access types with
various levels of performance. Higher performing 802.11 WIFI speeds typically
require more expensive radio hardware, more electricity, and a larger physical
size. Physical access types (wired devices) will be generally immobilized which
could be considered a detriment to physical performance, if mobility is
required for an IoT device to do its job effectively.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mobility">48.1.6. Mobility</h4>
<div class="paragraph">
<p>The mobility of an IoT device is going to be largely determined by its access
method. Devices that are on 802.11 WIFI within a factory will likely have
mobility through the entire factory, or possibly the entire complex, but will
not be able to travel large geographic distances. For some specific
manufacturing work carts (containing tools, diagnostic measurement machines,
etc), this might be an appropriate method. Devices connected via 4G LTE will
have greater mobility but will likely represent something that isn’t supposed
to be constrained to the factory, such as a service truck or van. Heavy
machinery bolted to the factory floor might be wired since it is immobile.</p>
</div>
</div>
<div class="sect3">
<h4 id="_security_and_privacy_2">48.1.7. Security and Privacy</h4>
<div class="paragraph">
<p>Providing security and private for IoT devices is challenging mostly due to the
sheer expanse of the access network and supported clients (IoT devices).
Similar concepts still apply as they would for normal hosts except for needing
to work in a massively scalable and distributed network:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use IEEE 802.1x for wired and wireless authentication for all devices. This is normally tied into a Network Access Control (NAC) architecture which authorizes a set of permissions per device.</p>
</li>
<li>
<p>Encrypt wired and wireless traffic using MACsec/IPsec as appropriate.</p>
</li>
<li>
<p>Maintain physical accounting of all devices, especially small ones, to prevent theft and reverse
engineering.</p>
</li>
<li>
<p>Do not allow unauthorized access to sensors; ensure remote locations are secure also.</p>
</li>
<li>
<p>Provide malware protection for sensors so that the compromise of a single sensor is detected
quickly and suppressed.</p>
</li>
<li>
<p>Rely on cloud-based threat analysis (again, assumes cloud is used) rather than a distributed
model given the size of the IoT access network and device footprint. Sometimes this extension of the cloud is called the “fog” and encompasses other things that product and act on IOT data.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Another discussion point on the topic of security is determining how/where to
“connect” an IoT network. This is going to be determined based on the business
need, as always, but the general logic is similar to what traditional corporate
WANs use:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Fully private connections: Some IoT networks have no legitimate need to be
accessible via the public Internet. Such examples would include Government
sensor networks which may be deployed in a battlefield support capacity. More
common examples might include Cisco’s “Smart Grid” architecture which is used
for electricity distribution and management within a city. Exposing such a
critical resource to a highly insecure network offers little value since the
public works department can likely control it from a dedicated NOC. System
updates can be performed in-house and the existence of the IoT network can be
(and often times, should be) largely unknown by the general population. In
general, IoT networks that fall into this category are “producer-oriented”
networks.</p>
</li>
<li>
<p>Public Internet: Other IoT networks are designed to have their information
shared or made public between users. One example might be a managed thermostat
service; users can log into a web portal hosted by the service provider to
check their home heating/cooling statistics, make changes, pay bills, request
refunds, submit service tickets, and the like. Other networks might be
specifically targeted to sharing information publicly, such as fitness watches
that track how long an individual exercises. The information could be posted
publicly and linked to one’s social media page so others can see it. A more
practical and useful example could include public safety information via a web
portal hosted by the Government. In general, IoT networks that fall into this
category are “consumed-oriented” networks.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_standards_and_compliance">48.1.8. Standards and Compliance</h4>
<div class="paragraph">
<p>Controlling access and identifying areas of responsibility can be challenging
with IoT. Cisco provides the following example: For example, Smart Traffic
Lights where there are several interested parties such as Emergency Services
(User), Municipality (owner), Manufacturer (Vendor). Who has provisioning
access? Who accepts Liability?</p>
</div>
<div class="paragraph">
<p>There is more than meets the eye with respect to standards and compliance for
street lights. Most municipalities (such as counties or townships within the
United States) have ordinances that dictate how street lighting works. The
light must be a certain color, must not “trespass” into adjacent streets, must
not negatively affect homeowners on that street, etc. This complicates the
question above because the lines become blurred between organizations rather
quickly. In cases like this, the discussions must occur between all
stakeholders, generally chaired by a Government/company representative
(depending on the consumer/customer), to draw clear boundaries between
responsibilities.</p>
</div>
<div class="paragraph">
<p>Radio frequency (RF) spectrum is a critical point as well. While WIFI can
operate in the 2.4 GHz and 5.0 GHz bands without a license, there are no
unlicensed 4G LTE bands at the time of this writing. Deploying 4G LTE capable
devices on an existing carrier’s network within a developed country may not be
a problem. Doing so in developing or undeveloped countries, especially if 4G
LTE spectrum is tightly regulated but poorly accessible, can be a challenge.</p>
</div>
<div class="paragraph">
<p>Several new protocols have been introduced specifically for IoT, some of which
are standardized:</p>
</div>
<div class="sect4">
<h5 id="_rpl">RPL</h5>
<div class="paragraph">
<p>IPv6 Routing Protocol for LLNs (RFC 6550): RPL is a distance-vector
routing protocol specifically designed to support IoT. At a high-level, RPL is
a combination of control-plane and forwarding logic of three other
technologies: regular IP routing, multi-topology routing (MTR), and MPLS
traffic-engineering (MPLS TE). RPL is similar to regular IP routing in that
directed acyclic graphs (DAG) are created through the network. This is a fancy
way of saying “loop-free shortest path” between two points. These DAGs can be
“colored” into different topologies which represent different network
characteristics, such as high bandwidth or low latency. This forwarding
paradigm is similar to MTR in concept. Last, traffic can be assigned to a
colored DAG based on administratively-defined constraints, including node
state, node energy, hop count, throughput, latency, reliability, and color (administrative preference). This is similar to MPLS TE’s constrained shortest path first (CSPF) process which is used for defining administrator- defined paths through a network based on a set of constraints, which might have technical and/or business drivers behind them.</p>
</div>
</div>
<div class="sect4">
<h5 id="_6lowpan">6LoWPAN</h5>
<div class="ulist">
<ul>
<li>
<p>IPv6 over Low Power WPANs (RFC 4919): This technology was specifically developed to be an adaptation layer for IPv6 for IEEE 802.15.4 wireless networks. Specifically, it “adapts” IPv6 to work over LLNs which encompasses many functions:</p>
<div class="ulist">
<ul>
<li>
<p>MTU correction: The minimum MTU for IPv6 across a link, as defined in RFC2460, is 1280 bytes. The maximum MTU for IEEE 802.15.4 networks is 127 bytes. Clearly, no value can mathematically satisfy both conditions concurrently. 6LoWPAN performs fragmentation and reassembly by breaking the large IPv6 packets into IEEE 802.15.4 frames for transmission across the wireless network.</p>
</li>
<li>
<p>Header compression: Many compression techniques are stateful and CPU-hungry. This strategy would not be appropriate for low-cost LLNs, so 6LoWPAN utilizes an algorithmic (stateless) mechanism. RFC4944 defines some common assumptions:</p>
<div class="ulist">
<ul>
<li>
<p>The version is always IPv6.</p>
</li>
<li>
<p>Both source and destination addresses are link-local.</p>
</li>
<li>
<p>The low-order 64-bits of the link-local addresses can be derived from the layer-2 network addressing in an IEEE 802.15.4 wireless network.</p>
</li>
<li>
<p>The packet length can be derived from the layer-2 header.</p>
</li>
<li>
<p>Next header is always ICMP, TCP, or UDP.</p>
</li>
<li>
<p>Flow label and traffic class are always zero.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, an IPv6 header (40 bytes) and a UDP header (8 bytes) are 48 bytes long when concatenated. This can be compressed down to 7 bytes by 6LoWPAN.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mesh routing: Somewhat similar to WIFI, mesh networking is possible, but requires up to 4 unique addresses. The original source/destination addresses can be retained in a new “mesh header” while the per-hop source/destination addresses are written to the MAC header.</p>
</li>
<li>
<p>MAC level retransmissions: IP was designed to be fully stateless and any retransmission or flow control was the responsibility of upper-layer protocols, such as TCP. When using 6LoWPAN, retransmissions can occur at layer-2.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_coap">CoAP</h5>
<div class="ulist">
<ul>
<li>
<p>Constrained Application Protocol (RFC7252) designed for LLNs and M2M communications</p>
</li>
<li>
<p>At a high-level, very similar to HTTP in terms of the capabilities it provides.</p>
<div class="ulist">
<ul>
<li>
<p>support the transfer of application data using common methods such as GET, POST, PUT, and DELETE.</p>
</li>
<li>
<p>runs over UDP port 5683 by default (5684 for secure CoAP) and was specifically designed to be lighter weight and faster than HTTP.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Supports multicast: Because it is UDP-based, IP multicast is possible. This can be used both for application discovery (in lieu of DNS) or efficient data transfer.</p>
</li>
<li>
<p>Built-in security: CoAP supports using datagram TLS (DTLS) with both pre-shared key and digital certificate support. As mentioned earlier, CoAP DTLS uses UDP port 5684.</p>
</li>
<li>
<p>Small header: The CoAP overhead adds only 4 bytes.</p>
</li>
<li>
<p>Fast response: When a client sends a CoAP GET to a server, the requested data is immediately returned in an ACK message, which is the fastest possible data exchange.</p>
</li>
<li>
<p>Despite CoAP being designed for maximum efficiency, it is not a general replacement for HTTP.</p>
<div class="ulist">
<ul>
<li>
<p>It only supports a subset of HTTP capabilities and should only be used within IoT environments.</p>
</li>
<li>
<p>To interwork with HTTP, one can deploy an HTTP/CoAP proxy as a “gateway” device between the multi-service edge and smart device networks.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_mqtt">MQTT</h5>
<div class="ulist">
<ul>
<li>
<p>Message Queuing Telemetry Transport (not standardized)</p>
</li>
<li>
<p>MQTT is, in a sense, the predecessor of CoAP in that it was created in 1999
and was specifically designed for lightweight, web-based, machine-to-machine
communications. Like HTTP, it relies on TCP, except uses ports 1883 and 8883
for plain-text and TLS communications, respectively. Being based on TCP also
implies a client/server model, similar to HTTP, but not necessary like CoAP.
Compared to CoAP, MQTT is losing traction given the additional benefits
specific to modern IoT networks that CoAP offers.</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 24. CoAP, MQTT, and HTTP comparison</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">CoAP</th>
<th class="tableblock halign-left valign-top">MQTT</th>
<th class="tableblock halign-left valign-top">HTTP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transport and ports</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP 5683/5684</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP 1883/1889</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP 80/443</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security support</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DTLS via PSK/PKI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS via PSK/PKI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS via PSK/PKI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast support</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes but no encryption support yet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lightweight</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standardized</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No; in progress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rich feature set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_migration">48.1.9. Migration</h4>
<div class="paragraph">
<p>Migrating to IoT need not be swift. For example, consider an organization which
is currently running a virtual private cloud infrastructure with some critical
in-house applications in their private cloud. All remaining COTS applications
are in the public cloud. Assume this public cloud is hosted locally by an ISP
and is connected via an MPLS L3VPN extranet into the corporate VPN. If this
corporation owns a large manufacturing company and wants to begin deploying
various IoT components, it can begin with the large and immobile pieces.</p>
</div>
<div class="paragraph">
<p>The multi-service edge (access) network from the regional SP POP to the factory
likely already supports Ethernet as an access technology, so devices can use
that for connectivity. Over time, a corporate WLAN can be extended for 802.11
WIFI capable devices. Assuming this organization is not deploying a private 4G
LTE network, sensors can immediately be added using cellular as well. The
migration strategy towards IoT is very similar to adding new remote branch
sites, except the number of hosts could be very large. The LAN, be it wired or
wireless, still must be designed correctly to support all of the devices.</p>
</div>
</div>
<div class="sect3">
<h4 id="_environmental_impacts_on_the_network">48.1.10. Environmental Impacts on the Network</h4>
<div class="paragraph">
<p>Environment impacts are especially important for IoT given the scale of devices
deployed. Although wireless technologies become more resilient over time, they
remain susceptible to interference and other natural phenomena which can
degrade network connectivity. Some wireless technologies are even impacted by
rain, a common occurrence in many parts of the word. The significance of this
with IoT is to consider when to use wired or wireless communication as for a
sensor. Some sensors may even be able to support multiple communications styles
in an active/standby method. As is true in most networks, resilient design is
important in ensuring that IoT-capable devices are operable.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<h1 id="_appendices" class="sect0">Appendices</h1>
<div class="sect1">
<h2 id="_lab_equipment_and_ios_releases">49. Lab Equipment and IOS Releases</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Cisco ISR 2900 Series routers running IOS version 15.3T Universal Software release</p>
</li>
<li>
<p>Catalyst 3560X Series switches running IOS version 15.0SE Universal (IP Services) Software release</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ios">50. IOS</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_ios_xe">51. IOS-XE</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>runs IOS as a process on top of Linux OS</p>
</li>
<li>
<p>modular &#8594; extensibility</p>
</li>
<li>
<p>high availability</p>
<div class="ulist">
<ul>
<li>
<p>Can upgrade one package without rebooting the whole device</p>
</li>
</ul>
</div>
</li>
<li>
<p>separates control plane (Forwarding and Feature Manager)
and data plane (Forwarding Engine Driver)</p>
<div class="ulist">
<ul>
<li>
<p>The FFM provides a set of APIs used to manage the control plane
processes. The resulting outcome is that the FFM programs the data plane
through the FED and maintains all forwarding states for the system. It is the
FED that allows the drivers to affect the data plane, and it is provided by
the platform.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cisco IOS XE consists of different modules called sub-packages that provide a specific function:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RPBase: provides the operating system software for the route processor.</p>
</li>
<li>
<p>RPControl: controls the control plane processes that interface between the IOS process and the rest of the platform.</p>
</li>
<li>
<p>RPAccess: used for access to the router through protocols like SSH / SSL.</p>
</li>
<li>
<p>RPIOS: provides the Cisco IOS kernel</p>
</li>
<li>
<p>ESPBase: provides the ESP operating system and control processes, and the ESP software. The ESP (Embedded Services Processor) is responsible for the data plane and all flows through the data plane. It is also responsible for features/tasks like QoS, ACLs, VPNs, Netflow, NAT, etc.</p>
</li>
<li>
<p>SIPBase: this controls the SIP operating system and control processes. A SIP (Shared Port Adapter Interface Processor) is a carrier card that you insert in a router slot. The SIP can hold one or more SPAs and it provides the connection between the route processor and SPA.</p>
</li>
<li>
<p>SIPSPA: provides the SPA driver and Field Programmable Device (FPD). The SPA (Shared Port Adapter) is inserted in the subslot of a SIP and provides the interface between the network and SIP.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The complete image that has all sub-packages is called a consolidated package.
This is the most simple solution since it’s a single image file. It’s also
possible to run individual sub-packages, the advantage of this is that the
router will only run the software that you require on your router so you will
save some memory and your router will boot faster.</p>
</div>
<div class="paragraph">
<p><a href="http://dtdccie.blogspot.co.za/2014/08/differences-between-ios-and-ios-xe.html" class="bare">http://dtdccie.blogspot.co.za/2014/08/differences-between-ios-and-ios-xe.html</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ios_system_management">52. IOS System Management</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Configuration Fundamentals Configuration Guide, Cisco IOS Release 15M&amp;T</p>
</li>
<li>
<p>Interface and Hardware Component Configuration Guide, Cisco IOS Release 15M&amp;T</p>
</li>
<li>
<p>Loading and Managing System Images Configuration Guide, Cisco IOS Release 15M&amp;T</p>
</li>
<li>
<p>Maintaining System Memory Configuration Guide, Cisco IOS Release 15M&amp;T</p>
</li>
<li>
<p>Managing Configuration Files Configuration Guide, Cisco IOS Release 15M&amp;T</p>
</li>
<li>
<p>Software Activation Configuration Guide, Cisco IOS Release 15M&amp;T</p>
</li>
<li>
<p>The Integrated File System Configuration Guide, Cisco IOS Release 15M&amp;T</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_configuration_files">52.1. Configuration files</h3>
<div class="ulist">
<ul>
<li>
<p>startup-config</p>
</li>
<li>
<p>running-config</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># configure [terminal|memory|network]</pre>
</div>
</div>
<div class="paragraph">
<p>copy {ftp: | rcp: | tftp:system:running-config}</p>
</div>
<div class="listingblock">
<div class="title">task: Create a configuration archive</div>
<div class="content">
<pre>conf t
archive
  path &lt;url&gt;
  maximum &lt;number&gt;
  time-period &lt;minutes&gt;
end</pre>
</div>
</div>
<div class="listingblock">
<div class="title">task: Save the running configuration file to the configuration archive</div>
<div class="content">
<pre># archive config</pre>
</div>
</div>
<div class="listingblock">
<div class="title">task: Replace the running configuration file with a saved configuration file</div>
<div class="content">
<pre># configure replace &lt;source-url&gt; [nolock][list][force][ignorecase][time &lt;minutes&gt;][reverttrigger[error][timer &lt;minutes&gt;]]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">source-url</dt>
<dd>
<p>URL of the saved Cisco IOS configuration file that is to replace the current running configuration</p>
</dd>
<dt class="hdlist1">list</dt>
<dd>
<p>displays a list of the command lines applied by the Cisco IOS software parser during each pass of the configuration replace operation. The total number of passes performed is also displayed.</p>
</dd>
<dt class="hdlist1">force</dt>
<dd>
<p>replaces the current running configuration file with the specified saved Cisco IOS configuration file without prompting you for confirmation.</p>
</dd>
<dt class="hdlist1">time</dt>
<dd>
<p>specify minutes within which you must enter the configureconfirm command to confirm replacement of the current running configuration file. If the configureconfirm command is not entered within the specified time limit, the configuration replace operation is automatically reversed (in other words, the current running configuration file is restored to the configuration state that existed prior to entering the configurereplace command).</p>
</dd>
<dt class="hdlist1">nolock</dt>
<dd>
<p>disables the locking of the running configuration file that prevents other users from changing the running configuration during a configuration replace operation.</p>
</dd>
<dt class="hdlist1">ignorecase</dt>
<dd>
<p>allows the configuration to ignore the case of the confirmation command</p>
</dd>
<dt class="hdlist1">reverttrigger</dt>
<dd>
<p>set the following triggers for reverting to the original configuration:</p>
<div class="ulist">
<ul>
<li>
<p>error&#8212;&#8203;Reverts to the original configuration upon error.</p>
</li>
<li>
<p>timerminutes&#8212;&#8203;Reverts to the original configuration if specified time elapses.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">task: Cancel the timed rollback immediately</div>
<div class="content">
<pre># configure revert now</pre>
</div>
</div>
<div class="listingblock">
<div class="title">task: Specify a new revert time</div>
<div class="content">
<pre># configure revert timer &lt;minutes&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">task: Set the maximum allowable time period of no activity before reverting to the saved configuration</div>
<div class="content">
<pre># configure revert timer idle &lt;minutes&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_general">53. General</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="../images/osi-vs-tcpip.png" alt="OSI vs DoD TCP/IP">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_notes_to_self">54. Notes To Self</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">2017-06-17 Sat 14:53</dt>
<dd>
<p>Do not follow the blueprint order for the book.
Create a graph of technologies/concepts to master
and start at the root (or from the node with less dependencies)</p>
</dd>
<dt class="hdlist1">2017-06-18 Sun 04:52</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>I am considering to bring chapter on security closed to the associate feature chapter.</p>
</li>
<li>
<p>Example: DHCP snooping and DHCP, Dynamic ARP Inspection near ARP.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2017-11-17 08:46:27 SAST
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>