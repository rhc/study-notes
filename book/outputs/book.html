<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="Christian Kyony">
<title>CCIE Routing and Switching study notes</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: rgba(0, 0, 0, 0.8); padding: 0; margin: 0; font-family: "Noto Serif", "DejaVu Serif", serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #7a2518; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2156a5; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #1d4b8f; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.15em; margin-bottom: 0; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Open Sans", "DejaVu Sans", sans-serif; font-weight: 300; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0; font-weight: bold; }
dl dd { margin-bottom: 0; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: rgba(0, 0, 0, 0.8); border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

.keyseq { color: rgba(51, 51, 51, 0.8); }

kbd { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; display: inline-block; color: rgba(0, 0, 0, 0.8); font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: rgba(0, 0, 0, 0.8); }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Open Sans", "DejaVu Sans", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #7a2518; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f8f8f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: rgba(0, 0, 0, 0.8); padding: 1.25em; }

#footer-text { color: rgba(255, 255, 255, 0.8); line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Noto Serif", "DejaVu Serif", serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Open Sans", "DejaVu Sans", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f8; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #7a2518; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: rgba(0, 0, 0, 0.8); font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 1.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 ; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #19407c; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: rgba(0, 0, 0, 0.8); -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

dt, th.tableblock, td.content, div.footnote { text-rendering: optimizeLegibility; }

h1, h2, p, td.content, span.alt { letter-spacing: -0.01em; }

p strong, td.content strong, div.footnote strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content, span.alt { font-size: 1.0625rem; }

p { margin-bottom: 1rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

.print-only { display: none !important; }

@media print { @page { margin: 1.25cm 0.75cm; }
  * { -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
  a { color: inherit !important; text-decoration: underline !important; }
  a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  pre, blockquote, tr, img, object, svg { page-break-inside: avoid; }
  thead { display: table-header-group; }
  svg { max-width: 100%; }
  p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
  #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
  .sect1 { padding-bottom: 0 !important; }
  .sect1 + .sect1 { border: 0 !important; }
  #header > h1:first-child { margin-top: 1.25rem; }
  body.book #header { text-align: center; }
  body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
  body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
  body.book #header .details span:first-child { margin-left: 0 !important; }
  body.book #header .details br { display: block; }
  body.book #header .details br + span:before { content: none !important; }
  body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
  .listingblock code[data-lang]:before { display: block; }
  #footer { background: none !important; padding: 0 0.9375em; }
  #footer-text { color: rgba(0, 0, 0, 0.6) !important; font-size: 0.9em; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>CCIE Routing and Switching study notes</h1>
<div class="details">
<span id="author" class="author">Christian Kyony</span><br>
<span id="email" class="email"><a href="mailto:ckyony@changamuka.com">ckyony@changamuka.com</a></span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">2015-10-12</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_dedication">Dedication</a></li>
<li><a href="#_part_i_layer_2_technologies">Part I : Layer 2 Technologies</a>
<ul class="sectlevel1">
<li><a href="#_switch_administration">1. Switch administration</a>
<ul class="sectlevel2">
<li><a href="#_interface_characteristics">1.1. Interface Characteristics</a></li>
<li><a href="#_system_clock">1.2. System clock</a></li>
<li><a href="#_system_name_and_prompt">1.3. System Name and Prompt</a></li>
<li><a href="#_motd_login_banner">1.4. MOTD login Banner</a></li>
<li><a href="#_login_banner">1.5. Login Banner</a></li>
<li><a href="#_mac_address_table">1.6. MAC address table</a></li>
<li><a href="#_errdisable_recovery">1.7. errdisable recovery</a></li>
<li><a href="#_l2_mtu">1.8. L2 MTU</a></li>
</ul>
</li>
<li><a href="#_ethernet">2. Ethernet</a>
<ul class="sectlevel2">
<li><a href="#_frame_formats">2.1. Frame Formats</a></li>
<li><a href="#_ethernet_mac_addresses">2.2. Ethernet MAC Addresses</a></li>
<li><a href="#_rj_45_pinouts_and_cat5_wiring">2.3. RJ-45 pinouts and Cat5 wiring</a></li>
<li><a href="#_auto_negotiation_speed_and_duplex">2.4. Auto-negotiation, Speed and Duplex</a></li>
<li><a href="#_switch_internal_processing">2.5. Switch internal processing</a></li>
<li><a href="#_switching_and_bridging_logic">2.6. Switching and bridging logic</a></li>
<li><a href="#_standards">2.7. Standards</a></li>
<li><a href="#_troubleshooting">2.8. Troubleshooting</a></li>
</ul>
</li>
<li><a href="#_cdp_lldp_and_udld">3. CDP, LLDP and UDLD</a>
<ul class="sectlevel2">
<li><a href="#_cdp">3.1. CDP</a></li>
<li><a href="#_lldp">3.2. LLDP</a></li>
<li><a href="#_udld">3.3. UDLD</a></li>
</ul>
</li>
<li><a href="#_vlans_and_trunking">4. VLANs and Trunking</a>
<ul class="sectlevel2">
<li><a href="#_normal_and_extended_vlans">4.1. Normal and Extended VLANs</a></li>
<li><a href="#_voice_vlans">4.2. Voice VLANs</a></li>
<li><a href="#_private_vlans">4.3. Private VLANs</a></li>
<li><a href="#_vtp">4.4. VTP</a></li>
<li><a href="#_dtp">4.5. DTP</a></li>
<li><a href="#_isl">4.6. ISL</a></li>
<li><a href="#_ieee_802_1q">4.7. IEEE 802.1Q</a></li>
</ul>
</li>
<li><a href="#_spanning_tree">5. Spanning tree</a>
<ul class="sectlevel2">
<li><a href="#_stp">5.1. STP</a></li>
<li><a href="#_mst">5.2. MST</a></li>
</ul>
</li>
<li><a href="#_etherchannel">6. EtherChannel</a>
<ul class="sectlevel2">
<li><a href="#_etherchannel_2">6.1. EtherChannel</a></li>
<li><a href="#_lacp">6.2. LACP</a></li>
<li><a href="#_pagp">6.3. PAgP</a></li>
</ul>
</li>
<li><a href="#_span_rspan_and_erspan">7. SPAN , RSPAN and ERSPAN</a>
<ul class="sectlevel2">
<li><a href="#_local_span_sessions">7.1. Local SPAN sessions</a></li>
<li><a href="#_remote_span_sessions">7.2. Remote SPAN sessions</a></li>
<li><a href="#_interaction_with_other_features">7.3. Interaction with other features</a></li>
<li><a href="#_encapsulated_rspan">7.4. Encapsulated RSPAN</a></li>
</ul>
</li>
<li><a href="#_virtual_switch_system">8. Virtual Switch System</a>
<ul class="sectlevel2">
<li><a href="#_vss_active_and_standby_switch">8.1. VSS Active and Standby Switch</a></li>
<li><a href="#_virtual_switch_link">8.2. Virtual Switch Link</a></li>
</ul>
</li>
<li><a href="#_wan">9. WAN</a>
<ul class="sectlevel2">
<li><a href="#_hdlc">9.1. HDLC</a></li>
<li><a href="#_ppp">9.2. PPP</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_part_ii_layer_3_technologies">Part II : Layer 3 Technologies</a>
<ul class="sectlevel1">
<li><a href="#_ip_addressing">10. IP addressing</a>
<ul class="sectlevel2">
<li><a href="#_ipv4">10.1. IPv4</a></li>
<li><a href="#_arp">10.2. ARP</a></li>
<li><a href="#_dhcp">10.3. DHCP</a></li>
<li><a href="#_nat">10.4. NAT</a></li>
<li><a href="#_nhrp">10.5. NHRP</a></li>
<li><a href="#_ipv6">10.6. IPv6</a></li>
</ul>
</li>
<li><a href="#_ip_switching">11. IP Switching</a>
<ul class="sectlevel2">
<li><a href="#_cef">11.1. CEF</a></li>
</ul>
</li>
<li><a href="#_ip_routing">12. IP routing</a>
<ul class="sectlevel2">
<li><a href="#_rip">12.1. RIP</a></li>
<li><a href="#_eigrp">12.2. EIGRP</a></li>
<li><a href="#_ospf">12.3. OSPF</a></li>
<li><a href="#_bgp">12.4. BGP</a></li>
<li><a href="#_redistribution">12.5. Redistribution</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_part_iii_vpn_technologies">Part III : VPN Technologies</a>
<ul class="sectlevel1">
<li><a href="#_mpls">13. MPLS</a>
<ul class="sectlevel2">
<li><a href="#_concepts_4">13.1. Concepts</a></li>
<li><a href="#_label_distribution_and_control">13.2. label distribution and control</a></li>
<li><a href="#_commands">13.3. Commands</a></li>
</ul>
</li>
<li><a href="#_gre">14. GRE</a>
<ul class="sectlevel2">
<li><a href="#_tunneling">14.1. Tunneling</a></li>
<li><a href="#_gre_header">14.2. GRE header</a></li>
<li><a href="#_gre_tunnel">14.3. GRE tunnel</a></li>
<li><a href="#_troubleshooting_4">14.4. Troubleshooting</a></li>
<li><a href="#_questions_2">14.5. Questions</a></li>
</ul>
</li>
<li><a href="#_dmvpn">15. DMVPN</a>
<ul class="sectlevel2">
<li><a href="#_concepts_5">15.1. Concepts</a></li>
<li><a href="#_phases">15.2. Phases</a></li>
</ul>
</li>
<li><a href="#_ipsec">16. IPSEC</a></li>
</ul>
</li>
<li><a href="#_part_iv_infrastructure_security">Part IV : Infrastructure Security</a>
<ul class="sectlevel1">
<li><a href="#_device_security">17. Device security</a>
<ul class="sectlevel2">
<li><a href="#_aaa">17.1. AAA</a></li>
</ul>
</li>
<li><a href="#_network_security">18. Network security</a>
<ul class="sectlevel2">
<li><a href="#_switch_security">18.1. Switch security</a></li>
<li><a href="#_access_control_list">18.2. Access control list</a></li>
<li><a href="#_router_security">18.3. Router security</a></li>
</ul>
</li>
<li><a href="#_ieee_802_1x">19. IEEE 802.1X</a>
<ul class="sectlevel2">
<li><a href="#_definition_2">19.1. Definition</a></li>
<li><a href="#_port_security">19.2. Port security</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_part_v_infrastructure_services">Part V : Infrastructure Services</a>
<ul class="sectlevel1">
<li><a href="#_system_management">20. System management</a>
<ul class="sectlevel2">
<li><a href="#_telnet">20.1. Telnet</a></li>
<li><a href="#_ssh">20.2. SSH</a></li>
<li><a href="#_scp">20.3. SCP</a></li>
<li><a href="#__t_ftp">20.4. [T]FTP</a></li>
<li><a href="#_snmp">20.5. SNMP</a></li>
<li><a href="#_syslog">20.6. Syslog</a></li>
<li><a href="#_ntp">20.7. NTP</a></li>
</ul>
</li>
<li><a href="#_qos">21. QoS</a>
<ul class="sectlevel2">
<li><a href="#_mqc">21.1. MQC</a></li>
<li><a href="#_rsvp">21.2. RSVP</a></li>
</ul>
</li>
<li><a href="#_first_host_redundancy_protocols">22. First Host Redundancy Protocols</a>
<ul class="sectlevel2">
<li><a href="#_hsrp">22.1. HSRP</a></li>
<li><a href="#_glbp">22.2. GLBP</a></li>
<li><a href="#_vrrp">22.3. VRRP</a></li>
<li><a href="#_idrp">22.4. IDRP</a></li>
<li><a href="#_ipv6_ra_rs">22.5. IPv6 RA/RS</a></li>
</ul>
</li>
<li><a href="#_multicast_2">23. Multicast</a>
<ul class="sectlevel2">
<li><a href="#_igmp">23.1. IGMP</a></li>
<li><a href="#_pim">23.2. PIM</a></li>
</ul>
</li>
<li><a href="#_network_optimization">24. Network optimization</a>
<ul class="sectlevel2">
<li><a href="#_ip_sla">24.1. IP SLA</a></li>
<li><a href="#_enhanced_object_tracking">24.2. Enhanced Object Tracking</a></li>
<li><a href="#_netflow">24.3. NetFlow</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_part_vi_evolving_technologies">Part VI : Evolving Technologies</a>
<ul class="sectlevel1">
<li><a href="#_cloud">25. cloud</a>
<ul class="sectlevel2">
<li><a href="#_compare_and_contrast_cloud_deployment_models">25.1. Compare and contrast Cloud deployment models</a></li>
<li><a href="#_describe_cloud_implementations_and_operations">25.2. Describe Cloud implementations and operations</a></li>
</ul>
</li>
<li><a href="#_sdn">26. SDN</a>
<ul class="sectlevel2">
<li><a href="#_describe_functional_elements_of_network_programmability_and_how_they_interact">26.1. Describe functional elements of network programmability  and how they interact</a></li>
<li><a href="#_describe_aspects_of_virtualization_and_automation_in_network_environments">26.2. Describe aspects of virtualization and automation in network environments</a></li>
</ul>
</li>
<li><a href="#_internet_of_things">27. Internet of Things</a>
<ul class="sectlevel2">
<li><a href="#_describe_architectural_framework_and_deployment_considerations_for_internet_of_things_iot">27.1. Describe architectural framework and deployment considerations for Internet of Things [IoT]</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_dedication">Dedication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To Cyril "Matiere" Kalenga</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<h1 id="_part_i_layer_2_technologies" class="sect0">Part I : Layer 2 Technologies</h1>
<div class="sect1">
<h2 id="_switch_administration">1. Switch administration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_interface_characteristics">1.1. Interface Characteristics</h3>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swint.html" class="bare">http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swint.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_system_clock">1.2. System clock</h3>
<div class="ulist">
<ul>
<li>
<p>Can be set manually or dynamic with NTP</p>
</li>
<li>
<p>Keeps track internally based on UTC</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the Time Zone</div>
<div class="content">
<pre>(config)# clock timezone &lt;zone&gt; &lt;hours-offset&gt; [minutes-offset]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use the minutes-offset variable  when the local time zone is a percentage of an hour different from UTC.
For example, the time zone for some sections of Atlantic Canada (AST) is UTC-3.5, where the 3 means 3 hours and.5 means 50 percent.
In this case, the necessary command is clock timezone AST -3 30.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Reset the time to UTC</div>
<div class="content">
<pre>(config)# no clock timezone</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the system clock manually</div>
<div class="content">
<pre>clock set hh:mm:ss month day year</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the time and date configuration</div>
<div class="content">
<pre># sh clock [detail]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure Daylight Saving Time</div>
<div class="content">
<pre>(config)# clock summer-time &lt;zone&gt; recurring [week day month hh : mm : week day month hh : mm [offset]]

Example(config)# clock summer-time PDT recurring 1 Sunday April 2:00 last Sunday Octorber 2:00</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_system_name_and_prompt">1.3. System Name and Prompt</h3>
<div class="listingblock">
<div class="title">Task: Configure a system name</div>
<div class="content">
<pre>(config)# hostname &lt;name&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_motd_login_banner">1.4. MOTD login Banner</h3>
<div class="ulist">
<ul>
<li>
<p>MOTD and login not configured by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a message of the day login banner</div>
<div class="content">
<pre>(config)# banner motd &lt;delimiting-character&gt;
&lt;message&gt; &lt;delimiting-character&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_login_banner">1.5. Login Banner</h3>
<div class="ulist">
<ul>
<li>
<p>displayed on all connected terminals</p>
</li>
<li>
<p>appears after the MOTD banner and before the login prompt</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a Login Banner</div>
<div class="content">
<pre>(config)# banner login &lt;delimiting-character&gt;
&lt;message&gt; &lt;delimiting-character&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mac_address_table">1.6. MAC address table</h3>
<div class="ulist">
<ul>
<li>
<p>lists the destination MAC address with the associated VLANs , port number, and the type (static or dynamic)</p>
</li>
<li>
<p>dynamic address are discarded after  the <strong>aging time</strong> (300 seconds by default)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display Address Table Entries for the specified MAC address</div>
<div class="content">
<pre># sh mac address-table address &lt;MAC&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display only dynamic MAC addresses</div>
<div class="content">
<pre># sh mac address-table dynamic</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the number of addresses present</div>
<div class="content">
<pre># sh mac address-table count</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the MAC address table information for the specified VLAN</div>
<div class="content">
<pre># sh mac address-table vlan</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the MAC address table information for the specified interface</div>
<div class="content">
<pre># sh mac address-table interface</pre>
</div>
</div>
<div class="sect3">
<h4 id="_aging_time">1.6.1. Aging time</h4>
<div class="ulist">
<ul>
<li>
<p>Default: 300 seconds</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the length of time that a dynamic entry remains in the MAC address after the entry is used or updated</div>
<div class="content">
<pre># mac address-table aging-time [0 | 10-1000000] [vlan &lt;1-4094&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Displays the aging time</div>
<div class="content">
<pre># sh mac address-table aging-time [&lt;vlan_id&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Remove Dynamic Address Entries</div>
<div class="content">
<pre># clear mac address-table dynamic [&lt;mac-address&gt;]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mac_address_change_notification_traps">1.6.2. MAC Address change Notification Traps</h4>
<div class="ulist">
<ul>
<li>
<p>send SNMP trap when the switch learns or removes dynamic and secure MAC addresses.</p>
</li>
<li>
<p>do not send trap for self addesses, multicast addresses or static addresses</p>
</li>
<li>
<p>can set a trap-interval time to bundle the notification traps to reduce network traffic</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Send MAC address change notification traps to an NMS host</div>
<div class="content">
<pre>(config)# snmp-server host &lt;host-addr&gt; { traps | informs} { version { 1 | 2c | 3 } } &lt;community-string&gt; mac-notification
(config)# snmp-server enable traps mac-notification change
(config)# mac address-table notification change [ interval &lt;seconds&gt; ] [ history-size &lt;i0-1-500&gt; ]
(config)# interface &lt;interface-id&gt;
(config-if)# snmp trap mac-notification change {added | removed }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the MAC address table notification change configuration</div>
<div class="content">
<pre># sh mac address-table notification change [interface]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mac_address_move_notification_traps">1.6.3. MAC address move Notification traps</h4>
<div class="ulist">
<ul>
<li>
<p>send a SNMP notification whenever a MAC address moves from one port to another within the same VLAN</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Send MAC address move notification traps to an NMS host</div>
<div class="content">
<pre>(config)# snmp-server host &lt;host-addr&gt; { traps | informs} { version { 1 | 2c | 3 } } &lt;community-string&gt; mac-notification
(config)# snmp-server enable traps mac-notification move
(config)# mac address-table notification mac-move</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the MAC address table notification move configuration</div>
<div class="content">
<pre># sh mac address-table notification mac-move</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mac_treshold_notification_traps">1.6.4. MAC Treshold notification traps</h4>
<div class="ulist">
<ul>
<li>
<p>Send an SNMP notification when a MAC Address table treshold limit is reached or exceeded.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure MAC Treshold notifcation traps</div>
<div class="content">
<pre>(config)# snmp-server host &lt;host-addr&gt; { traps | informs} { version { 1 | 2c | 3 } } &lt;community-string&gt; mac-notification
(config)# snmp-server enable traps mac-notification treshold
(config)# mac address-table notification treshold ! to enable the feature
(config)# mac address-table notification treshold [limit &lt;percentage] | [ interval &lt;seconds&gt; ]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the MAC address table notification treshold configuration</div>
<div class="content">
<pre># sh mac address-table notification treshold</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_static_addresses">1.6.5. Static addresses</h4>
<div class="ulist">
<ul>
<li>
<p>manually entered in the address table and must be manually removed</p>
</li>
<li>
<p>can be unicast or mcast</p>
</li>
<li>
<p>doesn&#8217;t age  and is retained when the switch restarts</p>
</li>
<li>
<p>must be associated with a VLAN and a interface</p>
<div class="ulist">
<ul>
<li>
<p>A packet with a static address that arrives on a VLAN where
it has not been statically entered is flooded to all ports and not learned</p>
</li>
<li>
<p>if the VLAN is in a private-primary or private-secondary, configure the same static address in all associated VLANs.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Add a static address to the MAC address table</div>
<div class="content">
<pre>(config)# mac address-table static &lt;MAC&gt; vlan &lt;vlan-id&gt; interface &lt;interface-id&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display only static MAC addresses</div>
<div class="content">
<pre># sh mac address-table static</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unicast_mac_address_filtering">1.6.6. Unicast MAC address filtering</h4>
<div class="ulist">
<ul>
<li>
<p>Drops packets with specific source or destination MAC addressess</p>
</li>
<li>
<p>disabled by default</p>
</li>
<li>
<p>mcast, bcast and router MAC addresses are not supported</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable unicast MAC address filtering</div>
<div class="content">
<pre>(config)# mac address-table static &lt;MAC&gt; vlan &lt;vlan-id&gt; drop</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mac_address_learning_on_a_vlan">1.6.7. MAC Address learning on a VLAN</h4>
<div class="ulist">
<ul>
<li>
<p>enabled by default on al VLANs</p>
</li>
<li>
<p>can be disabled with the following restrictions:</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>If the VLAN has a configured switch virtual interface (SVI),  the switch then floods all IP packets in the Layer 2 domain.</p>
</li>
<li>
<p>If you disable MAC address learning on a VLAN with more than two ports, every packet entering the switch is flooded in that VLAN domain.</p>
</li>
<li>
<p>You cannot disable MAC address learning on a VLAN that is used internally by the switch. If the VLAN ID that you enter is an internal VLAN, the switch generates an error message and rejects the command. To view internal VLANs in use, enter the show vlan internal usage privileged EXEC command.</p>
</li>
<li>
<p>If you disable MAC address learning on a VLAN configured as a private-VLAN primary VLAN, MAC addresses are still learned on the secondary VLAN that belongs to the private VLAN and are then replicated on the primary VLAN. If you disable MAC address learning on the secondary VLAN, but not the primary VLAN of a private VLAN, MAC address learning occurs on the primary VLAN and is replicated on the secondary VLAN.</p>
</li>
<li>
<p>You cannot disable MAC address learning on an RSPAN VLAN. The configuration is not allowed.</p>
</li>
<li>
<p>If you disable MAC address learning on a VLAN that includes a secure port, MAC address learning is not disabled on that port. If you disable port security, the configured MAC address learning state is enabled.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Disable MAC address learning</div>
<div class="content">
<pre>(config)# no mac address-table learning vlan &lt;vlan-id&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the MAC address learning</div>
<div class="content">
<pre>sh mac address-table learning [vlan &lt;vlan-id&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Reenable MAC address learning</div>
<div class="content">
<pre>(config)# default mac address-table learning vlan &lt;vlan-id&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_errdisable_recovery">1.7. errdisable recovery</h3>

</div>
<div class="sect2">
<h3 id="_l2_mtu">1.8. L2 MTU</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_ethernet">2. Ethernet</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>IEEE 802.3 standards</p>
</li>
<li>
<p>CSMA/CD protocol</p>
</li>
<li>
<p>Medium: coaxial, twisted-pair, optical fiber</p>
</li>
<li>
<p>Data rates: 10/100/1000/10000 Mbps</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_frame_formats">2.1. Frame Formats</h3>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-dix-and-revised-802.3.png" alt="Ethernet (DIX) and Revised (1997) IEEE 802.3" width="521" height="60">
</div>
<div class="title">Figure 1. Ethernet (DIX) and Revised (1997) IEEE 802.3</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-ieee802.3-extended.png" alt="Original IEEE 802.3" width="737" height="60">
</div>
<div class="title">Figure 2. Original IEEE 802.3</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-ieee802.3-snap.png" alt="IEEE 802.3 with SNAP" width="850" height="60">
</div>
<div class="title">Figure 3. IEEE 802.3 with SNAP</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Preamble DIX or Preamble and Start of Frame Delimiter(802.3)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>62 alternating 1s and 0s, and ends with a pair of 1s.</p>
</li>
<li>
<p>For clocking synchronization of the transmitted signal.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Type of protocol</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Length</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Length in bytes of the data following the Length field, up to the Ethernet trailer.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">DA</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Destination address can be an individual or group address</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SA</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source address is always unicast address</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">DSAP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Destination Service Access Protocol</p>
</li>
<li>
<p>The size limitations, along with other Point (802.2) uses of the low-order bits, required the later addition of SNAP headers.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SSAP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source Service Access Protocol</p>
</li>
<li>
<p>Describes the upper-layer protocol Point (802.2) that created the frame.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Control</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Enables both connectionless and connection-oriented operation.</p>
</li>
<li>
<p>Generally used only for connectionless operation by modern protocols, with a 1-byte value of 0x03.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SNAP OUI </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Generally unused today,</p>
</li>
<li>
<p>Providing a place for the sender of the frame to code the OUI representing the manufacturer of the Ethernet NIC.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SNAP Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Using same values as the DIX Type field, overcoming deficiencies with size and use of the DSAP field.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Data</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>N bytes where 46 &#8656; n &#8656; 1500</p>
</li>
<li>
<p>If n &lt; 46, use padding</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">FCS (Frame check sequence)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Contains a 32-bit cyclic redundancy check (CRC) value</p>
</li>
<li>
<p>Calculated by the sending MAC</p>
</li>
<li>
<p>Re-calculated by the receiving MAC to check for damaged frames.</p>
</li>
<li>
<p>Generated from the DA, SA, Length/Type, and Data fields</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_ethernet_mac_addresses">2.2. Ethernet MAC Addresses</h3>
<div class="ulist">
<ul>
<li>
<p>48 bits in hexadecimal</p>
</li>
<li>
<p>Canonical transmission (little endian)= MSO to LSO with LSB to MSB for each octet where</p>
<div class="ulist">
<ul>
<li>
<p>I/G bit: (0/1) Individual or Group address, first bit to be transmitted as LSB of MSO</p>
</li>
<li>
<p>U/L bit: (0/1) Universally or Locally administrated, second bit to be transmitted</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Example: AC-10-7B-3A-92-3C

Convert to Hexa : 10101100 00010000 01101011 00111010 01010010 00111100
Transmission    : 00110101 00001000 11010110 01011100 01001010 00111100</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Change the MAC address</div>
<div class="content">
<pre>(config-if)# mac-address AC-10-BE-EF-DE-AD</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Even if you change the MAC address of the swithch port,
STP will continue to use the BIA.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_types_of_mac_addresses">2.2.1. Types of MAC addresses</h4>
<div class="ulist">
<ul>
<li>
<p>Unicast : I/G bit = 0</p>
</li>
<li>
<p>Multicast: I/G bit = 1</p>
</li>
<li>
<p>Broadcast: all devices in the segment</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rj_45_pinouts_and_cat5_wiring">2.3. RJ-45 pinouts and Cat5 wiring</h3>
<div class="ulist">
<ul>
<li>
<p>Defined by <a href="http://www.eia.org">EIA</a> / <a href="http://www.tiaonline.org">TIA</a></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ethernet-pinouts.png" alt="Ehernet and ISO" height="50">
</div>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 1. Ethernet cabling types</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type of cable</th>
<th class="tableblock halign-left valign-top">Pinouts</th>
<th class="tableblock halign-left valign-top">Key pins connected</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Straight-through</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T568A or T568B both ends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-1; 2-2; 3-3; 6-6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-over</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T568A on one end,  T568B on the other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-3; 2-6; 3-1; 6-2</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Auto-MDIX (automatic medium-dependent interface crossover)</p>
<div class="ulist">
<ul>
<li>
<p>Detects the wrong cable and causes the switch to swap the pair it uses for transmitting and receiving</p>
</li>
<li>
<p>Not supported on all Cisco switch models</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_auto_negotiation_speed_and_duplex">2.4. Auto-negotiation, Speed and Duplex</h3>
<div class="ulist">
<ul>
<li>
<p>By default, Ethernet auto-negotiation uses FLP (Fast Link Pulses)to determine the speed and duplex setting.</p>
</li>
<li>
<p>To disable auto-negotiation, manually configure the speed and the duplex settings.</p>
</li>
<li>
<p>if auto-negotation is disabled on one end by statically setting the speed , the other end</p>
<div class="ulist">
<ul>
<li>
<p>detects the speed based on the incoming electrical signal</p>
</li>
<li>
<p>sets duplex to half for 10 and 100 Mbps and full duplex for 1Gps interfaces</p>
</li>
</ul>
</div>
</li>
<li>
<p>if auto-negotation is disabled on both end and different speeds statically configured, link down</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set speed for the interface</div>
<div class="content">
<pre>(config-if)# speed {10 | 100 | 1000 | auto | nonegotiate}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set duplex mode for the interface</div>
<div class="content">
<pre>(config-if)# duplex {auto | full | half}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Show controllers</div>
<div class="content">
<pre>Router# show controllers fastethernet1
!
Interface FastEthernet1   MARVELL 88E6052
Link is DOWN
Port is undergoing Negotiation or Link down
Speed :Not set, Duplex :Not set
!
Switch PHY Registers:
~~~~~~~~~~~~~~~~~~~~~
00 : 3100   01 : 7849   02 : 0141   03 : 0C1F   04 : 01E1
05 : 0000   06 : 0004   07 : 2001   08 : 0000   16 : 0130
17 : 0002   18 : 0000   19 : 0040   20 : 0000   21 : 0000
!
Switch Port Registers:
~~~~~~~~~~~~~~~~~~~~~~
Port Status Register       [00] : 0800
Switch Identifier Register [03] : 0520
Port Control Register      [04] : 007F
Rx Counter Register        [16] : 000A
Tx Counter Register        [17] : 0008</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_switch_internal_processing">2.5. Switch internal processing</h3>
<div class="paragraph">
<p>Switches forward frames when necessary, and do not forward when there is no need to do so, thus
reducing overhead.</p>
</div>
<div class="paragraph">
<p>To accomplish this, switches perform three actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Learn MAC addresses by examining the source MAC address of each received frame</p>
</li>
<li>
<p>Decide when to forward a frame or when to filter (not forward) a frame, based on the destination MAC address</p>
</li>
<li>
<p>Create a loop-free environment with other bridges by using the Spanning Tree Protocol</p>
</li>
</ul>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Store-and-forward
</td>
<td class="hdlist2">
<p>The switch fully receives all bits in the frame (store) before forwarding
the frame (forward). This allows the switch to check the FCS before
forwarding the frame, thus ensuring that errored frames are not forwarded.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Cut-through
</td>
<td class="hdlist2">
<p>The switch performs the address table lookup as soon as the Destination
Address field in the header is received. The first bits in the frame can be sent out
the outbound port before the final bits in the incoming frame are received. This
does not allow the switch to discard frames that fail the FCS check, but the
forwarding action is faster, resulting in lower latency.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Fragment-free
</td>
<td class="hdlist2">
<p>This performs like cut-through switching, but the switch waits for 64 bytes to be
received before forwarding the first bytes of the outgoing frame. According to
Ethernet specifications, collisions should be detected during the first 64 bytes of
the frame, so frames that are in error because of a collision will not be forwarded.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_switching_and_bridging_logic">2.6. Switching and bridging logic</h3>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type of Address</th>
<th class="tableblock halign-left valign-top">Switch Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Known unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forwards frame out the single interface associated with the destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unknown unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floods frame out all interfaces, except the interface on which the frame was received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Broadcast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floods frame identically to unknown unicasts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floods frame identically to unknown unicasts, unless multicast optimizations are configured</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_standards">2.7. Standards</h3>
<table class="tableblock frame-none grid-none spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dot1q trunking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rapid STP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1ax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LACP (formerly 802.3ad)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical Link Control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast ethernet over copper and optical cable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gigabit ethernet over optical cable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3ab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gigabit ethernet over copper cable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_troubleshooting">2.8. Troubleshooting</h3>
<div class="ulist">
<ul>
<li>
<p>Add something about excessive collisions, late collisions, runts, re: duplex mismatches</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cdp_lldp_and_udld">3. CDP, LLDP and UDLD</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cdp">3.1. CDP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Catalyst3560-X Configuration Guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swcdp.html">CDP</span></span> </a></p>
</div>
<div class="sect3">
<h4 id="_overview">3.1.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>Layer 2 discovery protocol  running on Cisco devices</p>
</li>
<li>
<p>Retrieves device type and SNMP agent address of neighboring devices</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_packet_format">Packet format</h5>
<div class="ulist">
<ul>
<li>
<p>Header followed by a set of TLV value</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/cdp-frame-format.png" alt="CDP frame format" width="512" height="248">
</div>
<div class="title">Figure 4. CDP frame format</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cdp_operations">3.1.2. CDP operations</h4>
<div class="ulist">
<ul>
<li>
<p>Enable by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display global information about CDP characteristics</div>
<div class="content">
<pre># show cdp

Capability Codes: R - Router, T - Trans Bridge, B - Source Route Bridge
                 S - Switch, H - Host, I - IGMP, r - Repeater

Device ID        Local Intrfce     Holdtme    Capability  Platform  Port ID
Router3             Ser 1          120           R        2500      Ser 0
Router1             Eth 1          180           R        2500      Eth 0
Switch1             Eth 0          240           S        1900      2</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>show cdp entry &lt;entry-name&gt; [protocol | version]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable CDP</div>
<div class="content">
<pre>(config)# no cdp run</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable CDP on an interface</div>
<div class="content">
<pre>(config-if)# cdp enable</pre>
</div>
</div>
<div class="sect4">
<h5 id="_cdp_updates">CDP updates</h5>
<div class="listingblock">
<div class="title">Task: Set the transmission frequency of CDP updates in seconds</div>
<div class="content">
<pre>(config)# cdp timer &lt;seconds&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Default: 60 seconds range: 5-254 seconds
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Specify the amount of time a receiving device should hold the information sent by your device</div>
<div class="content">
<pre>(config)# cdp holdtime &lt;seconds&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
default: 180 seconds, range: 10 to 255 seconds
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_version">Version</h5>
<div class="listingblock">
<div class="title">Task: Send Version-2 advertisements</div>
<div class="content">
<pre>(config)# cdp advertise-v2</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_and_maintenance">3.1.3. Monitoring and maintenance</h4>
<div class="listingblock">
<div class="title">Task: Reset the traffic counters to zero</div>
<div class="content">
<pre>clear cdp counters</pre>
</div>
</div>
<div class="sect4">
<h5 id="_neighbors">Neighbors</h5>
<div class="listingblock">
<div class="title">Task: Delete the CDP table of information about neighbors</div>
<div class="content">
<pre>clear cdp table</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display information about interfaces where CDP enabled</div>
<div class="content">
<pre>sh cdp interface [&lt;interface-id&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display information about neighbors</div>
<div class="content">
<pre>sh cdp neighbors [&lt;interface-id&gt;] [detail]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display CDP counters, including the number of packets sent and received and checksum errors</div>
<div class="content">
<pre># show cdp traffic

Total packets output: 543, Input: 333
 Hdr syntax: 0, Chksum error: 0, Encaps failed: 0
 No memory: 0, Invalid: 0, Fragmented: 0
 CDP version 1 advertisements output: 191, Input: 187
 CDP version 2 advertisements output: 352, Input: 146</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lldp">3.2. LLDP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Catalyst Configuration Guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swlldp.html">LLDP</span></span> </a></p>
</div>
<div class="sect3">
<h4 id="_overview_2">3.2.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>IEEE 802.1AB link layer discovery protocol</p>
</li>
<li>
<p>neighbor discovery protocol</p>
</li>
<li>
<p>advertises TLV(type, length, value) for each attribute</p>
<div class="ulist">
<ul>
<li>
<p>basic mandatory</p>
<div class="ulist">
<ul>
<li>
<p>port description</p>
</li>
<li>
<p>system name</p>
</li>
<li>
<p>system description</p>
</li>
<li>
<p>system capabilities</p>
</li>
<li>
<p>management address</p>
</li>
</ul>
</div>
</li>
<li>
<p>optional</p>
<div class="ulist">
<ul>
<li>
<p>port vlan ID for ieee 802.1</p>
</li>
<li>
<p>MAC/PHY configuration/status for ieee 802.3</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_lldp_global_state">3.2.2. LLDP global state</h4>
<div class="ulist">
<ul>
<li>
<p>Disabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable LLDP globally on the switch</div>
<div class="content">
<pre>(config)# lldp run</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display global information, such as frequency of transmissions, the holdtime for packets being sent, and the delay time before LLDP initializes on an interface.</div>
<div class="content">
<pre>show lldp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display LLDP counters, including the number of packets sent and received, number of packets discarded, and number of unrecognized TLVs.</div>
<div class="content">
<pre>show lldp traffic</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Reset the traffic counters to zero.</div>
<div class="content">
<pre>clear lldp counters</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Delete the LLDP neighbor information table.</div>
<div class="content">
<pre>clear lldp table</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Clear the NMSP statistic counters.</div>
<div class="content">
<pre>clear nmsp statistics</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lldp_interfaces">3.2.3. LLDP interfaces</h4>
<div class="ulist">
<ul>
<li>
<p>Disabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable an interface to send LLDP packets</div>
<div class="content">
<pre>(config-if)# lldp transmit</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable an interface to receive LLDP packets</div>
<div class="content">
<pre>(config-if)# lldp receive</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display information about interfaces with LLDP enabled.</div>
<div class="content">
<pre>show lldp interface [&lt;interface-id&gt;]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_neighbors_2">3.2.4. Neighbors</h4>
<div class="listingblock">
<div class="title">Task: Display information about a specific neighbor.</div>
<div class="content">
<pre>show lldp entry &lt;entry-name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display information about all neighbors.</div>
<div class="content">
<pre>show lldp entry *</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display information about neighbors, including device type, interface type and number, holdtime settings, capabilities, and port ID.</div>
<div class="content">
<pre>show lldp neighbors [&lt;interface-id&gt;] [detail]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_timers">3.2.5. Timers</h4>
<div class="ulist">
<div class="title">Task: Specify the amount of time a receiving device should hold the information from your device</div>
<ul>
<li>
<p>default: 120 s, range: 0 - 65535</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# lldp holdtime &lt;seconds&gt;</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Task: Specify the delay time in seconds for LLDP to initialize on an interface.</div>
<p>The range is 2 to 5 seconds; the default is 2 seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# lldp reinit delay</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Task: Set the sending frequency of LLDP updates in seconds.</div>
<p>The range is 5 to 65534 seconds; the default is 30 seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# lldp timer rate</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tlv">3.2.6. TLV</h4>
<div class="listingblock">
<div class="title">Task: Specify the LLDP TLVs to send or receive.</div>
<div class="content">
<pre>(config)# lldp tlv-select</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the LLDP-MED TLVs to send or receive.</div>
<div class="content">
<pre>(config)# lldp med-tlv-select</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the LLDP-MED TLV to send</div>
<div class="content">
<pre>(config-if)# lldp med-tlv-select {inventory-management | location | network-policy | power-management }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure network policy TLV</div>
<div class="content">
<pre>(config)# network-policy profile &lt;profile-number&gt;
(config)#  {voice | voice-signaling} vlan [&lt;id&gt;  {cos &lt;cvalue&gt; | dscp &lt;dvalue&gt;}]
            | [[dot1p {cos &lt;cvalue&gt; | dscp &lt;dvalue&gt;}] | none | untagged]
(config-if)# network-policy &lt;profile-number&gt;
(config-if)# lldp med-tlv select network-policy</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>if the interface is configured as a tunnel port, LLDP is automatically disabled.</p>
</li>
<li>
<p>If you first configure a network-policy profile on an interface, you cannot apply the switchport voice vlan command on the interface. If the switchport voice vlan vlan-id is already configured on an interface, you can apply a network-policy profile on the interface. This way the interface has the voice or voice-signaling VLAN network-policy profile applied on the interface.</p>
</li>
<li>
<p>You cannot configure static secure MAC addresses on an interface that has a network-policy profile.</p>
</li>
<li>
<p>You cannot configure a network-policy profile on a private-VLAN port.</p>
</li>
<li>
<p>For wired location to function, you must first enter the ip device tracking global configuration command.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Display the location information for an endpoint.</div>
<div class="content">
<pre>show location</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_network_policy_profiles">3.2.7. Network-policy profiles</h4>
<div class="listingblock">
<div class="title">Task: Display the configured network-policy profiles.</div>
<div class="content">
<pre>show network-policy profile</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the NMSP information.</div>
<div class="content">
<pre>show nmsp</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lldp_med">3.2.8. LLDP-MED</h4>
<div class="ulist">
<ul>
<li>
<p>LLDP for Media Endpoint Devices</p>
</li>
<li>
<p>operates between endpoint devices (ip phones) and network devices (switches)</p>
</li>
<li>
<p>supports VoIP applications</p>
</li>
<li>
<p>TLVs enabled by default:</p>
<div class="ulist">
<ul>
<li>
<p>LLDP-MED capabilities TLV</p>
</li>
<li>
<p>network policy TLV</p>
</li>
<li>
<p>Power management TLV</p>
</li>
<li>
<p>Inventory management TLV</p>
</li>
<li>
<p>Location TLV</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_wired_location_service">3.2.9. Wired location service</h4>
<div class="ulist">
<ul>
<li>
<p>The switch uses the wired location service feature to send location and
attachment tracking information for its connected devices to a Cisco Mobility
Services Engine (MSE). The tracked device can be a wireless endpoint, a wired
endpoint, or a wired switch or controller. The switch notifies the MSE of
device link up and link down events through the Network Mobility Services
Protocol (NMSP) location and attachment notifications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The MSE starts the NMSP connection to the switch, which opens a server port.
When the MSE connects to the switch there are a set of message exchanges to
establish version compatibility and service exchange information followed by
location information synchronization. After connection, the switch periodically
sends location and attachment notifications to the MSE. Any link up or link
down events detected during an interval are aggregated and sent at the end of
the interval.</p>
</div>
<div class="paragraph">
<p>When the switch determines the presence or absence of a device on a link-up or
link-down event, it obtains the client-specific information such as the MAC
address, IP address, and username. If the client is LLDP-MED- or CDP-capable,
the switch obtains the serial number and UDI through the LLDP-MED location TLV
or CDP.</p>
</div>
<div class="paragraph">
<p>Depending on the device capabilities, the switch obtains this client information at link up:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Slot and port specified in port connection</p>
</li>
<li>
<p>MAC address specified in the client MAC address</p>
</li>
<li>
<p>IP address specified in port connection</p>
</li>
<li>
<p>802.1X username if applicable</p>
</li>
<li>
<p>Device category is specified as a wired station</p>
</li>
<li>
<p>State is specified as new</p>
</li>
<li>
<p>Serial number, UDI</p>
</li>
<li>
<p>Model number</p>
</li>
<li>
<p>Time in seconds since the switch detected the association</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on the device capabilities, the switch obtains this client information at link down:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Slot and port that was disconnected</p>
</li>
<li>
<p>MAC address</p>
</li>
<li>
<p>IP address</p>
</li>
<li>
<p>802.1X username if applicable</p>
</li>
<li>
<p>Device category is specified as a wired station</p>
</li>
<li>
<p>State is specified as delete</p>
</li>
<li>
<p>Serial number, UDI</p>
</li>
<li>
<p>Time in seconds since the switch detected the disassociation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the switch shuts down, it sends an attachment notification with the state
delete and the IP address before closing the NMSP connection to the MSE. The
MSE interprets this notification as disassociation for all the wired clients
associated with the switch.</p>
</div>
<div class="paragraph">
<p>If you change a location address on the switch, the switch sends an NMSP
location notification message that identifies the affected ports and the
changed address information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_udld">3.3. UDLD</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Catalyst 3560 Configuration Guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swudld.html">UDLD</span></span></a></p>
</div>
<div class="sect3">
<h4 id="_overview_3">3.3.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>Problem:  unidirectional links</p>
<div class="ulist">
<ul>
<li>
<p>one of the 2 transmission paths has failed but not both</p>
</li>
<li>
<p>due to miscabling, cutting on fiber cable, unplugging one fiber, GBIC problems, &#8230;&#8203;</p>
</li>
<li>
<p>can cause a loop as the previously blocking port will move to a forwarding state</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/stp-unidirectional-links.png" alt="stp unidirectional links" height="150">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>solutions:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">UDLD <strong>u</strong>ni<strong>d</strong>irectional <strong>l</strong>ink <strong>d</strong>etection</dt>
<dd>
<p>Uses Layer 2 messaging to decide when a switch can no longer receive frames from
a neighbor. The switch whose transmit interface did not fail is placed into an err-disabled
state.</p>
</dd>
<dt class="hdlist1">UDLD aggressive mode</dt>
<dd>
<p>Attempts to reconnect with the other switch (eight times)
after realizing no messages have been received.
If the other switch does not reply to the repeated additional messages,
both sides become err-disabled.</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_modes_of_operations">Modes of operations</h5>
<div class="sect5">
<h6 id="_normal">Normal</h6>
<div class="ulist">
<ul>
<li>
<p>default</p>
</li>
<li>
<p>detects unidirectional links due to misconnected ports on fiber-optic connection</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_aggresive_mode">Aggresive mode</h6>

</div>
</div>
</div>
<div class="sect3">
<h4 id="_tasks">3.3.2. Tasks</h4>
<div class="sect4">
<h5 id="_default_configuration">Default configuration</h5>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Setting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDLD global enable state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Globally disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDLD per-port enable state for fiber-optic media</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled on all Ethernet fiber-optic ports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDLD per-port enable state for UTP copper media</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled on all Ethernet 10/100/1000BASE-TX ports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDLD aggressive mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Enable UDLD globally</div>
<div class="content">
<pre>(config)# udld {aggressive | enable | message time &lt;seconds&gt;}</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">message time &lt;seconds&gt;</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>configure the period of time between UDLD probe messages on ports
that are in the advertisement phase and are detected to be bidirectional.</p>
</li>
<li>
<p>range: 1 to 90 seconds</p>
</li>
<li>
<p>default: 15 seconds</p>
</li>
<li>
<p>This command affects fiber-optic ports only. Use <strong>(config-if)# udld</strong>
to enable UDLD on other port types.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Reset an interface disabled by UDLD</div>
<div class="content">
<pre>udld reset</pre>
</div>
</div>
<div class="paragraph">
<p>You can also  restart the disabled port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>shutdown</strong> followed by <strong>no shutdown</strong></p>
</li>
<li>
<p><strong>no udld {aggressive | enable}</strong> followed by <strong>udld {aggressive | enable}</strong></p>
</li>
<li>
<p><strong>no udld port</strong> followed by <strong>udld port [aggressive]</strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_udld_error_disabled_state">3.3.3. UDLD error-disabled state</h4>
<div class="listingblock">
<div class="title">Task: Recover from the UDLD error-disabled state</div>
<div class="content">
<pre>! Enable UDLD to automatically recover
(config)# errdisable recovery cause udld

! Specify the time to recover from the UDLD error-disabled state
(config-if)# errdisable recovery interval &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display UDLD status</div>
<div class="content">
<pre>show udld [interface-id]</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vlans_and_trunking">4. VLANs and Trunking</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_normal_and_extended_vlans">4.1. Normal and Extended VLANs</h3>
<div class="ulist">
<ul>
<li>
<p>administratively defined subset of switch ports that are in the same broadcast domain</p>
</li>
<li>
<p>best practice: one VLAN, one IP subnet</p>
</li>
<li>
<p>traffic inside same VLAN is layer 2 switched</p>
</li>
<li>
<p>traffic between VLANs is layer 3 routed</p>
</li>
<li>
<p>can span multiple physical switches over "trunks"</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_vlan_numbering">4.1.1. VLAN numbering</h4>
<div class="ulist">
<ul>
<li>
<p>VLAN ID = 12 bits</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Reserved [0, 4095] </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>not available for use</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Normal-range [1-1005]</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>advertised and pruned by VTP v1 and v2 except vlan 1, 1002-1005</p>
</li>
<li>
<p>configured in both vlan database mode and configuration mode</p>
</li>
<li>
<p>stored in VLAN.DAT file in Flash</p>
</li>
<li>
<p>Special vlans:</p>
<div class="ulist">
<ul>
<li>
<p>Vlan 1 is the default Ethernet VLAN for all access ports; cannot be deleted or changed.</p>
</li>
<li>
<p>Vlan 1002-1004 : default for FDDI</p>
</li>
<li>
<p>Vlan 1002-1005 : default for Token Ring translational bridge.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Extended-range [1006-4094] </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>cannot be advertised or pruned by VTP v1 and v2</p>
</li>
<li>
<p>configured only in VTP transparent mode</p>
</li>
<li>
<p>stored only in the running configuration</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_vlan_trunks">4.1.2. VLAN Trunks</h4>
<div class="ulist">
<ul>
<li>
<p>trunk: point-to-point links for multiple VLANs between devices</p>
</li>
<li>
<p>trunking add ISL or 802.1q headers to include VLAN id.</p>
<div class="ulist">
<ul>
<li>
<p>ISL : Cisco proprietary, 30-bytes (26-byte header + 4-byte trailer), does not modify original frame</p>
</li>
<li>
<p>802.1q: IEEE standard, 4-byte tag except for native VLAN, modifies original frame</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_basic_configuration">4.1.3. Basic configuration</h4>
<div class="paragraph">
<p>Configuring VLANs requires few steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the VLAN itself</p>
</li>
<li>
<p>Associate the correct ports with VLAN</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>VLAN creation can be done either in VLAN database mode configuration (after <strong>vlan database</strong> ) or normal configuration mode</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 2. Catalyst 3550 VLAN database vs configuration mode</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VLAN Database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vtp {domain domain-name | password password | pruning | v2-mode | {server | client | transparent}}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">vtp {domain domain-name | file filename | interface name | mode {client | server | transparent} | password password | pruning | version number}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vlan vlan-id [backupcrf {enable | disable}] [mtu mtu-size] [name vlan-name] [parent parent-vlan-id] [state {suspend | active}]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">vlan vlan-id 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show {current | proposed | difference}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No equivalent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apply | abort | reset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No equivalent</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_troubleshoot">4.1.4. Troubleshoot</h4>
<div class="paragraph">
<p>Check "Creating ethernet vlans on catalyst switches: troubleshoot tips"</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SVI will be in "up/down" state after being deleted</p>
</li>
<li>
<p>SVI will be in "up/up" if</p>
<div class="ulist">
<ul>
<li>
<p>the VLAN associated with the SVI exists in the VLAN database</p>
</li>
<li>
<p>at least one trunk or access port in the "up/up" state has been assigned to the VLAN</p>
</li>
<li>
<p>those ports in the "up/up" state are not blocked by STP</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_voice_vlans">4.2. Voice VLANs</h3>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swvoip.html" class="bare">http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swvoip.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_private_vlans">4.3. Private VLANs</h3>
<div class="ulist">
<ul>
<li>
<p>separate ports as if they are on different VLAN while consuming only one subset.</p>
</li>
<li>
<p>typically use by service provider in a multi-tenant offerings: one router, one switch, multiple customers</p>
</li>
<li>
<p>pVLAN = one primary VLAN ( promiscuous ports) + multiple secondary VLANs ( community and isolated ports)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swpvlan.html" class="bare">http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swpvlan.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_vtp">4.4. VTP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Catalyst Configuration guides</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swvtp.html#pgfId-1035238">Configuring VTP</span></span> </a></p>
</div>
<div class="sect3">
<h4 id="_overview_4">4.4.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>VTP vlan trunk protocol</p>
</li>
<li>
<p>Cisco-proprietary that distributes VLAN information among Catalyst switches</p>
</li>
<li>
<p>Advertises the VLAN Id, Name and Type but not which ports should be in each VLAN</p>
</li>
<li>
<p>Eases administrative burden for addition, deletion and renaming of VLANs</p>
</li>
<li>
<p>Supports 1005 VLANs (IP base or IP services feature set) or 255 VLANs (LAN base feature set)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_vtp_message_format">4.4.2. VTP message format</h4>
<div class="ulist">
<ul>
<li>
<p>Encapsulated in ISL or 802.1q frames</p>
</li>
<li>
<p>Multicasted to  MAC address: 0100-0CCC-CCCC, LLC code: SNAP (AAAA), Type 2003 in the SNAP Header</p>
</li>
<li>
<p>Carried through trunk ports and VLAN 1</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/vtp-in-isl.png" alt="vtp in isl" height="80">
</div>
<div class="title">Figure 5. Example: VTP packet encapsulated in ISL frame</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The VTP header contains these fields:</p>
<div class="ulist">
<ul>
<li>
<p>VTP protocol version: 1,2,3</p>
</li>
<li>
<p>VTP message types: summary advertisements, subset advertisements, advertisement requests, VTP join messages</p>
</li>
<li>
<p>management domain length</p>
</li>
<li>
<p>management domain name</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_summary_advertisements">Summary advertisements</h5>
<div class="ulist">
<ul>
<li>
<p>Informs adjacent Catalysts of the current VTP domain name and the configuration revision number.</p>
</li>
<li>
<p>5 minutes intervals</p>
</li>
<li>
<p>When the switch receives a summary advertisement packet,</p>
<div class="ulist">
<ul>
<li>
<p>the switch compares the VTP domain name to its own VTP domain name.</p>
</li>
<li>
<p>If the name is different, the switch simply ignores the packet.</p>
</li>
<li>
<p>If the name is the same, the switch then compares the configuration revision to its own revision.</p>
</li>
<li>
<p>If its own configuration revision is higher or equal, the packet is ignored.</p>
</li>
<li>
<p>If it is lower, an advertisement request is sent.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/vtp-summary-advert-packet-format.png.png" alt="VTP Summary Advert" width="896" height="312">
</div>
<div class="title">Figure 6. VTP Summary Advert</div>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Followers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that this packet is followed by a Subset Advertisement packet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updater Identity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address of the switch that is the last to have incremented the configuration revision.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update Timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date and time of the last increment of the configuration revision.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MD5 Digest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If MD5 is configured and used to authenticate the validation of a VTP update.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_subset_advertisements">Subset advertisements</h5>
<div class="ulist">
<ul>
<li>
<p>Follows the summary advertisement after addition, deletion or modification of a VLAN.</p>
</li>
<li>
<p>Contains a list of VLAN information.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/vtp-subset-advert-packet-format.png.png" alt="VTP Subset advertisements" width="896" height="312">
</div>
<div class="title">Figure 7. VTP Subset advertisements</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Code</dt>
<dd>
<p>value: 0x02 for subset advertisement.</p>
</dd>
<dt class="hdlist1">Sequence number</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Identify the packet in the stream of packets that follow a summary advertisement</p>
</li>
<li>
<p>Starts with value 1</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_advertisement_request">Advertisement request</h5>
<div class="paragraph">
<p>A switch needs a VTP advertisement request in these situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The switch has been reset.</p>
</li>
<li>
<p>The VTP domain name has been changed.</p>
</li>
<li>
<p>The switch has received a VTP summary advertisement with a higher configuration revision than its own.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upon receipt of an advertisement request, a VTP device sends a summary advertisement.
One or more subset advertisements follow the summary advertisement. This is an example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/vtp-request-advert-packet-format.png.png" alt="VTP advertisement request" width="896" height="216">
</div>
<div class="title">Figure 8. VTP advertisement request</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Start-Value</dt>
<dd>
<p>This is used in cases in which there are several subset advertisements.
If the first (n) subset advertisement has been received
and the subsequent one (n+1) has not been received,
the Catalyst only requests advertisements from the (n+1)th one.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vtp_domains">4.4.3. VTP domains</h4>
<div class="ulist">
<ul>
<li>
<p>Controls which devices can exchange VTP advertisements</p>
</li>
<li>
<p>Defaults to null value</p>
</li>
<li>
<p>Switch inherits VTP domain name of first received advertisement over trunk links</p>
</li>
<li>
<p>A switch can only be part of one domain at a time</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the VTP domain name</div>
<div class="content">
<pre>(config)# vtp domain &lt;name&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_revision_number">4.4.4. Configuration revision number</h4>
<div class="ulist">
<ul>
<li>
<p>32-bit</p>
</li>
<li>
<p>Incremented by one for each configuration change</p>
</li>
<li>
<p>Higher revision indicates newer database</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_allowed_active_and_pruned_vlans">4.4.5. Allowed, active and pruned VLANs</h4>
<div class="paragraph">
<p>Although a trunk can support VLANs 1–4094, several mechanisms reduce the actual number of
VLANs whose traffic flows over the trunk. First, VLANs can be administratively forbidden from
existing over the trunk using the <strong>switchport trunk allowed</strong> interface subcommand. Also, any
allowed VLANs must be configured on the switch before they are considered active on the trunk.
Finally, VTP can prune VLANs from the trunk, with the switch simply ceasing to forward frames
from that VLAN over the trunk.</p>
</div>
<div class="paragraph">
<p>The <strong>show interface trunk</strong> command lists the VLANs that fall into each category:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed VLANs </dt>
<dd>
<p>Each trunk allows all VLANs by default. However, VLANs can be
removed or added to the list of allowed VLANs by using the switchport trunk allowed
command.</p>
</dd>
<dt class="hdlist1">Allowed and active </dt>
<dd>
<p>To be active, a VLAN must be in the allowed list for the trunk (based on trunk configuration),
and the VLAN must exist in the VLAN configuration on the switch.
With PVST+, an STP instance is actively running on this trunk for the VLANs in this list.</p>
</dd>
<dt class="hdlist1">Active and not pruned </dt>
<dd>
<p>This list is a subset of the “allowed and active” list, with any VTP-pruned VLANs removed.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_vtp_modes">4.4.6. VTP modes</h4>
<div class="paragraph">
<p>You can configure a switch to operate in any one of these VTP modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Server</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Default mode</p>
</li>
<li>
<p>Allows addition, deletion and modification of VLAN information</p>
</li>
<li>
<p>Changes on server overwrite the rest of the domain</p>
</li>
<li>
<p>Configuration saved in NVRAM</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Configure the switch as a VTP server</div>
<div class="content">
<pre>vtp mode server</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Client</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Cannot add, remove or modify VLAN information</p>
</li>
<li>
<p>Listens for advertisements originated by server, install them and passes them on</p>
</li>
<li>
<p>Configuration saved in NVRAM only for VTPv3</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Configure the switch as a VTP client</div>
<div class="content">
<pre>vtp mode client</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Transparent</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Keeps a separate VTP database from the rest of the domain</p>
</li>
<li>
<p>Does not originate advertisements</p>
</li>
<li>
<p>"transparently" passes received advertisements through without installing them</p>
</li>
<li>
<p>Can still create, remove or renamed VLANs which are not advertised to neighboring switches.</p>
</li>
<li>
<p>Need for some applications like Private VLANs</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Setup VTP transparent mode</div>
<div class="content">
<pre>vtp mode transparent</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Off (configurable only in CatOS switches)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Like VTP transparent mode with the exception that VTP advertisements are not forwarded</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 3. VTP Modes and Features</caption>
<colgroup>
<col style="width: 70%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server Mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transparent Mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Originates VTP advertisements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes received advertisements to update its VLAN configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forwards received VTP advertisements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Saves VLAN configuration in NVRAM or vlan.dat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, modify, or delete VLANs using  configuration commands</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_vtp_security">4.4.7. VTP security</h4>
<div class="ulist">
<ul>
<li>
<p>MD5 authentication prevents against certain attack</p>
<div class="ulist">
<ul>
<li>
<p>does not prevent against misconfiguration</p>
</li>
<li>
<p>password must be setup manually because switches only exchanges MD5 digest of the password.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure VTP authentication</div>
<div class="content">
<pre>(config)# vtp password &lt;string&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Show the VTP password</div>
<div class="content">
<pre>(config)# sh vtp password</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vtp_pruning">4.4.8. VTP pruning</h4>
<div class="ulist">
<ul>
<li>
<p>Problem:</p>
<div class="ulist">
<ul>
<li>
<p>Broadcasts and unknown unicast/multicast frame are flooded everywhere in the broadcast domain
included through trunks links</p>
</li>
<li>
<p>Manual editing allowed list is a huge administrative overhead</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/flooding-traffic-without-vtp-pruning.png" alt="Flooding traffic without VTP pruning">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Solution: VTP pruning</p>
<div class="ulist">
<ul>
<li>
<p>Switches advertise what they need</p>
</li>
</ul>
</div>
</li>
<li>
<p>All other VLANs are pruned off the trunk link</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/flooding-traffic-with-vtp-pruning.png" alt="Optimized flooded traffic with VTP pruning">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Restriction:</p>
<div class="ulist">
<ul>
<li>
<p>Pruning does not work in transparent mode. Why?</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_pruning_eligibility">Pruning eligibility</h5>
<div class="ulist">
<ul>
<li>
<p>When VTP pruning is enabled on a VTP server,
pruning is enabled for the entire management domain
except for pruning-ineligible VLANS ( Vlan 1, 1002-1005, 1006-4094)</p>
</li>
<li>
<p>Making VLANs pruning-eligible or pruning-ineligible affects pruning eligibility for those VLANs on that trunk only
(not on all switches in the VTP domain).</p>
</li>
<li>
<p>VTP pruning takes effect several seconds after you enable it.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_version_2">4.4.9. Version</h4>
<div class="paragraph">
<p>TODO: Add task for this section</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default: version 1</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_version_2_2">Version 2</h5>
<div class="paragraph">
<p>-</p>
</div>
</div>
<div class="sect4">
<h5 id="_version_3">Version 3</h5>
<div class="ulist">
<ul>
<li>
<p>Supports the whole IEEE 802.1q vlan range up to 4095 ( v1 and v2 support only normal range VLANs 1-1005)</p>
</li>
<li>
<p>Can send private LAN information in addition to normal VLAN information.</p>
</li>
<li>
<p>Backward compatible with VTP 2</p>
</li>
<li>
<p>Add support for databases other than VLAN databases such as MST databases.</p>
</li>
<li>
<p>Clear text or hidden password protection</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, read <a href="http://www.cisco.com/c/en/us/products/collateral/switches/catalyst-6500-series-switches/solution_guide_c78_508010.html">VTP version 3</a></p>
</div>
<div class="listingblock">
<div class="title">Task: Verify VTP configuration</div>
<div class="content">
<pre># show vtp status

VTP Version: 3 (capable)
Configuration Revision: 1
Maximum VLANs supported locally: 1005
Number of existing VLANs: 37
VTP Operating Mode: Server
VTP Domain Name: [smartports]
VTP Pruning Mode: Disabled
VTP V2 Mode: Enabled
VTP Traps Generation: Disabled
MD5 digest : 0x26 0xEE 0x0D 0x84 0x73 0x0E 0x1B 0x69
Configuration last modified by 172.20.52.19 at 7-25-08 14:33:43
Local updater ID is 172.20.52.19 on interface Gi5/2 (first layer3 interface fou)
VTP version running: 2</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting_2">4.4.10. Troubleshooting</h4>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/support/docs/lan-switching/vtp/98155-tshoot-vlan.html#topic9" class="bare">http://www.cisco.com/c/en/us/support/docs/lan-switching/vtp/98155-tshoot-vlan.html#topic9</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dtp">4.5. DTP</h3>
<div class="sect3">
<h4 id="_dynamic_trunk_protocol">4.5.1. Dynamic trunk protocol</h4>
<div class="ulist">
<ul>
<li>
<p>negotiate trunk status</p>
</li>
<li>
<p>default to <strong>dynamic auto</strong></p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 4. Trunking configuration options that lead to a working trunk</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Command</th>
<th class="tableblock halign-left valign-top">Short name</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">To trunk other side must be</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode trunk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trunk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always trunks on this end; sends DTP to help other side choose to trunk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On, desirable, auto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode trunk ; switchport nonegotiate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonegotiate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always trunks on this end; does not send DTP messages (good when other switch is a non-Cisco switch)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode dynamic desirable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desirable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sends DTP messages, and trunks if negotiation succeeds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On, desirable, auto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode dynamic auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replies to DTP messages, and trunks if negotiation succeeds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On, desirable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Never trunks; sends DTP to help other side reach same conclusion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Never trunks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchport mode access; switchport nonegotiate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access (with nonegotiate)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Never trunks; does not send DTP messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Never trunks)</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Configure an inter-switch links to be in dynamic desirable state</div>
<div class="content">
<pre>(config-if)# switchport mode dynamic desirable</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable DTP for a port administratively configured as a trunk</div>
<div class="content">
<pre>(config-if)# switchport mode trunk
(config-if)# switchport nonegotiate</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Put the interface into permanent nontrunking mode</div>
<div class="content">
<pre>(config-if)# switchport mode access</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display a summary of trunk-related information</div>
<div class="content">
<pre>show interface trunk: Summary of trunk-related information</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: List trunking details for a specified interface</div>
<div class="content">
<pre>show interface &lt;type number&gt; trunk</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: List nontrunking details for a particular interface</div>
<div class="content">
<pre>show interface &lt;type number&gt; switchport</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display DTP information for the switch</div>
<div class="content">
<pre># show dtp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display DTP information for a specific interface</div>
<div class="content">
<pre># show dtp interface &lt;type slot/number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable trunking but disable DTP for routers</div>
<div class="content">
<pre>! SW1
conf t
int e0/0
  switchport trunk enc dot1q
  switchport mode trunk
  switchport nonegotiate

! R1
conf t
int e0/0.1
  enc dot1q 123</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_verify">4.5.2. Verify</h4>
<div class="paragraph">
<p>What is TOS/TAT in</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sh dtp interface fa 0/19</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_isl">4.6. ISL</h3>
<div class="sect3">
<h4 id="_overview_5">4.6.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>Inter-Switch Link</p>
</li>
<li>
<p>Cisco proprietary</p>
</li>
<li>
<p>Provides VLAN trunking</p>
</li>
<li>
<p>Supports up to 1000 VLANs  (check ???)</p>
</li>
<li>
<p>Encapsulates the original header with 26-byte header</p>
</li>
<li>
<p>Removes the header at the receiving end</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_frame">4.6.2. Frame</h4>
<div class="paragraph">
<p>The ISL frame consists of three fields: the ISL header( 26 bytes), the original frame and the FCS (4 bytes)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/isl-frame.png" alt="isl frame" height="100">
</div>
</div>
<div class="sect4">
<h5 id="_field_descriptions">Field descriptions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">DA—Destination Address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>40-bit</p>
</li>
<li>
<p>Multicast address: "0100-0C00-00" or "0300-0C00-00".</p>
</li>
<li>
<p>The first 40 bits of the DA field signal the receiver that the packet is in ISL format. ???</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">TYPE—Frame Type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>4 bits</p>
</li>
<li>
<p>Indicates the type of the original frame</p>
<div class="ulist">
<ul>
<li>
<p>0000: 	Ethernet</p>
</li>
<li>
<p>0001: 	Token Ring</p>
</li>
<li>
<p>0010: 	FDDI</p>
</li>
<li>
<p>0011: 	ATM</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">USER—User Defined Bits (TYPE Extension)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>4 bits</p>
</li>
<li>
<p>Extends the meaning of the TYPE field</p>
</li>
<li>
<p>Default value: "0000"</p>
</li>
<li>
<p>For Ethernet frames, the USER field bits "0" and "1" indicate the priority of the packet as
it passes through the switch. Whenever traffic can be handled in a manner that
allows it to be forwarded more quickly, the packets with this bit set should
take advantage of the quick path. It is not required that such paths be
provided.</p>
<div class="ulist">
<ul>
<li>
<p>XX00 	Normal Priority</p>
</li>
<li>
<p>XX01 	Priority 1</p>
</li>
<li>
<p>XX10 	Priority 2</p>
</li>
<li>
<p>XX11 	Highest Priority</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SA—Source Address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>48 bits set to set MAC address of the switch port that transmits the frame.</p>
</li>
<li>
<p>May be ignored by the receiving device</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">LEN—Length</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits set to the length of the packet in bytes
with the exclusion of the DA, TYPE, USER, SA, LEN, and FCS fields.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">AAAA03 (SNAP)—Subnetwork Access Protocol (SNAP) and Logical Link Control (LLC)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>24 bits set to "0xAAAA03".</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HSA—High Bits of Source Address</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>24 bits set to 0x00-00-0C (Cisco OUI) of the SA field.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">VLAN—Destination Virtual LAN ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>15 bits set to the VLAN ID of the frame</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">BPDU—BPDU and CDP Indicator</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>1 bit set when STP or CDP encapsulates an ISL packet</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">INDX—Index</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits set to the port index of the source of the packet as it exits the switch</p>
</li>
<li>
<p>Used for diagnostic purposes only</p>
</li>
<li>
<p>May be ignored by the receiving bridge</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">RES—Reserved for Token Ring and FDDI</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits used when Token Ring or FDDI packets are encapsulated with an ISL frame</p>
<div class="ulist">
<ul>
<li>
<p>In the case of Token Ring frames, the Access Control (AC) and Frame Control (FC) fields are placed here.</p>
</li>
<li>
<p>In the case of FDDI, the FC field is placed in the Least Significant Byte (LSB) of this field.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For Ethernet packets, the RES field should be set to all zeros.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">ENCAP FRAME—Encapsulated Frame</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Encapsulated data packet with its own CRC value completely unmodified</p>
</li>
<li>
<p>Length from 1 to 24575 bytes</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">FCS—Frame Check Sequence</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>4 bytes set by the sending MAC and recalculated by the receiving bridge</p>
</li>
<li>
<p>New FCS calculated over the entire ISL packet</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ieee_802_1q">4.7. IEEE 802.1Q</h3>
<div class="sect3">
<h4 id="_definition">4.7.1. Definition</h4>
<div class="ulist">
<ul>
<li>
<p>Tags frames on a trunk</p>
<div class="ulist">
<ul>
<li>
<p>Inserts a 4-byte tag into the original frame between the Source Address and the Type/Length field</p>
</li>
<li>
<p>Recomputes the frame check sequence (FCS) before the device sends the frame over the trunk link.</p>
</li>
<li>
<p>Removes the tag at the receiving end</p>
</li>
</ul>
</div>
</li>
<li>
<p>Does not tag frames on the native VLAN.</p>
<div class="ulist">
<ul>
<li>
<p>Must use the same native VLAN on both sides of the trunk</p>
</li>
<li>
<p>Default to VLAN 1</p>
</li>
</ul>
</div>
</li>
<li>
<p>Supports up to 4096 VLANs</p>
<div class="ulist">
<ul>
<li>
<p>Defines a single instance of spanning tree that runs on the native VLAN for all the VLANs in the network.</p>
</li>
<li>
<p>lacks the flexibility and load balancing capability of PVST that is available with ISL.</p>
</li>
<li>
<p>PVST+ offers the capability to retain multiple spanning tree topologies with 802.1Q trunking.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_frame_format">4.7.2. Frame Format</h4>
<div class="imageblock">
<div class="content">
<img src="../images/802-1q-frame.png" alt="802.1Q frame">
</div>
</div>
<div class="sect4">
<h5 id="_field_descriptions_2">Field descriptions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">TPID—Tag Protocol Identifier</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>16 bits</p>
</li>
<li>
<p>Value: 08100</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Priority</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>3 bits</p>
</li>
<li>
<p>Called also user priority or IEEE 802.p</p>
</li>
<li>
<p>Indicates the frame priority level</p>
</li>
<li>
<p>Can be used to prioritize the traffic</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">CFI—Canonical Format Indicator</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>1 bit</p>
</li>
<li>
<p>Value: 0 if MAC address is in canonical format otherwise 1</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">VID—VLAN Identifier</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>12 bits</p>
</li>
<li>
<p>Identifies the VLAN to which the frame belongs</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_ethernet_frame_size_with_802_1q_tagging">Ethernet Frame Size with 802.1Q tagging</h5>
<div class="ulist">
<ul>
<li>
<p>Maximum size: 1522 bytes</p>
</li>
<li>
<p>Minimum size: 68 bytes</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_native_vlan">4.7.3. Native VLAN</h4>
<div class="listingblock">
<div class="title">Task:  Configure a native VLAN over a trunk link</div>
<div class="content">
<pre>(config-if)# switchport trunk native vlan &lt;id&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spanning_tree">5. Spanning tree</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_stp">5.1. STP</h3>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swstp.html" class="bare">http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swstp.html</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates loop-free layer 2 topology</p>
</li>
<li>
<p>prevents broadcast storms</p>
</li>
<li>
<p>STP variations:</p>
<div class="ulist">
<ul>
<li>
<p>802.1d : Common Spanning Tree</p>
</li>
<li>
<p>PVST/PVST+: Cisco per-VLAN Spanning Tree</p>
</li>
<li>
<p>802.1w: Rapid Spanning Tree Protocol</p>
</li>
<li>
<p>802.1s: Multiple STP</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_802_1d">5.1.1. 802.1d</h4>
<div class="ulist">
<ul>
<li>
<p>Uses bpdu</p>
</li>
<li>
<p>Elect one root switch and one designated switch for each segment</p>
</li>
<li>
<p>One root port per non-root switch, one designated port for each segment</p>
</li>
<li>
<p>Other ports on blocking state</p>
</li>
<li>
<p>Steps</p>
<div class="ulist">
<ul>
<li>
<p>elect the root switch with the lowest bridge id ( 2-byte priority + 6-byte MAC)</p>
</li>
<li>
<p>determine each switch&#8217;s root port: with the least cost path to the root</p>
</li>
<li>
<p>determine the designated port for each segment:
the switch that forwards the least cost hello on the segment</p>
</li>
<li>
<p>if there is a tie, select the lowest port ID</p>
</li>
</ul>
</div>
</li>
<li>
<p>Original ieee 802.1d bridge Id</p>
<div class="ulist">
<ul>
<li>
<p>2-byte priority</p>
</li>
<li>
<p>6-byte MAC adress</p>
</li>
</ul>
</div>
</li>
<li>
<p>Revised ieee 802.1d brigde id Priority for MAC address reduction</p>
<div class="ulist">
<ul>
<li>
<p>4 bits : priority multiple of 4096</p>
</li>
<li>
<p>12 bits : system id extension (vlan id ) to support pvst+ and ieee 802.1s</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_root_port_election">Root port election</h5>
<div class="ulist">
<ul>
<li>
<p>RP is upstream facing towards Root bridge</p>
</li>
<li>
<p>lowest root path cost ( cumulative cost of all links to get to the root)</p>
</li>
<li>
<p>cost based on inverse bandwith</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 5. default port costs</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Speed</th>
<th class="tableblock halign-left valign-top">original</th>
<th class="tableblock halign-left valign-top">revised</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Mbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 Mbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Gbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Gbps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Tie breaker when a switch receives multiple Hellos with equal cost</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>lowest bridge id</p>
</li>
<li>
<p>lowest port priority</p>
</li>
<li>
<p>lowest port number</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Task: Force election of a root bridge</div>
<div class="content">
<pre># spanning-tree vlan &lt;id&gt; root</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_determining_the_designated_port">determining the designated port</h5>
<div class="ulist">
<ul>
<li>
<p>Designated switch: send the hello with the lowest advertised cost for the segment</p>
</li>
<li>
<p>DP: port that forward frames onto that segment</p>
</li>
<li>
<p>DP are downstream facing away from root bridge</p>
</li>
<li>
<p>elected based on lowest root path cost, BID, port ID</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_blocking_all_non_rp_and_non_dp_ports">blocking all non-RP and non-DP ports</h5>
<div class="ulist">
<ul>
<li>
<p>Receive BPDUs</p>
</li>
<li>
<p>discard all other traffic</p>
</li>
<li>
<p>cannot send traffic</p>
</li>
<li>
<p>do not send Hellos</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_convergence">Convergence</h5>
<div class="ulist">
<ul>
<li>
<p>Steady operations: one Root bridge, one RP on each non-root bridge, one DP on each segment, blocking state</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>root switch generates a Hello every 2 seconds</p>
</li>
<li>
<p>each RP on non root switch receives a copy of the root&#8217;s hello</p>
</li>
<li>
<p>each DP updates and forwards the hello out</p>
</li>
<li>
<p>each blocking port receives a copy of the hello from the DP without forwarding it</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_topology_change_notification">Topology change notification</h5>
<div class="paragraph">
<p>more at
<a href="http://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/24062-146.html#topchng">understand new topology changes</a></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A switch experiencing the STP port state change sends a TCN BPDU out its Root Port; it
repeats this message every Hello time until it is acknowledged.</p>
</li>
<li>
<p>The next switch receiving that TCN BPDU sends back an acknowledgment via its next
forwarded Hello BPDU by marking the Topology Change Acknowledgment (TCA) bit in
the Hello.</p>
</li>
<li>
<p>The switch that was the DP on the segment in the first two steps repeats the first two steps,
sending a TCN BPDU out its Root Port, and awaiting acknowledgment from the DP on that
segment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By each successive switch repeating Steps 1 and 2, eventually the root receives a TCN BPDU.
Once received, the root sets the TC flag on the next several Hellos, which are forwarded to all
switches in the network, notifying them that a change has occurred. A switch receiving a Hello
BPDU with the TC flag set uses the short (Forward Delay time) timer to time out entries in
the CAM.</p>
</div>
<div class="paragraph">
<p>Transitioning from blocking to forwarding</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">forward data frames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learn source MAC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stable?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blocking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listening</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forwarding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_timers_2">Timers</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Hello timer</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>2 seconds</p>
</li>
<li>
<p>Interval at which the root sends Hellos</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">- Forward delay</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>15 seconds</p>
</li>
<li>
<p>Time that switch leaves a port in listening state and learning state</p>
</li>
<li>
<p>also used sd the short CAM timeout timer</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">- Maxage</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>20 seconds</p>
</li>
<li>
<p>Time without hearing a Hello before believing that the root has failed</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_pvst">PVST+</h5>
<div class="ulist">
<ul>
<li>
<p>Per-VLAN STP : for better load balancing</p>
<div class="ulist">
<ul>
<li>
<p>one instance of legacy STP per VLAN</p>
</li>
<li>
<p>Cisco ISL support</p>
</li>
</ul>
</div>
</li>
<li>
<p>PVST+</p>
<div class="ulist">
<ul>
<li>
<p>one instance of legacy STP per VLAN</p>
</li>
<li>
<p>Cisco ISL and 802.1q support</p>
</li>
<li>
<p>interoperability between CST and PVST</p>
</li>
</ul>
</div>
</li>
<li>
<p>default mode on most Catalyst platforms</p>
</li>
<li>
<p>allows root bridge/port placement per VLAN</p>
</li>
<li>
<p>Non-cisco + 802.1q &#8658; one Common Spanning Tree over vlan  1</p>
</li>
<li>
<p>When mixing cisco and non cisco switches with 802.1q trunking,</p>
<div class="ulist">
<ul>
<li>
<p>send bpdu to multicast destination MAC of 0100.0CCC.CCCD</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configuration">configuration</h5>
<div class="paragraph">
<p>show spanning-tree root
show spanning-tree vlan 1 root detail</p>
</div>
</div>
<div class="sect4">
<h5 id="_optimizing_improving_spanning_tree">optimizing, improving spanning tree</h5>
<div class="sect5">
<h6 id="_portfast">PortFast</h6>
<div class="ulist">
<ul>
<li>
<p>Used on access ports connected to end users devices not other switches</p>
</li>
<li>
<p>Puts the port into forwarding state immediately</p>
</li>
<li>
<p>Prevent them to generate TCNs</p>
</li>
<li>
<p>Can generate loops if another switch is connected. so must be used with bpdu guard and root guard features</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(cfg-if) spanning-tree portfast
(cfg) spanning-tree portfast default</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_uplinkfast">UplinkFast</h6>
<div class="ulist">
<ul>
<li>
<p>Used on access layer switches that have multiple uplinks to distribution/core switches</p>
</li>
<li>
<p>Immediately replaces a lost RP with an alternate RP</p>
</li>
<li>
<p>Increases the root and all port priority so the switch does not become root or transit switch</p>
</li>
<li>
<p>Time-out the correct entries in their CAMs but doesnt use the TCN process. Instead, finds all the MAC
addresses of local devices and sends one multicast frame with each local addresses as the source MAC
causing all the other switches to update their CAMs. The access switch also clears out the rest of the
entries in its own CAM.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)#  spanning-tree uplinkfast [max-update-rate rate]</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_backbonefast">BackboneFast</h6>
<div class="ulist">
<ul>
<li>
<p>Used in core switches to detect indirect link failures to the Root</p>
</li>
<li>
<p>Do not wait for Maxage to expire when another switch&#8217;s direct link fails</p>
</li>
<li>
<p>Send a Root Link Query out the port in which the missing Hello should arrive.
The RLQ asks the neighboring switch if that neighboring switch is still receiving Hellos from the root.
IF that neighbor had a direct link failure, it can tell the original switch via another RLQ that this path to the root is lost. Once known,
the switch experiencing the indirect link failure can go ahead and converge without waiting for Axage to expire</p>
</li>
<li>
<p>All switches must have backbone fast configured</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)#  spanning-tree backbonefast</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bpdu_filter">bpdu filter</h5>
<div class="ulist">
<ul>
<li>
<p>Filter BPDUs in and out</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_bpdu_guard">bpdu guard</h5>
<div class="ulist">
<ul>
<li>
<p>Puts a (portfast enabled ???) port into the errdisable state when a BPDU is received and shuts down the port</p>
</li>
<li>
<p>The port must be manually re-enabled or it can be recovered automatically through the errdiable timeout function.</p>
</li>
<li>
<p>A port configured with bpdu guard will not be put into the root-inconsistent state.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_loop_guard">loop guard</h5>
<div class="ulist">
<ul>
<li>
<p>Prevents non-designated ports from inadvertently forming layer 2 switching loops
if the flow of bpdus is interrupted.</p>
</li>
<li>
<p>Puts the port into the loop-inconsistent state when the steady flow of BPDUs is interrupted</p>
</li>
<li>
<p>Only used on point-to-point links</p>
</li>
<li>
<p>Can be used with <strong>UDLD aggressive mode</strong> to get extra protection.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_root_guard">root guard</h5>
<div class="ulist">
<ul>
<li>
<p>Prevent a port from becoming a root port when receiving a superior bpdu (e.g. inferior priority + mac)</p>
</li>
<li>
<p>it is enabled on ports other than the root  port and on switches other than the root.</p>
</li>
<li>
<p>Puts the port in <strong>root-inconsistent</strong> state (no data flow) until it stops receiving superior BPDUs.
No traffic is forwarded.</p>
</li>
<li>
<p>enforce the root bridge placement by ensuring the the port on which root guard is enabled is the designated port.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/10588-74.html" class="bare">http://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/10588-74.html</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enforce the root bridge placement</p>
</li>
<li>
<p>Ensures that the port on which root guard is enabled is the designated port.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_udld_2">UDLD</h5>
<div class="ulist">
<ul>
<li>
<p>unidirectional links:</p>
<div class="ulist">
<ul>
<li>
<p>one of the 2 transmission path has failed but not both</p>
</li>
<li>
<p>due to miscabling, cutting on fiber cable, unplugging one fiber, GBIC problems, &#8230;&#8203;</p>
</li>
<li>
<p>can cause a loop as the previously blocking port will move to a forwarding state</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/stp-unidirectional-links.png" alt="stp unidirectional links" height="150">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>solutions:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">UDLD <strong>u</strong>ni<strong>d</strong>irectional <strong>l</strong>ink <strong>d</strong>etection</dt>
<dd>
<p>Uses Layer 2 messaging to decide when a switch can no longer receive frames from
a neighbor. The switch whose transmit interface did not fail is placed into an err-disabled
state.</p>
</dd>
<dt class="hdlist1">UDLD aggressive mode</dt>
<dd>
<p>Attempts to reconnect with the other switch (eight times)
after realizing no messages have been received.
If the other switch does not reply to the repeated additional messages,
both sides become err-disabled.</p>
</dd>
<dt class="hdlist1">Loop Guard</dt>
<dd>
<p>When normal BPDUs are no longer received,
the port does not go through normal STP convergence, but rather falls into an STP loop-inconsistent state.</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all cases, the formerly blocking port that would now cause a loop is prevented from migrating
to a forwarding state. With both types of UDLD, the switch can be configured to automatically
transition out of err-disabled state. With Loop Guard, the switch automatically puts the port back
into its former STP state when the original Hellos are received again.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_802_1w">5.1.2. 802.1w</h4>
<div class="ulist">
<ul>
<li>
<p>Improves convergence by</p>
<div class="ulist">
<ul>
<li>
<p>waiting for only 3 missed Hellos on an RP before flushing the CAM instead of 10 with 802.1d</p>
</li>
<li>
<p>bypass listening state</p>
</li>
<li>
<p>includes natively Cisco PortFast, UplinkFast, BackboneFast</p>
</li>
<li>
<p>add backup DP when multiple ports connected to the same segment</p>
</li>
</ul>
</div>
</li>
<li>
<p>backward compatible with 802.1d although</p>
</li>
<li>
<p>All bridges generate BPDUs every Hello interval</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_rstp_link_types">RSTP link types</h5>
<div class="ulist">
<ul>
<li>
<p><strong>Point-to-point</strong>: switch to switch</p>
</li>
<li>
<p><strong>Shared</strong> : switch to hub</p>
</li>
<li>
<p><strong>Edge</strong>: switch to single end-user device</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_rstp_port_states">RSTP port states</h5>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">administrative state</th>
<th class="tableblock halign-left valign-top">802.1d</th>
<th class="tableblock halign-left valign-top">802.1w</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">discarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blocking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">discarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">listening</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">discarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">forwarding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">forwarding</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_rstp_role_ports">RSTP role ports</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Root Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Same role as 802.1d RP</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Designated Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Same role as 802.1d DP</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Alternate Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>an alternate root port</p>
</li>
<li>
<p>same concept as Cisco UplinkFast feature</p>
</li>
<li>
<p>protects against the loss of a switch&#8217;s RP by keeping track of the AP with a path to the root</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Backup Port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>no equivalent Cisco features</p>
</li>
<li>
<p>protects against losing the DP attached to a shared liknk
when the switch has another physical port attached to the same shared segment</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
root bridge ports are all designated port
unless 2 or more ports of the root bridge are connected together.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
a port needs to receive BPDUs to stay blocked.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_2">configuration</h5>
<div class="listingblock">
<div class="title">Task: Configure Rapid PVST</div>
<div class="content">
<pre>(config)#  spanning-tree mode rapid-pvst</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Rapid PVST+ immediately deletes dynamically learned MAC address entries
when it receives a topology change instead of a timer used by PVST+ or MST</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_802_1s">5.1.3. 802.1s</h4>
<div class="ulist">
<ul>
<li>
<p>Multiple VLANs mapped to the same STP instance.</p>
</li>
<li>
<p>enable load balancing</p>
</li>
<li>
<p>improves fault tolerance of the network
because a failure in one instance or forwarding path does not affect other instances.</p>
</li>
<li>
<p>Uses 802.1w for rapid convergence</p>
</li>
<li>
<p>Highly scalable</p>
<div class="ulist">
<ul>
<li>
<p>switches with same instance, configuration revision number and name form a <strong>region</strong></p>
</li>
<li>
<p>different regions see each other as virtual bridges</p>
</li>
</ul>
</div>
</li>
<li>
<p>each switch have three attributes:</p>
<div class="ulist">
<ul>
<li>
<p>alphanumeric configuration name (32 bytes)</p>
</li>
<li>
<p>configuration number (2 bytes)</p>
</li>
<li>
<p>4096-element table that associates each of the potential 4096 VLANs to a map ???</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_storm_control">storm control</h5>

</div>
<div class="sect4">
<h5 id="_unicast_flooding">unicast flooding</h5>

</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting_3">5.1.4. Troubleshooting</h4>
<div class="sect4">
<h5 id="_flapping_port_that_is_generating_bpdus_with_the_tcn_bit_set">flapping port that is generating BPDUs with the TCN bit set</h5>

</div>
</div>
<div class="sect3">
<h4 id="_questions">5.1.5. Questions</h4>

</div>
</div>
<div class="sect2">
<h3 id="_mst">5.2. MST</h3>
<div class="sect3">
<h4 id="_operations">5.2.1. operations</h4>
<div class="paragraph">
<p>cst &#8594; 1 stp for all vlan
pvst &#8594; 1 stp for each vlan
mst &#8594; 1 stp per instance</p>
</div>
</div>
<div class="sect3">
<h4 id="_readings">5.2.2. readings</h4>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swmstp.html" class="bare">http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swmstp.html</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_etherchannel">6. EtherChannel</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_etherchannel_2">6.1. EtherChannel</h3>
<div class="sect3">
<h4 id="_overview_6">6.1.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>EtherChannel aggregates bandwidth of up to 8 physical links</p>
</li>
<li>
<p>Consists of two parts:</p>
<div class="ulist">
<ul>
<li>
<p>Port-channel interface: logical interface representing the bundle</p>
</li>
<li>
<p>Member interfaces: physical links part of the bundle</p>
</li>
</ul>
</div>
</li>
<li>
<p>Channel can be any type of interface:</p>
<div class="ulist">
<ul>
<li>
<p>Layer 2 access, trunk, tunnel or layer 3 routed</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configured as either Layer 2 or Layer 3 interfaces.</p>
</li>
<li>
<p>To be part of a PortChannel, both sides must agree on:</p>
<div class="ulist">
<ul>
<li>
<p>Same speed and duplex settings</p>
</li>
<li>
<p>If not trunking, same access VLAN</p>
</li>
<li>
<p>If trunking, same trunk type, allowed VLANs, and native VLAN</p>
</li>
<li>
<p>On a single switch, each port in a PortChannel must have the same STP cost per VLAN on all links in the PortChannel</p>
</li>
<li>
<p>No ports with SPAN configured</p>
</li>
</ul>
</div>
</li>
<li>
<p>When several EtherChannel bundles exist between two switches,
STP blocks one of the bundles to prevent redundant links.
When spanning tree blocks one of the redundant links, it blocks one EtherChannel,
thus blocking all the ports belonging to this EtherChannel link.</p>
</li>
<li>
<p>Where there is only one EtherChannel link,
all physical links in the EtherChannel are active because STP sees only one (logical) link.</p>
</li>
<li>
<p>If a link within an EtherChannel fails,
traffic previously carried over that failed link changes to the remaining links within the EtherChannel.
A trap is sent for a failure, identifying the switch, the EtherChannel, and the failed link.
Inbound broadcast and multicast packets on one link in an EtherChannel are blocked from returning on any other link of the EtherChannel.</p>
</li>
<li>
<p>Each EtherChannel has a logical port-channel interface numbered from 1 to 64.
The channel groups are also numbered from 1 to 64.</p>
</li>
<li>
<p>When a port joins an EtherChannel, the physical interface for that port is shut down.</p>
</li>
<li>
<p>When the port leaves the port-channel, its physical interface is brought up,
and it has the same configuration as it had before joining the EtherChannel.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_link_aggregation_protocol">6.1.2. Link aggregation protocol</h4>
<div class="ulist">
<ul>
<li>
<p>PAgP</p>
<div class="ulist">
<ul>
<li>
<p>Maximum 8 ports</p>
</li>
</ul>
</div>
</li>
<li>
<p>LACP</p>
<div class="ulist">
<ul>
<li>
<p>Maximum 16 ports</p>
</li>
<li>
<p>Maximum 8 active ports and 8 standby ports</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Verify which negotiation protocol has been used for the EtherChannel</div>
<div class="content">
<pre># show etherchannel protocol</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the link aggregation protocol globally</div>
<div class="content">
<pre>(config-if)# channel-protocol {pagp | lacp}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <strong>channel-group</strong> interface configuration command can also set the mode for the EtherChannel</p>
</li>
<li>
<p>If you set the protocol by using <strong>channel-protocol</strong>,
the setting is not overriden by the <strong>channel-group</strong> interface configuration command.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_layer_2_etherchannels">6.1.3. Layer 2 EtherChannels</h4>
<div class="ulist">
<ul>
<li>
<p>Logical interfaces are dynamically created when using <strong>channel-group</strong> command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure layer 2 EtherChannels</div>
<div class="content">
<pre>conf t
interface &lt;type slot/number&gt;
  switchport mode {access | trunk}
  channel-group n mode {active | passive | on | {auto [non-silent] | desirable [non-silent]  }</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_layer_3_etherchannels">6.1.4. Layer 3 EtherChannels</h4>
<div class="listingblock">
<div class="title">Task: Create the port channel logical interface</div>
<div class="content">
<pre>conf t
interface port-channel &lt;number&gt;
  no switchport
  ip address &lt;a.b.c.d&gt; &lt;mask&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Assign the physical interfaces to the layer 3 port channel</div>
<div class="content">
<pre>conf t
interface &lt;type id&gt;
  no switchport
  no ip address
  channel-group n mode {active | passive | on | {auto [non-silent] | desirable [non-silent]  }</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Always issue the <strong>no switchport</strong> command before the <strong>channel-group</strong> command</p>
</li>
<li>
<p>If L3 port-channel configured properly, the <strong>show etherchannel summary</strong> command should show <strong>RU</strong> for routed and in use</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/etherchannel-relationships.png" alt="etherchannel relationships" height="150">
</div>
<div class="title">Figure 9. Relationship of Physical Ports, Logical Port Channels, and Channel Groups</div>
</div>
</div>
<div class="sect3">
<h4 id="_etherchannel_modes">6.1.5. EtherChannel modes</h4>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 6. EtherChannel modes</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Cisco PAgP</th>
<th class="tableblock halign-left valign-top">802.1AD LACP</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disable negotiation and forces the port into the portChannel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disable negotiation and prevents the ports to be part of the portChannel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">desirable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initiates the negotiation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">passive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">waits on other side to start negotiation</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Display EtherChannel status</div>
<div class="content">
<pre># show etherchannel [group-number]</pre>
</div>
</div>
<div class="sect4">
<h5 id="_pagp_and_lacp_interaction_with_other_features">PAgP and LACP Interaction with Other Features</h5>
<div class="ulist">
<ul>
<li>
<p>DTP and CDP send and receive packets over the physical interfaces in the EtherChannel.</p>
</li>
<li>
<p>PAgP and LACP transmit PDUs on the lowest numbered VLAN on the interfaces enable for (desirable,auto or active,passive)</p>
</li>
<li>
<p>STP sends packets over the first interface in the Etherchannel</p>
</li>
<li>
<p>The MAC address of a Layer 3 EtherChannel is the MAC address of the first interface in the port-channel.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_load_balancing_and_forwarding_modes">Load balancing and forwarding modes</h5>
<div class="ulist">
<ul>
<li>
<p>Load balancing between member interface based on a combination of</p>
<div class="ulist">
<ul>
<li>
<p>Source MAC address</p>
</li>
<li>
<p>Destination MAC address</p>
</li>
<li>
<p>Source IP address</p>
</li>
<li>
<p>Destination IP address</p>
</li>
</ul>
</div>
</li>
<li>
<p>Uses only source MAC address by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the EtherChannel load-balancing method</div>
<div class="content">
<pre>(config)# port-channel load-balance { dst-ip | dst-mac | src-dst-ip | src-dst-mac | src-ip | src-mac}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the EtherChannel load-balancing method</div>
<div class="content">
<pre># show etherchannel load-balance

EtherChannel Load-Balancing Configuration:
src-mac

EtherChannel Load-Balancing Addresses Used Per-Protocol:
Non-IP: Source MAC address
IPv4: Source MAC address
IPv6: Source MAC address</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_misconfiguration_guard">6.1.6. Misconfiguration guard</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lacp">6.2. LACP</h3>
<div class="sect3">
<h4 id="_overview_7">6.2.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>IEEE 802.3ad</p>
</li>
<li>
<p>Automatic creation of port channels</p>
</li>
<li>
<p>Multicast address IEEE 802.3 Slow Protocols: 0180-C200-0002</p>
</li>
<li>
<p>EtherType value: 0x8809</p>
</li>
<li>
<p>Timers: hellos every second during hand shake</p>
</li>
<li>
<p>Maximum: 16 ports with max 8 active</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_restrictions">Restrictions</h5>

</div>
<div class="sect4">
<h5 id="_modes">Modes</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Passive</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Does not initiate LACP negotiation but responds to LACP packets</p>
</li>
<li>
<p>Default mode</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Active</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Initiate LACP negotiation by sending LACP packets</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">On</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Forces the interface to the channel without PAgP or LACP</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Working Etherchannel for On-On, Passive-Active, Active-Active</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lacp_hot_standby_ports">6.2.2. LACP hot-standby ports</h4>
<div class="ulist">
<ul>
<li>
<p>Only 8 LACP links can be active at one time</p>
</li>
<li>
<p>Any additional links are in hot-standby mode</p>
</li>
<li>
<p>If one of the active links becomes inactive,
a hot-standby link becomes active in its place</p>
</li>
<li>
<p>Each link is assigned a unique priority in this order</p>
<div class="ulist">
<ul>
<li>
<p>LACP system priority (1..65535, default: 32768)</p>
</li>
<li>
<p>System ID ( the switch MAC address)</p>
</li>
<li>
<p>LACP port priority</p>
</li>
<li>
<p>Port number</p>
</li>
</ul>
</div>
</li>
<li>
<p>In priority comparisons, lower values have higher priority.</p>
</li>
<li>
<p>To determine which ports are active and which ports are hot standby,</p>
<div class="ulist">
<ul>
<li>
<p>Select the master switch with a low system priority and system-id</p>
</li>
<li>
<p>Select the master ports with the low port priority and number.
The port-priority and port-number of the slave switch are not used.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Check which ports are in the hot-standby mode</div>
<div class="content">
<pre># show etherchannel summary</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the LACP system priority</div>
<div class="content">
<pre>(config)# lacp system-priority &lt;priority&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Show the LACP system priority</div>
<div class="content">
<pre># show lacp sys-id</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: LACP port priority</div>
<div class="content">
<pre>(config-if)# lacp port-prioriy</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lacp_port_channel_maxbundle_feature">6.2.3. LACP Port-channel MaxBundle feature</h4>
<div class="ulist">
<ul>
<li>
<p>Control the number of ports allowed to be bundled into the etherchannel</p>
</li>
<li>
<p>Allows hot-standby ports with fewer bundled ports</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the maximum number of bundled ports allowed in a LACP port channel</div>
<div class="content">
<pre>(config-if)# lacp max-bundle</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lacp_port_channel_min_links_feature">6.2.4. LACP Port-Channel Min-links feature</h4>
<div class="ulist">
<ul>
<li>
<p>Only for LACP Etherchannel</p>
</li>
<li>
<p>Prevents low-bandwidth interface from becoming active</p>
</li>
<li>
<p>Causes LACP etherChannels to become inactive if they have too feww active members ports to supply the required minimum bandwith</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the minimum number of member ports that must be in the link-up state and bundled in the etherchannel for the port channel interface to transition to the link-up state</div>
<div class="content">
<pre>(config-if)# port-channel min-link n</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pagp">6.3. PAgP</h3>
<div class="sect3">
<h4 id="_overview_8">6.3.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p><strong>P</strong>ort <strong>Ag</strong>gregation <strong>P</strong>rotocol</p>
</li>
<li>
<p>Cisco proprietary</p>
</li>
<li>
<p>Automatic creation of a EtherChannel.</p>
</li>
<li>
<p>Sends PagP packets every 30 seconds to multicast 0100-0CCC-CCCC</p>
</li>
<li>
<p>Same destination address than CDP, UDLD, VTP, and DTP.</p>
</li>
<li>
<p>Checks for configuration consistency and manages link additions and failures between two switches.</p>
</li>
<li>
<p>Protocol value: 0x104</p>
</li>
<li>
<p>Cannot be enabled on cross-stack EtherChannel</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display PAgP status</div>
<div class="content">
<pre># show pagp [channel-group-number]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_modes_2">6.3.2. Modes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Auto </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Never initiates PAgP communications but instead listen passively for any received PAgP packets
before creating an EtherChannel with the neighboring switch.</p>
</li>
<li>
<p>Default mode</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Desirable </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Initiates negotiations with other interfaces by sending PAgP packets.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">On </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Forces the interface to channel without PAgP.</p>
</li>
<li>
<p>Do not exchange PAgP packets.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Etherchannel formed for on-on, desirable-auto, desirable-desirable combinations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_physical_vs_aggregate_learners">6.3.3. Physical vs Aggregate learners</h4>
<div class="paragraph">
<p>Switches running PAgP are classified as:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">PAgP physical learners</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>learn MAC addresses using the physical ports within the EtherChannel instead
of via the logical EtherChannel link.</p>
</li>
<li>
<p>forward traffic to addresses based on the physical port via which the address
was learned.  The switch will send packets to the neighboring switch using
the same port in the EtherChannel from which it learned the source address.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Aggregate learners</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>learns addresses based on the aggregate or logical EtherChannel port.</p>
</li>
<li>
<p>transmit packets to the source by using any of the interfaces in the EtherChannel.</p>
</li>
<li>
<p>Aggregate learning is the default.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>By default, PAgP is not able to detect whether a neighboring switch is a
physical learner. Therefore, when configuring PAgP EtherChannels on switches
that support only physical learning, the learning method must be manually set
to physical learning. It is important when running in this mode, to set the
load-distribution method to source-based distribution so that any given source
MAC address is always sent on the same physical port.</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure the PAgP learning method</div>
<div class="content">
<pre>(config-if)# pagp learn-method {physical-port | aggregation-port&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the PAgP learning method</div>
<div class="content">
<pre># show pagp [channel-group-number] internal</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_priority">6.3.4. Priority</h4>
<div class="ulist">
<ul>
<li>
<p>Range: 0..255</p>
</li>
<li>
<p>Default: 128</p>
</li>
<li>
<p>The higher the priority, the more likely that the port will be used for PAgP transmission</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Assign a priority so that the selected port is chosen for packet transmission.</div>
<div class="content">
<pre>(config-if)# pagp port-priority &lt;priority&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_restrictions_2">6.3.5. Restrictions</h4>
<div class="paragraph">
<p>While PAgP allows for all links within the EtherChannel to be used to forward
and receive user traffic, there are some restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DTP and CDP send and receive packets over all the physical interfaces in the EtherChannel,
while PAgP sends and receives PAgP PDU only from interfaces that are
up and have PAgP enabled for auto or desirable modes.</p>
</li>
<li>
<p>When an EtherChannel bundle is configured as a trunk port,
the trunk sends and receives PAgP frames on the lowest numbered VLAN.
STP always chooses the first operational port in an EtherChannel bundle.</p>
</li>
<li>
<p>When configuring additional STP features such as Loop Guard on an EtherChannel,
remember that if Loop Guard blocks the first port,
no BPDUs will be sent over the channel,
even if other ports in the channel bundle are operational.
This is because PAgP will enforce uniform Loop Guard configuration on all of the ports that are part of the EtherChannel group.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_3">6.3.6. Configuration</h4>
<div class="sect4">
<h5 id="_validate_the_port_that_will_be_used_by_stp_to_send_packets_and_receive_packets">Validate the port that will be used by STP to send packets and receive packets</h5>
<div class="listingblock">
<div class="content">
<pre>Switch#show pagp neighbor
Flags:  S – Device is sending Slow hello.  C – Device is in Consistent state.
A – Device is in Auto mode.        P – Device learns on physical port.

Channel group 4 neighbors
Partner     Partner             Partner         Partner   Group
Port        Name                Device ID       Port       Age  Flags   Cap.
Gi1/1/3     Switch.1            00c5.a003.0080   Gi0/1     4s   SC      10001
Gi1/1/4     Switch.1            00c5.a003.0080   Gi0/2     3s   SC      10001</pre>
</div>
</div>
<div class="paragraph">
<p>STP will send packets only out of port Gi1/1/3
because it is the first operational interface.
If that port fails,
STP will send packets out of Gi1/1/4.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_silent_mode">6.3.7. Silent mode</h4>
<div class="listingblock">
<div class="title">Task: Configure a switch port for nonsilent operation</div>
<div class="content">
<pre></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a switch port for nonsilent operation</div>
<div class="content">
<pre></pre>
</div>
</div>
<div class="paragraph">
<p>TODO
You can also configure a single interface within the group for all
transmissions and use other interfaces for hot standby. The unused interfaces
in the group can be swapped into operation in just a few seconds if the
selected single interface loses hardware-signal detection.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_span_rspan_and_erspan">7. SPAN , RSPAN and ERSPAN</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>SPAN (Switch Port Analyzer) mirrors monitored (TX,RX or Both) traffic
on source ports or VLANs to a destination port for analysis.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_local_span_sessions">7.1. Local SPAN sessions</h3>
<div class="ulist">
<ul>
<li>
<p>Source and destination on the same switch
image::span-topology.png[SPAN Topology]</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display SPAN  status</div>
<div class="content">
<pre>Switch# show monitor session

Session 1
==========

Type              : Local Session
Source Ports      :
    RX Only       : None
    TX Only       : None
    Both          : Fa0/4
Source VLANs      :
    RX Only       : None
    TX Only       : None
    Both          : None
Source RSPAN VLAN : None
Destination Ports : Fa0/5
    Encapsulation: DOT1Q
          Ingress: Enabled, default VLAN = 5
Reflector Port    : None
Filter VLANs      : None
Dest RSPAN VLAN   : None</pre>
</div>
</div>
<div class="sect3">
<h4 id="_source">7.1.1. Source</h4>
<div class="ulist">
<ul>
<li>
<p>Can not mix source ports and source VLANs in a single session</p>
</li>
<li>
<p>Monitored traffic directions can be</p>
<div class="ulist">
<ul>
<li>
<p>Rx :  before any modification or processing by ACL or QoS or VACL</p>
</li>
<li>
<p>Tx : after all modification and processing performed by the switch.</p>
</li>
<li>
<p>Both: by default</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure span source ports/VLANs</div>
<div class="content">
<pre>monitor session &lt;1-66&gt; source {interface &lt;id&gt; | vlan &lt;id&gt;} [, | -] [both | rx | tx]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>(Optional) [, | -] Specify a series or range of interfaces. Enter a space before and after the comma; enter a space before and after the hyphen.</p>
</li>
<li>
<p>A single session can include multiple sources (ports or VLANs), defined in a series of commands, but you cannot combine source ports and source VLANs in one session.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_source_ports">Source ports</h5>
<div class="ulist">
<ul>
<li>
<p>Can be physical interfaces</p>
</li>
<li>
<p>Can be port-channel logical interfaces with port-channel numbers in (1..48)</p>
</li>
<li>
<p>Can be an access port, trunk port, routed port, or voice VLAN port.</p>
</li>
<li>
<p>Cannot be a destination port</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_source_vlans">Source VLANs</h5>
<div class="ulist">
<ul>
<li>
<p>All active ports in the source VLAN are included as source ports and can be monitored in either or both directions.</p>
</li>
<li>
<p>On a given port, only traffic on the monitored VLAN is sent to the destination port.</p>
</li>
<li>
<p>If a destination port belongs to a source VLAN, it is excluded from the source list and is not monitored.</p>
</li>
<li>
<p>If ports are added to or removed from the source VLANs, the traffic on the source VLAN received by those ports is added to or removed from the sources being monitored.</p>
</li>
<li>
<p>You cannot use filter VLANs in the same session with VLAN sources.</p>
</li>
<li>
<p>You can monitor only Ethernet VLANs.</p>
</li>
<li>
<p>Ignores CDP, BPDU, VTP,, DTP and PAgP frames unless <strong>encapsulation replicate</strong> is configured</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_destination_port">7.1.2. Destination port</h4>
<div class="ulist">
<ul>
<li>
<p>Must be a physical port</p>
</li>
<li>
<p>Cannot be a source port</p>
</li>
<li>
<p>By default, send packets untagged</p>
<div class="ulist">
<ul>
<li>
<p>can replicate the source interface encapsulation</p>
</li>
</ul>
</div>
</li>
<li>
<p>By default, disable the ingress traffic forwarding</p>
<div class="ulist">
<ul>
<li>
<p>can accept incoming packets with dot1q, isl or untagged</p>
</li>
</ul>
</div>
</li>
<li>
<p>Only one SPAN/RSPAN session can send traffic to a single destination port, cannot be used by two SPAN sessions</p>
</li>
<li>
<p>Only monitored traffic passes through the SPAN destination port</p>
</li>
<li>
<p>Entering SPAN configuration commands does not remove previously configured SPAN parameters.
Enter the <strong>no monitor session {session_number | all | local | remote}</strong> global configuration command to delete configured SPAN parameters.</p>
</li>
<li>
<p>For local SPAN, outgoing packets through the SPAN destination port carry the original encapsulation headers—untagged, ISL, or IEEE 802.1Q
If the encapsulation replicate keywords are specified.
If the keywords are not specified, the packets are sent in native form.
For RSPAN destination ports, outgoing packets are not tagged.</p>
</li>
<li>
<p>You can configure a disabled port to be a source or destination port,
but the SPAN function does not start until the destination port and at least one source port or source VLAN are enabled.</p>
</li>
<li>
<p>You cannot mix source VLANs and filter VLANs within a single SPAN session.</p>
</li>
<li>
<p>Up to 64 SPAN destination ports can be configured on a switch</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the destination port for a SPAN session</div>
<div class="content">
<pre>(config)# monitor &lt;session-number&gt; destination interface &lt;interface-id&gt;
                                   [encapsulation replicate]
                                   [ingress {dot1q vlan &lt;vlan-id&gt; | isl | untagged vlan &lt;vlan-id&gt;} ]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vlan_filtering">7.1.3. VLAN Filtering</h4>
<div class="ulist">
<ul>
<li>
<p>To limit SPAN traffic monitoring on trunk source ports to specific VLANs by using VLAN filtering.</p>
</li>
<li>
<p>Applies only to trunk ports or to voice VLAN ports.</p>
</li>
<li>
<p>Applies only to port-based sessions</p>
</li>
<li>
<p>Not  allowed in sessions with VLAN sources.</p>
</li>
<li>
<p>When a VLAN filter list is specified, only those VLANs in the list are monitored on trunk ports or on voice VLAN access ports.</p>
</li>
<li>
<p>SPAN traffic coming from other port types is not affected by VLAN filtering; that is, all VLANs are allowed on other ports.</p>
</li>
<li>
<p>VLAN filtering affects only traffic forwarded to the destination SPAN port and does not affect the switching of normal traffic.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Limit SPAN source to specific VLANs</div>
<div class="content">
<pre>(config)# monitor &lt;session-number&gt; filter vlan &lt;vlan-ids&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_remote_span_sessions">7.2. Remote SPAN sessions</h3>
<div class="paragraph">
<p>RSPAN consists of at least one RSPAN source session, an RSPAN VLAN, and at least one RSPAN destination session.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/rspan-topology.png" alt="RSPAN Topology">
</div>
</div>
<div class="paragraph">
<div class="title">Restrictions and considerations</div>
<p>When RSPAN is enabled, each packet being monitored is transmitted twice,
once as normal traffic and once as a monitored packet.
Therefore monitoring a large number of ports or VLANs could potentially generate large amounts of network traffic.</p>
</div>
<div class="sect3">
<h4 id="_rspan_vlan">7.2.1. RSPAN VLAN</h4>
<div class="ulist">
<ul>
<li>
<p>Can be propagated to all switches by VTP if RSPAN VLAN &lt; 1005</p>
</li>
<li>
<p>Must be created manually on extended-range VLAN</p>
</li>
<li>
<p>Can not be vlan 1, 1002-1005</p>
</li>
<li>
<p>Can served multiple RSPAN source/destination sessions</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Restrictions</div>
<ul>
<li>
<p>You can apply an output ACL to RSPAN traffic to selectively filter or monitor specific packets. Specify these ACLs on the RSPAN VLAN in the RSPAN source switches.</p>
</li>
<li>
<p>For RSPAN configuration, you can distribute the source ports and the destination ports across multiple switches in your network.</p>
</li>
<li>
<p>RSPAN does not support BPDU packet monitoring or other Layer 2 switch protocols.</p>
</li>
<li>
<p>The RSPAN VLAN is configured only on trunk ports and not on access ports.
To avoid unwanted traffic in RSPAN VLANs,
make sure that the VLAN remote-span feature is supported in all the participating switches.</p>
</li>
<li>
<p>Access ports (including voice VLAN ports) on the RSPAN VLAN are put in the inactive state.</p>
</li>
<li>
<p>RSPAN VLANs are included as sources for port-based RSPAN sessions when source trunk ports have active RSPAN VLANs. RSPAN VLANs can also be sources in SPAN sessions. However, since the switch does not monitor spanned traffic, it does not support egress spanning of packets on any RSPAN VLAN identified as the destination of an RSPAN source session on the switch.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure RSPAN VLAN on all participating switches</div>
<div class="content">
<pre>(config)# vlan &lt;rspan-vlan-id&gt;
(config-vlan)# remote-span</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rspan_source_session">7.2.2. RSPAN source session</h4>
<div class="ulist">
<ul>
<li>
<p>Must be configured on the monitored port&#8217;s switch</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the RSPAN source session</div>
<div class="content">
<pre>monitor session &lt;session-number&gt; source {interface interface-id | vlan vlan-id} [, | -] [both | rx | tx]
monitor session session_number destination remote vlan &lt;rspan-vlan-id&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rspan_destination_session">7.2.3. RSPAN destination session</h4>
<div class="ulist">
<ul>
<li>
<p>Takes all packets received on the RSPAN VLAN, strips off the VLAN tagging, and presents them on the destination port.</p>
</li>
<li>
<p>Excludes Layer 2 control</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the RSPAN destination session on a different switch (not the switch on which the source session was configured)</div>
<div class="content">
<pre>(config)# monitor session &lt;session-number&gt; source remote vlan &lt;rspan-vlan-id&gt;
(config)#  monitor session &lt;session-number&gt; destination interface &lt;interface-id&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interaction_with_other_features">7.3. Interaction with other features</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Routing </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>SPAN does not monitor routed traffic.</p>
</li>
<li>
<p>RSPAN only monitors traffic that enters or exits the switch, not traffic that is routed between VLANs.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">STP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A destination port does not participate in STP while its SPAN or RSPAN session is active.</p>
</li>
<li>
<p>The destination port can participate in STP after the SPAN or RSPAN session is disabled.</p>
</li>
<li>
<p>On a source port, SPAN does not affect the STP status. STP can be active on trunk ports carrying an RSPAN VLAN.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">CDP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A SPAN destination port does not participate in CDP while the SPAN session is active.</p>
</li>
<li>
<p>After the SPAN session is disabled, the port again participates in CDP.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">VTP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You can use VTP to prune an RSPAN VLAN between switches.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">VLAN and trunking</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You can modify VLAN membership or trunk settings for source or destination ports at any time.</p>
</li>
<li>
<p>However, changes in VLAN membership or trunk settings for a destination port do not take effect until you remove the SPAN destination configuration.</p>
</li>
<li>
<p>Changes in VLAN membership or trunk settings for a source port immediately take effect, and the respective SPAN sessions automatically adjust accordingly.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">EtherChannel</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You can configure an EtherChannel group as a source port but not as a SPAN destination port.</p>
</li>
<li>
<p>When a group is configured as a SPAN source, the entire group is monitored.</p>
</li>
<li>
<p>If a physical port is added to a monitored EtherChannel group, the new port is added to the SPAN source port list.</p>
</li>
<li>
<p>If a port is removed from a monitored EtherChannel group, it is automatically removed from the source port list.</p>
</li>
<li>
<p>A physical port that belongs to an EtherChannel group can be configured as a SPAN source port and still be a part of the EtherChannel.</p>
</li>
<li>
<p>In this case, data from the physical port is monitored as it participates in the EtherChannel.
However, if a physical port that belongs to an EtherChannel group is configured as a SPAN destination, it is removed from the group.
After the port is removed from the SPAN session, it rejoins the EtherChannel group.
Ports removed from an EtherChannel group remain members of the group, but they are in the inactive or suspended state.</p>
</li>
<li>
<p>If a physical port that belongs to an EtherChannel group is a destination port and the EtherChannel group is a source,
the port is removed from the EtherChannel group and from the list of monitored ports.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Multicasting</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Multicast traffic can be monitored.</p>
</li>
<li>
<p>For egress and ingress port monitoring, only a single unedited packet is sent to the SPAN destination port.</p>
</li>
<li>
<p>It does not reflect the number of times the multicast packet is sent.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Private VLAN</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A private-VLAN port cannot be a SPAN destination port.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Secure port</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A secure port cannot be a SPAN destination port.</p>
</li>
<li>
<p>For SPAN sessions, do not enable port security on ports with monitored egress when ingress forwarding is enabled on the destination port.
For RSPAN source sessions, do not enable port security on any ports with monitored egress.</p>
</li>
<li>
<p>An IEEE 802.1x port can be a SPAN source port.
You can enable IEEE 802.1x on a port that is a SPAN destination port; however,
IEEE 802.1x is disabled until the port is removed as a SPAN destination.</p>
</li>
<li>
<p>For SPAN sessions, do not enable IEEE 802.1x on ports with monitored egress when ingress forwarding is enabled on the destination port.
For RSPAN source sessions, do not enable IEEE 802.1x on any ports that are egress monitored.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_encapsulated_rspan">7.4. Encapsulated RSPAN</h3>
<div class="ulist">
<ul>
<li>
<p>ERSPAN consists of an ERSPAN source session, routable ERSPAN GRE encapsulated traffic, and an ERSPAN destination session.</p>
</li>
<li>
<p>Supported only on high-end switch</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/erspan.png" alt="erspan">
</div>
</div>
<div class="sect3">
<h4 id="_erspan_source_session">7.4.1. ERSPAN source session</h4>
<div class="listingblock">
<div class="title">Task: Configure ERSPAN source session</div>
<div class="content">
<pre>(config)# monitor session &lt;id&gt; type erspan-source
(config-mon-erspan-src)# source { interface &lt;interface-id&gt; | vlan &lt;vlan-ids&gt; [rx|tx|both]}
(config-mon-erspan-src)# destination
(config-mon-erspan-src-dst)# erspan-id &lt;erspan-flow-id&gt;
(config-mon-erspan-src-dst)# mtu &lt;size&gt;
(config-mon-erspan-src-dst)# origin ip address &lt;a.b.c.d&gt; [force]
(config-mon-erspan-src-dst)# no shutdown</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_erspan_destination_session">7.4.2. ERSPAN destination session</h4>
<div class="listingblock">
<div class="title">Task: Configure ERSPAN destination session</div>
<div class="content">
<pre>(config)# monitor session &lt;id&gt; type erspan-destination
(config-mon-erspan-dst)# destination interface &lt;interface-id&gt;
(config-mon-erspan-dst)# source
(config-mon-erspan-dst-src)# erspan-id &lt;erspan-flow-id&gt;
(config-mon-erspan-dst-src)# mtu &lt;size&gt;
(config-mon-erspan-dst-src)# ip address &lt;a.b.c.d&gt; [force]
(config-mon-erspan-dst-src)# no shutdown</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_espan_dummy_mac_address_rewrite">7.4.3. ESPAN dummy MAC address rewrite</h4>
<div class="ulist">
<ul>
<li>
<p>Supports customizaed MAC value for WAN interface and tunnel interface</p>
</li>
<li>
<p>Monitor the traffic going through WAN interface</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure ESPAN dummy MAC address</div>
<div class="content">
<pre>(config)# monitor session &lt;session-id&gt; type erspan-source
(config-mon-erspan-src-dst)# s-mac &lt;mac-address&gt;
(config-mon-erspan-src-dst)# d-mac &lt;mac-address&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_virtual_switch_system">8. Virtual Switch System</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="../images/vss.png" alt="Virtual Switch System">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>VSS makes two physical switches to act and appear as one single logical network element.</p>
</li>
<li>
<p>VSS manages the redundant links from access switches  as single Multi-chassis Etherchannel</p>
<div class="ulist">
<ul>
<li>
<p>No need for spanning-tree to block one of the links</p>
</li>
<li>
<p>two active links instead of one 1/10/40b interfaces</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_vss_active_and_standby_switch">8.1. VSS Active and Standby Switch</h3>
<div class="ulist">
<ul>
<li>
<p>Uses VLSP to negotiate the active and standby roles at start</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure VSS domain number and switch number</div>
<div class="content">
<pre>(config)# switch virtual domain &lt;1..255&gt;
(config-vs-domain)# switch [1 | 2]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure VSS switch priority</div>
<div class="content">
<pre>(config-vs-domain)# switch [1 | 2 ] priority [&lt;number&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>NOTE 1 lowest priority 255 highest priority 100 default</p>
</div>
</div>
<div class="sect2">
<h3 id="_virtual_switch_link">8.2. Virtual Switch Link</h3>
<div class="imageblock">
<div class="content">
<img src="../images/vss-logical.png" alt="Virtual Switch Link">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Normally built as etherchannel with up to 8 links</p>
</li>
<li>
<p>carries system control information
(
hot-standby supervisor programming,
line card status,
Distributed Forwarding Card (DFC) card programming,
system management, diagnostics, &#8230;&#8203;
)</p>
</li>
<li>
<p>carries user data traffic when necessary</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Create VSL</div>
<div class="content">
<pre>(config)#interface port channel 5
(config-if)# switchport
(config-if)# switch virtual link 1
(config-if)# no shut
(config-if)# exit
#! add physical interface to port channel
(config)# interface range gi 7/4 - 5
(config-if)# channel group 5 mode one
(config-if)# exit</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Convert the switch to virtual</div>
<div class="content">
<pre>(config)# switch convert mode virtual</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Displays the VSS information</div>
<div class="content">
<pre># sh switch virtual [role | link]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wan">9. WAN</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_hdlc">9.1. HDLC</h3>
<div class="sect3">
<h4 id="_concepts">9.1.1. Concepts</h4>

</div>
<div class="sect3">
<h4 id="_configuration_4">9.1.2. Configuration</h4>

</div>
</div>
<div class="sect2">
<h3 id="_ppp">9.2. PPP</h3>
<div class="sect3">
<h4 id="_concepts_2">9.2.1. Concepts</h4>
<div class="ulist">
<ul>
<li>
<p>HDLC (high-level data link control) and PPP: layer 2 on point-to-point links</p>
</li>
<li>
<p>ISO HDLC does not include a Type field , so the Cisco implementation adds a proprietary 2-byte Type field</p>
</li>
<li>
<p>hdlc : error detection, default on IOS serial links</p>
</li>
<li>
<p>ppp : error detection, error recovery, standard protocol Type field, supports synchronous and asynchronous links</p>
</li>
<li>
<p>hdlc vs ppp framing</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_ppp_lcp">PPP LCP</h5>
<div class="ulist">
<ul>
<li>
<p>LCP  (link control protocol) controls features independent of any Layer 3 protocol</p>
</li>
<li>
<p>NCP ( network control protocol) for each protocol (IP, appletalk, )</p>
</li>
<li>
<p>LCP operations:</p>
</li>
<li>
<p>LCP features</p>
</li>
<li>
<p>LQM link quality monitoring: drop if % of error frames above a configured value</p>
</li>
<li>
<p>looped link detection: drop link if a router receives its own randomly chosen magic number</p>
</li>
<li>
<p>layer 2 load balancing: fragment frames over multilink PPP</p>
</li>
<li>
<p>authentication: chap, pap</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_configuration_5">configuration</h6>
<div class="ulist">
<ul>
<li>
<p>minimal with <strong>encapsulation ppp</strong></p>
</li>
<li>
<p>optional authentication, quality</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multilink_ppp">multilink PPP</h5>
<div class="ulist">
<ul>
<li>
<p>originally intended to combine multiple ISDN B-channels without requiring any Layer 3 load balancing</p>
</li>
<li>
<p>now load balance traffic accross any type of point-to-point serial link</p>
</li>
<li>
<p>add a header ( 2 or 4 bytes ) to allow reassembly on the receiving end</p>
</li>
<li>
<p>configuration with multilink interfaces or virtual templates</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>LFI (link fragmentation and interleaving )</p>
</li>
<li>
<p>prevents small, delay sensitive packets from having to wait on longer, delay-insensitive packets to be completely serialized out an interface.</p>
</li>
<li>
<p>the queuing scheduler generally LLQ on the multilink interface determines the next packet to send:</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_configuration_6">configuration</h6>
<div class="paragraph">
<p>ppp multilink interleave
ppp multilink fragment-delay ms  defines the fragment size based on size = x * bandwidth</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ppp_compression">ppp compression</h5>
<div class="ulist">
<ul>
<li>
<p>use L2 payload compression ( ip + tcp + data + DL) : best with longer packet</p>
</li>
<li>
<p>TCP header compression ( ip + tcp )</p>
</li>
<li>
<p>RTP header compression (ip + udp + rtp)</p>
</li>
<li>
<p>payload compression works best with longer packets, and header with shorter packets</p>
</li>
<li>
<p>header compression : achieves better compression ration 10:1 to 20:1</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_layer_2_compression">layer 2 compression</h6>
<div class="ulist">
<ul>
<li>
<p>options: LZS (Lempel-Ziv Stacker), MPPC (microsoft point-to-point compression), Predictor</p>
</li>
<li>
<p>LZS use more CPU and less RAM than Predictor algorithm and have better compression ratio</p>
</li>
<li>
<p>stacker: supports hdlc, ppp, FR, ATM</p>
</li>
<li>
<p>mppc: ppp, atm</p>
</li>
<li>
<p>predictor: ppp, atm</p>
</li>
<li>
<p>configuration with a matching <strong>compress</strong> command under each interface on both end of the links</p>
</li>
<li>
<p>once configured, ppp starts ccp (compression control protocol) which is another NCP</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_header_compression">header compression</h6>
<div class="ulist">
<ul>
<li>
<p>configured with legacy commands or MQC commands</p>
</li>
<li>
<p>legacy under the serial (ppp) or multilink interface</p>
</li>
<li>
<p><strong>ip tcp header-compression [passive]</strong></p>
</li>
<li>
<p><strong>ip rtp header-compression [passive]</strong></p>
</li>
<li>
<p>add also MQC commands</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_tasks">9.2.2. Configuration tasks</h4>
<div class="listingblock">
<div class="content">
<pre>debug ppp authentication</pre>
</div>
</div>
<div class="paragraph">
<p>read also <a href="http://www.cisco.com/c/en/us/support/docs/wan/point-to-point-protocol-ppp/25440-debug-ppp-negotiation.html#sampdebug">understanding debug ppp negotiation</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_pppoe">9.2.3. PPPoE</h4>
<div class="ulist">
<ul>
<li>
<p>used for digital subscriber line (DSL) Internet access
because the public telephone network uses ATM for its transport protocol;
therefore, Ethernet frames must be encapsulated in a protocol supported over both Ethernet and ATM.</p>
</li>
<li>
<p>The PPP Client feature permits a Cisco IOS router, rather than an endpoint host, to serve as the client
in a network. This permits multiple hosts to connect over a single PPPoE connection.</p>
</li>
<li>
<p>In a DSL environment, PPP interface IP addresses are derived from an upstream DHCP server
using IP Configuration Protocol (IPCP). Therefore, IP address negotiation must be enabled on the
router’s dialer interface. This is done using the ip address negotiated command in the dialer
interface configuration.</p>
</li>
<li>
<p>Because of the 8-byte PPP header, the MTU for PPPoE is usually set to 1492 bytes so that the
entire encapsulated frame fits within the 1500-byte Ethernet frame. A maximum transmission unit
(MTU) mismatch prevents a PPPoE connection from coming up. Checking the MTU setting is a
good first step when troubleshooting PPPoE connections.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_tasks_2">9.2.4. Configuration tasks</h4>
<div class="paragraph">
<p>Example</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/pppoe-topology-example.png" alt="pppoe topology example" height="150">
</div>
</div>
<div class="paragraph">
<p>Example of config on the Edge router</p>
</div>
<div class="listingblock">
<div class="content">
<pre># conf t
(config)# interface fa0/1
(config-if)# ip address 192.168.100.1 255.255.255.0
(config-if)# ip nat inside
(config)# interface fa0/1
(config-if)# pppoe-client dial-pool-number 1
(config-if)# exit
(config)# interface dialer1
(config-if)# mtu 1492
(config-if)# encapsulation ppp
(config-if)# ip address negotiated
(config-if)# ppp authentication chap

!The remaining CHAP commands have been omitted for brevity.

(config-if)# ip nat outside
(config-if)# dialer pool 1
(config-if)# dialer-group 1
(config-if)# exit
(config)# dialer-list 1 protocol ip permit
(config)# ip nat inside source list 1 interface dialier1 overload
(config)# access-list 1 permit 192.168.100.0 0.0.0.255
(config)# ip route 0.0.0.0 0.0.0.0 dialer1</pre>
</div>
</div>
<div class="paragraph">
<p>Verify PPPoE connectivity</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show pppoe session</pre>
</div>
</div>
<div class="paragraph">
<p>Debug</p>
</div>
<div class="listingblock">
<div class="content">
<pre>debug pppoe [data | errors | events | packets]</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<h1 id="_part_ii_layer_3_technologies" class="sect0">Part II : Layer 3 Technologies</h1>
<div class="sect1">
<h2 id="_ip_addressing">10. IP addressing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ipv4">10.1. IPv4</h3>
<div class="ulist">
<ul>
<li>
<p>RFC 791</p>
</li>
<li>
<p>IP Ethernet protocol: 0x0800</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ip_packet_format">10.1.1. IP packet format</h4>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-header-format.png" alt="IP header format" width="896" height="376">
</div>
<div class="title">Figure 10. IP header format</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
IP Header Length (IHL)
</td>
<td class="hdlist2">
<p>datagram header length in 32-bit words.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Type-of-Service
</td>
<td class="hdlist2">
<p>Specifies how an upper-layer protocol would like a current datagram to be handled, and assigns datagrams various levels of importance.
Currently referred to as Differentiated Services Code Point (DSCP) (6 bits).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Total Length
</td>
<td class="hdlist2">
<p>Specifies the length, in bytes, of the entire IP packet, including the data and header.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Identification
</td>
<td class="hdlist2">
<p>Contains an integer that identifies the current datagram. This field is used to help piece together datagram fragments.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Flags
</td>
<td class="hdlist2">
<p>Consists of a 3-bit field of which the two low-order (least-significant) bits control fragmentation. The low-order bit specifies whether the packet can be fragmented. The middle bit specifies whether the packet is the last fragment in a series of fragmented packets. The third or high-order bit is not used.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Fragment Offset
</td>
<td class="hdlist2">
<p>Indicates the position of the fragment&#8217;s data relative to the beginning of the data in the original datagram, which allows the destination IP process to properly reconstruct the original datagram.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Time-to-Live
</td>
<td class="hdlist2">
<p>Maintains a counter that gradually decrements down to zero, at which point the datagram is discarded. This keeps packets from looping endlessly.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Protocol
</td>
<td class="hdlist2">
<p>Indicates which upper-layer protocol receives incoming packets after IP processing is complete.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Header Checksum
</td>
<td class="hdlist2">
<p>Helps ensure IP header integrity.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Options
</td>
<td class="hdlist2">
<p>Allows IP to support various options, such as security.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Data
</td>
<td class="hdlist2">
<p>Contains upper-layer information.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ip_address">10.1.2. IP address</h4>
<div class="ulist">
<ul>
<li>
<p>32-bits written in "dotted decimal"</p>
</li>
<li>
<p>classes: A,B,C,D,E</p>
</li>
<li>
<p>classless : prefix + host</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Assign an IP address to an interface</div>
<div class="content">
<pre>(config-if)# ip address &lt;a.b.c.d&gt; &lt;e.f.g.h&gt; [secondary]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the IP parameters for the interface</div>
<div class="content">
<pre>show ip interface</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the IP networks the device is connected to</div>
<div class="content">
<pre>show ip route connected</pre>
</div>
</div>
<div class="sect4">
<h5 id="_cidr">CIDR</h5>
<div class="ulist">
<ul>
<li>
<p>Classless interdomain routing</p>
</li>
<li>
<p>defined in RFS 1517-1520</p>
</li>
<li>
<p>administrative assigment of large address blocks and the related summarized
routes for the purpose of reducing the size of the Internet routing table</p>
</li>
<li>
<p>Enable by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable classless addressing</div>
<div class="content">
<pre>(config)# ip classless</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the format in which netmask appear for the current session</div>
<div class="content">
<pre>(config)# line vty &lt;first&gt; &lt;last&gt;
(config-line)# term ip netmask-format {bitcount | decimal | hexadecimal}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the format in which netmask appear for the current line</div>
<div class="content">
<pre>(config)# line vty &lt;first&gt; &lt;last&gt;
(config-line)# term ip netmask-format {bitcount | decimal | hexadecimal}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_private_addressing">Private addressing</h5>
<div class="ulist">
<ul>
<li>
<p>RFC 1918</p>
</li>
<li>
<p>10.0.0.0/8</p>
</li>
<li>
<p>172.16.0.0/12</p>
</li>
<li>
<p>192.168.0.0/16</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_vlsm">VLSM</h5>
<div class="ulist">
<ul>
<li>
<p>Variable length subnet mask</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_subnet_zero">Subnet zero</h5>
<div class="listingblock">
<div class="title">Task: Allow IP subnet zero</div>
<div class="content">
<pre>(config)# ip subnet-zero</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_unnumbered_interfaces">Unnumbered interfaces</h5>
<div class="ulist">
<ul>
<li>
<p>Borrow the IP address of another interface</p>
</li>
<li>
<p>only point-to-point (non-multiaccess) WAN interfaces</p>
</li>
<li>
<p>You cannot reboot a IOS image over an ip unnumbered interface</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: configure unnumbered interfaces on point-to-point WAN interfaces</div>
<div class="content">
<pre>(config-if)# ip unnumbered &lt;interface-type interface-id&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_31_bit_prefix">31-bit prefix</h5>
<div class="ulist">
<ul>
<li>
<p>Conserve IP address space</p>
</li>
<li>
<p>Since RFC 3021</p>
</li>
<li>
<p>only on point-to-point WAN interfaces</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Use a 31-bit prefix on point-to-point WAN interfaces</div>
<div class="content">
<pre>(config)# ip classless
(config-if)# ip address a.b.c.d 255.255.255.254</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arp">10.2. ARP</h3>
<div class="ulist">
<ul>
<li>
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">IP Addressing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipaddr_arp/configuration/15-mt/arp-15-mt-book.html">ARP</span></span> </a></p>
</li>
<li>
<p><a href="https://wwwietf.org/rfc/rfc826.txt">RFC 826</a></p>
</li>
<li>
<p>Finds hardware address (MAC) of a host given IP address</p>
</li>
<li>
<p>maintains ARP cache</p>
</li>
<li>
<p>ARP Ethernet protocol: 0x0806</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_protocol">10.2.1. Protocol</h4>
<div class="imageblock">
<div class="content">
<img src="../images/arp.png" alt="header format" width="896" height="344">
</div>
<div class="title">Figure 11. header format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">OpCode</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>1 for request</p>
</li>
<li>
<p>2 for response</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_static_arp_entries">10.2.2. Static ARP entries</h4>
<div class="listingblock">
<div class="title">Task: Enable the interface encapsulation</div>
<div class="content">
<pre>(config-if)# arp {arpa | frame-relay | snap}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Define static ARP entries</div>
<div class="content">
<pre># arp &lt;ip-address&gt;  &lt;hardware-address&gt; &lt;encapsulation-type&gt; [&lt;interface-type&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Define static ARP entries for a specific VRF</div>
<div class="content">
<pre># arp vrf &lt;name&gt;  &lt;hardware-address&gt; &lt;encapsulation-type&gt; [&lt;interface-type&gt;]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dynamic_arp_entries">10.2.3. Dynamic ARP entries</h4>
<div class="ulist">
<ul>
<li>
<p>Stored in ARP cache</p>
</li>
<li>
<p>timeout by default in 4 hours</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: clear the entire ARP cache on an interface</div>
<div class="content">
<pre># clear arp interface &lt;type-number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: clear all dynamic entries from the ARP cache, the fast-switchig cache, and the IP route cache</div>
<div class="content">
<pre># clear arp-cache</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: set an expiration time for dynamic entries in the arp cache</div>
<div class="content">
<pre>(config-if)# arp timeout &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the arp cache</div>
<div class="content">
<pre># show arp
# show ip arp</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre># show arp

Protocol    Address            Age (min)   Hardware Addr      Type    Interface
Internet    10.108.42.112      120         0000.a710.4baf     ARPA    Ethernet3
AppleTalk   4028.5             29          0000.0c01.0e56     SNAP    Ethernet2
Internet    110.108.42.114     105         0000.a710.859b     ARPA    Ethernet3
AppleTalk   4028.9             -           0000.0c02.a03c     SNAP    Ethernet2
Internet    10.108.42.121      42          0000.a710.68cd     ARPA    Ethernet3
Internet    10.108.33.9        -           0000.0c01.7bbd     SNAP    Fddi0</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display ARP and RARP processes</div>
<div class="content">
<pre># sh processes cpu | include (ARP|PID)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_proxy_arp">10.2.4. Proxy ARP</h4>
<div class="ulist">
<ul>
<li>
<p>Same message as ARP</p>
</li>
<li>
<p>Allows response for IP address in remote subnet.</p>
</li>
<li>
<p>RFC 1027</p>
</li>
<li>
<p>Mostly replaced by DHCP nowadays</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: disable Proxy ARP globally</div>
<div class="content">
<pre># ip arp proxy disable</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable Proxy ARP on an interface</div>
<div class="content">
<pre>(config-if)# no ip proxy-arp</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gratuitous_arp">10.2.5. Gratuitous ARP</h4>
<div class="ulist">
<ul>
<li>
<p>broadcast ARP messages where the SPA=TPA and THA=FF:FF:FF:FF:FF:FF</p>
</li>
<li>
<p>used to</p>
<div class="ulist">
<ul>
<li>
<p>to detect IP address conflit</p>
</li>
<li>
<p>to update other machine ARP table</p>
</li>
<li>
<p>to update mac table of the connected switche</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>[TIP] If we see multiple gratitous ARPs from the same host frequently,
it can be an indication of bad Ethernet NICs</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dhcp">10.3. DHCP</h3>
<div class="ulist">
<ul>
<li>
<p>Menu:Configuration guides[IP Addressing &gt; <a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipaddr_dhcp/configuration/15-mt/dhcp-15-mt-book/dhcp-overview.html">DHCP</a> ]</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_overview_9">10.3.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>Https://tools.ietf.org/html/rfc2131[RFC 2131]</p>
<div class="ulist">
<ul>
<li>
<p>Dynamic Host Configuration Protocol</p>
</li>
<li>
<p>Based on BOOTP</p>
</li>
<li>
<p>Client/agent relay/server model</p>
</li>
<li>
<p>UDP port 67</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/dhcp-request.png" alt="DHCP request for an IP address from a DHCP Server">
</div>
<div class="title">Figure 12. DHCP request for an IP address from a DHCP Server</div>
</div>
</div>
<div class="sect3">
<h4 id="_protocol_operations">10.3.2. Protocol operations</h4>
<div class="imageblock">
<div class="content">
<img src="../images/dhcp-message-format.png.png" alt="DHCP message" width="896" height="440">
</div>
<div class="title">Figure 13. DHCP message</div>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 81.8182%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">FIELD</th>
<th class="tableblock halign-center valign-top">OCTETS</th>
<th class="tableblock halign-left valign-top">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">op</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message op code / message type.   1 = BOOTREQUEST, 2 = BOOTREPLY</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">htype</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware address type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hlen</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware address length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hops</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client sets to zero, optionally used by relay agents when booting via a relay agent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xid</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction ID, a random number chosen by the client, used by the client and server to associate messages and responses between a client and a server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secs</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filled in by client, seconds elapsed since client began address acquisition or renewal process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flags</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ciaddr</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client IP address; only filled in if client is in BOUND, RENEW or REBINDING state and can respond to ARP requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yiaddr</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'your' (client) IP address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">siaddr</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address of next server to use in bootstrap returned in DHCPOFFER, DHCPACK by server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">giaddr</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relay agent IP address, used in booting via a relay agent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">chaddr</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client hardware address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sname</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional server host name, null terminated string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boot file name, null terminated string; "generic" name or null in DHCPDISCOVER, fully qualified directory-path name in DHCPOFFER.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">options</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">var</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional parameters field.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_dhcp_server">10.3.3. DHCP Server</h4>
<div class="ulist">
<ul>
<li>
<p>Accepts address assignment requests and renewals from clients</p>
</li>
<li>
<p>Assign address, name server, gateways, &#8230;&#8203;</p>
</li>
<li>
<p>Accepts broadcasts from local clients or relay agents</p>
</li>
<li>
<p>Database as a tree used for attribute inheritance</p>
<div class="ulist">
<ul>
<li>
<p>Root: address pool for natural networks</p>
</li>
<li>
<p>Branches: subnetwork address pools</p>
</li>
<li>
<p>Leaves: manual bindings</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Clear DHCP server variables</div>
<div class="content">
<pre>clear ip dhcp binding { &lt;address&gt; | * }
clear ip dhcp conflict { &lt;address&gt; | * }
clear ip dhcp server statistics</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Troubleshoot DHCP IP address assignments, lease expirations, and database chnages</div>
<div class="content">
<pre># debug ip dhcp server events</pre>
</div>
</div>
<div class="sect4">
<h5 id="_database_agent">Database agent</h5>
<div class="ulist">
<ul>
<li>
<p>Host (ftp, tftp, rcp) or storage that stores the DHCP bindings database.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Save automatic bindings on a remote host</div>
<div class="content">
<pre>ip dhcp database &lt;url&gt; [timeout &lt;seconds&gt;] [ write-dely &lt;seconds&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><strong>url</strong>: can be ftp,tftp, rcp, flash, disk</p>
</li>
<li>
<p><strong>timeout</strong>: how long the DHCP server wait before aborting database transfer. default: 5 minutes</p>
</li>
<li>
<p><strong>write-delay</strong>: how soon the DHCP server should send database updates. default:  5 minutes, minimum: 60 seconds</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Run DHCP server without database agent</div>
<div class="content">
<pre>(config)# no ip dhcp conflict logging</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Not recommended</p>
</li>
<li>
<p>TODO: add the reason</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_address_pool">Address Pool</h5>
<div class="ulist">
<ul>
<li>
<p>Specify which DHCP options to use for the client</p>
<div class="ulist">
<ul>
<li>
<p>If the client is not directly connected to the DHCP server (the giaddr field of the DHCPDISCOVER broadcast message is nonzero), the server matches the DHCPDISCOVER with the DHCP pool that has the subnet that contains the IP address in the giaddr field.</p>
</li>
<li>
<p>If the client is directly connected to the DHCP server (the giaddr field is zero), the DHCP server matches the DHCPDISCOVER with DHCP pools that contain the subnets configured on the receiving interface. If the interface has secondary IP addresses, subnets associated with the secondary IP addresses are examined for possible allocation only after the subnet associated with the primary IP address (on the interface) is exhausted.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Create a pool</div>
<div class="content">
<pre>(config)# ip dhcp pool &lt;name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the subnet network number and mask of the address pool</div>
<div class="content">
<pre>(dhcp-config)# network &lt;network-number&gt; [mask | prefix-length]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the secondary subnets</div>
<div class="content">
<pre>(dhcp-config)# network &lt;network-number&gt; [mask | prefix-length] secondary</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Exclude IP address</div>
<div class="content">
<pre>(config)# ip dhcp excluded-address &lt;low-address&gt; [&lt;high-address&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the domain name</div>
<div class="content">
<pre>(dhcp-config)# domain-name &lt;example.com&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the name server per order of preference</div>
<div class="content">
<pre>(dhcp-config)# dns-server &lt;address&gt; [&lt;address2&gt; ... &lt;address8&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the default boot image for a client</div>
<div class="content">
<pre>(dhcp-config)# bootfile &lt;filename&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the netbios server</div>
<div class="content">
<pre>(dhcp-config)# netbios-name-server &lt;address&gt; [&lt;address2&gt; ... &lt;address8&gt;]
(dhcp-config)# netbios-node-type &lt;type&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the gateway</div>
<div class="content">
<pre>(dhcp-config)# default-router  &lt;address&gt; [&lt;address2&gt; ... &lt;address8&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify  a custom DHCP code</div>
<div class="content">
<pre>(dhcp-config)# option &lt;code&gt; [instance &lt;number&gt;] {ascii &lt;string&gt; | hex &lt;string&gt; | &lt;ip-address&gt;}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the duration of the lease</div>
<div class="content">
<pre>(dhcp-config)# lease &lt;days&gt; [&lt;hours&gt; [&lt;minutes&gt;] ]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the lease for ever</div>
<div class="content">
<pre>(dhcp-config)# lease infinite</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the utilization mark of the current address pool size</div>
<div class="content">
<pre>(dhcp-config)# utilization mark high &lt;percentage-number&gt; [log]
(dhcp-config)# utilization mark low &lt;percentage-number&gt; [log]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a DHCP address pool with secondary subnets</div>
<div class="content">
<pre>(dhcp-config)# override default-router ??
(dhcp-config)# override utilization high &lt;percentage&gt;
(dhcp-config)# override utilization low &lt;percentage&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>TODO: add explanation</p>
</div>
<div class="listingblock">
<div class="title">Task: Verify the DHCP address pool configuration</div>
<div class="content">
<pre># show ip dhcp pool [name]
# show ip dhcp binding [address]
# show ip dhcp conflict [name]
# show ip dhcp database [url]
# show ip dhcp server statistics [type-number]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_address_bindings">Address bindings</h5>
<div class="ulist">
<ul>
<li>
<p>Mapping between the IP address and MAC address of a client</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display the current mapping</div>
<div class="content">
<pre># show ip dhcp binding</pre>
</div>
</div>
<div class="sect5">
<h6 id="_automatic_bindings">automatic bindings</h6>
<div class="ulist">
<ul>
<li>
<p>Dynamically maps hardware address to an IP address from a pool.</p>
</li>
<li>
<p>Stored in volatile RAM and periodically copied to database agent</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_manual_binding">manual binding</h6>
<div class="ulist">
<ul>
<li>
<p>MAC address of hosts are found in the DHCP database</p>
</li>
<li>
<p>Stored in NVRAM</p>
</li>
<li>
<p>Can be configured</p>
<div class="ulist">
<ul>
<li>
<p>Individually and stored in NVRAM</p>
</li>
<li>
<p>In batch from text files</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify the IP address and subnet mask of the client</div>
<div class="content">
<pre>(dhcp-config)# host &lt;address&gt; [&lt;mask&gt;| &lt;/prefix-length]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the unique identifier for a DHCP client</div>
<div class="content">
<pre>(dhcp-config)# client-identifier &lt;unique-identifier&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Send with DHCP option 61</p>
</li>
<li>
<p>Unique identifier</p>
<div class="ulist">
<ul>
<li>
<p>7-byte: 1byte for the media , 6 byte for the MAC address</p>
</li>
<li>
<p>27-byte: vendor, MAC address, source interface of the client</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Determine the client identifier</div>
<div class="content">
<pre># debug ip dhcp server packet

DHCPD:DHCPDISCOVER received from client 0b07.1134.a029 through relay 10.1.0.253.
DHCPD:assigned IP address 10.1.0.3 to client 0b07.1134.a029.</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task:</div>
<div class="content">
<pre>(dhcp-config)# hardware-address &lt;hw-address&gt; [&lt;protocol-type&gt; | &lt;hw-number&gt;]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>For client who can not send a client identifier in the packet</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task:</div>
<div class="content">
<pre>(dhcp-config)# client-name &lt;name&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not include the domain name</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_static_mapping">Static mapping</h5>
<div class="ulist">
<ul>
<li>
<p>From customer-created text file that DHCP server reads at boot</p>
<div class="ulist">
<ul>
<li>
<p>Short configuration: no need for several numerous host pools with manual bindings</p>
</li>
<li>
<p>Reduce space required in NVRAM to maintain address pools</p>
</li>
</ul>
</div>
</li>
<li>
<p>The file format has the following elements:</p>
<div class="ulist">
<ul>
<li>
<p>Database version number</p>
</li>
<li>
<p>End-of-file designator</p>
</li>
<li>
<p>Hardware type</p>
</li>
<li>
<p>Hardware address</p>
</li>
<li>
<p>IP address</p>
</li>
<li>
<p>Lease expiration</p>
</li>
<li>
<p>Time the file was created</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>*time* Jan 21 2005 03:52 PM
*version* 2
!IP address    Type    Hardware address     Lease expiration
10.0.0.4 /24   1       0090.bff6.081e       Infinite
10.0.0.5 /28   id      00b7.0813.88f1.66    Infinite
10.0.0.2 /21   1       0090.bff6.081d       Infinite
*end*</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the DHCP server to read a static mapping text file</div>
<div class="content">
<pre>(dhcp-config)# origin file &lt;url&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pings">Pings</h5>
<div class="ulist">
<ul>
<li>
<p>DHCP server pings an IP address twice before assigning it to a client.</p>
</li>
<li>
<p>If the ping is unanswered after waiting for 2 seconds, the server assumes that the address is not in use.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify the number of packets sent to a pool address before assigning it to a client</div>
<div class="content">
<pre>(config)# ip dhcp ping packets &lt;number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify how long a DHCP server waits for a ping reply from an address pool</div>
<div class="content">
<pre>(config)# ip dhcp ping timeout &lt;milliseconds&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bootp_interoperability">BOOTP interoperability</h5>
<div class="listingblock">
<div class="title">Task: Configure the DHCP server to not reply to any BOOTP requests.</div>
<div class="content">
<pre>(config)# ip dhcp boot ignore</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Forward ignored BOOTP request packets to another DHCP server</div>
<div class="content">
<pre>(config)# ip helper-address &lt;a.b.c.d&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_central_dhcp_server">Central DHCP server</h5>
<div class="ulist">
<ul>
<li>
<p>Updates specific DHCP options for remote DHCP server</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Import DHCP option parameters from central DHCP server</div>
<div class="content">
<pre>(dhcp-config)# import all
(config)# interface &lt;type&gt; &lt;number&gt;
(config-if)# ip address dhcp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the options that are imported from the central DHCP server</div>
<div class="content">
<pre># sh ip dhcp import</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_option_82">Option 82</h5>
<div class="ulist">
<ul>
<li>
<p>DHCP option contains information known by the relay agent</p>
</li>
<li>
<p>For dynamic IP addresses allocation</p>
</li>
<li>
<p>TOBECOMPLETED</p>
</li>
<li>
<p>By default, OS DHCP server uses info provided by option 82</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable DHCP address allocation with option 82</div>
<div class="content">
<pre>(config)# ip dhcp use class</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Define a DHCP class and relay agent information patterns</div>
<div class="content">
<pre>(config)# ip dhcp class &lt;name&gt;
(dhcp-class)# relay agent information
(dhcp-class-info)# relay-information hex &lt;pattern&gt; [*] [bitmask &lt;mask&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display DHCP class matching results</div>
<div class="content">
<pre># debug ip dhcp server class</pre>
</div>
</div>
<div class="sect5">
<h6 id="_static_route_with_the_next_hop_dynamically_obtained_through_dhcp">Static route with the next-hop dynamically obtained through DHCP</h6>
<div class="paragraph">
<p>TODO: explanation/context</p>
</div>
<div class="listingblock">
<div class="title">Task: Assign a static route for the default next-hop device when the DHCP server is accessed for an IP address</div>
<div class="content">
<pre># ip route &lt;prefix&gt; &lt;mask&gt; {&lt;ip-address&gt; | &lt;interface-number&gt; [&lt;ip-number&gt;]} dhcp [&lt;distance&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Ensure that the DHCP client and server are defined to supply a DHCP device option 3 of the DHCP packet.</p>
</li>
<li>
<p>If the DHCP client is not able to obtain an IP address or the default device IP address, the static route is not installed in the routing table.</p>
</li>
<li>
<p>If the lease has expired and the DHCP client cannot renew the address, the DHCP IP address assigned to the client is released and any associated static routes are removed from the routing table.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_statistics">Statistics</h5>
<div class="listingblock">
<div class="title">Task: Display server statistics</div>
<div class="content">
<pre># show ip dhcp server statistics</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Reset all DHCP server counters to 0</div>
<div class="content">
<pre># clear ip dhcp server statistics</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dhcp_relay_agent">10.3.4. DHCP Relay Agent</h4>
<div class="ulist">
<ul>
<li>
<p>Forwards requests and replies between clients and servers not on the same physical subnet</p>
</li>
<li>
<p>Sets the <strong>giaddr</strong> field and adds option 82</p>
</li>
<li>
<p>DHCP server and relay agent are enabled by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify the packet forwarding address</div>
<div class="content">
<pre>(config-if)# ip helper-address &lt;a.b.c.d&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Reduce the frequency with which DHCP clients change their addresses and forwards client requests to the server that handle the previous request.</div>
<div class="content">
<pre>(config-if)# ip dhcp relay prefer known-good-server</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The relay agent deletes the ARP entries for addresses offered to the client
on unnumbered interfaces.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Disable the DHCP relay agent service</div>
<div class="content">
<pre># no service dhcp</pre>
</div>
</div>
<div class="sect4">
<h5 id="_option_82_2">Option 82</h5>
<div class="imageblock">
<div class="content">
<img src="../images/dhcp-relay-agent-option-82.png" alt="dhcp relay agent option 82">
</div>
</div>
<div class="listingblock">
<div class="title">Task: Insert the DHCP relay agent information option in BOOTREQUEST messages forwarded to a DHCP server</div>
<div class="content">
<pre># ip dhcp relay information option</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>This function is disabled by default</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Check whethers the relay agent information option forwarded BOOTREPLY message is valid</div>
<div class="content">
<pre># ip dhcp relay information check</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the reforwarding policy</div>
<div class="content">
<pre># ip dhcp relay information policy {drop | keep | replace }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure all interfaces as trusted sources of the DHCP relay information option.</div>
<div class="content">
<pre># ip dhcp relay information trust-all</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure an interface as trusted sources of the DHCP relay information option.</div>
<div class="content">
<pre>(config-if)# ip dhcp relay information trusted</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display all interfaces that are configure to be a trusted source for the DHCP relay information option.</div>
<div class="content">
<pre># show ip dhcp relay information trusted-sources</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure per-interface support for the relay agent information option</div>
<div class="content">
<pre>(config-if)# ip dhcp relay information option-insert [none]
(config-if)# ip dhcp relay information check-reply [none]
(config-if)# ip dhcp relay information policy-action {drop | keep | replace}</pre>
</div>
</div>
<div class="paragraph">
<p>See more optional tasks
<a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipaddr_dhcp/configuration/15-mt/dhcp-15-mt-book/config-dhcp-relay-agent.html#GUID-B4DA9D20-F7A3-44BC-8019-D120136458DC">here</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dhcp_client">10.3.5. DHCP Client</h4>
<div class="listingblock">
<div class="title">Task: Acquire an IP address on an interface from DHCP</div>
<div class="content">
<pre>(config-if)# ip address dhcp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the DHCP packets sent and received during troubleshooting on the client side</div>
<div class="content">
<pre># debug dhcp detail</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Force a release of a DHCP lease</div>
<div class="content">
<pre># release dhcp</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>release dhcp</strong> command</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Starts the process to immediately release a DHCP lease for the specified interface.</p>
</li>
<li>
<p>Does not deconfigure the <strong>ip address dhcp</strong> command specified in the configuration file for the interface.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Force a renewal of a DHCP lease</div>
<div class="content">
<pre># renew dhcp</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <strong>renew dhcp</strong> command advances the DHCP lease timer to the next stage,
at which point one of the following occurs:</p>
<div class="ulist">
<ul>
<li>
<p>If the lease is currently in a BOUND state, the lease is advanced to the RENEW state and a DHCP RENEW request is sent.</p>
</li>
<li>
<p>If the lease is currently in a RENEW state, the timer is advanced to the REBIND state and a DHCP REBIND request is sent.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If there is no response to the RENEW request,
the interface remains in the RENEW state.
In this case, the lease timer will advance to the REBIND state and subsequently send a REBIND request.</p>
</li>
<li>
<p>If a NAK response is sent in response to the RENEW request, the interface is deconfigured.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_configurable_dhcp_client_feature">Configurable DHCP client feature</h5>
<div class="ulist">
<ul>
<li>
<p>Allows a client to use a user-specified client identifier, class identifier or suggested lease time when requesting an address from a DHCP server.</p>
</li>
<li>
<p>Options available:</p>
<div class="ulist">
<ul>
<li>
<p>Option 33: configure a list of static routes in the client.</p>
</li>
<li>
<p>Option 51: request a lease time for the IP address.</p>
</li>
<li>
<p>Option 55: request certain options from the DHCP server</p>
</li>
<li>
<p>Option 60: configure the vendor class identifier string to use in the DHCP interaction.</p>
</li>
<li>
<p>Option 61: specify their unique identifier</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_forcerenew_message_handling">FORCERENEW Message Handling</h5>
<div class="paragraph">
<p>TODO: Explain the feature</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure FORCERENEW message handling</div>
<div class="content">
<pre>! Specify the key chain to be used in authenticating a request
(config)# key chain &lt;name&gt;
(config-keychain)# key &lt;id&gt;
(config-keychain-key)# key-string &lt;text&gt;
!
! Specify the type of authentication
(config)# interface &lt;type number&gt;
(config-if)# ip dhcp client authentication key-chain &lt;name&gt;
(config-if)# ip dhcp client authentication mode &lt;type&gt;
!
# ip dhcp-client forcerenew</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_accounting_and_security">10.3.6. Accounting and Security</h4>
<div class="ulist">
<ul>
<li>
<p>Address vulnerability in PWLAN</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_dhcp_accounting">DHCP Accounting</h5>
<div class="ulist">
<ul>
<li>
<p>add AAA and RADIUS support to DHCP configuration</p>
</li>
<li>
<p>sends secure START/STOP accounting messages upon lease assignment/termination</p>
</li>
<li>
<p>Restrictions:</p>
<div class="ulist">
<ul>
<li>
<p>AAA and RADIUS must be enabled</p>
</li>
<li>
<p>only for network pools with automatic bindings</p>
</li>
<li>
<p><strong>clear ip dhcp binding</strong> or <strong>no service dhcp</strong> triggers accounting STOP messages</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable DHCP accounting if a specifier server group is configured to run RADIUS accounting</div>
<div class="content">
<pre>(dhcp-config)# accounting &lt;method-list-name&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Troubleshoot DHCP accounting</div>
<div class="content">
<pre>debug radius accounting
debug ip dhcp server events
debug aaa accounting
debug aaa id</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dhc_secured_ip_address_assignment">DHC secured IP address assignment</h5>
<div class="ulist">
<ul>
<li>
<p>Secures and synchronizes the MAC address of the client to the DHCP binding,
preventing hackers form spoofing the DHCP server and taking over a DHCP lease of an authorized client</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Secure ARP table entries to DHCP leases in the DHCP database</div>
<div class="content">
<pre>(dhcp-config)# update arp</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Existing active DHCP leases will not be secured until they are renewed.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Configure the renewal policy for unknown clients</div>
<div class="content">
<pre>(dhcp-config)# renew deny unknown</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>In some usage scenarios, such as a wireless hotspot,
where both DHCP and secure ARP are configured, a
connected client device might go to sleep or suspend for
a period of time. If the suspended time period is
greater than the secure ARP timeout (default of 91
seconds), but less than the DHCP lease time, the client
can awake with a valid lease, but the secure ARP timeout
has caused the lease binding to be removed because the
client has been inactive. When the client awakes, the
client still has a lease on the client side but is
blocked from sending traffic. The client will try to
renew its IP address but the DHCP server will ignore the
request because the DHCP server has no lease for the
client. The client must wait for the lease to expire
before being able to recover and send traffic again.</p>
</li>
<li>
<p>To remedy this situation, use the <strong>renew deny unknown</strong>
command in DHCP pool configuration mode. This command
forces the DHCP server to reject renewal requests from
clients if the requested address is present at the
server but is not leased. The DHCP server sends a
DHCPNAK denial message to the client, which forces the
client back to its initial state. The client can then
negotiate for a new lease immediately, instead of
waiting for its old lease to expire.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_dhcp_per_interface_lease_limit_and_statistics">DHCP per interface lease limit and statistics</h5>
<div class="ulist">
<ul>
<li>
<p>Allows an ISP to limit the number of DHCP leases allowed on an interface.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a DHCP lease limit to control the number of subscribers on an interface</div>
<div class="content">
<pre>(config)#  ip dhcp limit lease log
(config-if)# ip dhcp limit lease &lt;max-users&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the DHCP lease limit configuration</div>
<div class="content">
<pre># show ip dhcp limit lease</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Clear the stored lease violation entries</div>
<div class="content">
<pre># clear ip dhcp limit lease</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dhcp_authorized_arp">DHCP authorized ARP</h5>
<div class="listingblock">
<div class="title">Task: Disable dynamic ARP learning on an interface</div>
<div class="content">
<pre>(config-if)# arp authorized</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure how long an entry remains in the ARP cache</div>
<div class="content">
<pre>(config-if)# arp timeoute &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task:</div>
<div class="content">
<pre># show arp</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_arp_auto_logoff">ARP auto-logoff</h5>
<div class="ulist">
<ul>
<li>
<p>enhances DHCP authorized ARP by providing finer control and probing authorized clients to detect a logoff.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure an interval and number of probe retries for ARP</div>
<div class="content">
<pre>(config-if)# arp probe interval &lt;seconds&gt; count &lt;number&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dhcp_snooping">DHCP snooping</h5>
<div class="paragraph">
<div class="title">TODO</div>
<p>add information about option 82</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nat">10.4. NAT</h3>
<div class="ulist">
<ul>
<li>
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">IP Addressing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipaddr_nat/configuration/15-mt/nat-15-mt-book/iadnat-addr-consv.html#GUID-C79465FE-A23C-4341-88DC-E43E342D4977">NAT</span></span> </a></p>
</li>
<li>
<p><a href="https://www.ietf.org/rfc/rfc1631.txt">RFC 1631</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_purpose">10.4.1. Purpose</h4>
<div class="ulist">
<ul>
<li>
<p>IPv4 address conservation</p>
</li>
<li>
<p>can be static, dynamic or pat</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_inside_and_outside_address">10.4.2. Inside and outside address</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Inside local address
</td>
<td class="hdlist2">
<p>The (private) IP address that is assigned to a host on the inside network.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Inside global address
</td>
<td class="hdlist2">
<p>A (public) IP address that represents one or more inside local IP addresses to the outside world.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Outside local address
</td>
<td class="hdlist2">
<p>The (private) IP address of an outside host as it appears to the inside network.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Outside global address
</td>
<td class="hdlist2">
<p>The (public) IP address assigned to a host on the outside network by the owner of the host.</p>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Display NAT translation information</div>
<div class="content">
<pre>show ip nat translations [verbose]
show ip nat statistics</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_static_nat">10.4.3. Static NAT</h4>
<div class="ulist">
<ul>
<li>
<p>Statically correlates the same local host to the same public IP address.</p>
</li>
<li>
<p>Does not conserve IP addresses.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure static translation of inside source address</div>
<div class="content">
<pre>conf t
ip nat inside source static &lt;local-ip&gt; &lt;global-ip&gt;

interface &lt;type number&gt;
  ip address &lt;ip-address&gt; &lt;mask&gt; [secondary]
  ip nat inside

interface type number
  ip address &lt;ip-address&gt; &lt;mask&gt;
  ip nat outside</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dynamic_nat_without_pat">10.4.4. Dynamic NAT without PAT</h4>
<div class="ulist">
<ul>
<li>
<p>One local host uses an available public IP address in a pool.</p>
</li>
<li>
<p>Does not conserve IP addresses.</p>
</li>
<li>
<p>Timeout after period of nonuse</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure dynamic translation of inside source address</div>
<div class="content">
<pre>ip nat pool &lt;name&gt; &lt;start-ip&gt; &lt;end-ip&gt; {netmask &lt;mask&gt; | prefix-length &lt;length&gt;}
access-list &lt;acl&gt; permit source [&lt;w.i.l.d&gt;]
ip nat inside source list &lt;acl&gt; pool &lt;name&gt;

interface &lt;type number&gt;
  ip address &lt;ip-address&gt; &lt;mask&gt;
  ip nat inside

interface &lt;type number&gt;
  ip address &lt;ip-address&gt; &lt;mask&gt;
  ip nat outside</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Change timeouts value</div>
<div class="content">
<pre>ip nat translation &lt;seconds&gt;
ip nat translation udp-timeout &lt;seconds&gt;
ip nat translation dns-timeout &lt;seconds&gt;
ip nat translation tcp-timeout &lt;seconds&gt;
ip nat translation finrst-timeout &lt;seconds&gt;
ip nat translation icmp-timeout &lt;seconds&gt;
ip nat translation syn-timeout &lt;seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pat">10.4.5. PAT</h4>
<div class="ulist">
<ul>
<li>
<p>Like dynamic NAT but multiple local hosts share a single public address by multiplexing TCP/UDP ports.</p>
</li>
<li>
<p>Conserves IP addresses.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_nat_for_overlapping_address">10.4.6. NAT for overlapping address</h4>
<div class="ulist">
<ul>
<li>
<p>Can be done with any of the first three types.</p>
</li>
<li>
<p>Translates both source and destination addresses, instead of just the source (for packets going from
enterprise to the Internet).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_tcp_load_distribution_for_nat">10.4.7. TCP load distribution for NAT</h4>
<div class="ulist">
<ul>
<li>
<p>Round-robin allocation of a virtual host that coordinates load sharing among real hosts.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/nat-tcp-load-distribution.png" alt="nat tcp load distribution">
</div>
<div class="title">Figure 14. NAT TCP load distribution</div>
</div>
<div class="listingblock">
<div class="title">Task: Allow internal users access to the internet</div>
<div class="content">
<pre>ip nat pool &lt;name&gt; &lt;start-ip&gt; &lt;end-ip&gt; {netmask netmask | prefix-length prefix-length}
access-list number permit a.b.c.d [e.f.g.h]
ip nat inside source list number pool name overload

interface type number
  ip address ip-address mask
  ip nat inside

interface type number
  ip address ip-address mask
  ip nat outside
end</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_overlapping_networks">10.4.8. Overlapping networks</h4>
<div class="paragraph">
<p>Configure dynamic translation of overlapping networks if your IP addresses in the stub network are
legitimate IP addresses belonging to another network and you want to communicate with those hosts or
routers using dynamic translation.</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure overlapping network</div>
<div class="content">
<pre>ip nat pool name start-ip end-ip {netmask netmask | prefix-length prefix-length}
access-list access-list-number permit source [source-wildcard]
ip nat outside source list access-list-number pool name

interface type number
  ip address ip-address mask
  ip nat inside

interface type number
  ip address ip-address mask
  ip nat outside</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_tcp_load_balancing">10.4.9. Server TCP load balancing</h4>
<div class="listingblock">
<div class="content">
<pre>ip nat pool name start-ip end-ip {netmask netmask | prefix-length prefix-length} type rotary
access-list access-list-number permit source [source-wildcard]
ip nat inside destination-list access-list-number pool name

interface type number
  ip address ip-address mask
  ip nat inside

interface type number
  ip address ip-address mask
  ip nat outside</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Clear NAT entries before the timeout</div>
<div class="content">
<pre>clear ip nat translation inside global-ip local-ip outside local-ip global-ip
clear ip nat translation outside global-ip local-i p
clear ip nat translation protocol inside global-ip global-port local-ip local-port outside local-ip local-port-global-ip global-port
clear ip nat translation {* | [forced] | [inside global-ip local-ip] [outside local-ip global-ip]}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable Syslog for logging NAT translations</div>
<div class="content">
<pre>ip nat log translations syslog
no logging console</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nat_order_of_operations">10.4.10. NAT order of operations</h4>
<div class="sect4">
<h5 id="_inside_to_outside">Inside-to-Outside</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If IPSec then check input access list</p>
</li>
<li>
<p>decryption - for CET (Cisco Encryption Technology) or IPSec</p>
</li>
<li>
<p>check input access list</p>
</li>
<li>
<p>check input rate limits</p>
</li>
<li>
<p>input accounting</p>
</li>
<li>
<p>redirect to web cache</p>
</li>
<li>
<p>policy routing</p>
</li>
<li>
<p>routing</p>
</li>
<li>
<p>NAT inside to outside (local to global translation)</p>
</li>
<li>
<p>crypto (check map and mark for encryption)</p>
</li>
<li>
<p>check output access list</p>
</li>
<li>
<p>inspect (Context-based Access Control (CBAC))</p>
</li>
<li>
<p>TCP intercept</p>
</li>
<li>
<p>encryption</p>
</li>
<li>
<p>Queueing</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_outside_to_inside">Outside-to-Inside</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If IPSec then check input access list</p>
</li>
<li>
<p>decryption - for CET or IPSec</p>
</li>
<li>
<p>check input access list</p>
</li>
<li>
<p>check input rate limits</p>
</li>
<li>
<p>input accounting</p>
</li>
<li>
<p>redirect to web cache</p>
</li>
<li>
<p>NAT outside to inside (global to local translation)</p>
</li>
<li>
<p>policy routing</p>
</li>
<li>
<p>routing</p>
</li>
<li>
<p>crypto (check map and mark for encryption)</p>
</li>
<li>
<p>check output access list</p>
</li>
<li>
<p>inspect CBAC</p>
</li>
<li>
<p>TCP intercept</p>
</li>
<li>
<p>encryption</p>
</li>
<li>
<p>Queueing</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Read more:
<a href="http://www.cisco.com/c/en/us/support/docs/ip/network-address-translation-nat/6209-5.html#topic1NAT">Order of operations</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nhrp">10.5. NHRP</h3>
<div class="paragraph">
<p>TIP:
if dmvpn phase 3, the tunnel key must be the same as the tunnel key</p>
</div>
<div class="paragraph">
<p>!! DMVPN HUB
int f0/0.123
	enc dot1q 123
	ip address 10.0.0.1 255.255.255.0
	no shut
int t123
  ip add 129.99.123.1 255.255.255.0
  tunnel source f0/0.123
  tunnel mode gre multipoint
  tunnel key 123
  ip nhrp network-id 123
  ip nhrp map multicast dynamic
  ip nhrp network-id 321</p>
</div>
<div class="paragraph">
<p>!! DMVPN SPOKE
int f0/0.123
	desc ospf
	enc dot1q 123
	ip address 10.0.0.2 255.255.255.0
int t123
  ip add 129.99.123.2 255.255.255.0
  tunnel source f0/0.123
  tunnel destination 10.0.0.1
  tunnel key 123
  ip nhrp network-id 123
  ip nhrp nhs 129.99.123.1
  ip nhrp map multicast 10.0.0.1
  ip nhrp map 129.99.123.1 10.0.0.1</p>
</div>
<div class="listingblock">
<div class="title">Task: Verify that NHRP registration has been sent from spokes to the hub</div>
<div class="content">
<pre>R1#sh ip nhrp

129.99.123.2/32 via 129.99.123.2
   Tunnel123 created 00:08:18, expire 01:54:55
   Type: dynamic, Flags: unique registered
   NBMA address: 10.0.0.2
129.99.123.3/32 via 129.99.123.3
   Tunnel123 created 00:09:22, expire 01:54:57
   Type: dynamic, Flags: unique registered
   NBMA address: 10.0.0.3</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ipv6">10.6. IPv6</h3>
<div class="sect3">
<h4 id="_ipv6_header">10.6.1. IPv6 Header</h4>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 7. IPv6 Base Header Format</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Comparison with IPv4</th>
<th class="tableblock halign-left valign-top">Packet</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="dlist">
<dl>
<dt class="hdlist1">Streamlined</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Fragmentation fields moved out of base header</p>
</li>
<li>
<p>IP options moved out of base header</p>
</li>
<li>
<p>Header checksum eliminated</p>
</li>
<li>
<p>Header length field eliminated</p>
</li>
<li>
<p>Length field excludes IPv6 header</p>
</li>
<li>
<p>Alignment changed from 32 to 64 bits</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Revised</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Time to live &#8594; hop limit</p>
</li>
<li>
<p>Protocol &#8594; next header</p>
</li>
<li>
<p>Precedence and TOS &#8594; traffic class</p>
</li>
<li>
<p>Addresses increased 32 bits &#8594; 128 bits</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Extended</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Flow label field added</p>
</li>
</ul>
</div>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<img src="../images/ipv6-header-format.png" alt="ipv6 header format" width="896" height="440">
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_traffic_class">Traffic Class</h5>
<div class="ulist">
<ul>
<li>
<p>6 bits for ToS</p>
</li>
<li>
<p>2 bits for ECN</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_flow_label">Flow Label</h5>
<div class="ulist">
<ul>
<li>
<p>Sequence in a particular flow</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_payload_length">Payload Length</h5>
<div class="paragraph">
<p>-</p>
</div>
</div>
<div class="sect4">
<h5 id="_next_header">Next header</h5>
<div class="paragraph">
<p>When more than one extension header is used in the same
packet, it is recommended that those headers appear in the
following order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IPv6 header</p>
</li>
<li>
<p>Hop-by-hop options header</p>
</li>
<li>
<p>Destination options header (routing header associations)</p>
</li>
<li>
<p>Routing header</p>
</li>
<li>
<p>Fragment header</p>
</li>
<li>
<p>Authentication header</p>
</li>
<li>
<p>Encapsulating security payload header</p>
</li>
<li>
<p>Destination options header (options processed by final estination)</p>
</li>
<li>
<p>Upper-layer header</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Header Type</th>
<th class="tableblock halign-left valign-top">Next Header Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hop-by-Hop Options Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read by all devices in transit network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination Option Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read by the final destination device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Routing Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support routing decision making</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fragment Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">44</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains parameters of datagram fragmentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Header (RFC 1826) and ESP Header (RFC 1827)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">51</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encapsulating Security Payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carries encrypted data for secure communication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upper-Layer Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TCP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upper-Layer Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(UDP)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mobility Header (currently without upper layer)</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Value 59 means No Next Header</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_addressing">10.6.2. Addressing</h4>
<div class="ulist">
<ul>
<li>
<p>128 bits</p>
</li>
<li>
<p>Represented in hexadecimal and uses 8 colon-separated fields of 16 bits.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_ipv4_vs_ipv6">IPv4 vs IPv6</h5>
<div class="ulist">
<ul>
<li>
<p>Multiple ipv6 addresses on a logical or physical interface with equal precedence on IOS (only one primary
ipv4 with optional secondary address)</p>
</li>
<li>
<p>Automatic configuration of globally unique address (without the need of DHCP)</p>
</li>
<li>
<p>Built-in neighbor discovery of neighbors, routers and gateways</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_address_abbreviation_rules">Address abbreviation rules</h5>
<div class="ulist">
<ul>
<li>
<p>Whenever one or more successive 16-bit groups in an IPv6 address consist of all 0s, that
portion of the address can be omitted and represented by two colons (::). The two-colon
abbreviation can be used only once in an address, to eliminate ambiguity.</p>
</li>
<li>
<p>When a 16-bit group in an IPv6 address begins with one or more 0s, the leading 0s can be
omitted. This option applies regardless of whether the double-colon
abbreviation method is used anywhere in the address.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>2001:0001:0000:0000:00A1:0CC0:01AB:397A

2001:1:0:0:A1:CC0:1AB:397A
2001:0001::00A1:0CC0:01AB:397A
2001:1::A1:CC0:1AB:397A</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_address_types">Address types</h5>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address Type</th>
<th class="tableblock halign-left valign-top">Range</th>
<th class="tableblock halign-left valign-top">Application</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggregatable global unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000::/3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host-to-host communication; same as IPv4 unicast.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF00::/8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One-to-many and many-to-many communication; same as IPv4 multicast.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anycast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as Unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application-based, including load balancing, optimizing traffic for a particular service, and
redundancy. Relies on routing metrics to determine the best destination for a particular host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link-local  unicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FE80::/10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connected-link communications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solicited-node multicast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::1:FF00:0/104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Neighbor solicitation.</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_unicast">Unicast</h6>
<div class="sect6">
<h7 id="_aggregatable_global_addresses">Aggregatable global addresses</h7>
<div class="ulist">
<ul>
<li>
<p>Begin with binary 001 (hexadeximal= 2000::/3)</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ipv6-unicast-address-format.png" alt="ipv6 unicast address format" height="150">
</div>
</div>
</div>
<div class="sect6">
<h7 id="_link_local_addresses">Link-local addresses</h7>
<div class="ulist">
<ul>
<li>
<p>Starts with FE80::/10</p>
</li>
<li>
<p>Follows by 54 bits set to 0</p>
</li>
<li>
<p>Interface ID</p>
</li>
<li>
<p>Routers do not forward link-local traffic to other segments.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_ipv4_compatible_addresses">IPv4-compatible addresses</h7>
<div class="ulist">
<ul>
<li>
<p>One option is to have first 96 bits set to 0</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>0:0:0:0:0:10:10:100:16
::10:10:100:16
::A:A:64:10</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_assign_an_ipv6_unicast_address_to_a_router_interface">Assign an IPv6 unicast address to a router interface</h7>
<div class="listingblock">
<div class="title">Task: Enable ipv6 on the router</div>
<div class="content">
<pre>(config)# ipv6 unicast-routing</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a global unicast address</div>
<div class="content">
<pre>(config-if)# ipv6 address 2014:10:12::19:66/64</pre>
</div>
</div>
<div class="paragraph">
<p>Router automatically configure a link local address on all IPv6 enabled interfaces.
However, you can explicitly configure one</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ipv6 address fe80::1 link-local</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_multicast">Multicast</h6>
<div class="sect6">
<h7 id="_ipv6_multicast_address_format">IPv6 multicast address format</h7>
<div class="ulist">
<ul>
<li>
<p>Begin with FF as the first octect, or FF00::/8</p>
</li>
<li>
<p>The second octet specifies lifetime (permanent or temporary) and the scope (node, link, site, organization, global)</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ipv6-multicast-address-format.png" alt="ipv6 multicast address format">
</div>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 8. IPv6 Multicast Well-Known Addresses</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Multicast Group</th>
<th class="tableblock halign-left valign-top">IPv4 Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subnet broadcast address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OSPFv3 routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OSPFv3 designated routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIGRP routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIM routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FF02::D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.0.13</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each router must join the <strong>solicited-node group</strong> (FF02::1:FF00:0000/104)  for all unicast and anycast traffic.
The last 24 bits come from the corresponding last 24 bits of the unicast or anycast address.
The <strong>neighbor discovery</strong> process uses solicited-node addresses.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_anycast">Anycast</h6>
<div class="paragraph">
<p>Anycast addresses can be assigned to any number of hosts that provide the same service; when other hosts access this
service, the specific server they hit is determined by the unicast routing metrics on the path to that
particular group of servers. This provides geographic differentiation, enhanced availability, and
load balancing for the service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ipv6 address 3001:fffe::104/64 anycast</pre>
</div>
</div>
<div class="paragraph">
<p>All IPv6 routers additionally must support the subnet router anycast address. This anycast address
is a prefix followed by all 0s in the interface ID portion of the address. Hosts can use a subnet
router anycast address to reach a particular router on the link identified by the prefix given in the
subnet router anycast address.</p>
</div>
</div>
<div class="sect5">
<h6 id="_the_unspecified_address">The unspecified address</h6>
<div class="ulist">
<ul>
<li>
<p>Represented by <strong>::</strong></p>
</li>
<li>
<p>Used as source address by an interface that has not yet learned its unicast addresses.</p>
</li>
<li>
<p>Cannot be assigned to an interface</p>
</li>
<li>
<p>Cannot be used as a destination address</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_embed_an_rp_address_within_a_multicast_group_address">how to embed an RP address within a multicast group address</h6>
<div class="paragraph">
<p>RFC 2373</p>
</div>
<div class="paragraph">
<p>Given address 2001:DB*:0717::A,
Follow the structure FF<em>7</em><strong>X</strong>:0<strong>Y</strong>30:2001:DB8:0717::<strong>group</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>FF for a multicast address</p>
</li>
<li>
<p>7 indicates that the RP address is embedded in the multicast address</p>
</li>
<li>
<p>X for the multicast scope</p>
<div class="ulist">
<ul>
<li>
<p>1 node-local</p>
</li>
<li>
<p>2 link-local</p>
</li>
<li>
<p>5 site-local</p>
</li>
<li>
<p>8 organization-local</p>
</li>
<li>
<p>E global</p>
</li>
<li>
<p>F reserved</p>
</li>
</ul>
</div>
</li>
<li>
<p>0 in the first character of the second hextet</p>
</li>
<li>
<p>Y for the RP interface ID from 1 to F</p>
</li>
<li>
<p>30 for the mask for the network (0x30 = decimal 48)</p>
</li>
<li>
<p>Remaining hextets for the network prefix</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ipv6_address_autoconfiguration">IPv6 address autoconfiguration</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Stateful autoconfiguration</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Assigns a host its entire 128-bit address using DHCP</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Stateless autoconfiguration</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Assigns a host a 64-bit prefix,
and the host derives the last bit using EUI-64 process.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect5">
<h6 id="_eui_64_address">EUI-64 address</h6>
<div class="ulist">
<ul>
<li>
<p>Split 48-bit MAC address in two parts</p>
</li>
<li>
<p>Place FFFE in the middle</p>
</li>
<li>
<p>Set to 1 the universal/local bit (7th bit in the interface id )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given the IPv6 prefix 2001:128:1f:633 and MAC address 00:07:85:80:71:B8,
the resulting EUI-address is 2001:128:1f:633:<strong>2</strong>07:85<strong>FF:FE</strong>80:71B8/64</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ipv6 address 2001:128:1f:633::/64 eui-64</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_basic_ipv6_functionality_protocols">10.6.3. Basic  IPv6 functionality protocols</h4>
<div class="sect4">
<h5 id="_neighbor_discovery">Neighbor discovery</h5>
<div class="ulist">
<ul>
<li>
<p>RFC 2461</p>
</li>
<li>
<p>Discover and track other IPv6 hosts on connected interfaces</p>
</li>
<li>
<p>Uses ICMPv6 messages and Solicited-node multicast addresses</p>
</li>
<li>
<p>Major roles</p>
<div class="ulist">
<ul>
<li>
<p>Stateless address autoconfiguration (detailed in RFC 2462)</p>
</li>
<li>
<p>Duplicate address detection (DAD)</p>
</li>
<li>
<p>Router discovery</p>
</li>
<li>
<p>Prefix discovery</p>
</li>
<li>
<p>Parameter discovery (link MTU, hop limits)</p>
</li>
<li>
<p>Neighbor discovery</p>
</li>
<li>
<p>Neighbor address resolution (replaces ARP, both dynamic and static)</p>
</li>
<li>
<p>Neighbor and router reachability verification</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_neighbor_advertisements">Neighbor advertisements</h6>
<div class="ulist">
<div class="title">ICMPv6 messages used by ND</div>
<ul>
<li>
<p>Host advertises their pr</p>
</li>
<li>
<p>Source addresses</p>
</li>
<li>
<p>Destination addresses</p>
</li>
<li>
<p>Icmp type, code: 134,0</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_neighbor_solicitation">Neighbor solicitation</h6>
<div class="ulist">
<ul>
<li>
<p>NS messages to find the link-layer of a specific neighbor</p>
</li>
<li>
<p>Source address: manual assigned or ::</p>
</li>
<li>
<p>Destination address: target address or solicited-node multicast address</p>
</li>
<li>
<p>ICMP type, code: 135,0</p>
</li>
<li>
<p>Uses in 3 operations: duplicate address detection, neighbor reachability verification, layer 3 to layer 2 address resolution.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IPv6 does not include ARP as a protocol but rather integrates the same functionality into ICMP as part of neighbor discovery.
The response to an NS message is an NA message .
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ipv6-neighbor-discovery.png" alt="ipv6 neighbor discovery">
</div>
<div class="title">Figure 15. Neighbor discovery between two hosts</div>
</div>
</div>
<div class="sect5">
<h6 id="_router_advertisement">Router advertisement</h6>
<div class="ulist">
<ul>
<li>
<p>Routers advertise their presence and link prefixes, MTU, hop limits</p>
</li>
<li>
<p>Source address: router&#8217;s link-local address</p>
</li>
<li>
<p>Destination address: all-nodes FF02::1 for periodic broadcasts, querying host address for response</p>
</li>
<li>
<p>Icmp type, code: 134,0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A Cisco IPv6 router begins sending RA messages for each of its configured interface prefixes
when the <strong>ipv6 unicast-routing</strong> command is configured. You can change the default RA interval
(200 seconds) using the command <strong>ipv6 nd ra-interval</strong>. Router advertisements on a given interface
include all of the 64-bit IPv6 prefixes configured on that interface. This allows for stateless address
autoconfiguration using EUI-64 to work properly. RAs also include the link MTU, hop limits, and
whether a router is a candidate default router.</p>
</div>
<div class="paragraph">
<p>IPv6 routers send periodic RA messages to inform hosts about the IPv6 prefixes used on the link
and to inform hosts that the router is available to be used as a default gateway.
By default, a Cisco router running IPv6 on an interface advertises itself as a candidate default router.</p>
</div>
<div class="listingblock">
<div class="title">Task: Prevent router to advertise itself as a default candidate but do not hide its presence</div>
<div class="content">
<pre>ipv6 nd ra-lifetime 0</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Hide presence of a router running IPv6</div>
<div class="content">
<pre>ipv6 nd suppress-ra</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_router_solicitation">Router solicitation</h6>
<div class="ulist">
<ul>
<li>
<p>Host query for the presence of routers on the link</p>
</li>
<li>
<p>Source address: querying host interface, or :: if not assigned</p>
</li>
<li>
<p>Destination address: FF02::2</p>
</li>
<li>
<p>Icmp type, code : 133,0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At startup, IPv6 hosts can send RS messages to the all-routers multicast address.
Hosts do this to learn the addresses of routers on a given link, as well as their various
parameters, without waiting for a periodic RA message. If a host has no configured IPv6 address,
it sends an RS using the unspecified address as the source. If it has a configured address, it sources
the RS from the configured address.</p>
</div>
</div>
<div class="sect5">
<h6 id="_duplicate_address_detection">Duplicate address Detection</h6>
<div class="paragraph">
<p>To verify that autoconfigured or statically address is unique,
the host sends an NS message to its own autoconfigured address&#8217;s corresponding solicited-node multicast address.
This message is sourced from the unspecified address ::.
In the target address field in the NS is the address the host seeks to verify.
If an NA from another host results, the sending host knows that the address is not unique</p>
</div>
</div>
<div class="sect5">
<h6 id="_neighbor_unreachability_detection">Neighbor unreachability detection</h6>
<div class="paragraph">
<p>2 options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a host sends a probe to the desired host&#8217;s solicited-node multicast address and receives an RA or an NA in response.</p>
</li>
<li>
<p>a host, in communication with the desired host, receives a clue from higher-layer protocol (e.g. TCP ACK)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_icmpv6">ICMPv6</h5>
<div class="ulist">
<ul>
<li>
<p>RFC 2463</p>
</li>
<li>
<p>Two groups of messages: error reporting messages and informational messages</p>
</li>
<li>
<p>IOS implements ICMP rate limiting by setting the minimum interval between error messages and build a token bucket</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Limit ICMPv6 error messages with default interval 100 ms , and default token-bucket size 10.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ipv6 icmp error-interval seconds ???</pre>
</div>
</div>
<div class="sect5">
<h6 id="_unicast_reverse_path_forwarding">Unicast reverse path forwarding</h6>
<div class="ulist">
<ul>
<li>
<p>Protects router from DoS attacks from spoofed IPv6 host address.</p>
</li>
<li>
<p>Performs a recursive lookup in the ipv6 routing table
to verify that the packet came in on the correct interface.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ipv6 verify unicast reverse-path</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dns">DNS</h5>
<div class="ulist">
<ul>
<li>
<p>Provides resolution of domain names</p>
</li>
<li>
<p>DNS records: AAAA (RFC 1886), A6 (RFC 2874)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_cdp_2">CDP</h5>
<div class="ulist">
<ul>
<li>
<p>Cisco Discovery Protocol</p>
</li>
<li>
<p>Provides extensive information about the configuration and functionality of Cisco devices.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Display IPv6 information transmitted in CDP</div>
<div class="content">
<pre># show cdp neighbors detail</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dhcp_2">DHCP</h5>
<div class="ulist">
<ul>
<li>
<p>RFC 3315</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Two conditions can cause a host to use DHCPv6:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The host is explicitly configured to use DHCPv6 based on an implementation-specific setting.</p>
</li>
<li>
<p>An IPv6 router advertises in its RA messages that it wants hosts to use DHCPv6 for
addressing. Routers do this by setting the M flag (Managed Address Configuration) in RAs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use stateful autoconfiguration, a host sends a DHCP request to one of two well-known IPv6
multicast addresses on UDP port 547:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FF02::1:2, all DHCP relay agents and servers</p>
</li>
<li>
<p>FF05::1:3, all DHCP servers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The DHCP server then provides the necessary configuration information in reply to the host on UDP port 546.
This information can include the same types of information used in an IPv4 network,
but additionally it can provide information for multiple subnets,
depending on how the DHCP server is configured.</p>
</div>
<div class="paragraph">
<p>To configure a Cisco router as a DHCPv6 server,
you first configure a DHCP pool, just as in IPv4
then enable the DHCPv6 service using the <strong>ipv6 dhcp server pool-name</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="_access_lists">Access lists</h5>
<div class="paragraph">
<p>Similar with IPv4 access lists except that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Because Neighbor Discovery is a key protocol in IPv6 networks, access lists implicitly permit
ND traffic. This is necessary to avoid breaking ND’s ARP-like functionality.
You can override this implicit-permit behavior using deny statements in IPv6 access lists.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure an interface to filter traffic using an access list</div>
<div class="content">
<pre>ipv6 traffic-filter access-list-name {in | out}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>IPv6 access lists are always named; they cannot be numbered (unless you use a number as a name).</p>
</li>
<li>
<p>IPv6 access lists are configured in named access-list configuration mode, which is like IPv4
named access-list configuration mode. However, you can also enter IPv4-like commands that
specify an entire access-list entry on one line. The router will convert it to the correct
configuration commands for named access-list configuration mode.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ipv6_routing">10.6.4. IPv6 routing</h4>
<div class="sect4">
<h5 id="_static_routes">Static routes</h5>
<div class="paragraph">
<p>Similar to IPv4 static routes except that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An IPv6 static route to an interface has an administrative distance of 1, not 0 as in IPv4.</p>
</li>
<li>
<p>An IPv6 static route to a next-hop IP address also has an administrative distance of 1, like IPv4.</p>
</li>
<li>
<p>Floating static routes work the same way in IPv4 and IPv6.</p>
</li>
<li>
<p>An IPv6 static route to a broadcast interface type, such as Ethernet, must also specify a next-hop IPv6 address because</p>
<div class="ulist">
<ul>
<li>
<p>IPv6 does not use ARP</p>
</li>
<li>
<p>There is no concept of proxy ARP</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ipv6 route 2001:128::/64 2001::207:85FF:FE80:7208</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>show ipv6 route</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ospfv3">OSPFv3</h5>
<div class="paragraph">
<p><a href="http://www.cisco.com/en/US/docs/ios/ipv6/configuration/guide/ip6-ospf.html#wp1069821">implementing OSPF for IPv6</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_eigrpv6">EIGRPv6</h5>

</div>
</div>
<div class="sect3">
<h4 id="_ospfv3_2">10.6.5. ospfv3</h4>
<div class="ulist">
<ul>
<li>
<p>Router id is highest ipv4 loopback, highest ipv4, or <strong>router-id</strong> id command</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_readings_2">10.6.6. readings</h4>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/ios/12_4/interface/configuration/guide/inb_tun.html#wp1045782">Implement tunnels</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ip_switching">11. IP Switching</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cef">11.1. CEF</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_ip_routing">12. IP routing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_rip">12.1. RIP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">IP Routing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/iproute_rip/configuration/15-mt/irr-15-mt-book/irr-cfg-info-prot.html#GUID-2651B980-3A1B-489F-98D0-93A7102AEA5D">RIP</span></span> </a></p>
</div>
<div class="sect3">
<h4 id="_overview_10">12.1.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>Distance vector protocol</p>
</li>
<li>
<p>transport: UDP 520</p>
</li>
<li>
<p>update destination:</p>
<div class="ulist">
<ul>
<li>
<p>broadcast 255.255.255.255 for RIPv1</p>
</li>
<li>
<p>multicast 224.0.0.9 for RIPv2</p>
</li>
</ul>
</div>
</li>
<li>
<p>full updates every 30 seconds</p>
</li>
<li>
<p>Trigerred updates</p>
</li>
<li>
<p>multiple routes to the same subnet with equal metric:</p>
<div class="ulist">
<ul>
<li>
<p>1 to 6</p>
</li>
<li>
<p>default = 4</p>
</li>
<li>
<p>configured with <strong>ip maximum-paths <em>n</em></strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>metric: hop count with</p>
<div class="ulist">
<ul>
<li>
<p>1 signifying a directly connected network of the advertising router</p>
</li>
<li>
<p>16 signifying an unreachable network.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Support CIDR, VLSM, authentication</p>
</li>
<li>
<p>Periodic updates every 30 seconds to multicast address 224.0.0.9</p>
</li>
<li>
<p>Split horizon with poison reverse</p>
</li>
<li>
<p>Subnet mask included in route entry</p>
</li>
<li>
<p>Administrative distance: 120</p>
</li>
<li>
<p>Route tags when routes are redistributed into RIP</p>
</li>
<li>
<p>Can advertise a next-hop router that is different from itself</p>
</li>
<li>
<p>Does not keep a separate topology table</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_default_rip_configuration">12.1.2. Default RIP configuration</h4>
<div class="ulist">
<ul>
<li>
<p>version : 1</p>
</li>
<li>
<p>auto-summary : enable</p>
</li>
<li>
<p>authentication : disable</p>
</li>
<li>
<p>authentication mode: text</p>
</li>
<li>
<p>split-horizon : enable</p>
</li>
<li>
<p>Interpacket delay : no</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_basic_configuration_2">12.1.3. Basic configuration</h4>
<div class="listingblock">
<div class="content">
<pre>(config)#router rip
(config-router)#version 2
(config-router)#network 10.0.0.0
(config-router)#no auto-summary</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_version_4">12.1.4. Version</h4>
<div class="listingblock">
<div class="title">Task: Specify the RIP version globally</div>
<div class="content">
<pre>(config-router)# version {1 | 2}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure an interface to send only a RIPv2 packets</div>
<div class="content">
<pre>(config-if)ip rip send version {1,2}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure an interface to receive only a RIPv2 packets</div>
<div class="content">
<pre>(config-if)ip rip receive version {1|2}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authentication">12.1.5. Authentication</h4>
<div class="listingblock">
<div class="title">Task: Enable RIP authentication</div>
<div class="content">
<pre>(config-if)# ip rip authentication key-chain &lt;name&gt;
(config-if)# ip rip authentication mode {text | md5}</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use *show key chain" to spot invisible blank space after passwords</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_summarization">12.1.6. Summarization</h4>
<div class="ulist">
<ul>
<li>
<p>Default: auto-summarization</p>
<div class="ulist">
<ul>
<li>
<p>summarizes prefixes to the classful network boundaries
when classful network boundaries are crossed.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Supernet advertisement not allowed</p>
<div class="ulist">
<ul>
<li>
<p>e.g. <strong>ip summary-address rip 10.0.0.0 252.0.0.0</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Disable automatic route summarization</div>
<div class="content">
<pre>(config-router)# no auto-summary</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Summarize a prefix</div>
<div class="content">
<pre>(config-if)# ip summary-address rip &lt;ip-address&gt; &lt;mask&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_route_updates">12.1.7. Route updates</h4>
<div class="listingblock">
<div class="title">Task: Disable sending RIP updates on an interface but continue to receive the update</div>
<div class="content">
<pre>(config-if)# passive-interface { default | &lt;type number&gt;}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable the validation of the source IP address of incoming RIP routing updates</div>
<div class="content">
<pre>(config-router)# no validate-update-source</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_route_filtering">12.1.8. Route filtering</h4>
<div class="listingblock">
<div class="title">Task: Stop advertising a route with a prefix-list</div>
<div class="content">
<pre></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: filter out RIP routes with extended access lists</div>
<div class="content">
<pre>(config-router)# distribute-list &lt;extended-acl&gt; {in|out} [&lt;interface-id&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The source field in the ACL matches the update source of the route</p>
</li>
<li>
<p>The destination field represents the network address</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_route_metric">12.1.9. Route metric</h4>

</div>
<div class="sect3">
<h4 id="_split_horizon">12.1.10. Split horizon</h4>
<div class="listingblock">
<div class="title">Task: Disable split horizon</div>
<div class="content">
<pre>(config-if)# no ip split-horizon</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_interpacket_delay_for_rip_updates">12.1.11. Interpacket delay for RIP updates</h4>
<div class="ulist">
<ul>
<li>
<p>Useful when high-end router send RIP updates to low-end router</p>
</li>
<li>
<p>default: 0 in range 8 to 50 milliseconds</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure interpacket delay</div>
<div class="content">
<pre>(config-if)# output-delay &lt;milliseconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rip_optimization_over_wan">12.1.12. Rip Optimization over WAN</h4>
<div class="listingblock">
<div class="title">Task: Enable triggered extensions for RIP</div>
<div class="content">
<pre>(config)# int serial &lt;controller-number&gt;
(config-if)# ip rip trigerred</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_offset_list">12.1.13. Offset-list</h4>
<div class="listingblock">
<div class="title">Task: Add an offset to incoming and outgoing metrics to RIP routes</div>
<div class="content">
<pre>(config-router)# offset-list {&lt;acl&gt;} {in | out } &lt;offset&gt; {interface-type-number&gt;}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_timers_3">12.1.14. Timers</h4>
<div class="listingblock">
<div class="title">Task: Configure RIP timers</div>
<div class="content">
<pre>(config-router)# timers basic &lt;update&gt; &lt;invalid&gt; &lt;holddown&gt; &lt;flush&gt; [&lt;sleeptime&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Update timer: interval between updates. Default: 30 seconds</p>
</li>
<li>
<p>Invalid timer: time in seconds after which a route is declared invalid.</p>
<div class="ulist">
<ul>
<li>
<p>Should be at least 3 times the update timer.</p>
</li>
<li>
<p>Invalid routes are still used for forwarding packets</p>
</li>
<li>
<p>Default: 180 seconds</p>
</li>
</ul>
</div>
</li>
<li>
<p>Holdown timer: interval during which routing information about better paths is suppressed.</p>
<div class="ulist">
<ul>
<li>
<p>Should be at least 3 times the update timer</p>
</li>
<li>
<p>The route is marked inaccessible and advertised as unreachable.</p>
</li>
<li>
<p>Holdown routes are still used for forwarding packets</p>
</li>
<li>
<p>Default: 180 seconds</p>
</li>
</ul>
</div>
</li>
<li>
<p>Flush timer: amount of time that must pass berore a route is removed from the RIB. Default: 240 seconds</p>
</li>
<li>
<p>Sleep time: amount of time for which routing updates will be postponed.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Specify a default update interval on an interface</div>
<div class="content">
<pre>(config-if)# ip rip advertise &lt;seconds&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The comd above overrides the update timers set by <strong>timers basic</strong> command.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eigrp">12.2. EIGRP</h3>
<div class="ulist">
<ul>
<li>
<p>classless protocol (VLSM, summarization)</p>
</li>
<li>
<p>multiple routed protocol support (ipv4, ipx, appletalk, )</p>
</li>
<li>
<p>uses its own transport protocol</p>
<div class="ulist">
<ul>
<li>
<p>IP protocol 88: RTP</p>
</li>
<li>
<p>uses multicast to 224.0.0.10 and unicast</p>
</li>
</ul>
</div>
</li>
<li>
<p>Administrative distance : 90 internal routes, 5 summary routes , 170 external routes</p>
</li>
<li>
<p>Forms active neighbor adjacencies</p>
</li>
<li>
<p>DUAL for loop-free topology and fast convergence</p>
</li>
<li>
<p>granular metric</p>
</li>
<li>
<p>unequal cost load balancing</p>
</li>
<li>
<p>summarization</p>
</li>
<li>
<p>Supports MD5 based authentication</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_eigrp_messages">12.2.1. EIGRP messages</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Hello
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>multicast to 224.0.0.10</p>
</li>
<li>
<p>do not require acknowlegment</p>
</li>
<li>
<p>can be used as Ack if sent without data</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Ack
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>unicast</p>
</li>
<li>
<p>contains a nonzero acknowledgement number</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Update
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>multicast or unicast</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Query
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>multicast unless in response to a received query</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Reply
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>unicast</p>
</li>
<li>
<p>indicates that it does not need to go into Active state
because it has a FS</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Request
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>unicast or multicast</p>
</li>
<li>
<p>get specific info from neighbors</p>
</li>
<li>
<p>used in route server applications</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Exchange EIGRP packets only as unicast</div>
<div class="content">
<pre>(config-router)# neighbor &lt;a.b.c.d&gt; &lt;interface-id&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Exchange EIGRP packets only as unicast</div>
<div class="content">
<pre>(config-router-af-interface)# neighbor &lt;a.b.c.d&gt; &lt;interface-id&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: debug EIGRP</div>
<div class="content">
<pre>debug ip eigrp packet [hello | ack | update } quey | reply]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_neighbors_3">12.2.2. Neighbors</h4>
<div class="ulist">
<ul>
<li>
<p>discovered with Hello packets</p>
</li>
<li>
<p>must agree on</p>
<div class="ulist">
<ul>
<li>
<p>primary IPv4 subnet</p>
</li>
<li>
<p>Autonomous System Number</p>
</li>
<li>
<p>authentication</p>
</li>
<li>
<p>K values</p>
</li>
</ul>
</div>
</li>
<li>
<p>do not need to agree on timers</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Verify neighbor adjacencies</div>
<div class="content">
<pre># sh ip eigrp neighbors [detail]</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Check that the queue count is zero
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_eigrp_loop_prevention_techniques">12.2.3. EIGRP Loop prevention techniques</h4>

</div>
<div class="sect3">
<h4 id="_split_horizon_2">12.2.4. Split horizon</h4>
<div class="ulist">
<ul>
<li>
<p>Enable by default on all interfaces</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Disable split horizon for EIGRP</div>
<div class="content">
<pre>(config-if)# no ip split-horizon eigrp &lt;asn&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable split horizon in named configuration</div>
<div class="content">
<pre>(config-router-af-interface)# no split-horizon</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dual_feasibility_condition">12.2.5. DUAL feasibility condition</h4>

</div>
<div class="sect3">
<h4 id="_eigrp_reconvergence">12.2.6. EIGRP reconvergence</h4>
<div class="ulist">
<ul>
<li>
<p>if the successor becomes unreachable,</p>
<div class="ulist">
<ul>
<li>
<p>if there is a feasible successor</p>
<div class="ulist">
<ul>
<li>
<p>use the FS without local computation</p>
</li>
</ul>
</div>
</li>
<li>
<p>else</p>
<div class="ulist">
<ul>
<li>
<p>query the neighbors and put the route in active</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Transport: IP protocol 88</p>
</li>
<li>
<p>Hello interval</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_metric">12.2.7. Metric</h4>
<div class="paragraph">
<p>metric = 256 * [K1 x bandwidth + (k2 x bandwidth)/ (256 -load) + k3 x delay] x [k5 /( reliability + k4)]</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bandwith: 10<sup>7</sup> / minimum bandwidth in Kbps</p>
</li>
<li>
<p>delay: in tens-of-microseconds</p>
</li>
<li>
<p>reliability: likelihood of successful packet transmission with 0 means 0% and 255 means 100%</p>
</li>
<li>
<p>load : effective load of the route with 255 means 100% loading</p>
</li>
<li>
<p>mtu : minimum Maximum transmission unit</p>
</li>
<li>
<p>default values: k1,k2,k3,k4,k5 = 1,0,1,0,0</p>
</li>
<li>
<p>the values of K must match for the neighbors to become adjacents</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Description</div>
<div class="content">
<pre>(config-router)# metric weights</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wide_metric">12.2.8. Wide Metric</h4>
<div class="paragraph">
<p>Metric = [(K1*Minimum Throughput + (K2*Minimum Throughput/(256-Load) + (K3*Total Latency) + (K6*Extended Attributes)]* [K5/(K4 + Reliability)]</p>
</div>
</div>
<div class="sect3">
<h4 id="_eigrp_autonomous_system_configuration">12.2.9. EIGRP Autonomous System Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>created with the command  <strong>router eigrp</strong> &lt;autonomous-system-number&gt;</p>
</li>
<li>
<p>EIGRP VPNs can be configured only under IPv4 address family. A VRF instance and route distinguisher must be defined before the address family session can be created.</p>
</li>
<li>
<p>recommendation: configure the asn when the address family is configured by <strong>router eigrp</strong> &lt;asn&gt; <strong>address-family</strong> or seperately using the <strong>autonomous-system</strong> command.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_eigrp_named_configuration">12.2.10. EIGRP Named Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Global params under SAFI or in <strong>config-router-topology base</strong> mode</p>
</li>
<li>
<p>interface params in <strong>config-router-af-interface</strong> mode</p>
</li>
<li>
<p>wide-meric scaling automatic enabled</p>
</li>
<li>
<p>can be configured in IPv4 and IPv6 named configuration</p>
</li>
<li>
<p>VRF instance and a RD are optional</p>
</li>
<li>
<p>EIGRP IPv6 VRF-lite feature is available only in EIGRP named configuration</p>
</li>
<li>
<p>EIGRP VPNs can be configured. A VRF and RD must be defind before the address-family session can be created.</p>
</li>
<li>
<p>a single EIGRP routing process can support multiple VRFs.  However, a single VRF can be supported by each VPN . Redistribution between VRFs is not supported.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure a basic EIGRP named configuration</div>
<div class="content">
<pre>(config)# router eigrp &lt;virtual-instance-name&gt;
(config-router)# address-family ipv4 [multicast] [umicast] [vrf &lt;vrf-name&gt;] autonomous-system &lt;asn&gt;
(config-router-af)# network &lt;a.b.c.d&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eigrpv3">12.2.11. EIGRPv3</h4>
<div class="listingblock">
<div class="content">
<pre>(config-router)# address-family ipv6 [unicast] [vrf vrf-name] autonomous-system asn</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eigrp_neighbor_relationship_maintenance">12.2.12. EIGRP Neighbor Relationship Maintenance</h4>
<div class="ulist">
<ul>
<li>
<p>Hellos</p>
</li>
<li>
<p>adjancency</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_dual_finite_state_machine">12.2.13. DUAL Finite State Machine</h4>
<div class="ulist">
<ul>
<li>
<p>A successor is a neighboring router that has a least-cost path to a
destination that is guarentedd not to be part of a routinf</p>
</li>
<li>
<p>Feasibility condition: RD &lt; FD</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_protocol_dependent_modules">12.2.14. Protocol-Dependent Modules</h4>

</div>
<div class="sect3">
<h4 id="_goodbye_message">12.2.15. Goodbye Message</h4>
<div class="ulist">
<ul>
<li>
<p>broadcast when an EIGRP routing process is shut down</p>
</li>
<li>
<p>Speeds convergence as peers don&#8217;t have to wait the hold timer expiration</p>
</li>
<li>
<p>Normal message displayed by routers that support Good Bye message</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>*Apr 26 13:48:42.523: %DUAL-5-NBRCHANGE: IP-EIGRP(0) 1: Neighbor 10.1.1.1
(Ethernet0/0) is down: Interface Goodbye received</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Misleading message displayed by router which doesn&#8217;t support the Goodbye message</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>*Apr 26 13:48:41.811: %DUAL-5-NBRCHANGE: IP-EIGRP(0) 1: Neighbor
(Ethernet0/0) is down: K-value mismatch</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The receipt of a goodbye message by a non supporting peer does not disrupt normal network operations.</p>
</li>
<li>
<p>The nonsupporting peer will terminate the session when the hold timer expires</p>
</li>
<li>
<p>The sending and receiving routers will converge normally after the sender reloads</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_routing_metric_offset_lists">12.2.16. Routing Metric Offset Lists</h4>

</div>
<div class="sect3">
<h4 id="_eigrp_cost_metrics">12.2.17. EIGRP Cost Metrics</h4>

</div>
<div class="sect3">
<h4 id="_summarization_2">12.2.18. Summarization</h4>
<div class="ulist">
<ul>
<li>
<p>All subnets are suppressed</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable auto-summarization</div>
<div class="content">
<pre>(config-router)# auto-summarization</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Cannot be used in divergent networks</p>
</li>
<li>
<p>create null0 summary</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Advertise a single summary in EIGRP classic mode</div>
<div class="content">
<pre>(config-if)# ip summary-address eigrp &lt;asn&gt; &lt;prefix&gt; &lt;mask&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Advertise a single summary in EIGRP named mode</div>
<div class="content">
<pre>(config-router-af-interface)# summary-address &lt;prefix&gt; &lt;mask&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure summarization to advertise a default route into EIGRP</div>
<div class="content">
<pre>(config-if)# ip summary-address eigrp &lt;asn&gt; 0.0.0.0 0.0.0.0</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>All subnets will be suppressed because all IPv4 networks are subnet of 0/0</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_leak_map">Leak map</h5>
<div class="listingblock">
<div class="title">Task: Advertise specific subnets of a EIGRP summary</div>
<div class="content">
<pre>(config-if)# ip summary-address eigrp &lt;asn&gt; &lt;prefix&gt; &lt;mask&gt; leak-map &lt;route-maps&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_floating_summary_routes">Floating Summary Routes</h5>
<div class="paragraph">
<p>TODO
- By default, summarization install a route to Null0 to match the summary
  to prevent forwarding traffic for unreachable destinations.
-</p>
</div>
</div>
<div class="sect4">
<h5 id="_poisoned_floating_summarization">Poisoned Floating Summarization</h5>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eigrp_route_authentication">12.2.19. EIGRP Route Authentication</h4>
<div class="ulist">
<ul>
<li>
<p>Supports MD5 in classic mode</p>
</li>
<li>
<p>supports MD5 and SHA-256 in multi-af mode</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Use MD5 password in EIGRP classic mode</div>
<div class="content">
<pre>(config-if)# ip authentication mode eigrp &lt;asn&gt; md5
(config-if)# ip authentication key-chain eigrp &lt;asn&gt; &lt;password&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Use MD5 password in EIGRP named mode</div>
<div class="content">
<pre>(config-router-af-interface)# authentication mode md5
(config-router-af-interface)# authentication key-chain &lt;sesame&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Authenticate EIGRP neighbor with SHA-256 password</div>
<div class="content">
<pre>(config-router-af-interface)# authenticate mode hmac-sha-256 &lt;password&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>can be applied at the <strong>af-interface-default</strong> in multi-af mode</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_hello_packets_and_the_hold_time_intervals">12.2.20. Hello Packets and the Hold-Time Intervals</h4>

</div>
<div class="sect3">
<h4 id="_split_horizon_3">12.2.21. Split Horizon</h4>

</div>
<div class="sect3">
<h4 id="_link_bandwidth_percentage">12.2.22. Link Bandwidth Percentage</h4>
<div class="ulist">
<ul>
<li>
<p>by default, EIGRP packets consume  max 50% of the link bandwidth as configured by the <strong>bandwith</strong> command</p>
</li>
<li>
<p>bandwidth configured by <strong>bandwidth</strong> in AS configuration and <strong>bandwith-percent</strong> for named configuration</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_eigrp_stub_routing">12.2.23. EIGRP Stub Routing</h4>

</div>
<div class="sect3">
<h4 id="_eigrp_stub_routing_leak_map_support">12.2.24. EIGRP Stub Routing Leak Map Support</h4>

</div>
<div class="sect3">
<h4 id="_eigrp_autonomous_system_configuration_2">12.2.25. EIGRP autonomous system configuration</h4>
<div class="listingblock">
<div class="title">Task: Create a basic EIGRP AS system configuration</div>
<div class="content">
<pre>(config)# router eigrp asn
(config-router)# network a.b.c.d [e.f.g.h]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A maximum of 30 EIGRP can be configured</p>
</li>
<li>
<p>EIGRP sends updates only interfaces in the specified networks</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_verify_eigrp_topology">12.2.26. verify eigrp topology</h4>
<div class="listingblock">
<div class="content">
<pre>show ip eigrp topology [all-links]
show ip eigrp topology [prefix/len]</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ospf">12.3. OSPF</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">IP Routing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/iproute_ospf/configuration/15-mt/iro-15-mt-book/configuring_ospf.html">OSPF</span></span> </a></p>
</div>
<div class="sect3">
<h4 id="_overview_11">12.3.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>link-state interior gateway protocol</p>
</li>
<li>
<p>RFC 2328</p>
</li>
<li>
<p>Dijkstra short path first algorithm</p>
</li>
<li>
<p>classless protocol</p>
</li>
<li>
<p>Transport via IP protocol 89</p>
<div class="ulist">
<ul>
<li>
<p>multicasts to 224.0.0.5 for AllSPF routers and to 224.0.0.6 for Designated Routers</p>
</li>
<li>
<p>unicasts</p>
</li>
</ul>
</div>
</li>
<li>
<p>equal-cost multipath</p>
</li>
<li>
<p>hierarchical design to reduce traffic</p>
</li>
<li>
<p>authentication updates</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_neighbors_4">12.3.2. Neighbors</h4>
<div class="paragraph">
<p>To form adjacency neighbors must agree on &#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>unique router ID</p>
</li>
<li>
<p>unique interface IP address</p>
<div class="ulist">
<ul>
<li>
<p>primary IP address for OSPFv2</p>
</li>
<li>
<p>link-local address for OSPFv3</p>
</li>
</ul>
</div>
</li>
<li>
<p>common attributes</p>
<div class="ulist">
<ul>
<li>
<p>interface area-id</p>
</li>
<li>
<p>authentication</p>
</li>
<li>
<p>hello and dead intervals</p>
</li>
<li>
<p>stub area flag</p>
</li>
<li>
<p>interface MTU ??</p>
</li>
<li>
<p>other optional capabilities</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ospf_cost">12.3.3. Ospf cost</h4>
<div class="paragraph">
<p>\(cost = 10^8 / bandwidth(bps)\)</p>
</div>
<div class="listingblock">
<div class="title">Task: Description</div>
<div class="content">
<pre>(config-router)# auto-cost reference-bandwitch &lt;bps&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_common_ospf_protocol_header_format">12.3.4. Common OSPF protocol header format</h4>
<div class="sect4">
<h5 id="_packet_types">Packet types</h5>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-header-format.png" alt="OSPF header format" width="896" height="312">
</div>
<div class="title">Figure 16. OSPF header format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Version</dt>
<dd>
<p>The OSPF version number (2).</p>
</dd>
<dt class="hdlist1">Type</dt>
<dd>
<p>Hello (1), database description (2), Link-State Request (3), Link-State Update (4), or Link-State Acknowledgment (5).</p>
</dd>
<dt class="hdlist1">Packet length</dt>
<dd>
<p>Length of the protocol packet in bytes including the OSPF header.</p>
</dd>
<dt class="hdlist1">Router ID</dt>
<dd>
<p>The ID of the router originating the packet.</p>
</dd>
<dt class="hdlist1">Area ID</dt>
<dd>
<p>The area that the packet is being sent into.</p>
</dd>
<dt class="hdlist1">Checksum</dt>
<dd>
<p>The standard IP checksum of the entire contents of the packet, excluding the 64-bit authentication field.</p>
</dd>
<dt class="hdlist1">AuType</dt>
<dd>
<p>Identifies the authentication scheme to be used for the packet.</p>
<div class="ulist">
<ul>
<li>
<p>0: no authentication</p>
</li>
<li>
<p>1: plain-text authentication</p>
</li>
<li>
<p>2: cryptographic authentication</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Authentication</dt>
<dd>
<p>A 64-bit field for use by the authentication scheme.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_hello_packet">Hello Packet</h5>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-hello-packet-format.png" alt="OSPF Hello Packet format" width="896" height="312">
</div>
<div class="title">Figure 17. OSPF Hello Packet format</div>
</div>
</div>
<div class="sect4">
<h5 id="_database_description_packet">Database Description Packet</h5>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-database-description-message-format.png" alt="OSPF Hello Packet format" width="896" height="248">
</div>
<div class="title">Figure 18. OSPF Hello Packet format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Interface MTU</dt>
<dd>
<p>Size of the largest IP message that can be sent on this router&#8217;s interface
without fragmentation</p>
</dd>
<dt class="hdlist1">Options</dt>
<dd>
<p>For optional OSPF capabilities</p>
</dd>
<dt class="hdlist1">I-bit</dt>
<dd>
<p>Initial for the first in a sequence of DD messages</p>
</dd>
<dt class="hdlist1">M-bit</dt>
<dd>
<p>More DD follow this one</p>
</dd>
<dt class="hdlist1">MS-bit</dt>
<dd>
<p>if this message is sent by the master in the communication</p>
</dd>
</dl>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">functionality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">discover/maintain neighbors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">summarize database contents</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link-state request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">database download</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link-state update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">databases update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link-state acknowledge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flooding acknowledgement</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_link_state_request">Link State Request</h5>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-link-state-request-message-format.png" alt="OSPF Link State Request format" width="896" height="248">
</div>
<div class="title">Figure 19. OSPF Link State Request format</div>
</div>
</div>
<div class="sect4">
<h5 id="_link_state_update">Link State Update</h5>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-link-state-update-message-format.png" alt="OSPF Link State Update format" width="896" height="184">
</div>
<div class="title">Figure 20. OSPF Link State Update format</div>
</div>
</div>
<div class="sect4">
<h5 id="_link_state_acknowledgment">Link State Acknowledgment</h5>
<div class="imageblock">
<div class="content">
<img src="../images/ospf-link-state-ack-message-format.png" alt="OSPF Link State Acknowledgment format" width="896" height="152">
</div>
<div class="title">Figure 21. OSPF Link State Acknowledgment format</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">LSA headers</dt>
<dd>
<p>Contains LSA headers to identify the LSAs acknowledged.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_link_state_packets">Link-State Packets</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Type 1</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Router LSA</p>
</li>
<li>
<p>generated by each router for each interface in the area</p>
</li>
<li>
<p>flooded only within the same area</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Type 2</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Network LSA</p>
</li>
<li>
<p>generated by DR</p>
</li>
<li>
<p>describes the set of routers attached to a particular network</p>
</li>
<li>
<p>flooded only within the area that contains the network</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Type 3</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Summary inter-area LSA</p>
</li>
<li>
<p>Generated by ABR</p>
</li>
<li>
<p>describes inter-area routes to network</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Type 4</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Summary inter-area LSA</p>
</li>
<li>
<p>Generated by ABR</p>
</li>
<li>
<p>describes routes to ASBR</p>
</li>
<li>
<p>tells other other routers in the area how to get to the advertising router
of an external route</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Type 5</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>AS external LSA</p>
</li>
<li>
<p>originated by ASBR</p>
</li>
<li>
<p>describes routes to destinations external to the AS</p>
</li>
<li>
<p>flooded all over except stub areas</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
OSPF&#8217;s SPF algorithm links different pieces of information together.
For a router in Area 1 to reach the external route in Area 3,
it has to look at the Type-5 that represents the external route.
Then it has to look at the Type-4 representing the ABR on the area that the ASBR lives in.
Then we have to look at the Type-3 to get to that remote ABR.
Finally we look at the Type-1 and Type-2 LSAs in our area to determine how to get to our closest ABR.
Read more
<a href="https://supportforums.cisco.com/document/133976/reading-and-understanding-ospf-database#sthash.qdHPgN1P.dpuf">here</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_backbone_and_area_0">12.3.5. backbone and area 0</h4>

</div>
<div class="sect3">
<h4 id="_virtual_links">12.3.6. Virtual links</h4>
<div class="ulist">
<ul>
<li>
<p>purposes:</p>
<div class="ulist">
<ul>
<li>
<p>Areas not physically connected to area 0</p>
</li>
<li>
<p>partitioning the backbone</p>
</li>
</ul>
</div>
</li>
<li>
<p>transit area can not be stub</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Router A</div>
<div class="content">
<pre>(config)# router ospf 10
(config-router)# area 2 virtual-link 2.2.2.2</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Router B</div>
<div class="content">
<pre>(config)# router ospf 10
(config-router)# area 2 virtual-link 1.1.1.1</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: TODO</div>
<div class="content">
<pre>(config-router)# no capability transit</pre>
</div>
</div>
<div class="sect4">
<h5 id="_adjacency">Adjacency</h5>

</div>
<div class="sect4">
<h5 id="_dr_election">DR election</h5>
<div class="ulist">
<ul>
<li>
<p>There is no pre-emption in ospf</p>
<div class="ulist">
<ul>
<li>
<p>Router must wait for the failure of the current DR</p>
</li>
<li>
<p>use the WAIT timer = DEAD timer</p>
</li>
</ul>
</div>
</li>
<li>
<p>on hub-and-spoke, best practice is to have hub as DR and spokes not eligible as DR with priority=0jgt</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_router_id">Router id</h5>
<div class="paragraph">
<p>Determined by these rules in order of preference at boot or ospf process restart:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>manually configured router id</p>
</li>
<li>
<p>highest IP address of an up/up loopback not used by other OSPF process</p>
</li>
<li>
<p>highest IP address of an up/up non-loopack interfaces  not used by other OSPF process</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Set the router-id</div>
<div class="content">
<pre>(config-router)# router-id &lt;a.b.c.d&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Priority</div>
<div class="content">
<pre>(config-if)# ip ospf priority &lt;0-255&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the WAIT timer</div>
<div class="content">
<pre>(config-if)# ip ospf dead-timer &lt;seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_network_types">network types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Point-to-point</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>only 2 routers</p>
</li>
<li>
<p>automatic neighbor relationships</p>
</li>
<li>
<p>no DR/BDR election</p>
</li>
<li>
<p>multicast hellos</p>
</li>
<li>
<p>default for HDLC and PPP</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">broadcast</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>automatic neighbor discovery</p>
</li>
<li>
<p>DR/BDR election</p>
</li>
<li>
<p>default for ethernet, TR, FDDI</p>
</li>
<li>
<p>multicast hellos</p>
</li>
<li>
<p>DR doesn&#8217;t change the next hop of advertised prefixes</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Non-broadcast</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unicast hellos</p>
</li>
<li>
<p>manual configuration of neighbor</p>
</li>
<li>
<p>DR/BDR election</p>
</li>
<li>
<p>default on Frame Relay, X.25 and SMDS</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Point-to-multipoint</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>multi-access, broadcast</p>
</li>
<li>
<p>automatic discovery of neighbor (MA)</p>
</li>
<li>
<p>DR/BDR election</p>
</li>
<li>
<p>one IP subnet</p>
</li>
<li>
<p>maintain connectivity during a VC failure ???</p>
</li>
<li>
<p>generates host routes (with mask /32 ) for each neighbor</p>
</li>
<li>
<p>default for ???</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Point-to-multipoint non-broadcast</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>manual configuration of neighbor</p>
</li>
<li>
<p>no DR/BDR election</p>
</li>
<li>
<p>network proprietary to Cisco</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Loopback</dt>
<dd>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
if Multi-Access network type then no DR/BDR election
if non-broadcast, then manual configuration of neighbors
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/support/docs/ip/open-shortest-path-first-ospf/7039-1.html#t27">OSPF design guide: selecting interface network types</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">OSPF network type compatibilities</div>
<div class="ulist">
<ul>
<li>
<p>iakfsadfj</p>
</li>
<li>
<p>adsfkjasdf</p>
</li>
<li>
<p>asdfjsadfj</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_graceful_restart">Graceful restart</h5>
<div class="ulist">
<ul>
<li>
<p>enables a router to continue to forward packets during a restart of the routing process</p>
</li>
<li>
<p>must be configured on all neighbor routers</p>
</li>
<li>
<p>can also work with EIGRP, BGP, IS-IS</p>
</li>
<li>
<p>default since IOS 12.4(6)T</p>
</li>
<li>
<p>2 versions: RFC 3623 and Cisco NSF</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/en/US/docs/ios-xml/ios/iproute_ospf/command/ospf-a1.html#wp258289">Cisco
NSF</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_spf_throttling">SPF throttling</h5>

</div>
<div class="sect4">
<h5 id="_capability_vrf_lite">capability vrf-lite</h5>
<div class="paragraph">
<p>Read OSG, chapter 19, VRF lite, pp. 872-876</p>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/en/US/docs/ios-xml/ios/iproute_ospf/command/ospf-a1.html#wp2582896905" class="bare">http://www.cisco.com/en/US/docs/ios-xml/ios/iproute_ospf/command/ospf-a1.html#wp2582896905</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_summarization_3">summarization</h5>
<div class="paragraph">
<p>Why the null 0 interface is added ?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>do prevent routing loops</p>
<div class="ulist">
<ul>
<li>
<p>packets destined for the routes that have been summarized will a longer  match</p>
</li>
<li>
<p>packets destined to summary routes will be dropped</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>See good explanation</p>
</div>
</div>
<div class="sect4">
<h5 id="_ospf_states">OSPF states</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Down</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>No hellos have been received from neighbors</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Attempt</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Unicast hello packet has been sent to neighbor, but not yet received back</p>
</li>
<li>
<p>only used for manually configured NBMA neighbors</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Init</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>I have received a hello packet from a neighbor,
but they have not acknowledged a hello from me</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">2-way</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>I have received a hello packet from a neighbor
and he acknowledged a hello from me</p>
</li>
<li>
<p>I can see my Router Id in the neighbor&#8217;s hello packet</p>
</li>
<li>
<p>Stop here for DROthers</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Exstart</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Master &amp; slave relationship is formed where master has higher router-id</p>
</li>
<li>
<p>Master chooses the starting sequence number ofr the DBD packets that are
used for actual LSA exchange.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Exchange</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Local link state database is sent through DBD packets</p>
</li>
<li>
<p>DBD sequence number is used for reliable acknowledgement/retransmission</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Loading</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>LSR packets are sent to ask for more info about a particular LSA</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Full</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Neighbors are fully adjacent and databases are synchronized.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ospf_process">12.3.7. OSPF process</h4>
<div class="listingblock">
<div class="title">Task: Enable OSPF process (legacy command )</div>
<div class="content">
<pre>(config)# router ospf &lt;process-id&gt;
(config-router)# network &lt;a.b.c.d&gt; [&lt;w.i.l.d&gt;] area &lt;id&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>inject both the primary and secondary addresses</p>
</li>
<li>
<p>If an interface is IP unnumbered, and there is a <strong>network</strong> statement
that matches the IP address of the primary interface,
inject both the primary interface and the unnumbered interface</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Enable OSPF Process (interface level)</div>
<div class="content">
<pre>(config-if)# ip ospf &lt;process-id&gt; area &lt;id&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Prevent OSPF to advertize secondary prefixes</div>
<div class="content">
<pre>(config-if)# ip ospf &lt;process-id&gt; area &lt;id&gt; secondaries none</pre>
</div>
</div>
<div class="sect4">
<h5 id="_ospf_authentication">OSPF authentication</h5>
<div class="ulist">
<ul>
<li>
<p>Null , default: type 0</p>
</li>
<li>
<p>Plain-text, simple password authentication</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# area &lt;id&gt; authentication
(config-if)# ip ospf authentication-key &lt;string&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Message digest authentication</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# area &lt;id&gt; authentication message-digest
(config-if)# ip ospg message-digest-key key-id md5 &lt;string&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Message digest</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_spf_timers">spf timers</h5>
<div class="ulist">
<ul>
<li>
<p>spf-delay: between topology change notifications and recalculation of the shortest path</p>
</li>
<li>
<p>spf-holdtime : between spf calculations</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure spf timers</div>
<div class="content">
<pre>(config-router)# timers spf seconds &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: configure spf throttling</div>
<div class="content">
<pre>spf ???</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Task: Ensure that one router performs LSA translation in a NSSA area</div>
<p>TODO</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_readings_3">12.3.8. readings</h4>
<div class="paragraph">
<p><a href="http://www.cisco.com/en/US/tech/tk365/technologies_tech_note09186a0080094aaa.shtml">What
are ospf areas and virtual links</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/en/US/tech/tk365/technologies_white_paper09186a0080094e9e.shtml#appa1">ospf
design guide: link-state advertisements</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bgp">12.4. BGP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration guides</span>&#160;&#9656; <span class="submenu">IP Routing</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/iproute_bgp/configuration/15-mt/irg-15-mt-book/configuring_a_basic_bgp_network.html">BGP</span></span> </a></p>
</div>
<div class="sect3">
<h4 id="_concepts_3">12.4.1. Concepts</h4>
<div class="ulist">
<ul>
<li>
<p>Exterior gateway protocol</p>
</li>
<li>
<p>Creates loop-free inter-domain routing between AS.</p>
</li>
<li>
<p>Path vector algorithm = (distance vector + AS-path loop detection)</p>
</li>
<li>
<p>TCP 179</p>
</li>
<li>
<p>AD: external 20 , internal and local 200</p>
</li>
<li>
<p>RFC 1771</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_autonomous_systems">Autonomous systems</h5>
<div class="ulist">
<ul>
<li>
<p>AS: set of routers under a single technical administration</p>
</li>
<li>
<p>AS can be:</p>
<div class="ulist">
<ul>
<li>
<p>stub : only one exit</p>
</li>
<li>
<p>multihomed: multiple connections with the one or multiple providers</p>
<div class="ulist">
<ul>
<li>
<p>transit: allows traffic with origin and destination outside the AS</p>
</li>
<li>
<p>non-transit:</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_asn_format">ASN format</h6>
<div class="ulist">
<ul>
<li>
<p>2-byte (RFC 4271)</p>
<div class="ulist">
<ul>
<li>
<p>0 - 65535</p>
</li>
<li>
<p>reserved: 0, 65535</p>
</li>
<li>
<p>public use: 1 - 64495</p>
</li>
<li>
<p>documentation: 64496-64511 (RFC 5398)</p>
</li>
<li>
<p>private use: 64512 - 65534</p>
</li>
</ul>
</div>
</li>
<li>
<p>4-byte (RFC 5396)</p>
<div class="ulist">
<ul>
<li>
<p>Asplain: decimal value notation for 2-byte and 4-byte ASNs</p>
</li>
<li>
<p>Asdot: decimal value notation for 2-byte and dot notation for 4-byte ASN</p>
</li>
<li>
<p>Documentation: 65536-65551 (RFC 5398)</p>
</li>
</ul>
</div>
</li>
<li>
<p>AS 23456: reserved for gradual transition from 2-byte to 4-byte (RFC 4893)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bgp_peers">12.4.2. BGP peers</h4>
<div class="ulist">
<ul>
<li>
<p>Manually configured and not automatically discovered</p>
</li>
<li>
<p>Formed over a TCP connection</p>
</li>
<li>
<p>Exchanges PA(Path Attributes) and NLRI (IP/prefix) with the same PA</p>
</li>
<li>
<p>Starts with full BGP routing table then incremental updates</p>
</li>
<li>
<p>Keep table version number</p>
<div class="dlist">
<dl>
<dt class="hdlist1">iBPG peers </dt>
</dl>
</div>
</li>
<li>
<p>same AS</p>
</li>
<li>
<p>must be fully meshed within AS</p>
<div class="dlist">
<dl>
<dt class="hdlist1">eBGP peers </dt>
</dl>
</div>
</li>
<li>
<p>different AS</p>
</li>
<li>
<p>by default, one hop away but you can change that with <strong>ebgp-multihop</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_bgp_message_format">12.4.3. BGP message format</h4>
<div class="ulist">
<ul>
<li>
<p>Minimum size: 19 bytes</p>
</li>
<li>
<p>Maximum size: 4096 bytes (why?)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_keepalive">KEEPALIVE</h5>
<div class="imageblock">
<div class="content">
<img src="../images/tcp-header-format.png" alt="BGP header format" width="896" height="280">
</div>
<div class="title">Figure 22. BGP header format</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Marker:</p>
<div class="ulist">
<ul>
<li>
<p>16 bytes</p>
</li>
<li>
<p>set to all 1s for OPEN message or if OPEN message without authentication</p>
</li>
<li>
<p>computed by the authentication process</p>
</li>
</ul>
</div>
</li>
<li>
<p>Length:</p>
<div class="ulist">
<ul>
<li>
<p>2 bytes</p>
</li>
<li>
<p>total length in bytes of the message including the header</p>
</li>
</ul>
</div>
</li>
<li>
<p>Type:</p>
<div class="ulist">
<ul>
<li>
<p>1 byte</p>
</li>
<li>
<p>indicates message type (1: Open, 2: Update, 3: Notification, 4: Keepalive)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_open">OPEN</h5>
<div class="ulist">
<ul>
<li>
<p>Initiates the session</p>
</li>
<li>
<p>Contains BGP version , local AS number, BGP router Id</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/bgp-open.png" alt="bgp open" width="896" height="280">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Version: 1 octet</p>
</li>
<li>
<p>My autonomous system:</p>
</li>
<li>
<p>Hold time:</p>
<div class="ulist">
<ul>
<li>
<p>maximum interval in seconds between successive Keepalive  or Update messages.</p>
</li>
<li>
<p>A receiver compares the value of the Hold Time and the value of its configured hold time
and accepts the smaller value or rejects the connection.</p>
</li>
<li>
<p>Can be set to zero to indicates that the connection is always up //find a better formulation</p>
</li>
<li>
<p>if not set to zero, the minimum recommended hold time is 3 seconds</p>
</li>
</ul>
</div>
</li>
<li>
<p>BGP identifier:</p>
<div class="ulist">
<ul>
<li>
<p>router ID</p>
</li>
<li>
<p>determined by these rules in order of preference at boot or bgp process restart:</p>
<div class="ulist">
<ul>
<li>
<p>manually configured router id</p>
</li>
<li>
<p>highest IP address of an up/up loopback</p>
</li>
<li>
<p>highest IP address of an up/up non-loopack</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional parameters length:</p>
</li>
<li>
<p>total length in octects of the following Optional Parameters field</p>
</li>
<li>
<p>Optional Parameters:</p>
</li>
<li>
<p>Variable length field containing a triplet &lt;Type: 1 octet,Length: 1 octet,Value&gt;</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_keepalive_2">KEEPALIVE</h5>
<div class="ulist">
<ul>
<li>
<p>Every 60 seconds</p>
</li>
<li>
<p>Hold-time: 180 seconds</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_update">UPDATE</h5>
<div class="ulist">
<ul>
<li>
<p>Advertises a single feasible route to a peer and/or withdraws multiple unfeasible routes</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/.png" alt="header format" width="896" height="312">
</div>
<div class="title">Figure 23. header format</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Unfeasible Routes Length</p>
<div class="ulist">
<ul>
<li>
<p>2-octet field</p>
</li>
<li>
<p>total length of the following Withdrawn Routes field, in octets.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Withdrawn Routes</p>
<div class="ulist">
<ul>
<li>
<p>variable-length</p>
</li>
<li>
<p>lists routes to be withdrawn from service.</p>
</li>
<li>
<p>Each route in the list is described with a (Length, Prefix) tuple in which the Length is
the length of the prefix and the Prefix is the IP address prefix of the withdrawn route.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Total Path Attribute Length</p>
<div class="ulist">
<ul>
<li>
<p>2-octet</p>
</li>
<li>
<p>total length of the following Path Attribute field, in octets.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Path Attributes</p>
<div class="ulist">
<ul>
<li>
<p>variable-length</p>
</li>
<li>
<p>lists the attributes associated with the NLRI in the following field.
  Each path attribute is a variable-length triple of (Attribute Type, Attribute
Length, Attribute Value). The Attribute Type part of the triple is a 2-octet field consisting of
four flag bits, four unused bits, and an Attribute Type code (see <a href="#AttributeTypeCode">Attribute Type Code</a>).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/bgp-attribute.png" alt="Attribute Type part of the Path Attributes field" width="512" height="152">
</div>
<div class="title">Figure 24. Attribute Type part of the Path Attributes field</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Flag bits (1/0)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>O: Optional / Well-known</p>
</li>
<li>
<p>T: Transitive / Non-transitive</p>
</li>
<li>
<p>P: Partial / Complete</p>
</li>
<li>
<p>E: Extended length / Regular length ( 2-bytes/ 1-bytes)</p>
</li>
<li>
<p>U: Unused</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<table id="AttributeTypeCode" class="tableblock frame-none grid-rows spread">
<caption class="title">Table 9. Attribute Type Code</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Category</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ORIGIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Well-known mandatory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AS_PATH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Well-known mandatory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEXT_HOP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Well-known mandatory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULTI_EXIT_DISC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional nontransitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCAL_REF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional transitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATOMIC_AGGREGATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Well-known discretionary</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AGGREGATOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional transitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COMMUNITY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional transitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ORIGINATOR_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional nontransitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLUSTER_LIST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional nontransitive</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
tasks for Internet, no-export, no-advertise, local-as
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_notification">NOTIFICATION</h5>
<div class="ulist">
<ul>
<li>
<p>go out in response to error, fatal condition</p>
</li>
<li>
<p>torn down or reset the BGP peer session</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_bgp_fsm_states">BGP FSM States</h5>
<div class="imageblock">
<div class="content">
<img src="../images/diag-d6ff0ffda84c98a3d039a592e4eae223.png" alt="BGP neighbor negotiation finite state machines" width="923" height="321">
</div>
<div class="title">Figure 25. BGP neighbor negotiation finite state machines</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Idle</strong> – initial BGP state after enabling BGP process or resetting device.</p>
</li>
<li>
<p><strong>Connect</strong> - waits for a TCP connection with the remote peer. If
successful, sends OPEN message. If not, resets the ConnectRetry timer and transitions to Active state.</p>
</li>
<li>
<p><strong>Active</strong> – attempts to initiate a TCP connection with the remote
peer. If successful, sends OPEN message. If not, resets ConnectRetry timer and transitions back to Connect state</p>
</li>
<li>
<p><strong>OpenSent</strong> – TCP connection up and OPEN message sent,  transition to OpenReceive state and wait for initial
keepalive to move into OpenConfirm state.
If TCP session disconnect, terminate BGP session, reset ConnectRetry timer, move back to Active State.</p>
</li>
<li>
<p><strong>OpenConfirm</strong> – OPEN messages sent and received. Wait for KEEPALIVE</p>
</li>
<li>
<p><strong>Established</strong> – KEEPALIVE received, neighbor parameters match. the BGP peer session is fully established. UPDATE
messages containing routing information will now be sent.</p>
</li>
<li>
<p>If peer stuck in <strong>Active</strong> state, potential problems can include:</p>
<div class="ulist">
<ul>
<li>
<p>no IP connectivity</p>
</li>
<li>
<p>incorrect <strong>neighbor</strong> statement</p>
</li>
<li>
<p>access-list filtering TCP port 179</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_bgp_session_reset">BGP session reset</h5>
<div class="ulist">
<ul>
<li>
<p>Whenever the routing policy changes due to a configuration change</p>
</li>
<li>
<p>Reset with <strong>clear ip bgp</strong></p>
</li>
<li>
<p>Can be hard reset, soft reset or dynamic inbound soft reset</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_hard_reset">Hard reset</h6>
<div class="ulist">
<ul>
<li>
<p>Tears down the peering sessions including the TCP connections</p>
</li>
<li>
<p>Deletes prefixes learned from the peers.</p>
</li>
<li>
<p>Pros: no memory overhead</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_soft_reset">Soft reset</h6>
<div class="ulist">
<ul>
<li>
<p>Stores prefix information</p>
</li>
<li>
<p>Do not tearn down existing peering sessions</p>
</li>
<li>
<p>Can be configured for inbound or outbound sessions</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_dynamic_inbound_soft_reset">Dynamic inbound soft reset</h6>
<div class="ulist">
<ul>
<li>
<p>Do not store update information locally</p>
</li>
<li>
<p>Relies on dynamic exchanges with supporting peers</p>
</li>
<li>
<p>The peers supports the capability if  <strong>show ip bgp neighbors</strong> displays
<em>Received route refresh capability from peer</em> .</p>
</li>
<li>
<p>Use <strong>bgp soft-reconfig-backup</strong> to store updates for peers who do not support the refresh route capability</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bgp_route_aggregation">BGP route aggregation</h5>
<div class="ulist">
<ul>
<li>
<p>2 methods</p>
<div class="ulist">
<ul>
<li>
<p>basic route redistribution: creates an aggregate route, then redistributes the routes in BGP</p>
</li>
<li>
<p>conditional aggregation: creates an aggregate route , then advertises or not certain routes
based on route maps, AS-SET, or summary information</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>bgp suppress-inactive</strong> stops BGP to advertise inactive routes (not installed
into the RIB) to any peer.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_bgp_route_aggregation_generating_as_set_information">BGP route aggregation generating AS_SET information</h6>
<div class="paragraph">
<p>#TODO: improve this part</p>
</div>
<div class="paragraph">
<p>AS_SET information can be generated when BGP routes are aggregated using the
aggregate-address command. The path advertised for such a route is an AS_SET
consisting of all the elements, including the communities, contained in all the
paths that are being summarized. If the AS_PATHs to be aggregated are
identical, only the AS_PATH is advertised. The ATOMIC-AGGREGATE attribute, set
by default for the aggregate-address command, is not added to the AS_SET.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_routing_policy_change_management">Routing policy change management</h5>
<div class="paragraph">
<p>TODO: add this part under bgp reset</p>
</div>
</div>
<div class="sect4">
<h5 id="_bgp_peer_groups">BGP peer groups</h5>
<div class="ulist">
<ul>
<li>
<p>Group of peers with the same update policies ( outbound route maps, distribute lists, filter lists, update source ,)</p>
</li>
<li>
<p>Benefits:</p>
<div class="ulist">
<ul>
<li>
<p>simplify configuration</p>
</li>
<li>
<p>make configuration updates more efficient</p>
</li>
</ul>
</div>
</li>
<li>
<p>Restrictions for eBGP peers:</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_bgp_backdoor_routes">BGP backdoor routes</h5>
<div class="ulist">
<ul>
<li>
<p>Use <strong>network backdoor</strong> to cause BGP to prefer EIGRP</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/bgp-backdoor-route-topology.png" alt="bgp backdoor route topology">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_best_path_selection_algorithm">Best path selection algorithm</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>highest weight</p>
</li>
<li>
<p>highest local pref</p>
</li>
<li>
<p>locally originated paths over externally originated paths</p>
</li>
<li>
<p>shortest AS path</p>
</li>
<li>
<p>lowest origin type ( internal over external over incomplete)</p>
</li>
<li>
<p>lowest MED</p>
</li>
<li>
<p>eBGP paths over iBGP paths</p>
</li>
<li>
<p>lowest IGP cost</p>
</li>
<li>
<p>oldest path</p>
</li>
<li>
<p>lowest BGP router id</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
“We Love Oranges AS Oranges Mean Pure Refreshment”.
W Weight (Highest) L Local_Pref (Highest) O Originate (local originate) AS
As_Path (shortest) O Origin Code (IGP &lt; EGP &lt; Incomplete) M MED (lowest) P
Paths (External Paths preferred Over Internal) R Router ID (lowest)
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_community_attributes">community attributes</h5>
<div class="ulist">
<ul>
<li>
<p>No-advertise: prevents advertisements to any BGP peer</p>
</li>
<li>
<p>No-export: prevents advertisements to any eBGP peer</p>
</li>
<li>
<p>No-advertise: prevents advertisements outside the AS, or in confederation scenarios, outside the sub-AS</p>
</li>
<li>
<p>Internet:  advertises routes to any route</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_tasks_3">12.4.4. Configuration tasks</h4>
<div class="sect4">
<h5 id="_configuring_a_bgp_routing_process">Configuring a BGP Routing Process</h5>
<div class="ulist">
<ul>
<li>
<p>Configure a bgp routing process</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>router bgp &lt;asn&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify a network as  local to the BGP routing table</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>network &lt;prefix&gt; [mask  &lt;a.b.c.d&gt;] [route-map &lt;name&gt;]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the bgp router id</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>bgp router-id &lt;ip-address&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the bgp network timers</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# timers bgp &lt;keepalive-seconds&gt; &lt;holdtime-seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_a_bgp_peer">Configuring a BGP Peer</h5>
<div class="listingblock">
<div class="content">
<pre>neighbor &lt;ip-address&gt; remote-as &lt;asn&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the IPv4 address family</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# address-family ipv4 [unicast | multicast | vrf &lt;name&gt;]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable the neighbor to exchange prefixes for the ipv4 unicast address family with the local device</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; activate</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_a_bgp_peer_for_the_ipv4_vrf_address_family">Configuring a BGP Peer for the IPv4 VRF Address Family</h5>
<div class="ulist">
<ul>
<li>
<p>Associate a vpn vrf instance with an interface</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# interface &lt;type&gt; &lt;number&gt;
(config-if)# vrf forwarding &lt;name&gt;
(config-if)# ip address &lt;prefix&gt; &lt;mask&gt; [secondary [vrf &lt;name&gt;]]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure a VRF routing table with the same name assigned to the VRF
and enters the VRF configuration mode</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ip vrf &lt;name&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create routing and forwarding tables and specify the default route distinguisher for a vpn</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-vrf)# rd &lt;route-distinguisher&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a route target extended community for a VRF</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-vrf)# route-target [import | export | both] &lt;community&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_customizing_a_bgp_peer">Customizing a BGP Peer</h5>
<div class="ulist">
<ul>
<li>
<p>Disable the IPv4 unicast address family for the BGP routing process</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>no bgp default ipv4-unicast</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a neighbor</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; remote-as &lt;asn&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a text description with a specified neighbor</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; description &lt;text&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a text description with a specified peer group</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;peer-group-name&gt; description &lt;text&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Exit address family configuration mode</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router-af)# exit-address-family</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Disable a BGP peer or peer group</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; shutdown</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_monitoring_and_maintaining_basic_bgp">Monitoring and Maintaining Basic BGP</h5>
<div class="ulist">
<ul>
<li>
<p>Enable logging of BGP neighbor resets</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# bgp log-neighbor-changes</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure a BGP speaker to perform inbound soft reconfiguration
for peers that do not support the route refresh capability.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# bgp soft-reconfig-backup</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Start storing updates for each neighbor that do not support route refresh</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address|peer-group-name&gt; soft-reconfiguration [inbound]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>All the updates received from this neighbor will be stored unmodified,
regardless of the inbound policy. When inbound soft reconfiguration is done
later, the stored information will be used to generate a new set of inbound
updates.</p>
</li>
<li>
<p>Memory requirements can increased.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Apply a route map to incoming or outgoing routes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address|peer-group-name&gt; route-map &lt;name&gt; [in | out]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_aggregating_route_prefixes_using_bgp">Aggregating Route Prefixes Using BGP</h5>
<div class="ulist">
<ul>
<li>
<p>Redistribute static routes into the BGP routing table</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# redistribute static</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an aggregate entry in a BGP routing table</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# aggregate-address &lt;prefix&gt; &lt;mask&gt; [as-set]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an aggregate route and suppress advertisements of more-specific routes to all peers</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# aggregate-address &lt;prefix&gt; &lt;mask&gt; [summary-only]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an aggregate route but suppress advertisement of specified routes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# aggregate-address &lt;prefix&gt; &lt;mask&gt; [suppress-map &lt;map-name&gt;]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Selectively advertises routes previously suppressed by the <strong>aggregate-address</strong> command</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address | peer-group-name&gt; unsuppress-map &lt;map-name&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Conditionally advertise BGP routes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The routes or prefixes that will be conditionally advertised are defined in two
route maps: an advertise map and either an exist map or nonexist map. The route
map associated with the exist map or nonexist map specifies the prefix that the
BGP speaker will track. The route map associated with the advertise map
specifies the prefix that will be advertised to the specified neighbor when the
condition is met.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a prefix is found to be present in the exist map by the BGP speaker, the
prefix specified by the advertise map is advertised.</p>
</li>
<li>
<p>If a prefix is found not to be present in the nonexist map by the BGP
speaker, the prefix specified by the advertise map is advertised.</p>
</li>
<li>
<p>If the condition is not met, the route is withdrawn and conditional
advertisement does not occur. All routes that may be dynamically advertised
or not advertised must exist in the BGP routing table in order for
conditional advertisement to occur. These routes are referenced from an
access list or an IP prefix list.</p>
</li>
<li>
<p>Advertise selectively some BGP routes to neighbor</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; advertise-map &lt;name-1&gt; { exist-map &lt;name&gt; | non-exist-map &lt;name&gt;}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Inject more specific prefixes into a BGP routing table over less specific prefixes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# bgp inject-map &lt;name&gt; exist-map &lt;name&gt; [copy-attributes]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_originating_bgp_routes">Originating BGP Routes</h5>
<div class="ulist">
<ul>
<li>
<p>Advertise a default route to BGP peers</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; default-originate  [route-map &lt;name&gt;]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Indicate a network reachable through a backdoor route</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# network &lt;ip-address&gt; backdoor</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
BGP only advertize networks in the RIB
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_a_bgp_peer_group">Configuring a BGP Peer Group</h5>
<div class="ulist">
<ul>
<li>
<p>Create a BGP peer group</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;peer-group-name&gt; peer-group</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Assign a neighbor to a peer group</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; peer-group &lt;name&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_modify_the_default_output_and_regex_match_format_for_4_byte_asn">Modify the default output and regex match format for 4-byte ASN</h5>
<div class="listingblock">
<div class="content">
<pre>(config-router)# bgp asnotation dot</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_suppress_inactive_route_advertisement_using_bgp">Suppress inactive route advertisement using BGP</h5>
<div class="ulist">
<ul>
<li>
<p>Suppress inactive route advertisement</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router-af)# bgp suppress-inactive</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configure_basic_peer_session_template">Configure basic peer session template</h5>
<div class="ulist">
<ul>
<li>
<p>Create a peer session template</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# template peer-session &lt;name&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Inherit the configuration of another peer session template</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router-stmp)# inherit peer-session &lt;template-name&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Send a peer session template to a neighbor so that the neighbor can inherit the configuration</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# neighbor &lt;ip-address&gt; inherit peer-session &lt;template-name&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configure_basic_peer_policy_template">configure basic peer policy template</h5>
<div class="ulist">
<ul>
<li>
<p>Create a peer policy template</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router)# template peer-policy &lt;name&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the maximum number of prefixes that a neighbor will accept from this peer</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-router-ptmp)# maximum-prefix &lt;limit&gt; [&lt;threshold&gt;] [restart &lt;interval&gt; | warning-only]</pre>
</div>
</div>
<div class="ulist NOTE">
<ul class="NOTE">
<li>
<p>A peer policy template can directly or indirectly inherit up to 8 peer
policy templates.</p>
</li>
<li>
<p>A BGP neighbor cannot be configured to work with both peer groups and peer
templates. A BGP neighbor can be configured to belong only to a peer group or
to inherit policies only from peer templates.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_verify_2">12.4.5. Verify</h4>
<div class="ulist">
<ul>
<li>
<p>Display the entries in the bgp routing table</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip bgp [prefix] [mask]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display info about the TCP and BGP connection to neighbors</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>#  show ip bgp neigbors &lt;ip-address&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify that the VRF instance has been created</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip vrf</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display information about all the BGP paths in the database</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip bgp paths</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display the status of all BGP connections</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip bgp summary</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display IPv4 multicast database-related information</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip bgp ipv4 multicast &lt;command&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display injected paths</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip bgp injected-paths

BGP table version is 11, local router ID is 10.0.0.1
Status codes:s suppressed, d damped, h history, * valid, &gt; best, i -
internal
Origin codes:i - IGP, e - EGP, ? - incomplete
   Network          Next Hop            Metric LocPrf Weight Path
*&gt; 172.16.0.0       10.0.0.2                               0 ?
*&gt; 172.17.0.0/16    10.0.0.2                               0 ?</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display update replication stats for BGP update groups</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip bgp replication [&lt;index-group&gt; | &lt;ip-address&gt;] [summary]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display BGP routes that are not installed in the RIB</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># show ip bgp rib-failure

Network            Next Hop                      RIB-failure   RIB-NH Matches
10.1.15.0/24       10.1.35.5           Higher admin distance              n/a
10.1.16.0/24       10.1.15.1           Higher admin distance              n/a</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display locally configured peer session template</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip bgp template peer-session</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshoot_2">12.4.6. Troubleshoot</h4>
<div class="ulist">
<ul>
<li>
<p>Verify basic network connectivity between BGP devices</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ping vrf</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Clear and reset BGP neighbor sessions</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># clear ip bgp *</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Clear BGP update group membership and recalcultar BGP update groups</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># clear ip bgp update-group [ &lt;index-group&gt; | &lt;ip-address&gt; ]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Display info about the processing of BGP update groups.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># debug ip bgp groups</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_todos">12.4.7. todos</h4>
<div class="ulist">
<ul>
<li>
<p>Concept: bgp route aggregation generating AS_SET information</p>
</li>
<li>
<p>Multiprotocol bgp concepts</p>
</li>
<li>
<p>Multiprotocol bgp extensions for IP multicast concepts</p>
</li>
<li>
<p>AFI bgp address family identifier model : ipv4, ipv6,clns, vpnv4</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_redistribution">12.5. Redistribution</h3>
<div class="ulist">
<ul>
<li>
<p>Redistribution occurs from the routing table not the routing database</p>
</li>
<li>
<p>When redistributing protocol X into Y, take &#8230;&#8203;</p>
<div class="ulist">
<ul>
<li>
<p>routes in the RIB via protocol X</p>
</li>
<li>
<p>connected interfaces running protocol X</p>
</li>
</ul>
</div>
</li>
<li>
<p>choose</p>
<div class="ulist">
<ul>
<li>
<p>routes with lower AD</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_administrative_distance">12.5.1. Administrative distance</h4>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Route source</th>
<th class="tableblock halign-left valign-top">Distance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connected route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">summary EIGRP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eBGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">internal EIGRP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGRP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OSPF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IS-IS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">115</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ODR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">External EIGRP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">170</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iBGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unknown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">255</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_spot_issues">12.5.2. Spot issues</h4>
<div class="ulist">
<ul>
<li>
<p>Loops cannot occur with one single point of redistribution</p>
</li>
<li>
<p>Loops may occur with multiple points of redistribution</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_heuristics">12.5.3. heuristics</h4>
<div class="ulist">
<ul>
<li>
<p>identify each domain and associate a tag</p>
</li>
<li>
<p>assign tags to each domain</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>  route-map ospf2eigrp permit
    set tag 123</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>deny tag on re-entry</p>
<div class="ulist">
<ul>
<li>
<p>always block routes to be re-enter the domain</p>
</li>
<li>
<p>optionaly: block routes as per scenario requirement</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>  ! block own routes
  route-map ospf2eigrp deny 10
    match tag 456
  ! block some routes if requested
  route-map deny 20
    match tag 78</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>all tags to pass through transit domains without re-tagging them</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>! identify the transit tags without tagging
route-map ospf2eigrp permit 60
  match tag 234</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use BGP community instead of tags for BGP</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>route-map ospf2bgp permit 70
  set community 110</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>ip community-list 1 permit 10
  match community 1
  set tag 110</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_connected_routes">12.5.4. Connected routes</h4>
<div class="listingblock">
<div class="title">Task: redistribute connected routes</div>
<div class="content">
<pre>redistribute connected</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>OVerride the implicit redistribution of interfaces running the protocol X</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_static_routes_2">12.5.5. Static routes</h4>
<div class="listingblock">
<div class="title">Task: redistribute static route</div>
<div class="content">
<pre>(config-router)# redistribute static route-map &lt;name&gt; metric &lt;value&gt;
(config-router)# default-metric &lt;hops&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rip_2">12.5.6. RIP</h4>
<div class="ulist">
<ul>
<li>
<p>doesn&#8217;t differentiate between internal and external routes</p>
</li>
<li>
<p>no default seed metric</p>
<div class="ulist">
<ul>
<li>
<p>recommendation: use  1 as default-metric</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Prevent loss of packet when BGP routes are redistributed in RIP</div>
<div class="content">
<pre>(config)# router rip
(config-router)# input-queue 1024</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eigrp_2">12.5.7. EIGRP</h4>
<div class="listingblock">
<div class="content">
<pre>redistribute &lt;protocol&gt; metric &lt;bandwidth&gt; &lt;delay&gt; &lt;load&gt; &lt;reliability&gt; &lt;MTU&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>internal routes AD &lt; external routes</p>
</li>
<li>
<p>uses router-id for loop prevention</p>
</li>
<li>
<p>no default seed metric unless EIGRP to EIGRP</p>
<div class="ulist">
<ul>
<li>
<p>default-metric &lt;bandwidth&gt; &lt;delay&gt; &lt;load&gt; &lt;reliability&gt; &lt;MTU&gt;</p>
</li>
<li>
<p>default-metric 10000 100 1 255 1500</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Duplicate router-ids will prevent EIGRP to install routes
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ospf_redistribution">12.5.8. OSPF redistribution</h4>
<div class="ulist">
<ul>
<li>
<p>differentiates between internal and external routes but same AD= 110</p>
</li>
<li>
<p>Router-id for flooding loop prevention</p>
</li>
<li>
<p>Use <strong>subnets</strong> keyword</p>
</li>
<li>
<p>default metric is 1 for BGP and 20 for other IGP</p>
</li>
<li>
<p>default metric-type E2/N2</p>
</li>
<li>
<p>OSPF path selection
TODO: improve this part</p>
<div class="ulist">
<ul>
<li>
<p>E1 &gt; E2 &gt; N1 &gt; N2</p>
</li>
<li>
<p>E1 &amp; N1 vs E2 &amp; N2 metrics</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>router ospf 1
  redistribute rip
  redistribute eigrp
  default-metric 10</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Assign different AD to internal and external</div>
<div class="content">
<pre></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bgp_redistribution">12.5.9. BGP redistribution</h4>
<div class="sect4">
<h5 id="_igp_to_bgp">IGP to BGP</h5>
<div class="ulist">
<ul>
<li>
<p>denies OSPF external routes by default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: redistribute OSPF into BGP</div>
<div class="content">
<pre>redistribute ospf &lt;pid&gt; match internal external</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bgp_to_igp">BGP to IGP</h5>
<div class="ulist">
<ul>
<li>
<p>iBGP routes denied by default, eBGP routes win</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<h1 id="_part_iii_vpn_technologies" class="sect0">Part III : VPN Technologies</h1>
<div class="sect1">
<h2 id="_mpls">13. MPLS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_concepts_4">13.1. Concepts</h3>
<div class="ulist">
<ul>
<li>
<p>mpls vpn</p>
<div class="ulist">
<ul>
<li>
<p>ce : no mpls-aware</p>
</li>
<li>
<p>pe : mpls and vpn aware</p>
</li>
<li>
<p>p : no vpn aware</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_mpls_label_stack">13.1.1. MPLS label stack</h4>
<div class="imageblock">
<div class="content">
<img src="../images/mpls-header-format.png" alt="MPLS header format" width="896" height="152">
</div>
<div class="title">Figure 26. MPLS header format</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Label
</td>
<td class="hdlist2">
<p>Locally significant to the router</p>
</td>
</tr>
<tr>
<td class="hdlist1">
EXP
</td>
<td class="hdlist2">
<p>Experimental, class of service</p>
</td>
</tr>
<tr>
<td class="hdlist1">
S
</td>
<td class="hdlist2">
<p>Bottom-of-Stack flag</p>
</td>
</tr>
<tr>
<td class="hdlist1">
TTL
</td>
<td class="hdlist2">
<p>Time to live</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_label_distribution">13.1.2. label distribution</h4>
<div class="ulist">
<ul>
<li>
<p>protocol : ldp (default rfc 3036) or tdp (cisco)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_dynamic_discovery_of_adjacent_ldp_peers">dynamic discovery of adjacent ldp peers</h5>
<div class="ulist">
<ul>
<li>
<p>neigbhbor discovery UDP port 646</p>
<div class="ulist">
<ul>
<li>
<p>basic neighbor discovery: multicast hellos to directly connected neighbors</p>
</li>
<li>
<p>extended neighbor discovery: unicast hellos to non-directly connected neighbors</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>R1#sh mpls ldp neighbor
  Peer LDP Ident: 192.1.5.5:0; Local LDP Ident 192.1.1.1:0
    TCP connection: 192.1.5.5.21288 - 192.1.1.1.646
    State: Oper; Msgs sent/rcvd: 10/11; Downstream
    Up time: 00:04:24
    LDP discovery sources:
      FastEthernet0/0, Src IP addr: 172.16.15.5
    Addresses bound to peer LDP Ident:
    172.16.15.5 192.1.5.5</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>timers: hello interval (5 seconds) and holdtime (15 seconds)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# mpls ldp discovery hello interval &lt;sec&gt;
(config)# mpls ldp discovery hello holdtime &lt;sec&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_peering_establishment">peering establishment</h5>
<div class="paragraph">
<p>in 2 steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>transport connection: if the 2 peers have never established a tcp session, create a new session with a client (active device, highest ip address)
using a random port and the server (lowest ip addr) listening on the TCP 646 port.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>R1#show tcp brief (state)
TCB        Local_Address   Foreign_Address
498D80D8   192.1.1.1.646   192.1.5.5.21288   ESTAB</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>session establishment:</p>
<div class="ulist">
<ul>
<li>
<p>negotiates ldp protocol version, label exchange method, timers</p>
</li>
<li>
<p>if incompatibility, sends error negotiation messages and restart the negotiation
with initial backoff value (15 seconds) and maximum backoff value (120 seconds)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>R1#show mpls ldp parameters
  Protocol version: 1
  Session hold time: 180 sec; keep alive interval: 60 sec
  Discovery hello: holdtime: 15 sec; interval: 5 sec
  Discovery targeted hello: holdtime: 90 sec; interval: 10 sec
  Downstream on Demand max hop count: 255
  Downstream on Demand Path Vector Limit: 255
  LDP for targeted sessions
  LDP initial/maximum backoff: 15/120 sec
  LDP loop detection: off</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_regulation_of_peer_to_peer_communication_and_label_exchange">13.1.3. regulation of peer-to-peer communication and label exchange</h4>
<div class="ulist">
<ul>
<li>
<p>with keepalives (60 seconds)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# mpls ldp holdtime &lt;sec&gt;
%Previously established sessions may not use the new holdtime.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>keepalive timer is reset every time ldp packets or keepalive are received</p>
</li>
<li>
<p>keepalive are automatically adjusted to 1/3 of the configured holdtime</p>
</li>
<li>
<p>you need to reset the tcp session for new timers to take effect</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_label_distribution_and_control">13.2. label distribution and control</h3>
<div class="ulist">
<ul>
<li>
<p>methods:</p>
<div class="ulist">
<ul>
<li>
<p>Unsolicited downstream distribution mode</p>
</li>
<li>
<p>solicited downstream distribution mode</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>(to be revised )</p>
</div>
<div class="sect3">
<h4 id="_route_distinguishers_and_route_targets">13.2.1. Route distinguishers and route targets</h4>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/net_mgmt/ip_solution_center/3-1/mpls/user/guide/mpls/1_iscqsg.html#wp1039468">RD and RT</a></p>
</div>
<div class="paragraph">
<p>RD is added to prefix when BGP vpnv4 advertised NLRI.
  - only one per NLRI
RT is Path attribute of the NLRI
  - 1 or + for each RD/prefix
  - useful in overlapping VPNs or central service VPN offered by SP</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_commands">13.3. Commands</h3>
<div class="listingblock">
<div class="content">
<pre>show mpls forwarding-table</pre>
</div>
</div>
<div class="paragraph">
<p>check <a href="http://www.cisco.com/en/US/docs/ios-xml/ios/mpls/command/mp-s2.html#wp4232274342" class="bare">http://www.cisco.com/en/US/docs/ios-xml/ios/mpls/command/mp-s2.html#wp4232274342</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gre">14. GRE</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>tunnelling protocol developed by Cisco</p>
</li>
<li>
<p>IP protocol 47</p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc2784">RFC 2784</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc2345">RFC 2345</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc1234">RFC 1234</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_tunneling">14.1. Tunneling</h3>
<div class="ulist">
<ul>
<li>
<p>Tunneling uses encapsulates data packets with from one protocol inside a different protocol
and transports the data packets unchanged across a foreign network.</p>
</li>
<li>
<p>Unlike encapsulation, tunneling allows a lower-layer protocol, or same-layer protocol,
to be carried through the tunnel.</p>
</li>
<li>
<p><strong>Passenger protocol</strong> : The protocol that you are encapsulating. Examples: AppleTalk, IP, IPX.</p>
</li>
<li>
<p><strong>Carrier protocol</strong> : The protocol that does the encapsulating. Examples: GRE, IP-in-IP, L2TP,MPLS, STUN,DLSw+.</p>
</li>
<li>
<p><strong>Transport protocol</strong> : The protocol used to carry the encapsulated protocol. The main transport protocol is IP.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ip-tunneling-concepts.png" alt="ip tunneling concepts">
</div>
<div class="title">Figure 27. IP Tunneling Terminology and Concepts</div>
</div>
</div>
<div class="sect2">
<h3 id="_gre_header">14.2. GRE header</h3>
<div class="imageblock">
<div class="content">
<img src="../images/gre-header-format.png.png" alt="gre header format.png" width="896" height="248">
</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
C
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>Checksum present</p>
</li>
<li>
<p>Set to 1 if the checksum and the Reserved1 field are present</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
K
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>Key bit. Set to 1 if</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Reserved0
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>if any of bits 1-5 are non-zero, a receiver must discard the packet
unless receiver implements RFC1701</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Protocol Type
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>Ether protocol type (e.g. IPv4 &#8594; 0x800)</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_gre_keepalive">14.2.1. GRE keepalive</h4>
<div class="paragraph">
<p>The GRE tunnel keepalive mechanism gives the ability for one side to originate
and receive keepalive packets to and from a remote router even if the remote
router does not support GRE keepalives. For GRE keepalives, the sender
pre-builds the keepalive response packet inside the original keepalive request
packet so that the remote end only needs to do standard GRE decapsulation of
the outer GRE IP header and then forward the inner IP GRE packet. GRE tunnel
keepalives timers on each side are independent and do not have to match. The
problem with the configuration of keepalives only on one side of the tunnel is
that only the router that has keepalives configured marks its tunnel interface
as down if the keepalive timer expires. The GRE tunnel interface on the other
side, where keepalives are not configured, remains up even if the other side of
the tunnel is down. The tunnel can become a black-hole for packets directed
into the tunnel from the side that did not have keepalives configured.</p>
</div>
<div class="paragraph">
<p>Specifies the number of times that the device will continue to send keepalive
packets without response before bringing the tunnel interface protocol down.</p>
</div>
<div class="paragraph">
<p>GRE keepalive packets may be configured either on only one side of the tunnel or on both.
If GRE keepalive is configured on both sides of the tunnel, the period and retries arguments can be different at each side of the link.</p>
</div>
<div class="paragraph">
<p>This command is supported only on GRE point-to-point tunnels.</p>
</div>
<div class="listingblock">
<div class="title">Task: Configure GRE keepalives</div>
<div class="content">
<pre>(config-if)# keepalive [ period [retries]]</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gre_tunnel">14.3. GRE tunnel</h3>
<div class="paragraph">
<p>To build a tunnel, a tunnel interface must be defined on each of two routers
and the tunnel interfaces must reference each other.
At each router, the tunnel interface must be configured with a L3 address.
The tunnel endpoints, tunnel source, and tunnel destination must be defined,
and the type of tunnel must be selected.</p>
</div>
<div class="paragraph">
<p>Optional steps can be performed to customize the tunnel.</p>
</div>
<div class="paragraph">
<p>Remember to configure the router at each end of the tunnel.
If only one side of a tunnel is configured,
the tunnel interface may still come up and stay up (unless
keepalive is configured), but packets going into the tunnel will be dropped.</p>
</div>
<div class="listingblock">
<div class="title">Task: Summary steps</div>
<div class="content">
<pre>interface tunnel number
  bandwidth kbps
  keepalive [period [retries]]
  tunnel source {ip-address | interface-type interface-number}
  tunnel destination {hostname | ip-address}
  tunnel key key-number
  tunnel mode [gre {ip | multipoint} | dvmrp | ipip | mpls | nos]
  ip mtu bytes
  ip tcp mss mss-value
  tunnel path-mtu-discovery [age-timer {aging-mins| infinite}]</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The router should have a route to the destination address, but not through the tunnel interface.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configuration_example">14.3.1. Configuration example</h4>
<div class="paragraph">
<p>Note that Ethernet interface 0/1 is the tunnel source for Router A and the tunnel destination for Router B.
Fast Ethernet interface 0/1 is the tunnel source for Router B and the tunnel destination for Router A.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Router A</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre>interface Tunnel0
 ip address 10.1.1.2 255.255.255.0
 tunnel source Ethernet0/1
 tunnel destination 192.168.3.2
 tunnel mode gre ip
!
interface Ethernet0/1
 ip address 192.168.4.2 255.255.255.0</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Router B</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre>interface Tunnel0
 ip address 10.1.1.1 255.255.255.0
 tunnel source FastEthernet0/1
 tunnel destination 192.168.4.2
 tunnel mode gre ip
!
interface FastEthernet0/1
 ip address 192.168.3.2 255.255.255.0</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_4">14.4. Troubleshooting</h3>
<div class="paragraph">
<p>Three reasons for a GRE tunnel to shut down:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is no route to the tunnel destination address.</p>
</li>
<li>
<p>The interface that anchors the tunnel source is down.</p>
</li>
<li>
<p>The route to the tunnel destination address is through the tunnel itself. “%TUN-5-RECURDOWN:Tunnel0“</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the above three reasons for tunnel shut down are problems local to the
router at the tunnel endpoints and do not cover problems in the intervening
network.</p>
</div>
<div class="paragraph">
<p>Also if the two routers tunnel modes do not match, the tunnel interface can
still stay in an up/ip state but the routers cannot forward packets because of
the mismatch encapsulation.</p>
</div>
<div class="sect3">
<h4 id="__tun_5_recurdown_error_message_and_flapping_eigrp_ospf_bgp_neighbors_over_a_gre_tunnel">14.4.1. "%TUN-5-RECURDOWN" error message and flapping EIGRP/OSPF/BGP neighbors over a GRE tunnel</h4>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/support/docs/ip/enhanced-interior-gateway-routing-protocol-eigrp/22327-gre-flap.html" class="bare">http://www.cisco.com/c/en/us/support/docs/ip/enhanced-interior-gateway-routing-protocol-eigrp/22327-gre-flap.html</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_questions_2">14.5. Questions</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>What is the minimum amount of additional header that GRE adds to a packet?</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>16 bytes</p>
</li>
<li>
<p>20 bytes</p>
</li>
<li>
<p>24 bytes</p>
</li>
<li>
<p>36 bytes</p>
</li>
<li>
<p>48 bytes</p>
</li>
</ol>
</div>
</li>
<li>
<p>Which of the following are valid options in a GRE header (select all that apply)?</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>GRE Header Length</p>
</li>
<li>
<p>Checksum Present</p>
</li>
<li>
<p>Key Present</p>
</li>
<li>
<p>External Encryption</p>
</li>
<li>
<p>Protocol</p>
</li>
</ol>
</div>
</li>
<li>
<p>What is the purpose of a GRE tunnel interface?</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>It is always the tunnel source interface.</p>
</li>
<li>
<p>It is always the tunnel destination interface.</p>
</li>
<li>
<p>It is where the protocol that travels through the tunnel is configured.</p>
</li>
<li>
<p>It is the interface that maps to the physical tunnel port.</p>
</li>
<li>
<p>It is not used today</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="http://ptgmedia.pearsoncmg.com/9781587201509/samplechapter/158720150X_CH14.pdf" class="bare">http://ptgmedia.pearsoncmg.com/9781587201509/samplechapter/158720150X_CH14.pdf</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dmvpn">15. DMVPN</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_concepts_5">15.1. Concepts</h3>
<div class="ulist">
<ul>
<li>
<p>dynamic creation of spoke-to-spoke</p>
</li>
<li>
<p>DMVPN = mGRE + NHRP + IPSec</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Start with mGRE configuration</p>
</div>
<div class="paragraph">
<p>interface tunnel 0
  ip address 141.11.10.1 255.255.255.0
  tunnel source e0
  tunnel mode gre multipoint</p>
</div>
</div>
<div class="sect2">
<h3 id="_phases">15.2. Phases</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Phase 1</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Hub and spoke functionality</p>
</li>
<li>
<p>for simplified and smaller configuration</p>
</li>
<li>
<p>zero touch provisioning for adding spokes to the VPN</p>
</li>
<li>
<p>supports dynamically addressed CPEs</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Phase 2</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Spoke-to-spoke functionality</p>
</li>
<li>
<p>on demand spoke-to-spoke tunnels avoids dual encrypts/decrypts</p>
</li>
<li>
<p>Smaller spoke CPE can participate in the virtual mesh</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Phase 3</dt>
<dd>
<p>Architecture and scaling</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Verify NHRP configuration</div>
<div class="content">
<pre># sh ip nhrp

141.11.10.2/32 via 141.11.10.2
   Tunnel1234 created 00:02:21, expire 00:57:38
   Type: dynamic, Flags: unique registered
   NBMA address: 10.11.10.2
141.11.10.3/32 via 141.11.10.3
   Tunnel1234 created 00:02:09, expire 00:57:50
   Type: dynamic, Flags: unique registered
   NBMA address: 10.11.10.3</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ipsec">16. IPSEC</h2>
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<h1 id="_part_iv_infrastructure_security" class="sect0">Part IV : Infrastructure Security</h1>
<div class="sect1">
<h2 id="_device_security">17. Device security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_aaa">17.1. AAA</h3>
<div class="sect3">
<h4 id="_ppp_security">17.1.1. PPP security</h4>
<div class="ulist">
<ul>
<li>
<p>implement device access control</p>
<div class="ulist">
<ul>
<li>
<p>lines</p>
</li>
<li>
<p>password encryption</p>
</li>
<li>
<p>management plane protection</p>
</li>
<li>
<p>control plane protection</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_network_security">18. Network security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_switch_security">18.1. Switch security</h3>

</div>
<div class="sect2">
<h3 id="_access_control_list">18.2. Access control list</h3>
<div class="sect3">
<h4 id="_references">18.2.1. References</h4>
<div class="paragraph">
<p>sec-data-acl</p>
</div>
</div>
<div class="sect3">
<h4 id="_reflexive_acl">18.2.2. Reflexive ACL</h4>
<div class="ulist">
<ul>
<li>
<p>sourcecontrol</p>
</li>
<li>
<p>dhcp snooping</p>
</li>
<li>
<p>ip source-guard</p>
</li>
<li>
<p>dynamic arp inspection</p>
</li>
<li>
<p>port-security</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_router_security">18.3. Router security</h3>
<div class="ulist">
<ul>
<li>
<p>ipv4 access list</p>
</li>
<li>
<p>ipv6 traffic filter</p>
</li>
<li>
<p>unicast reverse path forwarding</p>
</li>
<li>
<p>ipv6 first hop security</p>
<div class="ulist">
<ul>
<li>
<p>ra guard</p>
</li>
<li>
<p>dhcp guard</p>
</li>
<li>
<p>binding table</p>
</li>
<li>
<p>device tracking</p>
</li>
<li>
<p>ND inspection/snooping</p>
</li>
<li>
<p>source guard</p>
</li>
<li>
<p>PACL</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ieee_802_1x">19. IEEE 802.1X</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_definition_2">19.1. Definition</h3>
<div class="ulist">
<ul>
<li>
<p>Port-based authentication</p>
</li>
<li>
<p>until the client is authenticated,
allows only EAPoL (Extensible Authentication Protocol over LAN), CDP and STP traffic</p>
</li>
<li>
<p>supplicant: client workstation running 802.1x compliant software</p>
</li>
<li>
<p>authenticator: edge switch or wireless access point</p>
</li>
<li>
<p>authentication server: performs the actual authentication (Radius with EAP)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_port_security">19.2. Port security</h3>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<h1 id="_part_v_infrastructure_services" class="sect0">Part V : Infrastructure Services</h1>
<div class="sect1">
<h2 id="_system_management">20. System management</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_telnet">20.1. Telnet</h3>
<div class="listingblock">
<div class="title">Task: Description</div>
<div class="content">
<pre>(config)# ip telnet hidden addresses</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ssh">20.2. SSH</h3>
<div class="sect3">
<h4 id="_configurations">20.2.1. Configurations</h4>
<div class="paragraph">
<p>blabla
xxxx</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scp">20.3. SCP</h3>

</div>
<div class="sect2">
<h3 id="__t_ftp">20.4. [T]FTP</h3>

</div>
<div class="sect2">
<h3 id="_snmp">20.5. SNMP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration guides</span>&#160;&#9656; <span class="submenu">Network Management</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/snmp/configuration/15-mt/snmp-15-mt-book/nm-snmp-cfg-snmp-support.html">configuring SNMP support</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application-layer protocol between SNMP managers and agents</p>
<div class="ulist">
<ul>
<li>
<p>SNMP manager running NMS software:i UDP port 162 open for traps/informs messages</p>
</li>
<li>
<p>SNMP managed devices running SNMP agent: UDP 161 open for GET/SET messages</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_version_5">20.5.1. Version</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">v1</dt>
<dd>
<p>original specs, weak authentication with community string</p>
</dd>
<dt class="hdlist1">v2c</dt>
<dd>
<p>64-bit counters, getBulkRequest, informsRequest</p>
</dd>
<dt class="hdlist1">v3</dt>
<dd>
<p>authentication, encryption</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_mib">20.5.2. MIB</h4>
<div class="paragraph">
<p>MIB: dictionaries of OID</p>
</div>
<div class="paragraph">
<p>OID: hierarchical identifiers in numerical format that represent MIB variables.
( e.g. 1.3.6.1.2.1 "Interfaces"
1.3.6.1.4.1.9 "Enterprises - Cisco"
)</p>
</div>
</div>
<div class="sect3">
<h4 id="_packet_format_2">20.5.3. Packet format</h4>
<div class="imageblock">
<div class="content">
<img src="../images/snmp-header.png" alt="SNMP header format" width="896" height="376">
</div>
<div class="title">Figure 28. SNMP header format</div>
</div>
<div class="sect4">
<h5 id="_snmp_pdu_types">SNMP PDU Types</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>SetRequest</p>
</li>
<li>
<p>GetRequest</p>
</li>
<li>
<p>GetNextRequest</p>
</li>
<li>
<p>GetBulkRequest</p>
</li>
<li>
<p>Trap</p>
</li>
<li>
<p>InformsRquest</p>
</li>
<li>
<p>Response</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_7">20.5.4. Configuration</h4>
<div class="sect4">
<h5 id="_configure_basic_system_information">Configure basic system information</h5>
<div class="listingblock">
<div class="title">Task: Configure the location information</div>
<div class="content">
<pre>(config)# snmp-server location &lt;homesweethome&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the contact information</div>
<div class="content">
<pre>(config)# snmp-server contact &lt;no-where-to-be-found&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the system serial number</div>
<div class="content">
<pre>(config)# snmp-server chassis-id &lt;system-serial-number&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configure_snmp_v1_2">Configure SNMP v1/2</h5>
<div class="listingblock">
<div class="title">Task: Create a view</div>
<div class="content">
<pre>(config)# snmp-server view &lt;name&gt; &lt;oid-tree&gt; {included | excluded}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a community string</div>
<div class="content">
<pre>(config)# snmp-server community &lt;string&gt; [view &lt;name&gt;] [ro|rw] [&lt;acl]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display community string</div>
<div class="content">
<pre># sh snmp community</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_traps">20.5.5. Traps</h4>
<div class="listingblock">
<div class="title">Task: Send traps to NMS</div>
<div class="content">
<pre>(config)# snmp-server host &lt;ip-address&gt; [traps | informs] [version {1| 2c | 3 [auth | noauth | priv]}] community-string [udp-port port-number] [notification-type]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_snmp_v3">20.5.6. SNMP v3</h4>
<div class="listingblock">
<div class="title">Task: Configure SNMP v3 group</div>
<div class="content">
<pre>(config)# snmp-server group [&lt;groupname&gt; {v1 | v2c | v3 [auth | noauth | priv]}]
            [read &lt;readview&gt;]
            [write &lt;writeview&gt;]
            [notify &lt;notifyview&gt;]
            [access &lt;acl]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display SNMP v3 group settings</div>
<div class="content">
<pre># sh snmp group</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure  SNMP v3 user</div>
<div class="content">
<pre>(config)# snmp-server engineID {local &lt;engine-id&gt; | remote &lt;ip-address&gt; [udp-port &lt;number&gt; ] [vrf &lt;vrf-name&gt; ] &lt;engine-id-string&gt; }
(config)# snmp-server user &lt;username&gt; &lt;groupname&gt; [remote &lt;ip-address&gt; [udp-port &lt;number&gt; ]] {v1 | v2c | v3 [encrypted] [auth {md5 | sha} &lt;auth-password&gt; ]} [access &lt;acl&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display SNMP user information</div>
<div class="content">
<pre># sh snmp user &lt;user&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display SNMP engineID</div>
<div class="content">
<pre># sh snmp engineID</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_a_device_as_snmp_manager">20.5.7. Configure a device as SNMP manager</h4>
<div class="listingblock">
<div class="title">Task: Configure the SNMP manager process</div>
<div class="content">
<pre>(config)# snmp-server manager</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the SNMP manager session time-out</div>
<div class="content">
<pre>(config)# snmp-server manager session-timeout &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the status of the SNMP sessions</div>
<div class="content">
<pre># sh snmp sessions brief</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the current set of pending SNMP requests</div>
<div class="content">
<pre># sh snmp pending</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enable_the_snmp_shutdown_mechanism">20.5.8. Enable the SNMP shutdown mechanism</h4>
<div class="listingblock">
<div class="title">Task: Enable the SNMP shutdown mechanism</div>
<div class="content">
<pre>(config)# snmp-server system-shutdown</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Define the maximum SNMP agent packet size</div>
<div class="content">
<pre>(config)# snmp-server packetsize &lt;bytes&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the TFTP servers used for saving and loading configuration files</div>
<div class="content">
<pre>(config)# snmp-server tftp-server-list &lt;acl&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable SNMP agent</div>
<div class="content">
<pre>(config)# no snmp-server</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syslog">20.6. Syslog</h3>

</div>
<div class="sect2">
<h3 id="_ntp">20.7. NTP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration guides</span>&#160;&#9656; <span class="submenu">Network Management</span>&#160;&#9656; <span class="submenu">Basic System Management</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/bsm/configuration/15-mt/bsm-15-mt-book/bsm-time-calendar-set.html">Setting Time and Calendar Services</span></span> </a></p>
</div>
<div class="sect3">
<h4 id="_overview_12">20.7.1. Overview</h4>
<div class="ulist">
<ul>
<li>
<p>Version 3 <a href="https://tools.ietf.org/html/rfc1305">RFC 1305</a></p>
</li>
<li>
<p>UDP port 123</p>
</li>
<li>
<p>IOS does not support stratum 1 service, cannot be linked to stratum 0 atomic clock</p>
</li>
<li>
<p>Accuracy &lt; milliseconds with 1 NTP packet per minute</p>
</li>
<li>
<p>Stratum</p>
<div class="ulist">
<ul>
<li>
<p>0 : atomic clock</p>
</li>
<li>
<p>8 : default value</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ntp_associations">20.7.2. NTP associations</h4>
<div class="ulist">
<ul>
<li>
<p>Polled-based: better accuracy and reliability</p>
<div class="ulist">
<ul>
<li>
<p>Client mode: <strong>ntp server</strong></p>
</li>
<li>
<p>Symmetric active mode: <strong>ntp peer</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Broadcast-based: less manual configuration on LAN</p>
<div class="ulist">
<ul>
<li>
<p>Server: <strong>ntp broadcast</strong></p>
</li>
<li>
<p>Client: <strong>ntp broadcast client</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Verify NTP status</div>
<div class="content">
<pre># show ntp status</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify NTP associations</div>
<div class="content">
<pre># show ntp associations</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Troubleshoot NTP associations</div>
<div class="content">
<pre># debug ntp refclock</pre>
</div>
</div>
<div class="sect4">
<h5 id="_polled_based_associations">Polled-based associations</h5>
<div class="listingblock">
<div class="content">
<pre>(config)# ntp server &lt;ip-address&gt; [normal-sync] [version &lt;number&gt;] [key &lt;id&gt;] [prefer]
(config)# ntp peer &lt;ip-address&gt; [normal-sync] [version &lt;number&gt;] [key &lt;id&gt;] [prefer]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_broadcast_based_associations">Broadcast-based associations</h5>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ntp broadcast version &lt;number&gt;
(config-if)# ntp broadcast client
(config-if)# ntp broadcastdelay &lt;microseconds&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ntp_access_groups">20.7.3. NTP access groups</h4>
<div class="listingblock">
<div class="title">Task: Grant/deny access privileges with ipv4 or ipv6 access-lists</div>
<div class="content">
<pre>(config)# ntp access-group [ipv4 | ipv6] &lt;options&gt;  &lt;access-list-id&gt; [kod]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><em>options</em> per increasing order of restrictions are:</p>
<div class="ulist">
<ul>
<li>
<p><strong>peer</strong>: synchronize itself to systems whose address passes access list criteria</p>
</li>
<li>
<p><strong>serve</strong>: allows time requests and NTP control queries but no synchronization</p>
</li>
<li>
<p><strong>serve-only</strong>: allows only time requests</p>
</li>
<li>
<p><strong>query-only</strong>: allows only NTP control queries</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>kod</strong> sends the kiss-of-death packet to any host that tries to send a packet
that is not compliant with the access-group policy.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ntp_authentication">20.7.4. NTP authentication</h4>
<div class="ulist">
<ul>
<li>
<p>Use cryptographic checksum keys</p>
</li>
<li>
<p>Encryption/decryption are CPU-intensive and may degrade accuracy</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ntp authenticate
(config)# ntp authentication-key &lt;number&gt; md5 &lt;key&gt;
(config)# ntp trusted-key &lt;key-number&gt; [-&lt;end-key-number]
(config)# ntp server &lt;ip-address&gt; key &lt;id&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_source_ip_address">20.7.5. Source IP address</h4>
<div class="ulist">
<ul>
<li>
<p>Default to NTP packet outgoing interface</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Change the source IP address for all destinations</div>
<div class="content">
<pre>(config)# ntp source interface</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Change the source for a specific association</div>
<div class="content">
<pre>(config)# ntp {server|peer} source</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoritative_server">20.7.6. Authoritative server</h4>
<div class="listingblock">
<div class="title">Task:</div>
<div class="content">
<pre>(config)# ntp master</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_panic_treshold">20.7.7. Panic treshold</h4>
<div class="listingblock">
<div class="title">Task: Reject time updates greater than the panic threshold of 1000 seconds</div>
<div class="content">
<pre>(config)# ntp panic update</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_orphan_mode">20.7.8. Orphan mode</h4>
<div class="ulist">
<ul>
<li>
<p>When a subnet lost communications with clock servers</p>
</li>
<li>
<p>Orphan parent simulate a UTC source for orphan children</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ntp server &lt;a.b.c.d&gt;
(config)# ntp peer &lt;e.f.g.h&gt;
(config)# ntp orphan &lt;stratum&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_external_reference_clock">20.7.9. external reference clock</h4>
<div class="listingblock">
<div class="content">
<pre># line aux &lt;number&gt;
# ntp refclock trimble pps none stratum &lt;number&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_software_clock">20.7.10. Software clock</h4>
<div class="listingblock">
<div class="content">
<pre>(config)# clock timezone &lt;zone&gt; &lt;hours-offset&gt; [&lt;minutes-offset&gt;]
(config)# summer-time &lt;zone&gt; recurring [&lt;week day month hh:mm&gt; [&lt;offset&gt;]]
(config)# summer-time &lt;zone&gt; date [&lt;date month year hh:mm&gt; [&lt;offset&gt;]]
# clock set &lt;hh:mm:ss date month year&gt;
# show clock</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hardware_clock">20.7.11. Hardware-clock</h4>
<div class="ulist">
<ul>
<li>
<p>different from software-clock</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># calendar set &lt;hh:mm:ss date month year&gt;
(config)# clock calendar-valid
# clock read-calendar
# clock update-calendar
# show calendar
# show clock [detail]
# show ntp associations [details]
# show ntp status</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_time_ranges">20.7.12. Time Ranges</h4>
<div class="listingblock">
<div class="title">Task: Configure time ranges</div>
<div class="content">
<pre>(config)# time-range &lt;name&gt;
(config-time-range)# absolute [start &lt;hh:mm date month year&gt;] [end &lt;hh:mm date month year&gt;]
(config-time-range)# periodic &lt;day-of-week&gt; &lt;hh:mm&gt; to [&lt;day-of-the-week&gt;] &lt;hh:mm&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify time range</div>
<div class="content">
<pre># show time-range</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vulnerability">20.7.13. Vulnerability</h4>
<div class="ulist">
<ul>
<li>
<p>DoS for version &#8656; 4.2.4p7</p>
</li>
<li>
<p>No workaround, disable NTP on the device</p>
</li>
<li>
<p>Symptoms:</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qos">21. QoS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_mqc">21.1. MQC</h3>
<div class="sect3">
<h4 id="_mqc_structure">21.1.1. MQC structure</h4>
<div class="ulist">
<ul>
<li>
<p>define a traffic class with <strong>class map</strong></p>
</li>
<li>
<p>create a traffic policy with <strong>policy map</strong></p>
</li>
<li>
<p>attach the traffic policy to an interface with <strong>service-policy</strong></p>
</li>
<li>
<p>restrictions: maximum of 256 classes in a single policy map</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_fields_that_can_be_marked_for_qos_purposes">21.1.2. Fields that can be marked for QoS purposes</h4>
<div class="ulist">
<ul>
<li>
<p>IPP, IP DSCP, DS field, ToS byte, CoS,Frame Relay  DE, ATM CLP, MPLS EXP</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_ipp">IPP</h5>
<div class="imageblock">
<div class="content">
<img src="../images/ipp-vs-dscp.png" alt="ipp vs dscp">
</div>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 10. IPP and Class Selector DSCP values</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSCP CS name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPP names</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS0/Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">routine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">priority</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">immediate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flash</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flash override</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">critical</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">internetwork control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">network control</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dscp">DSCP</h5>
<div class="ulist">
<ul>
<li>
<p>PHB: Per-hop Behavior</p>
</li>
<li>
<p>Expedited Forwarding:</p>
</li>
<li>
<p>packets given queunino</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_elements_of_a_traffic_class">21.1.3. Elements of a traffic class</h4>
<div class="paragraph">
<p>A traffic class contains 3 major elts: a name, a series of <strong>match</strong> commands followed by <strong>match-all</strong> (default) or <strong>match-any</strong></p>
</div>
<div class="ulist">
<div class="title">match commands that can be used with MQC</div>
<ul>
<li>
<p>match access-group</p>
</li>
<li>
<p>match any</p>
</li>
<li>
<p>match class-map</p>
</li>
<li>
<p>match cos</p>
</li>
<li>
<p>match destination-address mac</p>
</li>
<li>
<p>match discard-class</p>
</li>
<li>
<p>match [ip] dscp</p>
</li>
<li>
<p>match field</p>
</li>
<li>
<p>match fr-dlci</p>
</li>
<li>
<p>match input-interface</p>
</li>
<li>
<p>match ip rtp</p>
</li>
<li>
<p>match mpls experimental</p>
</li>
<li>
<p>match mpls experimental topmost</p>
</li>
<li>
<p>match not  // add a note here</p>
</li>
<li>
<p>match packet length
-</p>
</li>
<li>
<p>etc</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the match criteria for a class map on the basis of the specified protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol citrix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures NBAR to match Citrix traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol fasttrack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures NBAR to match FastTrack peer-to-peer traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol gnutella</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures NBAR to match Gnutella peer-to-peer traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol http</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures NBAR to match HTTP traffic by URL, host,MIME type, or fields in HTTP packet headers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match protocol rtp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures NBAR to match Real-Time Transport Protocol (RTP) traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match qos-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies a specific QoS group value as a match criterion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match source-address mac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses the source MAC address as a match criterion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the match criteria for a class map on the basis of the datagram header (Layer 2) or the network header (Layer 3).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies tag type as a match criterion.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
nbar cannot classify ipx
nbar cannot classify multicast traffic
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_elements_of_a_traffic_policy">21.1.4. Elements of a traffic policy</h4>
<div class="ulist">
<ul>
<li>
<p>contains 3 elts: name, traffic class, command to enable the QoS feature</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random-detect discard-class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the WRED parameters for a discard- class value for a class in a policy map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random-detect discard-class-based</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures  WRED on the basis of the discard class value of a packet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random-detect ecn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables explicit congestion notification (ECN).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random-detect exponential-weighting-constant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the exponential weight factor for the average queue size calculation for the queue reserved for a class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random-detect precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure the WRED parameters for a particular IP Precedence for a class policy in a policy map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set atm-clp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the cell loss priority (CLP) bit when a policy map is configured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set cos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the  Layer 2 class of service (CoS) value of an outgoing packet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set discard-class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marks a packet with a discard-class value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set [ip] dscp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marks a packet by setting the differentiated services code point (DSCP) value in the type of service (ToS) byte.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set fr-de</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes the discard eligible (DE) bit setting in the address field of a Frame Relay frame to 1 for all traffic leaving an interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set mpls experimental</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates the value to which the  MPLS bits are set if the packets match the specified policy map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the precedence value in the packet header.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set qos-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets a  QoS group identifier (ID) that can be used later to classify packets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shape</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shapes traffic to the indicated bit rate according to the algorithm specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shape adaptive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures a Frame  Relay interface or a point-to- point subinterface to estimate the available bandwidth by backward explicit congestion notification (BECN) integration while trafficommand</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shape fecn-adaptative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configures a Frame Relay interface to reflect FECN bits as BECN bits in Q.922 test response messages.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_service_policy">Service policy</h5>
<div class="listingblock">
<div class="content">
<pre>(config-if)# service-policy {input | output } policy-map-name</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_verification">21.1.5. Verification</h4>
<div class="paragraph">
<p>Display all class maps and their matching criteria</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; show class-map</pre>
</div>
</div>
<div class="paragraph">
<p>Display the configuration for the specified class of the specified policy map</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; show policy-map policy-name class class-name</pre>
</div>
</div>
<div class="paragraph">
<p>Display the configuration of all classes for all existing policy maps</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; show policy-map interface interface-name interface-number</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rsvp">21.2. RSVP</h3>
<div class="sect3">
<h4 id="_concepts_6">21.2.1. Concepts</h4>

</div>
<div class="sect3">
<h4 id="_configuration_tasks_4">21.2.2. Configuration tasks</h4>
<div class="listingblock">
<div class="content">
<pre>ip rsvp bandwidth [interface-kbps [single-flow-kbps] ]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>default 75 % can be allocated by to RSVP and up to 75% of the total bandwidth is available for a single flow</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_first_host_redundancy_protocols">22. First Host Redundancy Protocols</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_hsrp">22.1. HSRP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">First Hop Redundancy Protocols</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipapp_fhrp/configuration/15-mt/fhp-15-mt-book/fhp-hsrp-v2.html">HSRP Version 2</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.ietf.org/rfc/rfc2281.txt">RFC 2281</a></p>
</li>
<li>
<p>Set of routers sharing one virtual IP address and one virtual MAC address</p>
</li>
<li>
<p>elect one active router with the highest (priority, IP address)</p>
</li>
<li>
<p>standy router takes over if Active router fails</p>
</li>
<li>
<p>elect new standby router if standby router fails or becomes the active router.</p>
</li>
<li>
<p>to minimize network traffic, only the active and standby router send periodic HSRP messages.</p>
</li>
<li>
<p>a router may participate in multiple groups with seperate state and timers for each group</p>
</li>
<li>
<p>unique group id per vlan</p>
</li>
<li>
<p>hsrp address = 0000.0c07.AC<em>xy</em> (where xy is the HSRP group number in Hex)</p>
</li>
<li>
<p>send multicast 224.0.0.2 for v1 and 224.0.0.102 for v2</p>
</li>
<li>
<p>UDP port 1985</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_hsrp_packet">22.1.1. HSRP packet</h4>
<div class="paragraph">
<p>MAC header | IP header | UDP packet port 1985 | HSRP Packet</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/hsrp-packet.png" alt="HSRP packet" width="896" height="248">
</div>
<div class="title">Figure 29. HSRP packet</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_version">22.1.2. HSRP version</h4>
<div class="ulist">
<ul>
<li>
<p>version 1 by default</p>
</li>
<li>
<p>version 2 doesn&#8217;t interoperate with HSRPv1 on the same interface.</p>
<div class="ulist">
<ul>
<li>
<p>v1 and v2 can run on different physical interfaces of the same router</p>
</li>
<li>
<p>v1 cannot advertise and learn millisecond timers</p>
</li>
<li>
<p>v1 uses multicast 224.0.0.2 and v2 224.0.0.102</p>
</li>
<li>
<p>v2 uses jitter timers (negative for hellotimes and positive for holdtimes)</p>
</li>
</ul>
</div>
</li>
<li>
<p>group number: 0..255 for v1 and 0..4095 for v2</p>
</li>
<li>
<p>different virtual MAC address</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Change HSRP version</div>
<div class="content">
<pre>(config-if)# standby version {1 | 2}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_opcode">22.1.3. HSRP OpCode</h4>
<div class="ulist">
<ul>
<li>
<p>Uses the Opcode field for preemption</p>
<div class="ulist">
<ul>
<li>
<p>0: <strong>Hello</strong>: The router is running and is capable of becoming the active or standby router</p>
</li>
<li>
<p>1: <strong>Coup</strong>: The router wishes to become the active router</p>
</li>
<li>
<p>2: <strong>Resign</strong>: The router no longer wishes to be active router</p>
</li>
</ul>
</div>
</li>
<li>
<p>no preemption by default</p>
</li>
<li>
<p>preemption: the router with the highest priority becomes immediately the active router by sending a <strong>coup</strong> message,
The previous active router changes to the <strong>speak</strong> state and sends a <strong>resign</strong> message.</p>
</li>
<li>
<p>can specify a delay before take over to allow the router to populate its routing table</p>
<div class="ulist">
<ul>
<li>
<p><strong>minimum</strong> seconds after the last restart:</p>
</li>
<li>
<p><strong>reload</strong> seconds after the first interface-up event after the device has reloaded, if such an event occurs within 360 seconds from reload. ???</p>
</li>
<li>
<p><strong>sync</strong> seconds: for IP redundancy clients only ???</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure HSRP preemption</div>
<div class="content">
<pre>(config-if)# standby [ &lt;group-number&gt; ] preempt [ delay{ [ minimum &lt;seconds&gt; ] [ reload &lt;seconds&gt; ] [ sync &lt;seconds&gt; ] } ]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_state">22.1.4. HSRP State</h4>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 5%;">
<col style="width: 15%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the starting state and indicates that HSRP is not running. This state is entered via a configuration change or when an interface first comes up.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Learn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The router has not determined the virtual IP address, and not yet seen an authenticated Hello message from the active router. In this state the router is still waiting to hear from the active router.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The router knows the virtual IP address, but is neither the active router nor the standby router. It listens for Hello messages from those routers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Speak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The router sends periodic Hello messages and is actively participating in the election of the active and/or standby router. A router cannot enter Speak state unless it has the virtual IP address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The router is a candidate to become the next active router and sends periodic Hello messages. Excluding transient conditions, there MUST be at most one router in the group in Standby state.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The router is currently forwarding packets that are sent to the group&#8217;s virtual MAC address. The router sends periodic Hello messages. Excluding transient conditions, there MUST be at most one router in Active state in the group.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_priority_2">22.1.5. Priority</h4>
<div class="ulist">
<ul>
<li>
<p>default value: 100</p>
</li>
<li>
<p>The higher (priority || IP address) wins</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure HSRP priority</div>
<div class="content">
<pre>(config-if)# standby [group-number] priority &lt;number&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_timers">22.1.6. HSRP timers</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Hellotime</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>3 seconds by default</p>
</li>
<li>
<p>only meaningful in Hello messages</p>
</li>
<li>
<p>configured on the router or learned from authenticated Hello message from the active router</p>
<div class="ulist">
<ul>
<li>
<p>not learned if HSRP hellos &lt; 1 second</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Holdtime</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>10 seconds by default</p>
</li>
<li>
<p>&gt;= 3 * hellotime</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: configure HSRP timers</div>
<div class="content">
<pre>(config-if)# standby [group-number] timers[msec] &lt;hellotime&gt; [msec] &lt;holdtime&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_authentication">22.1.7. HSRP authentication</h4>
<div class="ulist">
<ul>
<li>
<p>clear-text or MD5 encryption</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure HSRP clear-text authentication</div>
<div class="content">
<pre>(config-if)# standby [group-number] authentication text &lt;string&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure HSRP MD5 authentication</div>
<div class="content">
<pre>(config-if)# standby [group-number] authentication  md5 { key-string [ 0 | 7 ] key [ timeout seconds ] | key-chain &lt;name-of-chain&gt; }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Debug HSRP authentication</div>
<div class="content">
<pre># debug standby errors</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_interface_or_object_tracking">22.1.8. HSRP Interface or Object tracking</h4>
<div class="ulist">
<ul>
<li>
<p>reduce HSRP priority if the monitored interface goes down, allowing another HSRP router to become active if it has preemption enabled.</p>
</li>
<li>
<p>cumulative reduction if multiple tracked interfaces are down</p>
</li>
<li>
<p>configurable decrement value (default = 10)</p>
</li>
<li>
<p>can shutdown/change the HSRP group to the Init state on the basis of the  tracked object&#8217;s state</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure interface tracking</div>
<div class="content">
<pre>(config-if)# standby track { &lt;object-number&gt; [&lt;priority-decrement&gt;] | interface-type &lt;interface-number&gt; [ decrement &lt;priority-decrement&gt; ] } [shutdown]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_support_for_icmp_redirects">22.1.9. HSRP support for ICMP redirects</h4>
<div class="ulist">
<ul>
<li>
<p>enabled by default with advertisement every 60 seconds and holddown of 180 seconds</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Why?</div>
<p>When HSRP is running, preventing hosts from discovering the interface (or
real) IP addresses of devices in the HSRP group is important. If a host is
redirected by ICMP to the real IP address of a device, and that device later
fails, then packets from the host will be lost.</p>
</div>
<div class="ulist">
<div class="title">How?</div>
<ul>
<li>
<p>looks up the next hop IP address in its table of real IP addresses vs virtual IP address</p>
</li>
<li>
<p>if match found, replaces the real IP address by the virtual IP addresses in the gateway field of the redirect packet</p>
</li>
<li>
<p>if no match (unknown), send the redirect packet to go out unchanged</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Restrictions</div>
<ul>
<li>
<p>Do not redirect to passive HSRP devices</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable ICMP redirects on an interface</div>
<div class="content">
<pre>(config-if)# standby redirect [timers &lt;advertisement&gt; &lt;holddown&gt;] [unknown]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable ICMP redirects on an interface</div>
<div class="content">
<pre>(config-if)# standby redirect [timers &lt;advertisement&gt; &lt;holddown&gt;] [unknown]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: configure ICMP redirect messages with HSRP virtual IP address as the gateway IP address</div>
<div class="content">
<pre>(config)# standby redirects [enable | disable]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Debug HSRP support for ICMP redirects</div>
<div class="content">
<pre># debug standby events icmp

10:43:08: HSRP: ICMP redirect not sent to 10.0.0.4 for dest 10.0.1.2
10:43:08: HSRP: could not uniquely determine IP address for mac 00d0.bbd3.bc22</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hsrp_virtual_ip_address_and_group">22.1.10. HSRP virtual IP address and group</h4>
<div class="ulist">
<ul>
<li>
<p>can have a name (no longer than 25 chars)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the virtual IP address</div>
<div class="content">
<pre>(config-if)# standby [&lt;group-number&gt;] ip [ &lt;a.b.c.d&gt;  [secondary]]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>by default, send one gratuitous ARP when a group becomes active and then another two and four seconds later.</p>
</li>
<li>
<p>When HSRP is on the Active state on an interface,
Proxy ARP requests are answered with the MAC address of the HSRP group.
otherwise, they are ignored.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the number of gratuitous ARP packets sent by HSRP group when it transitions to the active state, and how often the ARP packets are sent</div>
<div class="content">
<pre>(config-if)# standby arp gratuitous [count &lt;number=&gt; interval &lt;seconds&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: configure the name of the standby group</div>
<div class="content">
<pre>(config-if)# standby name &lt;group-name&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_glbp">22.2. GLBP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">First Hop Redundancy Protocols</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipapp_fhrp/configuration/15-mt/fhp-15-mt-book/Configuring-GLBP.html">Gateway Load Balancing Protocol</span></span> </a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>one AVG (active virtual gateway) per group</p>
</li>
<li>
<p>up to 4 primary AVFs (active virtual forwarder)</p>
</li>
<li>
<p>AVG responds to all ARP requests with MAC from all particapating AVF</p>
<div class="ulist">
<ul>
<li>
<p>Not with own MAC address like HSRP</p>
</li>
</ul>
</div>
</li>
<li>
<p>load-balancing</p>
<div class="ulist">
<ul>
<li>
<p>round-robin (default)</p>
</li>
<li>
<p>host-dependent</p>
</li>
<li>
<p>weigthed</p>
</li>
</ul>
</div>
</li>
<li>
<p>Multicast, 224.0.0.102, UDP port 3222</p>
</li>
<li>
<p>virtual MAC address 0007.B400.xxyy, where xx the group and yy in (00-03)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_glbp_packet_type">22.2.1. GLBP Packet Type</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Hello
</td>
<td class="hdlist2">
<p>advertise protocol info, multicast, sent by any AVG or AVF in [Speak, Standby, Active] State</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Request
</td>
<td class="hdlist2">
<p>request virtual MAC, unicast sent to AVG</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Reply
</td>
<td class="hdlist2">
<p>get virtual MAC, unicast sent from AVG</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_active_virtual_gateway">22.2.2. Active Virtual Gateway</h4>
<div class="ulist">
<ul>
<li>
<p>elected for each group max( priority, IP address )</p>
</li>
<li>
<p>assigns up to 4 virtual MAC address to AVFs</p>
</li>
<li>
<p>reponds to ARP request for the virtual IP address of the group</p>
</li>
<li>
<p>if failed, new AVG election from AVG in listen State</p>
</li>
<li>
<p>by default, no AVG preemption</p>
</li>
<li>
<p>load balancing methods</p>
<div class="ulist">
<ul>
<li>
<p>round-robin: by default, each AVF in turn is used for ARP</p>
</li>
<li>
<p>host-dependent: use same AVF based on the host MAC</p>
</li>
<li>
<p>weighted: use the weight value advertised by the gateway</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure GLBP virtual ip address</div>
<div class="content">
<pre>(config-if)# glbp &lt;group:0..1023 &gt; ip [&lt;virtual-ip-address&gt; [secondary]]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When the glbp ip command is enabled on an interface,
the handling of proxy ARP requests is changed
(unless proxy ARP was disabled).
the AVG intercepts the ARP requests and replies to the ARP on behalf of the connected nodes.
If a forwarder in the GLBP group is active, proxy ARP requests are answered using the MAC address of the first active
forwarder in the group.
If no forwarder is active, proxy ARP responses are suppressed.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Configure GLBP priority</div>
<div class="content">
<pre>(config-if)# glbp [&lt;group&gt;] priority &lt;level=100&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure GLBP preemption</div>
<div class="content">
<pre>(config-if)# glbp [&lt;group&gt;] preempt [delay minimum &lt;seconds&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure GLBP load balancing</div>
<div class="content">
<pre>(config-if)# glbp &lt;group&gt; load-balancing [ &lt;host-dependent&gt; | &lt;round-robin&gt; | &lt;weighted&gt; ]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the time during which the AVG continues to redirect clients to a secondary AVF</div>
<div class="content">
<pre>(config-if)# glbp &lt;group&gt; timers redirect &lt;redirect-seconds=60&gt; &lt;timeout-seconds=1440&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The redirect timer sets the time delay between a forwarder failing on the
network and the AVG assuming that the forwarder will not return. The virtual
MAC address to which the forwarder was responsible for replying is still
given out in Address Resolution Protocol (ARP) replies, but the forwarding
task is handled by another router in the GLBP group.</p>
</li>
<li>
<p>The timeout interval is the time delay between a forwarder failing on the
network and the MAC address for which the forwarder was responsible becoming
inactive on all of the routers in the GLBP group. After the timeout
interval, packets sent to this virtual MAC address will be lost. The timeout
interval must be long enough to allow all hosts to refresh their ARP cache
entry that contained the virtual MAC address.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Display glbp status</div>
<div class="content">
<pre># sh glbp

FastEthernet0/0.40 - Group 1
  State is Standby
    1 state change, last state change 00:02:02
  Virtual IP address is 172.16.26.100
  Hello time 3 sec, hold time 10 sec
    Next hello sent in 2.720 secs
  Redirect time 600 sec, forwarder time-out 14400 sec
  Preemption disabled
  Active is 172.16.26.6, priority 100 (expires in 11.360 sec)
  Standby is local
  Priority 100 (default)
  Weighting 100 (default 100), thresholds: lower 1, upper 100
  Load balancing: round-robin
  Group members:
    ca02.6150.0000 (172.16.26.2) local
    ca06.618c.0000 (172.16.26.6)
  There are 2 forwarders (1 active)
  Forwarder 1
    State is Listen
    MAC address is 0007.b400.0101 (learnt)
    Owner ID is ca06.618c.0000
    Time to live: 14399.840 sec (maximum 14400 sec)
    Preemption enabled, min delay 30 sec
    Active is 172.16.26.6 (primary), weighting 100 (expires in 10.944 sec)
  Forwarder 2
    State is Active
      1 state change, last state change 00:02:08
    MAC address is 0007.b400.0102 (default)
    Owner ID is ca02.6150.0000
    Preemption enabled, min delay 30 sec
    Active is local, weighting 100</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_active_virtual_forwarder">22.2.3. Active Virtual Forwarder</h4>
<div class="ulist">
<ul>
<li>
<p>primary AVF gets virtual MACs from AVG</p>
</li>
<li>
<p>secondary AVF learns virtual MACs from hellos</p>
</li>
<li>
<p>Virtual forwarder preemptive is enabled by default with 30 seconds delay</p>
</li>
<li>
<p>uses weighting and object tracking to determine the forwarding capacity of each device in the GLBP group</p>
<div class="ulist">
<ul>
<li>
<p>decrement or increments the weight when the interface goes down or up</p>
</li>
<li>
<p>stops being AVF if value below lower threshold</p>
</li>
<li>
<p>resumes being AVF if value greater then upper threshold</p>
</li>
<li>
<p>When multiple tracked interfaces are down, the configured weighting decrements are cumulative.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify GLBP initial weighting value</div>
<div class="content">
<pre>(config-if)# glbp &lt;group-number&gt; weighting &lt;maximum&gt; [lower &lt;low-value&gt; ] [upper &lt;up-value&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: specify a tracking object where GLBP weighting changes based on the availability of the object being tracked</div>
<div class="content">
<pre>(config-if)# glbp &lt;group&gt; weighting track &lt;object-number&gt; [decrement &lt;value&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: configure a router to take over as (AVF) group if the current AVF falls below its low weighting threshold</div>
<div class="content">
<pre>(config-if)# glbp &lt;group&gt; preempt forwarder [delay minimum &lt;seconds&gt;]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authentication_2">22.2.4. Authentication</h4>
<div class="ulist">
<ul>
<li>
<p>supports no authentication, plain-text, or MD5 authentication</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: configure glbp authentication</div>
<div class="content">
<pre>(config-if)# glbp authentication { text &lt;string&gt; | key-chain &lt;name&gt; }</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_vrrp">22.3. VRRP</h3>
<div class="ulist">
<ul>
<li>
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">First Hop Redundancy Protocols</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipapp_fhrp/configuration/15-mt/fhp-15-mt-book/fhp-vrrp.html">VRRP</span></span> </a></p>
</li>
<li>
<p><a href="https://wwwietf.org/rfc/rfc3768.txt">RFC 3768</a></p>
</li>
<li>
<p>similar to HSRP</p>
</li>
<li>
<p>multicast virtual MAC address (0000.5E00.01xx, where xx is the hex VRRP group number).</p>
</li>
<li>
<p>Uses the IOS object tracking feature, rather than its own internal tracking mechanism, to track interface states for failover purposes.</p>
</li>
<li>
<p>preemption by default</p>
</li>
<li>
<p>the group IP address is the interface IP address of one of the VRRP routers.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_configuration_8">22.3.1. Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Similar than HSRP</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: enable VRRP</div>
<div class="content">
<pre>(config-if)# vrrp &lt;group&gt; []</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: verify VRRP configuration</div>
<div class="content">
<pre># sh vrrp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: customize VRRP</div>
<div class="content">
<pre>conf t
interface &lt;type number&gt;
  ip address ip-address mask
  vrrp &lt;group&gt; description text
  vrrp &lt;group&gt; priority level
  vrrp &lt;group&gt; preempt [delay minimum seconds]
  vrrp &lt;group&gt; timers learn</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_idrp">22.4. IDRP</h3>
<div class="ulist">
<ul>
<li>
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">First Hop Redundancy Protocols</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipapp_fhrp/configuration/15-mt/fhp-15-mt-book/fhp-vrrp.html">IRDP</span></span> </a></p>
</li>
<li>
<p><a href="http://www.ietf.org/rfc/rfc1256.txt">RFC 1256</a></p>
</li>
<li>
<p>ICMP Router Discovery Protocol allows hosts to locate routers
that can be used as gateway to reach IP-based devices on other networks.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_message_format">22.4.1. Message format</h4>
<div class="sect4">
<h5 id="_icmp_router_advertisement_message">ICMP Router Advertisement Message</h5>
<div class="imageblock">
<div class="content">
<img src="../images/icmp-router-advertisement.png" alt="icmp router advertisement" width="896" height="248">
</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Checksum
</td>
<td class="hdlist2">
<p>The 16-bit one&#8217;s complement of the one&#8217;s complement sum of the ICMP message,
starting with the ICMP Type.
For computing the checksum, the Checksum field is set to 0.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Num Addrs
</td>
<td class="hdlist2">
<p>Number of router addreses advertised in this message</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Addr Entry Size
</td>
<td class="hdlist2">
<p>Number of 32-bit words of information per router address (=2 for IPv4)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Lifetime
</td>
<td class="hdlist2">
<p>Maximum number of seconds that the router adresses may be considered valid.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Router Address[i]
</td>
<td class="hdlist2">
<p>Sending router&#8217;s addresses on the interface from which this message is sent.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Preference Level[i]
</td>
<td class="hdlist2">
<p>Preferability of each Router Address[i] as a default router,
relative to other router addresses on the same subnet. Higher values more preferable.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_icmp_router_solicitation_message">ICMP Router Solicitation Message</h5>
<div class="imageblock">
<div class="content">
<img src="../images/icmp-router-sollicitation.png" alt="icmp router sollicitation" width="896" height="184">
</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Checksum
</td>
<td class="hdlist2">
<p>The 16-bit one&#8217;s complement of the one&#8217;s complement sum of the ICMP message,
starting with the ICMP Type.
For computing the checksum, the Checksum field is set to 0.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Reserved
</td>
<td class="hdlist2">
<p>Sent as 0; ignored on reception.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_9">22.4.2. Configuration</h4>
<div class="listingblock">
<div class="title">Task: Configure a host to discover routers that transmit IRDP router updates after disabling IP routing</div>
<div class="content">
<pre>(config)# no ip routing
(config-if)# ip gdp irdp [multicast]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable IRDP on an interface</div>
<div class="content">
<pre>(config-if)# ip irdp</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Send IRDP Advertisement to the all-systems multicast addresses</div>
<div class="content">
<pre>(config-if)# ip irdp multicast</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the IRDP period for which advertisements are valid.</div>
<div class="content">
<pre>(config-if)# ip irdp holdtime &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Sets the IRDP maximum interval between advertisements.</div>
<div class="content">
<pre>ip irdp maxadvertinterval &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the IRDP minimum interval between advertisements.</div>
<div class="content">
<pre>ip irdp minadvertinterval &lt;seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Set the IRDP preference level of the device</div>
<div class="content">
<pre>(config-if)# ip irdp preference &lt;number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify an IRDP address and preference to proxy-advertise</div>
<div class="content">
<pre>(config-if)# ip irdp address &lt;a.b.c.d&gt; &lt;preference-level&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ipv6_ra_rs">22.5. IPv6 RA/RS</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_multicast_2">23. Multicast</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_igmp">23.1. IGMP</h3>
<div class="paragraph">
<p><span class="menuseq"><span class="menu">Configuration guides</span>&#160;&#9656; <span class="submenu">Multicast</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipmulti_igmp/configuration/15-mt/imc-igmp-15-mt-book.htm">IGMP</span></span> </a></p>
</div>
<div class="paragraph">
<p>Check also
<a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750x_3560x/software/release/15-0_2_se/configuration/guide/3750x_cg/swigmp.html#pgfId-1027678">Catalyst configuration guides</a></p>
</div>
<div class="sect3">
<h4 id="_concepts_7">23.1.1. Concepts</h4>
<div class="ulist">
<ul>
<li>
<p>Group membership protocol used by hosts to inform routers and multilayer switches of the
existence of members on their directly connected networks and to allow them to send and receive multicast datagrams.</p>
</li>
<li>
<p>IP protocol number: 2</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_messages">23.1.2. Messages</h4>
<div class="ulist">
<ul>
<li>
<p>membership queries:</p>
<div class="ulist">
<ul>
<li>
<p>general:  sent to 224.0.0.1 (all systems on a subnet)</p>
</li>
<li>
<p>group-specific: sent to the group</p>
</li>
</ul>
</div>
</li>
<li>
<p>membership reports</p>
<div class="ulist">
<ul>
<li>
<p>sollicited: sent to the group in v2, sent to 224.0.0.22 in v3</p>
</li>
<li>
<p>unsollicited</p>
</li>
</ul>
</div>
</li>
<li>
<p>Leave Group messages</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_default_igmp_configuration">23.1.3. Default IGMP configuration</h4>
<table class="tableblock frame-none grid-rows spread">
<colgroup>
<col style="width: 54.5454%;">
<col style="width: 45.4546%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Default Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version 2 on all interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP query timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60 seconds on all interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP maximum query response time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 seconds on all interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multilayer switch as a member of a multicast group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No group memberships are defined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to multicast groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All groups are allowed on an interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP host-query message interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60 seconds on all interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multilayer switch as a statically connected member</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Display multicast-related information about an interface.</div>
<div class="content">
<pre># show ip igmp interface [interface-id]</pre>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_version">IGMP version</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">v1</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>general membership queries</p>
</li>
<li>
<p>join</p>
</li>
<li>
<p>implicit leave</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">v2</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>group-specific queries</p>
</li>
<li>
<p>explicit leave group process</p>
</li>
<li>
<p>explicit max response time field</p>
</li>
<li>
<p>querier election'</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">v3</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>source filtering</p>
</li>
<li>
<p>uses 224.0.0.22 for membership reports</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Task: Specify the IGMP version</div>
<div class="content">
<pre>(config-if)# ip igmp version {1 | 2 | 3}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Return to the default version</div>
<div class="content">
<pre>(config-if)# no ip igmp version</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you change to version 1, you cannot configure the <strong>ip igmp query-interval</strong> or the <strong>ip igmp query-max-response-time</strong> interface configuration
commands.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_querier_election">Querier election</h5>
<div class="ulist">
<ul>
<li>
<p>Each IGMPv2 router sends general query message to 224.0.0.1 with its interface source address.</p>
</li>
<li>
<p>The router stops upon receiption of query messages with lowest IP address
&#8594; The router with the lowest IP address wins</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_igmpv2_query_timeout">IGMPv2 query timeout</h5>
<div class="ulist">
<ul>
<li>
<p>period of time before the multilayer switch takes over as the querier for the interface.</p>
</li>
<li>
<p>By default, the switch waits twice the query interval. After that time, if the switch has received no queries, it becomes the querier.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ip igmp querier-timeout &lt;60-300-seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_maximum_response_time_field">Maximum response time field</h5>
<div class="ulist">
<ul>
<li>
<p>v1, fixed at 10 seconds</p>
</li>
<li>
<p>v2, can be changed to control the burstiness of the response process especially with large number of active routers.
  Note that increasing the maximum response timer value also increases the leave
latency; the query router must now wait longer to make sure there are no more
hosts for the group on the subnet.</p>
</li>
<li>
<p>Default:10 seconds, range: 1..25.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task:Change the maximum response time field</div>
<div class="content">
<pre>(config-if)# ip igmp query-max-response-time &lt;seconds&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_join_the_club">23.1.4. Join the club</h4>
<div class="listingblock">
<div class="title">Task: Join a specified group</div>
<div class="content">
<pre>(config-if)# ip igmp join-group &lt;address&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Join a specified (S,G) channel</div>
<div class="content">
<pre>(config-if)# ip igmp join-group &lt;address&gt; source &lt;a.b.c.d&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display the multicast groups that are directly connected to the multilayer switch and that were learned through IGMP.</div>
<div class="content">
<pre># sh ip igmp groups [group-name | group-address | type number]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Forward multicast packet without accepting them</div>
<div class="content">
<pre>(config-if)# ip igmp static-group</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This method allows fast switching.
The outgoing interface appears in the IGMP cache,
but the switch itself is not a member,
as evidenced by lack of an L (local) flag in the multicast route entry.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ip igmp static-group</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_leave_process">23.1.5. Leave process</h4>
<div class="ulist">
<ul>
<li>
<p>in v1, implicit exit</p>
</li>
<li>
<p>in v2,</p>
<div class="ulist">
<ul>
<li>
<p>host send leave group message to group address,</p>
</li>
<li>
<p>querier send <strong>igmp-last-member-query-count</strong> group-specific queries at <strong>igmp-last-member-interval</strong> milliseconds</p>
</li>
<li>
<p>querier stops forwarding for the group if no reply within timeout period</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Specify the last member query interval</div>
<div class="content">
<pre>(config-if)# ip igmp last-member-query-interval &lt;milliseconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the last member query count</div>
<div class="content">
<pre>(config-if)# ip igmp last-member-query-count &lt;1-7&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Minimize the leave latency when only one IGMPv2 receiver is connected to the interface</div>
<div class="content">
<pre>(config-if)# ip igmp immediate-leave group-list &lt;acl&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Can also be in global mode but not combined with the interface mode
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_igmp_message_restriction">23.1.6. IGMP message restriction</h4>
<div class="listingblock">
<div class="title">Task: Restrict receivers on a subnet to join only certain multicast groups</div>
<div class="content">
<pre>(config-if)# ip igmp access-group &lt;standard-acl&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Restrict receivers on a subnet to join  multicast groups from specific sources</div>
<div class="content">
<pre>(config-if)# ip igmp access-group &lt;extended-acl&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_igmp_proxy">23.1.7. IGMP proxy</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="_igmp_snooping">23.1.8. IGMP snooping</h4>
<div class="ulist">
<ul>
<li>
<p>Problem: L2 switch forwards multicast packets to all interfaces &#8594; wasted traffic</p>
</li>
<li>
<p>Solution: Tracks IGMP messages (Join/Leave) to only forward invites to interested parties.</p>
<div class="ulist">
<ul>
<li>
<p>Add ports when receiving Join message</p>
</li>
<li>
<p>Delete ports when Leave messages or no membership reports from clients</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 11. Default IGMP snooping configuration</caption>
<colgroup>
<col style="width: 54.5454%;">
<col style="width: 45.4546%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Default Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP snooping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled globally and per VLAN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast routers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None configured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast router learning method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIM-DVMRP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP snooping Immediate Leave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None configured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCN flood query count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCN query solicitation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP snooping querier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IGMP report suppression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Task: Display IGMP snooping information</div>
<div class="content">
<pre># sh ip igmp snooping</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Disable IGMP snooping globally</div>
<div class="content">
<pre>(config)# no ip igmp snooping</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable VLAN snooping</div>
<div class="content">
<pre>(config)# ip igmp snooping vlan &lt;1-1001,1006-4094&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Change the snooping method</div>
<div class="content">
<pre>(config)# ip igmp snooping vlan &lt;vlan-id&gt; mrouter learn {cgmp | pim-dvmrp}</pre>
</div>
</div>
<div class="sect4">
<h5 id="_multicast_router_port">Multicast router port</h5>
<div class="listingblock">
<div class="title">Task: Add a multicast router port</div>
<div class="content">
<pre>(config)# ip igmp snooping vlan &lt;id&gt; mrouter interface &lt;type-number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify that IGMP snooping is enabled on the VLAN interface</div>
<div class="content">
<pre>(config)# sh ip igmp snooping mrouter vlan &lt;id&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_statically_join_a_group">Statically join a group</h5>
<div class="listingblock">
<div class="title">Task: Add a L2 port to join a group</div>
<div class="content">
<pre>ip igmp snooping vlan &lt;vlan-id&gt; static &lt;ip-address&gt; interface &lt;type number&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hosts or L2 ports normally join multicast groups dynamically
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Verify the member port and the IP address</div>
<div class="content">
<pre># sh ip igmp snooping groups</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_immediate_leave">IGMP immediate leave</h5>
<div class="listingblock">
<div class="title">Task: Remove a port immediately when it detects an IGMPv2 leave message</div>
<div class="content">
<pre>(config)# ip igmp snooping vlan &lt;id&gt; immediate-leave</pre>
</div>
</div>
<div class="sect5">
<h6 id="_igmp_leave_timer">IGMP leave Timer</h6>
<div class="listingblock">
<div class="title">Task: configure the IGMP leave timer globally</div>
<div class="content">
<pre>ip igmp snooping last-member-query-interval &lt;milliseconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: configure the IGMP leave timer on the VLAN interface</div>
<div class="content">
<pre>ip igmp snooping vlan &lt;id&gt; last-member-query-interval &lt;milliseconds&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_tcn_events">TCN Events</h5>
<div class="ulist">
<ul>
<li>
<p>when the client changed its loaction and the receiver is on smae port that was blocked but is now forwarding,</p>
</li>
<li>
<p>when a port went down without sending a leave message.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Control the multicast flooding time after a TCN event</div>
<div class="content">
<pre>(config)# ip igmp snooping tcn flood query count &lt;1-2-10&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Speed the process of recovering from the flood mode caused by a TCN event.</div>
<div class="content">
<pre>(config)# ip igmp snooping tcn query solicit</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>When a topology change occurs, the spanning-tree root sends a IGMP global leave with group 0.0.0.0.</p>
</li>
<li>
<p>however, after <strong>ip igmp snooping tcn query solicit</strong> command,
the switch sneds the global leave message whether or not it is the spanning-tree root.</p>
</li>
<li>
<p>When the router receives this special leave, it immediately sends general queries,
which expedite the process of recovering from the flood mode during the TCN event.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Disable the flooding of multicast traffic during a TCN event</div>
<div class="content">
<pre>(config-if)# no ip igmp snooping tcn flood</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>When the swith receives a TCN, multicast traffic is flooded to all the ports until 2 general queries are received.</p>
</li>
<li>
<p>If the switch has many ports with attached hosts subscribed to many groups,
this flooding might exceed the capacity of the link and cause packet loss.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_snooping_querier">IGMP snooping querier</h5>
<div class="listingblock">
<div class="title">Task: Enable IGMP snooping querier</div>
<div class="content">
<pre>(config)# ip igmp snooping querier
(config)# ip igmp snooping querier address &lt;ip.ad.re.ss&gt;
(config)# ip igmp snooping querier query-interval &lt;seconds&gt;
(config)# ip igmp snooping querier tcn query [count &lt;n&gt; | interval &lt;seconds&gt;]
(config)# ip igmp snooping querier timer expiry &lt;seconds&gt;
(config)# ip igmp snooping querier version {1 | 2}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display information about the IP address and receiving port for the most-recently received IGMP query in the VLAN</div>
<div class="content">
<pre># sh ip igmp snooping querier [vlan &lt;id&gt;] [detail]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_report_suppression">IGMP report suppression</h5>
<div class="listingblock">
<div class="title">Task: Disable IGMP report suppression</div>
<div class="content">
<pre>(config)# no ip igmp snooping report-suppression</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mvr">23.1.9. MVR</h4>
<div class="ulist">
<ul>
<li>
<p>Multicast VLAN Registration</p>
</li>
<li>
<p>Problem: How to scale multicast traffic accross an Ethernet ring-based SP network</p>
</li>
<li>
<p>Solution : one multicast VLAN shared with subscribers in seperate VLANs</p>
</li>
<li>
<p>Use case: broadcast of multiple TV channels over a service-provider network</p>
</li>
<li>
<p>works with or without IGMP snooping</p>
<div class="ulist">
<ul>
<li>
<p>If both enabled, MVR reacts only to join and leave messages from MVR groups.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 12. Default MVR configuration</caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Default Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled globally and per interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None configured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query response time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5 second</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast VLAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VLAN 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compatible</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface (per port) default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Neither a receiver nor a source port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immediate Leave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled on all ports</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_mvr_global_parameters">MVR global parameters</h5>
<div class="listingblock">
<div class="title">Task: Enable MVR on the switch</div>
<div class="content">
<pre>(config)# mvr</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure a range of IP multicast address on the switch</div>
<div class="content">
<pre>(config)# mvr group &lt;ip-address&gt; [count]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <strong>count</strong> parameter configure a contiguous series of MVR group addresses. Default= 1 in 1..256</p>
</li>
<li>
<p>Any multicast data sent to the ip address  corresponding to one TV channel
is sent to all source ports on the switch and all interested receiver ports.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Define the maximum time to wait for IGMP report memberships on a receiver port</div>
<div class="content">
<pre>(config)# mvr querytime &lt;tenths-of-seconds&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the VLAN in which multicast data is received</div>
<div class="content">
<pre>(config)# mvr vlan &lt;vlan-id&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>All source ports must belong to this VLAN</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Specify the MVR mode of operation</div>
<div class="content">
<pre>(config)# mvr mode { dynamic | compatible }</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><strong>dynamic</strong>: allows dynamic MVR memberships on source ports.</p>
</li>
<li>
<p><strong>compatible</strong> is the default and does not support ICMP dynamic joins on source ports.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Verify the MVR global configuration</div>
<div class="content">
<pre>(config)# sh mvr
(config)# sh mvr members</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mvr_interfaces">MVR interfaces</h5>
<div class="listingblock">
<div class="title">Task: configure an MVR port as source</div>
<div class="content">
<pre>(config-if)# mvr type source</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Configure uplinks ports that receive and send multicast data as source ports</p>
</li>
<li>
<p>Subscribers cannot be directly connected to source ports</p>
</li>
<li>
<p>All source ports on a switc belong to the single multicast VLAN.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: configure an MVR port as receiver</div>
<div class="content">
<pre>(config-if)# mvr type receiver</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Configure a port as a receiver port if it is a subscriber port and should only recieve multicast data.</p>
</li>
<li>
<p>Receiver ports do not receive data unless it becomes a member of the multicast group.</p>
</li>
<li>
<p>Receiver ports cannot belongs to the multicast VLAN.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Task: Statically configure a port to receive multicast traffic</div>
<div class="content">
<pre>(config)# mvr vlan &lt;id&gt; group &lt;ip-address&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Enable the Immediate-Leave feature of MVR on the receiver port</div>
<div class="content">
<pre>(config)# mvr immediate</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the MVR interface configuration</div>
<div class="content">
<pre># sh mvr interface</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Display all receiver and source ports that are members of a multicast group</div>
<div class="content">
<pre># sh mvr members [group-ip-address]</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_igmp_filtering_and_throttling">23.1.10. IGMP filtering and throttling</h4>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 13. Default IGMP filtering configuration</caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Default Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none applied</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none defined</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profile action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deny the range addresses</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_igmp_profiles">IGMP profiles</h5>
<div class="listingblock">
<div class="title">Task: Configure an IGMP profile</div>
<div class="content">
<pre>(config)# ip igmp profile &lt;number&gt;
(config-igmp-profile)# permit | deny
(config-igmp-profile)# range &lt;low-ip-address&gt; [&lt;high-ip-address&gt;]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Apply IGMP profile to an interface</div>
<div class="content">
<pre>(config)# ip igmp filter &lt;profile-number&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify the profile configuration</div>
<div class="content">
<pre># sh ip igmp profile &lt;number&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_igmp_throttling">IGMP throttling</h5>
<div class="listingblock">
<div class="title">Task: Set the maximum number of IGMP groups that the interface can join</div>
<div class="content">
<pre>(config-if)# ip igmp max-groups &lt;count&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Specify the action that the interface takes when it reaches the maximum number of entries and receives a new IGMP report</div>
<div class="content">
<pre>(config-if)# ip igmp max-groups action {deny | replace }</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pim">23.2. PIM</h3>
<div class="sect3">
<h4 id="_understanding">23.2.1. Understanding</h4>
<div class="ulist">
<ul>
<li>
<p>protocol-independent</p>
<div class="ulist">
<ul>
<li>
<p>relies on unicast routing table to perform RPF check</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_versions">Versions</h5>
<div class="sect5">
<h6 id="_pimv1">PIMv1</h6>
<div class="ulist">
<ul>
<li>
<p>Introduced in IOS 11.1(6)</p>
</li>
<li>
<p>Support Auto-RP : eliminates the need to manually configure the rendezvous point in every router.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_pimv2">PIMv2</h6>
<div class="ulist">
<ul>
<li>
<p>Default version since IOS 11.3</p>
</li>
<li>
<p>Support BSR (boot strap router) capability.</p>
</li>
<li>
<p>A single, active RP exists per multicast group, with multiple backup RPs. This single RP compares to multiple active RPs for the same group in PIMv1.</p>
</li>
<li>
<p>A BSR provides a fault-tolerant, automated RP discovery and distribution mechanism that enables routers and multilayer switches to dynamically learn the group-to-RP mappings.</p>
</li>
<li>
<p>Sparse mode and dense mode are properties of a group, as opposed to an interface. We strongly recommend sparse-dense mode, as opposed to either sparse mode or dense mode only.</p>
</li>
<li>
<p>PIM join and prune messages have more flexible encoding for multiple address families.</p>
</li>
<li>
<p>A more flexible hello packet format replaces the query packet to encode current and future capability options.</p>
</li>
<li>
<p>Register messages to an RP specify whether they are sent by a border router or a designated router.</p>
</li>
<li>
<p>PIM packets are no longer inside IGMP packets; they are standalone packets.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_modes_3">Modes</h5>
<div class="paragraph">
<p>PIM can operate in dense mode (DM), sparse mode (SM), or in sparse-dense mode
(PIM DM-SM), which handles both sparse groups and dense groups at the same
time.</p>
</div>
<div class="sect5">
<h6 id="_pim_dm">PIM DM</h6>
<div class="paragraph">
<p>In dense mode, a PIM DM router  assumes that all other
routers es forward multicast packets for a group. If a PIM
DM device receives a multicast packet and has no directly connected members or
PIM neighbors present, a prune message is sent back to the source. Subsequent
multicast packets are not flooded to this router or switch on this pruned
branch. PIM DM builds source-based multicast distribution trees.</p>
</div>
<div class="paragraph">
<p>The simplest form of a multicast distribution tree is a source tree whose root
is the source of the multicast traffic and whose branches form a spanning tree
through the network to the receivers. Because this tree uses the shortest path
through the network, it is also referred to as a shortest-path tree (SPT). A
separate SPT exists for every individual source sending to each group. The
special notation of (S,G) (pronounced S comma G) identifies an SPT where S is
the IP address of the source and G is the multicast group address.</p>
</div>
<div class="paragraph">
<p><a href="#x1">Host A Shortest-Path Tree</a> shows an example of SPT for group 224.1.1.1 rooted at the source,
Host A, and connecting two receivers, Hosts B and C. The SPT notation for this
group would be (194.1.1.1, 224.1.1.1).</p>
</div>
<div id="x1" class="imageblock">
<div class="content">
<img src="../images/pim-shortest-path-tree.png" alt="pim shortest path tree">
</div>
<div class="title">Figure 30. Host A Shortest-Path Tree</div>
</div>
<div class="paragraph">
<p>If Host B is also sending traffic to group 224.1.1.1 and Hosts A and C are
receivers, then a separate (S,G) SPT would exist with the notation of
(194.2.2.2, 224.1.1.1).</p>
</div>
<div class="paragraph">
<p>PIM DM employs only SPTs to deliver (S,G) multicast traffic by using a flood
and prune method. It assumes that every subnet in the network has at least one
receiver of the (S,G) multicast traffic, and therefore the traffic is flooded
to all points in the network.</p>
</div>
<div class="paragraph">
<p>To avoid unnecessary consumption of network resources, PIM DM devices send
prune messages up the source distribution tree to stop unwanted multicast
traffic. Branches without receivers are pruned from the distribution tree,
leaving only branches that contain receivers. Prunes have a timeout value
associated with them, after which the PIM DM device puts the interface into the
forwarding state and floods multicast traffic out the interface. When a new
receiver on a previously pruned branch of the tree joins a multicast group, the
PIM DM device detects the new receiver and immediately sends a graft message up
the distribution tree toward the source. When the upstream PIM DM device
receives the graft message, it immediately puts the interface on which the
graft was received into the forwarding state so that the multicast traffic
begins flowing to the receiver.</p>
</div>
</div>
<div class="sect5">
<h6 id="_pim_sm">PIM SM</h6>
<div class="paragraph">
<p>PIM SM uses shared trees and SPTs to distribute multicast traffic to multicast receivers in the network.</p>
</div>
<div class="paragraph">
<p>In PIM SM, a router  assumes that other routers or switches
do not forward multicast packets for a group, unless there is an explicit
request for the traffic (join message). When a host joins a multicast group
using IGMP, its directly connected PIM SM device sends PIM join messages toward
the root, also known as the RP. This join message travels router-by-router
toward the root, constructing a branch of the shared tree as it goes. The RP
keeps track of multicast receivers; it also registers sources through register
messages received from the source&#8217;s first-hop router (designated router [DR])
to complete the shared tree path from the source to the receiver. The branches
of the shared tree are maintained by periodic join refresh messages that the
PIM SM devices send along the branch.</p>
</div>
<div class="paragraph">
<p>When using a shared tree, sources must send their traffic to the RP so that the
traffic reaches all receivers. The special notation *,G, (pronounced star comma
G) is used to represent the tree, where * means all sources and G represents
the multicast group. Figure <a href="#pim-shared-distribution-tree">Shared Distribution Tree</a> shows a shared tree for group 224.2.2.2 with
the RP located at Router 3. Multicast group traffic from source Hosts A and D
travels to the RP (Router 3) and then down the shared tree to two receivers,
Hosts B and C. Because all sources in the multicast group use a common shared
tree, the special notation (*, 224.2.2.2) describes this shared tree.</p>
</div>
<div id="pim-shared-distribution-tree" class="imageblock">
<div class="content">
<img src="../images/pim-shared-distribution-tree.png" alt="pim shared distribution tree">
</div>
<div class="title">Figure 31. Shared Distribution Tree</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In addition to using the shared distribution tree, PIM SM can also use
SPTs. By joining an SPT, multicast traffic is routed directly to the receivers
without having to go through the RP, thereby reducing network latency and
possible congestion at the RP. The disadvantage is that PIM SM devices must
create and maintain (S,G) state entries in their routing tables along with the
(S,G) SPT. This action consumes router resources.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Prune messages are sent up the distribution tree to prune multicast group
traffic. This action permits branches of the shared tree or SPT that were
created with explicit join messages to be torn down when they are no longer
needed. For example, if a leaf router (a router without any downstream
connections) detects that it no longer has any directly connected hosts (or
downstream multicast routers) for a particular multicast group, it sends a
prune message up the distribution tree to stop the flow of unwanted multicast
traffic.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_shared_tree_vs_source_tree">Shared tree vs Source tree</h5>
<div class="paragraph">
<p>By default, members of a group receive data from senders to the group across a
single data-distribution tree rooted at the RP. Figure <a href="#pim_tree">PIM trees</a> shows this type of
shared-distribution tree. Data from senders is delivered to the RP for
distribution to group members joined to the shared tree.</p>
</div>
<div id="pim_tree" class="imageblock">
<div class="content">
<img src="../images/pim-trees.png" alt="pim trees">
</div>
<div class="title">Figure 32. PIM trees</div>
</div>
<div class="paragraph">
<p>If the data rate warrants, leaf routers (routers without any downstream
connections) on the shared tree can use the data distribution tree rooted at
the source. This type of distribution tree is called a shortest-path tree or
source tree. By default, the IOS software switches to a source tree upon
receiving the first data packet from a source.</p>
</div>
<div class="paragraph">
<p>This process describes the move from a shared tree to a source tree:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A receiver joins a group; leaf Router C sends a join message toward the RP.</p>
</li>
<li>
<p>The RP puts a link to Router C in its outgoing interface list.</p>
</li>
<li>
<p>A source sends data; Router A encapsulates the data in a register message
and sends it to the RP.</p>
</li>
<li>
<p>The RP forwards the data down the shared tree to Router C and sends a join
message toward the source. At this point, data might arrive twice at Router C,
once encapsulated and once natively.</p>
</li>
<li>
<p>When data arrives natively (unencapsulated) at the RP, it sends a
register-stop message to Router A.</p>
</li>
<li>
<p>By default, reception of the first data packet prompts Router C to send a
join message toward the source.</p>
</li>
<li>
<p>When Router C receives data on (S,G), it sends a prune message for the
source up the shared tree.</p>
</li>
<li>
<p>The RP deletes the link to Router C from the outgoing interface of (S,G).
The RP triggers a prune message toward the source.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Join and prune messages are sent for sources and RPs. They are sent hop-by-hop
and are processed by each PIM device along the path to the source or RP.
Register and register-stop messages are not sent hop-by-hop. They are sent by
the designated router that is directly connected to a source and are received
by the RP for the group.</p>
</div>
<div class="paragraph">
<p>Multiple sources sending to groups use the shared tree.</p>
</div>
<div class="paragraph">
<p>You can configure the PIM device to stay on the shared tree.</p>
</div>
</div>
<div class="sect4">
<h5 id="_auto_rp">Auto-RP</h5>
<div class="paragraph">
<p>This proprietary feature eliminates the need to manually configure the
rendezvous point (RP) information in every router and multilayer switch in the
network.  Auto-RP uses IP multicast to automate the distribution of group-to-RP mappings
to all Cisco routers and multilayer switches in a PIM network.</p>
</div>
<div class="paragraph">
<p>It has these benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is easy to use multiple RPs within a network to serve different group
ranges.</p>
</li>
<li>
<p>It allows load splitting among different RPs and arrangement of RPs according
to the location of group participants.</p>
</li>
<li>
<p>It avoids inconsistent, manual RP configurations on every router and
multilayer switch in a PIM network, which can cause connectivity problems.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Auto-RP to work, you configure a Cisco router
as the <strong>mapping agent</strong>. It uses IP multicast to learn which routers or switches
in the network are possible candidate RPs by joining the well-known
Cisco-RP-announce multicast group (224.0.1.39) to receive candidate RP
announcements. Candidate RPs send multicast RP-announce messages to a
particular group or group range every 60 seconds (default) to announce their
availability. Each RP-announce message contains a holdtime that tells the
mapping agent how long the candidate RP announcement is valid. The default is
180 seconds.</p>
</div>
<div class="paragraph">
<p>Mapping agents listen to these candidate RP announcements and use the
information to create entries in their Group-to-RP mapping caches. Only one
mapping cache entry is created for any Group-to-RP range received, even if
multiple candidate RPs are sending RP announcements for the same range. As the
RP-announce messages arrive, the mapping agent selects the router or switch
with the highest IP address as the active RP and stores this RP address in the
Group-to-RP mapping cache.</p>
</div>
<div class="paragraph">
<p>Mapping agents multicast the contents of their Group-to-RP mapping cache in
RP-discovery messages every 60 seconds (default) to the Cisco-RP-discovery
multicast group (224.0.1.40), which all Cisco PIM routers and multilayer
switches join to receive Group-to-RP mapping information. Thus, all routers and
switches automatically discover which RP to use for the groups they support.
The discovery messages also contain a holdtime, which defines how long the
Group-to-RP mapping is valid. If a router or switch fails to receive
RP-discovery messages and the Group-to-RP mapping information expires, it
switches to a statically configured RP that was defined with the <strong>ip pim
rp-address</strong> global configuration command. If no statically configured RP exists,
the router or switch changes the group to dense-mode operation.</p>
</div>
<div class="paragraph">
<p>Multiple RPs serve different group ranges or serve as hot backups of each
other.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bootstrap_router">Bootstrap Router</h5>
<div class="paragraph">
<p>PIMv2 BSR is another method to distribute group-to-RP mapping information to
all PIM routers and multilayer switches in the network. It eliminates the need
to manually configure RP information in every router and switch in the network.
However, instead of using IP multicast to distribute group-to-RP mapping
information, BSR uses hop-by-hop flooding of special BSR messages to distribute
the mapping information.</p>
</div>
<div class="paragraph">
<p>The BSR is elected from a set of candidate routers and switches in the domain
that have been configured to function as BSRs. The election mechanism is
similar to the root-bridge election mechanism used in bridged LANs. The BSR
election is based on the BSR priority of the device contained in the BSR
messages that are sent hop-by-hop through the network. Each BSR device examines
the message and forwards out all interfaces only the message that has either a
higher BSR priority than its BSR priority or the same BSR priority, but with a
higher BSR IP address. Using this method, the BSR is elected.</p>
</div>
<div class="paragraph">
<p>The elected BSR sends BSR messages to the all-PIM-routers multicast group
(224.0.0.13) with a TTL of 1. Neighboring PIMv2 routers es
receive the BSR message and multicast it out all other interfaces (except the
one on which it was received) with a TTL of 1. In this way, BSR messages travel
hop-by-hop throughout the PIM domain. Because BSR messages contain the IP
address of the current BSR, the flooding mechanism allows candidate RPs to
automatically learn which device is the elected BSR.</p>
</div>
<div class="paragraph">
<p>Candidate RPs send candidate RP advertisements showing the group range for
which they are responsible directly to the BSR, which stores this information
in its local candidate-RP cache. The BSR periodically advertises the contents
of this cache in BSR messages to all other PIM devices in the domain. These
messages travel hop-by-hop through the network to all routers and switches,
which store the RP information in the BSR message in their local RP cache. The
routers and switches select the same RP for a given group because they all use
a common RP hashing algorithm.</p>
</div>
<div class="sect5">
<h6 id="_multicast_forwarding_and_reverse_path_check">Multicast Forwarding and Reverse Path Check</h6>
<div class="paragraph">
<p>With unicast routing, routers and multilayer switches forward traffic through
the network along a single path from the source to the destination host whose
IP address appears in the destination address field of the IP packet. Each
router and switch along the way makes a unicast forwarding decision, using the
destination IP address in the packet, by looking up the destination address in
the unicast routing table and forwarding the packet through the specified
interface to the next hop toward the destination.</p>
</div>
<div class="paragraph">
<p>With multicasting, the source is sending traffic to an arbitrary group of hosts
represented by a multicast group address in the destination address field of
the IP packet. To determine whether to forward or drop an incoming multicast
packet, the router  uses a <strong>reverse path forwarding</strong> (RPF)
check on the packet as follows and shown in Figure <a href="#rpf">RPF Check</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The router  examines the source address of the arriving
multicast packet to determine whether the packet arrived on an interface that
is on the reverse path back to the source.</p>
</li>
<li>
<p>If the packet arrives on the interface leading back to the source, the RPF
check is successful and the packet is forwarded to all interfaces in the
outgoing interface list (which might not be all interfaces on the router).</p>
</li>
<li>
<p>If the RPF check fails, the packet is discarded.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Some multicast routing protocols, such as DVMRP, maintain a separate multicast
routing table and use it for the RPF check. However, PIM uses the unicast
routing table to perform the RPF check.</p>
</div>
<div class="paragraph">
<p>Figure <a href="#rpf">RPF Check</a> shows Gigabit Ethernet interface 0/2 receiving a multicast packet from source 151.10.3.21. A check of the routing table shows that the interface on the reverse path to the source is Gigabit Ethernet interface 0/1, not interface 0/2. Because the RPF check fails, the multilayer switch discards the packet. Another multicast packet from source 151.10.3.21 is received on interface 0/1, and the routing table shows this interface is on the reverse path to the source. Because the RPF check passes, the switch forwards the packet to all interfaces in the outgoing interface list.</p>
</div>
<div id="rpf" class="imageblock">
<div class="content">
<img src="../images/pim-rpf-check.png" alt="pim rpf check">
</div>
<div class="title">Figure 33. RPF Check</div>
</div>
<div class="paragraph">
<p>PIM uses both source trees and RP-rooted shared trees to forward datagrams ; the RPF check is performed differently for each:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a PIM router  has a source-tree state (that is, an (S,G) entry is present in the multicast routing table), it performs the RPF check against the IP address of the source of the multicast packet.</p>
</li>
<li>
<p>If a PIM router  has a shared-tree state (and no explicit source-tree state), it performs the RPF check on the rendezvous point (RP) address (which is known when members join the group).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sparse-mode PIM uses the RPF lookup function to determine where it needs to send joins and prunes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(S,G) joins (which are source-tree states) are sent toward the source.</p>
</li>
<li>
<p>(*,G) joins (which are shared-tree states) are sent toward the RP.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DVMRP and dense-mode PIM use only source trees and use RPF as previously described.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_neighbor_discovery_2">Neighbor Discovery</h5>
<div class="paragraph">
<p>PIM uses a neighbor discovery mechanism to establish PIM neighbor adjacencies.
To establish adjacencies, a PIM router  sends PIM hello
messages to the all-PIM-routers multicast group (224.0.0.13) on each of its
multicast-enabled interfaces. The hello message contains a holdtime, which
tells the receiver when the neighbor adjacency associated with the sender
expires if no more PIM hello messages are received. Keeping track of
adjacencies is important for PIM DM operation for building the source
distribution tree.</p>
</div>
<div class="paragraph">
<p>PIM hello messages are also used to elect the DR for multi-access networks
(Ethernet). The router  on the network with the highest IP
address is the DR. With PIM DM operation, the DR has meaning only if IGMPv1 is
in use; IGMPv1 does not have an IGMP querier election process, so the elected
DR functions as the IGMP querier. In PIM SM operation, the DR is the router or
switch that is directly connected to the multicast source. It sends PIM
register messages to notify the RP that multicast traffic from a source needs
to be forwarded down the shared tree.</p>
</div>
</div>
<div class="sect4">
<h5 id="_pimv1_and_pimv2_interoperability">PIMv1 and PIMv2 interoperability</h5>
<div class="paragraph">
<p>The Cisco PIMv2 implementation allows interoperability and transition between
Version 1 and Version 2, although there might be some minor problems.</p>
</div>
<div class="paragraph">
<p>You can upgrade to PIMv2 incrementally. PIM Versions 1 and 2 can be configured
on different routers and multilayer switches within one network. Internally,
all routers and multilayer switches on a shared media network must run the same
PIM version. Therefore, if a PIMv2 device detects a PIMv1 device, the Version 2
device downgrades itself to Version 1 until all Version 1 devices have been
shut down or upgraded.</p>
</div>
<div class="paragraph">
<p>PIMv2 uses the BSR to discover and announce RP-set information for each group
prefix to all the routers and multilayer switches in a PIM domain. PIMv1,
together with the Auto-RP feature, can perform the same tasks as the PIMv2 BSR.
However, Auto-RP is a standalone protocol, separate from PIMv1, and is a
proprietary Cisco protocol. PIMv2 is a standards track protocol in the IETF. We
recommend that you use PIMv2. The BSR mechanism interoperates with Auto-RP on
Cisco routers and multilayer switches.</p>
</div>
<div class="paragraph">
<p>When PIMv2 devices interoperate with PIMv1 devices, Auto-RP should have already
been deployed. A PIMv2 BSR that is also an Auto-RP mapping agent automatically
advertises the RP elected by Auto-RP. That is, Auto-RP sets its single RP on
every router  in the group. Not all routers and switches in
the domain use the PIMv2 hash function to select multiple RPs.</p>
</div>
<div class="paragraph">
<p>Dense-mode groups in a mixed PIMv1 and PIMv2 region need no special
configuration; they automatically interoperate.</p>
</div>
<div class="paragraph">
<p>Sparse-mode groups in a mixed PIMv1 and PIMv2 region are possible because the
Auto-RP feature in PIMv1 interoperates with the PIMv2 RP feature. Although all
PIMv2 devices can also use PIMv1, we recommend that the RPs be upgraded to
PIMv2 (or at least upgraded to PIMv1 in the Cisco IOS Release 11.3 software).
To ease the transition to PIMv2, we have these recommendations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use Auto-RP throughout the region.</p>
</li>
<li>
<p>Configure sparse-dense mode throughout the region.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_auto_rp_and_bsr_configuration_guidelines">Auto-RP and BSR configuration guidelines</h5>
<div class="paragraph">
<p>There are two approaches to using PIMv2. You can use Version 2 exclusively in
your network or migrate to Version 2 by employing a mixed PIM version
environment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If your network is all Cisco routers and multilayer switches, you can use
either Auto-RP or BSR.</p>
</li>
<li>
<p>If you have non-Cisco routers in your network, you must use BSR.</p>
</li>
<li>
<p>If you have Cisco PIMv1 and PIMv2 routers and multilayer switches and
non-Cisco routers, you must use both Auto-RP and BSR.</p>
</li>
<li>
<p>Because bootstrap messages are sent hop-by-hop, a PIMv1 device prevents these
messages from reaching all routers and multilayer switches in your network.
Therefore, if your network has a PIMv1 device in it and only Cisco routers and
multilayer switches, it is best to use Auto-RP.</p>
</li>
<li>
<p>If you have a network that includes non-Cisco routers, configure the Auto-RP
mapping agent and the BSR on a Cisco PIMv2 router . Ensure
that no PIMv1 device is on the path between the BSR and a non-Cisco PIMv2
router.</p>
</li>
<li>
<p>If you have non-Cisco PIMv2 routers that need to interoperate with Cisco PIMv1
routers and multilayer switches, both Auto-RP and a BSR are required. We
recommend that a Cisco PIMv2 device be both the Auto-RP mapping agent and the
BSR.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_tasks_5">23.2.2. Configuration tasks</h4>
<div class="sect4">
<h5 id="_configure_basic_multicast_routing">Configure basic multicast routing</h5>
<div class="paragraph">
<p>You must enable IP multicast routing and configure the PIM version and PIM mode
so that the IOS software can forward multicast packets and determine how the
multilayer switch populates its multicast routing table.</p>
</div>
<div class="paragraph">
<p>You can configure an interface to be in PIM dense mode, sparse mode, or
sparse-dense mode. The mode determines how the switch populates its multicast
routing table and how it forwards multicast packets it receives from its
directly connected LANs. You must enable PIM in one of these modes for an
interface to perform IP multicast routing. Enabling PIM on an interface also
enables IGMP operation on that interface.</p>
</div>
<div class="paragraph">
<p>By default, multicast routing is disabled, and there is no default mode
setting. The following procedure is required.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable IP multicast forwarding</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ip multicast-routing</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter interface configuration mode, and specify the Layer 3 interface on which you want to enable multicast routing.
The specified interface must be one of the following:</p>
<div class="ulist">
<ul>
<li>
<p>A routed port: a physical port that has been configured as a Layer 3 port by entering the no <strong>switchport interface</strong> configuration command.</p>
</li>
<li>
<p>An SVI: a VLAN interface created by using the <strong>interface vlan vlan-id</strong> global configuration command.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These ports must have IP addresses assigned to them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>interface &lt;interface-id&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the PIM version on the interface. By default, version 2 is enabled and is the recommended setting.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ip pim version [1|2]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable a PIM mode on the interface.  By default, no mode is configured.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# pim {dense-mode | sparse-mode | sparse-dense-mode }</pre>
</div>
</div>
<div class="sect5">
<h6 id="_manually_assigning_an_rp_to_multicast_groups">Manually Assigning an RP to Multicast Groups</h6>
<div class="paragraph">
<p>Senders of multicast traffic announce their existence through register messages
received from the source&#8217;s first-hop router (designated router) and forwarded
to the RP. Receivers of multicast packets use RPs to join a multicast group by
using explicit join messages. RPs are not members of the multicast group;
rather, they serve as a meeting place for multicast sources and group members.</p>
</div>
<div class="paragraph">
<p>Configure the address of a PIM RP.</p>
</div>
<div class="paragraph">
<p>By default, no PIM RP address is configured. You must configure the IP address
of RPs on all routers and multilayer switches (including the RP). If there is
no RP configured for a group, the multilayer switch treats the group as dense,
using the dense-mode PIM techniques. A PIM device can use multiple RPs, but
only one per group.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For ip-address, enter the unicast address of the RP in dotted-decimal
notation.</p>
</li>
<li>
<p>(Optional) For access-list-number, enter an IP standard access list number
from 1 to 99. If no access list is configured, the RP is used for all groups.</p>
</li>
<li>
<p>(Optional) The override keyword means that if there is a conflict between the
RP configured with this command and one learned by Auto-RP or BSR, the RP
configured with this command prevails.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ip pim rp-address ip-address [access-list-number] [override]</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configure_auto_rp">Configure Auto-RP</h5>
<div class="paragraph">
<p>Configure another PIM device to be the candidate RP for local groups.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For interface-id, enter the interface type and number that identifies the RP
address. Valid interfaces include physical ports, port channels, and VLANs.</p>
</li>
<li>
<p>For scope ttl, specify the time-to-live value in hops. Enter a hop count that
is high enough so that the RP-announce messages reach all mapping agents in the
network. There is no default setting. The range is 1 to 255.</p>
</li>
<li>
<p>For <strong>group-list</strong> access-list-number, enter an IP standard access list number
from 1 to 99. If no access list is configured, the RP is used for all groups.</p>
</li>
<li>
<p>For interval seconds, specify how often the announcement messages must be
sent. The default is 60 seconds. The range is 1 to 16383.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ip pim send-rp-announce &lt;interface-id&gt; scope &lt;ttl&gt; group-list &lt;access-list-number&gt; interval &lt;seconds&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Find a multilayer switch whose connectivity is not likely to be interrupted,
and assign it the role of RP-mapping agent.</p>
</div>
<div class="paragraph">
<p>For scope ttl, specify the time-to-live value in hops to limit the RP discovery
packets. All devices within the hop count from the source device receive the
Auto-RP discovery messages. These messages tell other devices which group-to-RP
mapping to use to avoid conflicts (such as overlapping group-to-RP ranges).
There is no default setting. The range is 1 to 255.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ip pim send-rp-discovery scope &lt;1..255&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Configure PIM-SM interfaces to use dense mode to flood Auto-RP traffic to 224.0.1.39 and 224.0.1.40.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ip pim autorp listener</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_prevent_join_messages_to_false_rps">Prevent Join Messages to false RPs</h5>
<div class="paragraph">
<p>Determine whether the <strong>ip pim accept-rp</strong> command was previously configured
throughout the network by using the show running-config privileged EXEC
command. If the <strong>ip pim accept-rp</strong> command is not configured on any device, this
problem can be addressed later. In those routers es already
configured with the <strong>ip pim accept-rp</strong> command, you must enter the command again
to accept the newly advertised RP.</p>
</div>
<div class="paragraph">
<p>To accept all RPs advertised with Auto-RP and reject all other RPs by default,
use the <strong>ip pim accept-rp auto-rp</strong> global configuration command.</p>
</div>
<div class="paragraph">
<p>If all interfaces are in sparse mode, use a default-configured RP to support
the two well-known groups 224.0.1.39 and 224.0.1.40. Auto-RP uses these two
well-known groups to collect and distribute RP-mapping information. When this
is the case and the <strong>ip pim accept-rp auto-rp</strong> command is configured, another <strong>ip
pim accept-rp</strong> command accepting the RP must be configured as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Switch(config)# ip pim accept-rp 172.10.20.1 1
Switch(config)# access-list 1 permit 224.0.1.39
Switch(config)# access-list 1 permit 224.0.1.40</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_prevent_candidate_rp_spoofing">Prevent candidate RP spoofing</h5>
<div class="paragraph">
<p>Filter incoming RP announcement messages.</p>
</div>
<div class="paragraph">
<p>Enter this command on each mapping agent in the network.</p>
</div>
<div class="paragraph">
<p>Without this command, all incoming RP-announce messages are accepted by
default.</p>
</div>
<div class="paragraph">
<p>For <strong>rp-list</strong> access-list-number, configure an access list of candidate RP
addresses that, if permitted, is accepted for the group ranges supplied in the
group-list access-list-number variable. If this variable is omitted, the filter
applies to all multicast groups.</p>
</div>
<div class="paragraph">
<p>If more than one mapping agent is used, the filters must be consistent across
all mapping agents to ensure that no conflicts occur in the Group-to-RP mapping
information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ip pim rp-announce-filter rp-list &lt;access-list-number&gt; group-list &lt;access-list-number&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_define_the_pim_domain_border">Define the PIM domain border</h5>
<div class="paragraph">
<p>As IP multicast becomes more widespread, the chances of one PIMv2 domain
bordering another PIMv2 domain is increasing. Because these two domains
probably do not share the same set of RPs, BSR, candidate RPs, and candidate
BSRs, you need to constrain PIMv2 BSR messages from flowing into or out of the
domain. Allowing these messages to leak across the domain borders could
adversely affect the normal BSR election mechanism and elect a single BSR
across all bordering domains and co-mingle candidate RP advertisements,
resulting in the election of RPs in the wrong domain.</p>
</div>
<div class="paragraph">
<p>Define a PIM bootstrap message boundary for the PIM domain.</p>
</div>
<div class="paragraph">
<p>Enter this command on each interface that connects to other bordering PIM
domains. This command instructs the multilayer switch to neither send or
receive PIMv2 BSR messages on this interface as shown in Figure <a href="#bsr-boundaries">Constraining PIMv2 BSR Messages</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ip pim bsr-border</pre>
</div>
</div>
<div id="bsr-boundaries" class="imageblock">
<div class="content">
<img src="../images/pim-constraining-bsr-messages.png" alt="pim constraining bsr messages">
</div>
<div class="title">Figure 34. Constraining PIMv2 BSR Messages</div>
</div>
</div>
<div class="sect4">
<h5 id="_define_the_ip_multicast_boundary">Define the IP multicast boundary</h5>
<div class="paragraph">
<p>You define a multicast boundary to prevent Auto-RP messages from entering the
PIM domain. You create an access list to deny packets destined for 224.0.1.39
and 224.0.1.40, which carry Auto-RP information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ip multicast boundary &lt;access-list-number&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configure_candidate_bsrs">Configure candidate BSRs</h5>
<div class="paragraph">
<p>You can configure one or more candidate BSRs. The devices serving as candidate
BSRs should have good connectivity to other devices and be in the backbone
portion of the network.</p>
</div>
<div class="paragraph">
<p>Configure your multilayer switch to be a candidate BSR.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For interface-id, enter the interface type and number on this switch from which the BSR address is derived to make it a candidate. This interface must be enabled with PIM. Valid interfaces include physical ports, port channels, and VLANs.</p>
</li>
<li>
<p>For hash-mask-length, specify the mask length (32 bits maximum) that is to be ANDed with the group address before the hash function is called. All groups with the same seed hash correspond to the same RP. For example, if this value is 24, only the first 24 bits of the group addresses matter.</p>
</li>
<li>
<p>(Optional) For priority, enter a number from 0 to 255. The BSR with the larger priority is preferred. If the priority values are the same, the device with the highest IP address is selected as the BSR. The default is 0.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ip pim bsr-candidate &lt;interface-id&gt; &lt;hash-mask-length&gt; [priority]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configure_candidate_rps">Configure Candidate RPs</h5>
<div class="paragraph">
<p>You can configure one or more candidate RPs. Similar to BSRs, the RPs should
also have good connectivity to other devices and be in the backbone portion of
the network. An RP can serve the entire IP multicast address space or a portion
of it. Candidate RPs send candidate RP advertisements to the BSR. When deciding
which devices should be RPs, consider these options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a network of Cisco routers and multilayer switches where only Auto-RP is
used, any device can be configured as an RP.</p>
</li>
<li>
<p>In a network that includes only Cisco PIMv2 routers and multilayer switches
and with routers from other vendors, any device can be used as an RP.</p>
</li>
<li>
<p>In a network of Cisco PIMv1 routers, Cisco PIMv2 routers, and routers from
other vendors, configure only Cisco PIMv2 routers and multilayer switches as
RPs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configure your multilayer switch to be a candidate RP.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For interface-id, enter the interface type and number whose associated IP address is advertised as a candidate RP address. Valid interfaces include physical ports, port channels, and VLANs.</p>
</li>
<li>
<p>(Optional) For group-list access-list-number, enter an IP standard access list number from 1 to 99. If no group-list is specified, the multilayer switch is a candidate RP for all groups.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ip pim rp-candidate interface-id [group-list access-list-number]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delay_the_use_of_pim_shortest_path_tree">Delay the Use of PIM Shortest-Path Tree</h5>
<div class="paragraph">
<p>The change from shared to source tree happens when the first data packet
arrives at the last-hop router. This change occurs
because the <strong>ip pim spt-threshold</strong> interface configuration command controls that
timing; its default setting is 0 kbps.</p>
</div>
<div class="paragraph">
<p>The shortest-path tree requires more memory than the shared tree but reduces
delay. You might want to postpone its use. Instead of allowing the leaf router
to immediately move to the shortest-path tree, you can specify that the traffic
must first reach a threshold.</p>
</div>
<div class="paragraph">
<p>You can configure when a PIM leaf router should join the shortest-path tree for
a specified group. If a source sends at a rate greater than or equal to the
specified kbps rate, the multilayer switch triggers a PIM join message toward
the source to construct a source tree (shortest-path tree). If the traffic rate
from the source drops below the threshold value, the leaf router switches back
to the shared tree and sends a prune message toward the source.</p>
</div>
<div class="paragraph">
<p>You can specify to which groups the shortest-path tree threshold applies by
using a group list (a standard access list). If a value of 0 is specified or if
the group list is not used, the threshold applies to all groups.</p>
</div>
<div class="paragraph">
<p>Specify the threshold that must be reached before moving to shortest-path tree
(spt).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For kbps, specify the traffic rate in kilobits per second. The default is 0
kbps. The range is 0 to 4294967.</p>
</li>
<li>
<p>Specify infinity if you want all sources for the specified group to use the
shared tree, never switching to the source tree.</p>
</li>
<li>
<p>(Optional) For group-list access-list-number, specify the access list created
in Step 2. If the value is 0 or if the group-list is not used, the threshold
applies to all groups.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ip pim spt-threshold {kbps | infinity} [group-list access-list-number]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_modifying_the_pim_router_query_message_interval">Modifying the PIM Router-Query Message Interval</h5>
<div class="paragraph">
<p>PIM routers and multilayer switches send PIM router-query messages to determine
which device will be the DR for each LAN segment (subnet). The DR is
responsible for sending IGMP host-query messages to all hosts on the directly
connected LAN.</p>
</div>
<div class="paragraph">
<p>With PIM DM operation, the DR has meaning only if IGMPv1 is in use. IGMPv1 does
not have an IGMP querier election process, so the elected DR functions as the
IGMP querier. With PIM SM operation, the DR is the device that is directly
connected to the multicast source. It sends PIM register messages to notify the
RP that multicast traffic from a source needs to be forwarded down the shared
tree. In this case, the DR is the device with the highest IP address.</p>
</div>
<div class="paragraph">
<p>The default is 30 seconds. The range is 1 to 65535.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ip pim query-interval &lt;seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_verify_3">Verify</h5>
<div class="paragraph">
<p>Display information about interfaces configured for PIM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip pim interface [type number] [count]</pre>
</div>
</div>
<div class="paragraph">
<p>List the PIM neighbors discovered by the multilayer switch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip pim neighbor [type number]</pre>
</div>
</div>
<div class="paragraph">
<p>Display the elected BSR</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip pim bsr</pre>
</div>
</div>
<div class="paragraph">
<p>displays the RP that was selected for the specified group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip pim rp-hash group</pre>
</div>
</div>
<div class="paragraph">
<p>displays how the multilayer switch learns of the RP (through the BSR or the Auto-RP mechanism).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip pim rp [group-name | group-address | mapping]</pre>
</div>
</div>
<div class="paragraph">
<p>Display the RP routers associated with a sparse-mode multicast group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip pim rp [group-name | group-address]</pre>
</div>
</div>
<div class="paragraph">
<p>Display how the multilayer switch is doing Reverse-Path Forwarding</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show ip rpf {source-address | name}</pre>
</div>
</div>
<div class="paragraph">
<p>Query a multicast router  about which neighboring multicast devices are peering with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mrinfo [hostname | address] [source-address | interface]</pre>
</div>
</div>
<div class="paragraph">
<p>Display IP multicast packet rate and loss information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mstat source [destination] [group]</pre>
</div>
</div>
<div class="paragraph">
<p>Trace the path from a source to a destination branch for a multicast distribution tree for a given group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mtrace source [destination] [group]</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshoot_3">23.2.3. Troubleshoot</h4>
<div class="paragraph">
<p>When debugging interoperability problems between PIMv1 and PIMv2, check these
in the order shown:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify RP mapping with the show ip pim rp-hash privileged EXEC command,
making sure that all systems agree on the same RP for the same group.</p>
</li>
<li>
<p>Verify interoperability between different versions of DRs and RPs. Make sure
the RPs are interacting with the DRs properly (by responding with
register-stops and forwarding decapsulated data packets from registers).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="http://www.cisco.com/c/en/us/td/docs/ios/12&lt;4t/ip&gt;mcast/configuration/guide/mctlsplt.html#wp1061381">Load splitting IP multicast traffic over ECMP</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_misc">23.2.4. Misc</h4>
<div class="paragraph">
<p>TODO To be added in the text</p>
</div>
<table class="tableblock frame-none grid-rows spread">
<caption class="title">Table 14. PIM type code</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hello</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register Stop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Join/Prune</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootstrap</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assert</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Graft</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Graft-Ack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Candidate RP Advertisement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State Refresh</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DF Election</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11-14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unassigned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for extension of type space</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Define the ssm range of IP multicast addresses</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config)# ip pim [vrf name] ssm { default | range access-list-number}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>default</strong> defines the ssm range access list to 232/8</p>
</div>
<div class="paragraph">
<p>TODO: Need to delete section below.</p>
</div>
<div class="sect4">
<h5 id="_configure_the_ttl_threshold">Configure the TTL Threshold</h5>
<div class="paragraph">
<p>Each time an IP multicast packet is forwarded by the multilayer switch, the
time-to-live (TTL) value in the IP header is decremented by one. If the packet
TTL decrements to zero, the switch drops the packet. TTL thresholds can be
applied to individual interfaces of the multilayer switch to prevent multicast
packets with a TTL less than the TTL threshold from being forwarded out the
interface. TTL thresholds provide a simple method to prevent the forwarding of
multicast traffic beyond the boundary of a site or region, based on the TTL
field in a multicast packet. This is known as TTL scoping.</p>
</div>
<div class="paragraph">
<p>Figure 33-10 shows a multicast packet arriving on Gigabit Ethernet interface
0/2 with a TTL value of 24. Assuming that the RPF check succeeds and that
Gigabit Ethernet interfaces 0/1, 0/3, and 0/4 are all in the outgoing interface
list, the packet would normally be forwarded out these interfaces. Because some
TTL thresholds have been applied to these interfaces, the multilayer switch
makes sure that the packet TTL value, which is decremented by 1 to 23, is
greater than or equal to the interface TTL threshold before forwarding the
packet out the interface. In this example, the packet is forwarded out
interfaces 0/1 and 0/4, but not interface 0/3.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/multicast-ttl-threshold.png" alt="multicast ttl threshold">
</div>
</div>
<div class="paragraph">
<p>Figure 33-11 shows an example of TTL threshold boundaries being used to limit
the forwarding of multicast traffic. Company XYZ has set a TTL threshold of 100
on all routed interfaces at the perimeter of its network. Multicast
applications that constrain traffic to within the company&#8217;s network need to
send multicast packets with an initial TTL value set to 99. The engineering and
marketing departments have set a TTL threshold of 40 at the perimeter of their
networks; therefore, multicast applications running on these networks can
prevent their multicast transmissions from leaving their respective networks.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/multicast-ttl-boundaries.png" alt="multicast ttl boundaries">
</div>
</div>
<div class="paragraph">
<p>The default TTL value is 0 hops, which means that all multicast packets are
forwarded out the interface. The range is 0 to 255.</p>
</div>
<div class="paragraph">
<p>Only multicast packets with a TTL value greater than the threshold are
forwarded out the interface.</p>
</div>
<div class="paragraph">
<p>You should configure the TTL threshold only on routed interfaces at the
perimeter of the network.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ip multicast ttl-threshold _value_</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configure_an_ip_multicast_boundary">Configure an IP multicast boundary</h5>
<div class="paragraph">
<p>Like TTL thresholds, administratively-scoped boundaries can also be used to
limit the forwarding of multicast traffic outside of a domain or subdomain.
This approach uses a special range of multicast addresses, called
administratively-scoped addresses, as the boundary mechanism. If you configure
an administratively-scoped boundary on a routed interface, multicast traffic
whose multicast group addresses fall in this range can not enter or exit this
interface, thereby providing a firewall for multicast traffic in this address
range.</p>
</div>
<div class="paragraph">
<p>Figure 33-12 shows that Company XYZ has an administratively-scoped boundary set
for the multicast address range 239.0.0.0/8 on all routed interfaces at the
perimeter of its network. This boundary prevents any multicast traffic in the
range 239.0.0.0 through 239.255.255.255 from entering or leaving the network.
Similarly, the engineering and marketing departments have an
administratively-scoped boundary of 239.128.0.0/16 around the perimeter of
their networks. This boundary prevents multicast traffic in the range of
239.128.0.0 through 239.128.255.255 from entering or leaving their respective
networks.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/multicast-administratively-scoped-boundaries.png" alt="multicast administratively scoped boundaries">
</div>
<div class="title">Figure 35. Administratively-Scoped Boundaries</div>
</div>
<div class="paragraph">
<p>You can define an administratively-scoped boundary on a routed interface for
multicast group addresses. A standard access list defines the range of
addresses affected. When a boundary is defined, no multicast data packets are
allowed to flow across the boundary from either direction. The boundary allows
the same multicast group address to be reused in different administrative
domains.</p>
</div>
<div class="paragraph">
<p>The IANA has designated the multicast address range 239.0.0.0 to
239.255.255.255 as the administratively-scoped addresses. This range of
addresses can then be reused in domains administered by different
organizations. The addresses would be considered local, not globally unique.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(config-if)# ip multicast boundary _standard-access-list-number_</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_network_optimization">24. Network optimization</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ip_sla">24.1. IP SLA</h3>
<div class="ulist">
<ul>
<li>
<p><span class="menuseq"><span class="menu">Configuration Guides</span>&#160;&#9656; <span class="submenu">Network Mgt</span>&#160;&#9656; <span class="menuitem"><a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipsla/configuration/15-mt/sla-15-mt-book.html">IP SLA</span></span> </a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To implement IP SLAs network performance measurement,</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the IP SLAs responder</p>
</li>
<li>
<p>Configure the required IP SLAs operation type</p>
</li>
<li>
<p>Configure any options available</p>
</li>
<li>
<p>Configure threshold conditions</p>
</li>
<li>
<p>Schedule the operation</p>
</li>
<li>
<p>Run the operation for a period of time to gather statistics</p>
</li>
<li>
<p>Display and interpret the results with Cisco CLI or NMS with SNMP</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_ip_slas_operation_types">24.1.1. IP SLAs Operation types</h4>
<div class="ulist">
<ul>
<li>
<p>ICMP echo, jitter, path echo , path jitter</p>
</li>
<li>
<p>TCP connect</p>
</li>
<li>
<p>UDP echo, jitter</p>
</li>
<li>
<p>VoIP RTP, UDP jitter, gatekeeper registration delay, post-dial delay</p>
</li>
<li>
<p>HTTP, FTP, DNS, DHCP</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure basic IP SLAs ICMP echo operation on the source device</div>
<div class="content">
<pre>(config)# ip sla &lt;operation-number&gt;
(config-ip-sla)# icmp-echo {&lt;destination-ip-address&gt;| &lt;destination-hostname&gt;}
                    [source-ip {&lt;src-ip&gt; | src-hostname} | source-interface &lt;interface-name&gt;]
(config-ip-sla-echo)# frequency &lt;seconds&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ip_slas_responder">24.1.2. IP SLAs Responder</h4>
<div class="ulist">
<ul>
<li>
<p>for Cisco device only</p>
</li>
<li>
<p>listens on specific port for control protol messages send by IP SLA operation</p>
</li>
<li>
<p>on receipt of the control, open specified TCP or UDP port for specified duration</p>
</li>
<li>
<p>disables the port after reponding to the IP SLA packet or specified timeout</p>
</li>
<li>
<p>may use MD5 authentication for control message</p>
</li>
<li>
<p>takes two timestamps at the target devices to eliminate processing time</p>
</li>
<li>
<p>can track one-way delay, jitter, and directional packet loss</p>
</li>
<li>
<p>requires NTP synchronization except for one-way jitter measurement</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ip-sla-responder-timestamps.png" alt="IP SLA Responder Time Stamping">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ip_slas_operation_scheduling">24.1.3. IP SLAs Operation scheduling</h4>
<div class="listingblock">
<div class="title">Task: schedule IP SLA operation</div>
<div class="content">
<pre>(config)# ip sla schedule &lt;operation-number&gt;
                          [ life {forever} | &lt;seconds&gt; ]
                          [start-time {now | pending | after &lt;hh:mm:ss&gt; | [&lt;hh:mm:ss&gt;]}] [month day | day month } ]
                          [ageout &lt;seconds&gt;]
                          [recurring]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify IP SLA configuration</div>
<div class="content">
<pre># sh ip sla configuration</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can create a multioperation group</p>
<div class="ulist">
<ul>
<li>
<p>The frequency of all operations scheduled must be the same</p>
</li>
<li>
<p>The list of operation ID numbers must be limited to a max of 125 chars including commas</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: schedule a group of IP SLA Operations</div>
<div class="content">
<pre>(config)# ip sla group schedule &lt;group-operation-number&gt; &lt;operation-id-numbers&gt;
                          { schedule-period &lt;schedule-period-range | schedule-together }
                          [ frequency &lt;group-operation-frequency&gt; ]
                          [ life {forever} | &lt;seconds&gt; ]
                          [start-time {now | pending| after &lt;hh:mm:ss&gt; | [&lt;hh:mm:ss&gt;]}] [month day | day month } ]
                          [ageout &lt;seconds&gt;]
                          [recurring]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify IP SLA multioperation configuration</div>
<div class="content">
<pre># sh ip sla group schedule</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ip_slas_operation_threshold_monitoring">24.1.4. IP SLAs Operation Threshold Monitoring</h4>
<div class="ulist">
<ul>
<li>
<p>can send SNMP traps that are triggered by connection loss, timeout, round-trip time threshold,
average jitter threshold, one-way packet loss, one-way jitter, one-way mean opinion score, one-way latency</p>
</li>
<li>
<p>can trigger another IP SLA operation</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mpls_vpn_awareness">24.1.5. MPLS VPN awareness</h4>
<div class="ulist">
<ul>
<li>
<p>IP SLA operations can be configured for a specific VPN</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_history_statistics">24.1.6. History Statistics</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Aggregated statistics
</td>
<td class="hdlist2">
<p>By default, two hours of aggregated
statistics for each operation. Value from each operation cycle is aggregated
with the previously available data within a given hour.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Operation snapshot history
</td>
<td class="hdlist2">
<p>snapshot of data for each
operation instance that matches a configurable filter, such as all, over
threshold, or failures. The entire dataset is available and no aggregation
takes place.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Distribution statistics
</td>
<td class="hdlist2">
<p>frequency distribution over
configurable intervals. Each time IP SLAs starts an operation, a new history
bucket is created until the number of history buckets matches the specified
size or the lifetime of the operation expires. By default, the history for an
IP SLAs operation is not collected. If history is collected, each bucket
contains one or more history entries from the operation. History buckets do not
wrap.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting_tips">24.1.7. Troubleshooting tips</h4>
<div class="ulist">
<ul>
<li>
<p>If IP SLAs operation is not running and not generating stats,
add the <strong>verify-data</strong> command in ip sla configuration mode</p>
</li>
<li>
<p>Use <strong>debug ip sla trace</strong> and <strong>debug ip sla error</strong> commands</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enhanced_object_tracking">24.2. Enhanced Object Tracking</h3>
<div class="ulist">
<ul>
<li>
<p>separates definition of tracked object vs action to be taken when tracked object change</p>
</li>
<li>
<p>tracked object can be: interface, ip route or ip sla operation or list of objects</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_interface_tracking">24.2.1. Interface Tracking</h4>
<div class="ulist">
<ul>
<li>
<p>can be line protocol or ip route</p>
</li>
<li>
<p>may consider the carrier delay timer</p>
</li>
<li>
<p>may have a delay between the changes and the notification</p>
</li>
<li>
<p>may change the polling frequency</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_interface_line_protocol_tracking">Interface line protocol tracking</h5>
<div class="listingblock">
<div class="title">Task: Track the line protocol state of an interface</div>
<div class="content">
<pre>(config)# track &lt;object-number&gt; interface &lt;type number&gt; line protocol</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_interface_ip_routing_tracking">Interface IP routing tracking</h5>
<div class="ulist">
<ul>
<li>
<p>The IP routing State is up if</p>
<div class="ulist">
<ul>
<li>
<p>ip routing is enable and active on the interface</p>
</li>
<li>
<p>known  ip address ( static, dhcp , ppp/ipcp, unnumbered )</p>
</li>
<li>
<p>interface line protocol up</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Track the IP routing state of an interface</div>
<div class="content">
<pre>(config)# track &lt;object-number&gt; interface &lt;type number&gt; ip routing</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_eot_support_for_carrier_delay">EOT support for carrier delay</h5>
<div class="ulist">
<ul>
<li>
<p>If a link fails, by default there is a two-second timer that must expire
before an interface and the associated routes are declared as being down. If
a link goes down and comes back up before the carrier delay timer expires,
the down state is effectively filtered, and the rest of the software on the
switch is not aware that a link-down event occurred. You can extend the
timer up to 60 seconds.</p>
</li>
<li>
<p>When EOT is configured on an interface, the tracking may detect the interface
is down before a configured carrier-delay timer has expired. This is because
EOT looks at the interface state and does not consider the carrier delay
timer.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: (optional) Enables EOT to consider the carrier-delay timer when tracking the status of an interface.</div>
<div class="content">
<pre>(config-track)# carrier-delay</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: (Optional) Specifies a period of time (in seconds) to delay communicating state changes of a tracked object.</div>
<div class="content">
<pre>(config-track)# delay {up &lt;seconds&gt; [down &lt;seconds&gt;] | down &lt;seconds [up &lt;seconds&gt;]}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ip_route_tracking">24.2.2. IP route Tracking</h4>
<div class="ulist">
<ul>
<li>
<p>Up if the route exists in the RIB and the route is accessible</p>
</li>
<li>
<p>polls the ip route state every 15 seconds</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Track an ip route</div>
<div class="content">
<pre>(config)# track &lt;object-number&gt; ip route &lt;a.b.c.d/prefix&gt; reachability</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task:(Optional) Specifies the interval in which the tracking process polls the tracked object.</div>
<div class="content">
<pre>(config)# track timer ip route { &lt;seconds&gt; | msec &lt;milliseconds&gt; }</pre>
</div>
</div>
<div class="paragraph">
<p>TODO: scaled metrics</p>
</div>
</div>
<div class="sect3">
<h4 id="_ip_sla_operation_tracking">24.2.3. IP SLA operation tracking</h4>
<div class="ulist">
<ul>
<li>
<p>tracks the state or the reachability of IP SLA operations
-</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Track the reachability of an IP SLA host</div>
<div class="content">
<pre>(config)# track &lt;object-number&gt; ip sla &lt;operation-number&gt; reachability</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre># show track 3
Device# show track 3

Track 3
   IP SLA 1 reachability
   Reachability is Up
     1 change, last change 00:00:47
   Latest operation return code: over threshold
   Latest RTT (millisecs) 4
   Tracked by:
     HSRP Ethernet0/1 3</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tracked_list">24.2.4. Tracked list</h4>
<div class="ulist">
<ul>
<li>
<p>can be constructed with</p>
<div class="ulist">
<ul>
<li>
<p>boolean expression</p>
</li>
<li>
<p>treshold and weight</p>
</li>
<li>
<p>treshold and percentage</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure tracked list object with a boolean expression</div>
<div class="content">
<pre>(config)# track &lt;list-object-number&gt; list boolean {and | or}
(config-track)# object &lt;object-number&gt; [not]</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure tracked list object with threshold and weight</div>
<div class="content">
<pre>(config)# track &lt;list-object-number&gt; list treshold weight
(config-track)# object &lt;object-number&gt; [weight &lt;number]
(config-track)# object &lt;object-number&gt; [weight &lt;number]
(config-track)# treshold weight {up &lt;number&gt; | down &lt;number&gt;| up &lt;number&gt; down &lt;number&gt;  }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure tracked list object with threshold and percentage</div>
<div class="content">
<pre>(config)# track &lt;list-object-number&gt; list treshold percentage
(config-track)# object &lt;object-number&gt;
(config-track)# object &lt;object-number&gt;
(config-track)# treshold percentage {up &lt;number&gt; | down &lt;number&gt;| up &lt;number&gt; down &lt;number&gt;  }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure tracked list default</div>
<div class="content">
<pre>(config-track)# default { delay | object &lt;object-number&gt; | treshold percentage }</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_netflow">24.3. NetFlow</h3>
<div class="ulist">
<ul>
<li>
<p>Cisco IOS application</p>
</li>
<li>
<p>provides statistics on packets flowing through the routing</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_netflow_flows">24.3.1. NetFlow flows</h4>
<div class="ulist">
<ul>
<li>
<p>unidirectional stream of packets between a given source and destination</p>
</li>
<li>
<p>combination of 7 fields: source/destination IP address/Port number, layer 3 protocol type, ToS, input logical interface</p>
</li>
<li>
<p>can include accounting fields (such as AS number in v5)</p>
</li>
<li>
<p>stored/captured in <strong>netflow cache</strong></p>
</li>
<li>
<p>exported to the flow collector (NetFlow Collection Engine)</p>
</li>
<li>
<p>prerequisites</p>
<div class="ulist">
<ul>
<li>
<p>ip routing</p>
</li>
<li>
<p>cef, dcef or fast switching</p>
</li>
<li>
<p>enough CPU and memory</p>
</li>
</ul>
</div>
</li>
<li>
<p>data capture</p>
<div class="ulist">
<ul>
<li>
<p>from ingress: ip-to-ip, ip-to-mpls, FR and ATM terminated packets</p>
</li>
<li>
<p>for egress: ip-to-ip(with Netflow Accounting), mpls-to-ip (NetFlow MPLS Egress)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Enable NetFlow Capture</div>
<div class="content">
<pre>(config-if)# ip flow { ingress | egress }</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Verify that NetFlow is operational</div>
<div class="content">
<pre># sh ip cache [verbose] flow</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_netflow_version">24.3.2. NetFlow version</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
v5
</td>
<td class="hdlist2">
<p>-
-</p>
</td>
</tr>
<tr>
<td class="hdlist1">
v9
</td>
<td class="hdlist2">
<div class="ulist">
<ul>
<li>
<p>flexible and extensible</p>
</li>
<li>
<p>template based</p>
</li>
<li>
<p>uses 2 flow record type: template flowset, and data flowset</p>
</li>
<li>
<p>v5 and v9 use the same packet structure</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/netflow-packet.png" alt="netflow packet" width="754" height="41">
</div>
</div>
<div class="sect4">
<h5 id="_version_5_2">Version 5</h5>
<div class="imageblock">
<div class="content">
<img src="../images/netflow-header-v5.png" alt="NetFlow header format" width="896" height="344">
</div>
<div class="title">Figure 36. NetFlow header format</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/flow-record-v5.png" alt="Flow Record format" width="896" height="408">
</div>
<div class="title">Figure 37. Flow Record format</div>
</div>
</div>
<div class="sect4">
<h5 id="_version_9">Version 9</h5>
<div class="imageblock">
<div class="content">
<img src="../images/netflow-header-v9.png" alt="NetFlow header format" width="896" height="312">
</div>
<div class="title">Figure 38. NetFlow header format</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_netflow_cache">24.3.3. NetFlow Cache</h4>
<div class="ulist">
<ul>
<li>
<p>contains flow record for all active flows.</p>
</li>
<li>
<p>up to 64K flow entries, each cache entry requires 64 bytes</p>
</li>
<li>
<p>removes flows if</p>
<div class="ulist">
<ul>
<li>
<p>flow transport is completed (TCP  FIN or RST )</p>
</li>
<li>
<p>flow cache full</p>
</li>
<li>
<p>flow becomes inactive after 15 seconds</p>
</li>
<li>
<p>flow active for more than 30 minutes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Configure the size of the NetFlow cache</div>
<div class="content">
<pre>(config)# ip flow-cache entries &lt;size=64000&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the flow cache timeout for inactive flow</div>
<div class="content">
<pre>(config)# ip flow-cache timeout inactive &lt;seconds=15&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: Configure the flow cache timeout for active flows</div>
<div class="content">
<pre>(config)# ip flow-cache timeout active &lt;minutes=30&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_netflow_data_export">24.3.4. NetFlow Data Export</h4>
<div class="ulist">
<ul>
<li>
<p>Send NetFlow cache entries to workstation running NetFlow Collection Engine</p>
</li>
<li>
<p>supports only two export destinations</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Task: Export NetFlow information to a workstation</div>
<div class="content">
<pre>(config)# ip flow-export destination {&lt;ip-address | hostname} &lt;udp-port&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: (optional) Use version 5 Export Format</div>
<div class="content">
<pre>(config)# ip flow-export version 5</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: (optional) Use version 9 Export Format</div>
<div class="content">
<pre>(config)# ip flow-export version 9</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task: verify that NetFlow data export is operational</div>
<div class="content">
<pre># sh ip flow export</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<h1 id="_part_vi_evolving_technologies" class="sect0">Part VI : Evolving Technologies</h1>
<div class="sect1">
<h2 id="_cloud">25. cloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IT resources and sces that are abstracted from the underlying infrastructure
and provided <strong>on-demand</strong> and <strong>at scale</strong> in a <strong>multitenant</strong> environment.</p>
</div>
<div class="sect2">
<h3 id="_compare_and_contrast_cloud_deployment_models">25.1. Compare and contrast Cloud deployment models</h3>
<div class="ulist">
<ul>
<li>
<p>Public</p>
</li>
<li>
<p>Private</p>
</li>
<li>
<p>virtual Private</p>
</li>
<li>
<p>inter-cloud</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_infrastructure_platform_and_software_services_xaas">25.1.1. Infrastructure, platform, and software services [XaaS]</h4>
<div class="ulist">
<ul>
<li>
<p>SaaS : Application sces</p>
</li>
<li>
<p>PaaS: run-time environment and software development frameworks and components  presented as API</p>
</li>
<li>
<p>IaaS: compute, network and storage</p>
</li>
<li>
<p>IT foundation: basic building blocks, core technologies</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_performance_and_reliability">25.1.2. Performance and reliability</h4>
<div class="paragraph">
<p>add comparisons table here</p>
</div>
</div>
<div class="sect3">
<h4 id="_security_and_privacy">25.1.3. Security and privacy</h4>
<div class="paragraph">
<p>add comparison table here</p>
</div>
</div>
<div class="sect3">
<h4 id="_scalability_and_interoperability">25.1.4. Scalability and interoperability</h4>
<div class="paragraph">
<p>add comparison table here</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_describe_cloud_implementations_and_operations">25.2. Describe Cloud implementations and operations</h3>
<div class="paragraph">
<p>How to connect to the cloud</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Private WAN (like MPLS L3VPN)</p>
</li>
<li>
<p>Internet Exchange Point (IXP)</p>
</li>
<li>
<p>Internet VPN</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_automation_and_orchestration">25.2.1. Automation and orchestration</h4>
<div class="paragraph">
<p>Automation: single task
Orchestration: process/workflow ordered set of tasks glued together with conditions</p>
</div>
</div>
<div class="sect3">
<h4 id="_workload_mobility">25.2.2. Workload mobility</h4>
<div class="ulist">
<ul>
<li>
<p>share workloads accross a collection of resources</p>
</li>
<li>
<p>different from VM mobility</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting_and_management">25.2.3. Troubleshooting and management</h4>
<div class="ulist">
<ul>
<li>
<p>Scripting languages: Python, Ruby,</p>
</li>
<li>
<p>NETCONF</p>
<div class="ulist">
<ul>
<li>
<p>transport protocol by which configurations are installed and changed</p>
</li>
<li>
<p>RFC 6241</p>
</li>
</ul>
</div>
</li>
<li>
<p>YANG</p>
<div class="ulist">
<ul>
<li>
<p>modeling language used represent device configuration and state (~ XML)</p>
</li>
<li>
<p>RFC 6020</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_openstack_components">25.2.4. OpenStack components</h4>
<div class="paragraph">
<p>TODO: change this to a table</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Compute (Nova)
</td>
<td class="hdlist2">
<p>Fabric controller (the main part of an IaaS system). Manages pools of computer resources. A compute resource could be a VM, container, or bare metal server. Side note: Containers are similar to VMs except they share a kernel. They are otherwise independent, like VMs, and are considered a lighter-weight yet secure alternative to VMs.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Networking (Neutron)
</td>
<td class="hdlist2">
<p>Manages networks and IP addresses. Ensures the network is not a bottleneck or otherwise limiting factor in a production environment. This is technology-agnostic network abstraction which allows the user to create custom virtual networks, topologies, etc. For example, virtual network creation includes adding a subnet, gateway address, DNS, etc.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Block Storage (Cinder)
</td>
<td class="hdlist2">
<p>Manages creation, attaching, and detaching of block storage devices to servers. This is not an implementation of storage itself, but provides as API to access that storage. Many storage appliance vendors often have a Cinder plug-in for OpenStack integration; this ultimately abstracts the vendor-specific user interfaces from the management process. Storage volumes can be detached and moved between instances (an interesting form of file transfer, file example) to share information and migrate data between projects.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Identity (Keystone)
</td>
<td class="hdlist2">
<p>Directory service contains users mapped to services they can access. Somewhat similar to group policies applied in corporate deployments. Tenants are stored here which allows them to access resources/services within OpenStack; commonly this is access to the OpenStack Dashboard (Horizon) to manage an OpenStack environment.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Image (Glance)
</td>
<td class="hdlist2">
<p>Provides discovery, registration, and delivery services. These images are like ordinary images to template new virtual services.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Object Storage (Swift)
</td>
<td class="hdlist2">
<p>Storage system with built-in data replication and integrity. Objects and files are written to disk using this interface which manages the I/O details. Scalable and resilient storage for all objects like files, photos, etc. This means the customer doesn’t have to deploy a block-storage solution themselves, then manage the storage protocols (iSCSI, NFS, etc).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Dashboard (Horizon)
</td>
<td class="hdlist2">
<p>The GUI for administrators and users to access, provision, and automate resources. The dashboard is based on Python Django framework and is layered on top of service APIs. Logging in relies on Keystone for identity management which secures access to the GUI. The dashboard supports different tenants (business units, groups/teams, customers, etc) with separate permissions and credentials; this is effectively role-based access control. The GUI provides the most basic/common functionality for users without needing CLI access, which is supported for advanced functions. “Security group” abstractions to enforce access control (often need to configure this before being able to access the new instances).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Orchestration (Heat)
</td>
<td class="hdlist2">
<p>Service to orchestrate multiple cloud applications via templates using a variety of APIs.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Workflow (Mistral)
</td>
<td class="hdlist2">
<p>Manages user-created workflows which can be triggered manually or by some event.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Telemetry (Ceilometer)
</td>
<td class="hdlist2">
<p>Provides a Single Point of Contact for billing systems used within the cloud environment.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Database (Trove)
</td>
<td class="hdlist2">
<p>This is a Database-as-a-service provisioning engine.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Elastic Map Reduce (Sahara)
</td>
<td class="hdlist2">
<p>Automated way to provision Hadoop clusters, like a wizard.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Bare Metal (Ironic)
</td>
<td class="hdlist2">
<p>Provisions bare metal machines rather than virtual machines.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Messaging (Zaqar)
</td>
<td class="hdlist2">
<p>Cloud messaging service for Web Developments (full RESTful API) used to communicate between SaaS and mobile applications.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Shared File System (Manila)
</td>
<td class="hdlist2">
<p>Provides an API to manage shares in a vendor agnostic fashion (create, delete, grant/deny access, etc).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
DNS (Designate)
</td>
<td class="hdlist2">
<p>Multi-tenant REST API for managing DNS (DNS-as-a-service).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Search (Searchlight)
</td>
<td class="hdlist2">
<p>Provides search capabilities across various cloud services and is being integrated into the Dashboard.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Key Manager (Barbican)
</td>
<td class="hdlist2">
<p>Provides secure storage, provisioning, and management of secrets (passwords).</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_resources_and_references">25.2.5. Resources and References</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.cisco.com/c/dam/en_us/solutions/industries/docs/gov/CiscoCloudComputing_WP.pdf" class="bare">http://www.cisco.com/c/dam/en_us/solutions/industries/docs/gov/CiscoCloudComputing_WP.pdf</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/OpenStack#Components">Open Stack Components</a></p>
</li>
<li>
<p><a href="http://www.cisco.com/c/en/us/solutions/cloud/overview.html">Cloud Overview</a></p>
</li>
<li>
<p><a href="http://www.unleashingit.com/" class="bare">http://www.unleashingit.com/</a></p>
</li>
<li>
<p><a href="http://www.cisco.com/go/cloud" class="bare">http://www.cisco.com/go/cloud</a></p>
</li>
<li>
<p><a href="https://www.openstack.org/software/" class="bare">https://www.openstack.org/software/</a></p>
</li>
<li>
<p><a href="http://getcloudify.org/2014/07/18/openstack-wiki-open-cloud.html">Designing Networks and Services for the Cloud</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sdn">26. SDN</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_describe_functional_elements_of_network_programmability_and_how_they_interact">26.1. Describe functional elements of network programmability  and how they interact</h3>
<div class="paragraph">
<p>SDN: network programmability</p>
</div>
<div class="ulist">
<ul>
<li>
<p>distributed</p>
</li>
<li>
<p>augmented</p>
</li>
<li>
<p>hybrid</p>
</li>
<li>
<p>centralized</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_controllers">26.1.1. Controllers</h4>
<div class="ulist">
<ul>
<li>
<p>responsible for programming forwarding tables of data-plane devices</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_apis">26.1.2. APIs</h4>

</div>
<div class="sect3">
<h4 id="_scripting">26.1.3. Scripting</h4>

</div>
<div class="sect3">
<h4 id="_agents">26.1.4. Agents</h4>

</div>
<div class="sect3">
<h4 id="_northbound_vs_southbound_protocols">26.1.5. Northbound vs. Southbound protocols</h4>

</div>
</div>
<div class="sect2">
<h3 id="_describe_aspects_of_virtualization_and_automation_in_network_environments">26.2. Describe aspects of virtualization and automation in network environments</h3>
<div class="sect3">
<h4 id="_devops_methodologies_tools_and_workflows">26.2.1. DevOps methodologies, tools and workflows</h4>

</div>
<div class="sect3">
<h4 id="_network_application_function_virtualization_nfv_afv">26.2.2. Network/application function virtualization [NFV, AFV]</h4>

</div>
<div class="sect3">
<h4 id="_service_function_chaining">26.2.3. Service function chaining</h4>

</div>
<div class="sect3">
<h4 id="_performance_availability_and_scaling_considerations">26.2.4. Performance, availability, and scaling considerations</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internet_of_things">27. Internet of Things</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_describe_architectural_framework_and_deployment_considerations_for_internet_of_things_iot">27.1. Describe architectural framework and deployment considerations for Internet of Things [IoT]</h3>
<div class="sect3">
<h4 id="_performance_reliability_and_scalability">27.1.1. Performance, reliability and scalability</h4>

</div>
<div class="sect3">
<h4 id="_mobility">27.1.2. Mobility</h4>

</div>
<div class="sect3">
<h4 id="_security_and_privacy_2">27.1.3. Security and privacy</h4>

</div>
<div class="sect3">
<h4 id="_standards_and_compliance">27.1.4. Standards and compliance</h4>

</div>
<div class="sect3">
<h4 id="_migration">27.1.5. Migration</h4>

</div>
<div class="sect3">
<h4 id="_environmental_impacts_on_the_network">27.1.6. Environmental impacts on the network</h4>

</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2016-11-05 13:04:15 SAST
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>