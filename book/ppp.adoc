= PPP


== Concepts

- HDLC (high-level data link control) and PPP: layer 2 on point-to-point links
- ISO HDLC does not include a Type field , so the Cisco implementation adds a proprietary 2-byte Type field 

- hdlc : error detection, default on IOS serial links
- ppp : error detection, error recovery, standard protocol Type field, supports synchronous and asynchronous links

- hdlc vs ppp framing

// add a picture here pp 


=== PPP LCP

- LCP  (link control protocol) controls features independent of any Layer 3 protocol
- NCP ( network control protocol) for each protocol (IP, appletalk, )

- LCP operations:

- LCP features

- LQM link quality monitoring: drop if % of error frames above a configured value
- looped link detection: drop link if a router receives its own randomly chosen magic number
- layer 2 load balancing: fragment frames over multilink PPP
- authentication: chap, pap

==== configuration 

- minimal with *encapsulation ppp*
- optional authentication, quality 


=== multilink PPP

- originally intended to combine multiple ISDN B-channels without requiring any Layer 3 load balancing
- now load balance traffic accross any type of point-to-point serial link
- add a header ( 2 or 4 bytes ) to allow reassembly on the receiving end
- configuration with multilink interfaces or virtual templates

// add example

 - LFI (link fragmentation and interleaving ) 
 - prevents small, delay sensitive packets from having to wait on longer, delay-insensitive packets to be completely serialized out an interface.
 - the queuing scheduler generally LLQ on the multilink interface determines the next packet to send:

// add fig 15-2


==== configuration

ppp multilink interleave 
ppp multilink fragment-delay ms  defines the fragment size based on size = x * bandwidth


=== ppp compression

- use L2 payload compression ( ip + tcp + data + DL) : best with longer packet
- TCP header compression ( ip + tcp )
- RTP header compression (ip + udp + rtp)

- payload compression works best with longer packets, and header with shorter packets
- header compression : achieves better compression ration 10:1 to 20:1 

==== layer 2 compression

- options: LZS (Lempel-Ziv Stacker), MPPC (microsoft point-to-point compression), Predictor
- LZS use more CPU and less RAM than Predictor algorithm and have better compression ratio

- stacker: supports hdlc, ppp, FR, ATM
- mppc: ppp, atm
- predictor: ppp, atm

- configuration with a matching *compress* command under each interface on both end of the links
- once configured, ppp starts ccp (compression control protocol) which is another NCP

==== header compression

- configured with legacy commands or MQC commands
- legacy under the serial (ppp) or multilink interface 
  - *ip tcp header-compression [passive]* 
  - *ip rtp header-compression [passive]* 

- add also MQC commands

// add examples


== Configuration tasks


----
debug ppp authentication
----

read also http://www.cisco.com/c/en/us/support/docs/wan/point-to-point-protocol-ppp/25440-debug-ppp-negotiation.html#sampdebug[understanding debug ppp negotiation]



== PPPoE


 - used for digital subscriber line (DSL) Internet access 
 because the public telephone network uses ATM for its transport protocol;
 therefore, Ethernet frames must be encapsulated in a protocol supported over both Ethernet and ATM.  

-  The PPP Client feature permits a Cisco IOS router, rather than an endpoint host, to serve as the client
 in a network. This permits multiple hosts to connect over a single PPPoE connection.

 - In a DSL environment, PPP interface IP addresses are derived from an upstream DHCP server
 using IP Configuration Protocol (IPCP). Therefore, IP address negotiation must be enabled on the
 routerâ€™s dialer interface. This is done using the ip address negotiated command in the dialer
 interface configuration.

 - Because of the 8-byte PPP header, the MTU for PPPoE is usually set to 1492 bytes so that the
 entire encapsulated frame fits within the 1500-byte Ethernet frame. A maximum transmission unit
 (MTU) mismatch prevents a PPPoE connection from coming up. Checking the MTU setting is a
 good first step when troubleshooting PPPoE connections.


== Configuration tasks

Example

image::images/pppoe-topology-example.png[height=150]


Example of config on the Edge router

----
# conf t
(config)# interface fa0/1
(config-if)# ip address 192.168.100.1 255.255.255.0
(config-if)# ip nat inside
(config)# interface fa0/1
(config-if)# pppoe-client dial-pool-number 1
(config-if)# exit
(config)# interface dialer1
(config-if)# mtu 1492
(config-if)# encapsulation ppp
(config-if)# ip address negotiated
(config-if)# ppp authentication chap

!The remaining CHAP commands have been omitted for brevity.

(config-if)# ip nat outside
(config-if)# dialer pool 1
(config-if)# dialer-group 1
(config-if)# exit
(config)# dialer-list 1 protocol ip permit
(config)# ip nat inside source list 1 interface dialier1 overload
(config)# access-list 1 permit 192.168.100.0 0.0.0.255
(config)# ip route 0.0.0.0 0.0.0.0 dialer1
----

Verify PPPoE connectivity 

----
show pppoe session
----

Debug 

----
debug pppoe [data | errors | events | packets]
----

